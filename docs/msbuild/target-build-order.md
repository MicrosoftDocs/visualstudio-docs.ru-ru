---
title: Порядок сборки целевых объектов | Документы Майкрософт
description: Узнайте, как указать порядок выполнения целевых объектов MSBuild, если входные данные одного целевого объекта зависят от выходных данных другого.
ms.custom: SEO-VS-2020
ms.date: 05/02/2019
ms.topic: conceptual
helpviewer_keywords:
- msbuild, build order
ms.assetid: f4a26339-9f9a-497a-9aa6-0797183d450d
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 873f669890e84281f73a96fa1739d267c10e83a1
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99966140"
---
# <a name="target-build-order"></a>Порядок сборки целевого объекта

Целевые объекты необходимо упорядочить, если входные данные для одного целевого объекта зависят от выходных данных другого целевого объекта. Эти атрибуты можно использовать для задания порядка выполнения целевых объектов:

- `InitialTargets`. Этот атрибут `Project` указывает целевые объекты, которые будут выполняться первыми, даже если целевые объекты указаны в командной строке или в атрибуте `DefaultTargets`.

- `DefaultTargets`. Этот атрибут `Project` указывает целевые объекты, которые будут выполняться, если целевой объект не указан явно в командной строке.

- `DependsOnTargets`. Этот атрибут `Target` указывает целевые объекты, которые необходимо выполнить перед запуском этого целевого объекта.

- `BeforeTargets` и `AfterTargets`. Эти атрибуты `Target` указывают, что этот целевой объект должен выполняться до или после указанных целевых объектов (MSBuild 4.0).

Целевой объект никогда не выполняется дважды во время сборки, даже если от него зависит последующий целевой объект в сборке. После запуска целевого объекта его участие в сборке завершается.

Целевые объекты могут иметь атрибут `Condition`. Если указанное условие имеет значение `false`, целевой объект не выполняется и не влияет на сборку. Дополнительные сведения об условиях см. в разделе [Условия](../msbuild/msbuild-conditions.md).

## <a name="initial-targets"></a>Начальные целевые объекты

Атрибут `InitialTargets` элемента [Project](../msbuild/project-element-msbuild.md) указывает целевые объекты, которые будут выполняться первыми, даже если целевые объекты указаны в командной строке или в атрибуте `DefaultTargets`. Начальные целевые объекты обычно используются для проверки ошибок.

Значение атрибута `InitialTargets` может представлять собой разделенный точкой с запятой упорядоченный список целевых объектов. В следующем примере указывается, что выполняется целевой объект `Warm`, а затем целевой объект `Eject`.

```xml
<Project InitialTargets="Warm;Eject" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
```

Импортированные проекты могут иметь собственные атрибуты `InitialTargets`. Все начальные целевые объекты собираются вместе и выполняются по порядку.

Дополнительные сведения см. в [практическом руководстве по выбору цели для первой сборки](../msbuild/how-to-specify-which-target-to-build-first.md).

## <a name="default-targets"></a>Целевые объекты по умолчанию

Атрибут `DefaultTargets` элемента [Project](../msbuild/project-element-msbuild.md) указывает, какой целевой объект или целевые объекты создаются, если целевой объект не задан явным образом в командной строке.

Значение атрибута `DefaultTargets` может представлять собой разделенный точкой с запятой упорядоченный список целевых объектов по умолчанию. В следующем примере указывается, что выполняется целевой объект `Clean`, а затем целевой объект `Build`.

```xml
<Project DefaultTargets="Clean;Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
```

Целевые объекты по умолчанию можно переопределить с помощью параметра командной строки **-target**. В следующем примере указывается, что выполняется целевой объект `Build`, а затем целевой объект `Report`. При указании целевых объектов таким образом все целевые объекты по умолчанию игнорируются.

 `msbuild -target:Build;Report`

Если указаны начальные целевые объекты и целевые объекты по умолчанию, и не указаны целевые объекты командной строки, MSBuild сначала выполняет начальные целевые объекты, а затем целевые объекты по умолчанию.

Импортированные проекты могут иметь собственные атрибуты `DefaultTargets`. Первый атрибут `DefaultTargets` определяет, какие целевые объекты по умолчанию будут выполняться.

Дополнительные сведения см. в [практическом руководстве по выбору цели для первой сборки](../msbuild/how-to-specify-which-target-to-build-first.md).

## <a name="first-target"></a>Первый целевой объект

Если начальные целевые объекты, целевые объекты по умолчанию или целевые объекты командной строки отсутствуют, MSBuild сначала выполняет первый обнаруженный целевой объект в файле проекта или любом импортированном файле проекта.

## <a name="target-dependencies"></a>Зависимости целевого объекта

Целевые объекты могут описывать отношения зависимости друг от друга. Атрибут `DependsOnTargets` указывает, что целевой объект зависит от других целевых объектов. Например, примененная к объекту директива

```xml
<Target Name="Serve" DependsOnTargets="Chop;Cook" />
```

сообщает MSBuild, что целевой объект `Serve` зависит от целевых объектов `Chop` и `Cook`. MSBuild выполняет целевой объект `Chop`, а затем выполняет объект `Cook` перед выполнением `Serve`.

## <a name="beforetargets-and-aftertargets"></a>Целевые объекты, выполняемые до и после заданного целевого объекта

В MSBuild 4.0 можно указать порядок целевых объектов с помощью атрибутов `BeforeTargets` и `AfterTargets`.

Рассмотрим следующий сценарий.

```xml
<Project DefaultTargets="Compile;Link" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="Compile">
        <Message Text="Compiling" />
    </Target>
    <Target Name="Link">
        <Message Text="Linking" />
    </Target>
</Project>
```

Чтобы создать промежуточный целевой объект `Optimize`, который будет выполняться после объекта `Compile`, но до объекта `Link`, добавьте следующий целевой объект в любое место элемента `Project`.

```xml
<Target Name="Optimize"
    AfterTargets="Compile" BeforeTargets="Link">
    <Message Text="Optimizing" />
</Target>
```

## <a name="determine-the-target-build-order"></a>Определение порядка сборки целевых объектов

MSBuild определяет порядок сборки целевых объектов следующим образом.

1. Выполняются целевые объекты `InitialTargets`.

2. Выполняются целевые объекты, заданные в командной строке параметром **-target**. Если целевые объекты не указаны в командной строке, выполняются целевые объекты `DefaultTargets`. Если оба типа отсутствуют, выполняется первый обнаруженный целевой объект.

3. Выполняется оценка атрибута `Condition` целевого объекта. Если атрибут `Condition` присутствует и имеет значение `false`, целевой объект не выполняется и не влияет на сборку.

   Другие целевые объекты, в которых указываются условные целевые объекты в `BeforeTargets` или `AfterTargets`, по-прежнему выполняются в предписанном порядке.

4. Прежде чем целевой объект выполняется или пропускается, выполняются его целевые объекты `DependsOnTargets`, если атрибут `Condition` не применяется к целевому объекту и не дает в результате `false`.

   > [!NOTE]
   > Целевой объект считается пропущенным, если он не выполняется, так как его выходные элементы актуальны (см. раздел [Инкрементная сборка](../msbuild/incremental-builds.md)). Эта проверка выполняется непосредственно перед выполнением задач в целевом объекте и не влияет на порядок выполнения целевых объектов.

5. Перед выполнением или пропуском целевого объекта выполняются все прочие целевые объекты, у которых он указан в атрибуте `BeforeTargets`.

6. Перед выполнением целевого объекта сравниваются его атрибуты `Inputs` и `Outputs`. Если MSBuild определяет, что какие-либо выходные файлы неактуальны по отношению к соответствующему входному файлу или файлам, то MSBuild выполняет целевой объект. В противном случае MSBuild пропускает целевой объект.

7. После выполнения или пропуска целевого объекта выполняются все прочие целевые объекты, у которых он указан в атрибуте `AfterTargets`.

## <a name="see-also"></a>См. также

- [Целевые объекты](../msbuild/msbuild-targets.md)
