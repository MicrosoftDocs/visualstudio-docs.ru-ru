---
title: Создание модульных тестов для библиотек DLL на C++
description: Узнайте о нескольких способах протестировать код библиотеки DLL в зависимости от того, экспортирует ли DLL функции, которые требуется проверить.
ms.custom: SEO-VS-2020
ms.date: 02/16/2021
ms.topic: how-to
ms.author: corob
manager: markl
ms.workload:
- cplusplus
author: corob-msft
ms.openlocfilehash: 6e8df96c6345d84531ef04eae56f7f60dcc3eefe
ms.sourcegitcommit: 4b2b6068846425f6964c1fd867370863fc4993ce
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/12/2021
ms.locfileid: "112042877"
---
# <a name="write-unit-tests-for-c-dlls-in-visual-studio"></a>Написание модульных тестов для библиотек DLL на C++ в Visual Studio

Существует несколько способов протестировать код библиотеки DLL в зависимости от того, экспортирует ли он функции, которые требуется проверить. Выберите один из следующих вариантов:

**Модульные тесты вызывают только функции, экспортированные из библиотеки DLL:** добавьте отдельный тестовый проект, как описывается в статье [Создание модульных тестов для C/C++](writing-unit-tests-for-c-cpp.md). В тестовом проекте добавьте ссылку на проект библиотеки DLL.

Перейдите к процедуре [Создание ссылки на экспортируемые функции из проекта библиотеки DLL](#projectRef).

**Сборка библиотеки DLL выполняется в виде файла EXE.** Добавьте отдельный тестовый проект. Привяжите его к выходному объектному файлу.

Перейдите к процедуре [Связывание тестов с объектным файлом или файлом библиотеки](#objectRef).

**Модульные тесты вызывают не являющиеся участниками функции, которые не экспортируются из библиотеки DLL; сборка библиотеки DLL может быть выполнена в виде статической библиотеки:** измените проект библиотеки DLL так, чтобы он компилировался в *LIB*-файл. Добавьте отдельные тестовый проект со ссылкой на тестируемый проект.

Этот подход имеет то преимущество, что вы можете использовать члены, которые не экспортируются, но тесты по-прежнему содержатся в отдельном проекте.

Перейдите к процедуре [Преобразование библиотеки DLL в статическую библиотеку](#staticLink).

**Модульные тесты должны вызывать не являющиеся участниками функции, которые не экспортируются, и сборку кода необходимо выполнить в виде библиотеки динамической компоновки (DLL):** добавьте модульные тесты в тот же проект, в котором находится код продукта.

Перейдите к процедуре [Добавление модульных тестов в тот же проект](#sameProject).

## <a name="create-the-tests"></a>Создание тестов

### <a name="to-change-the-dll-to-a-static-library"></a><a name="staticLink"></a> Преобразование библиотеки DLL в статическую библиотеку

- Если тесты должны использовать участники, которые не экспортируются проектом библиотеки DLL, а сборка тестируемого проекта выполнена в виде динамической библиотеки, то следует преобразовать его в статическую библиотеку.

  1. В **обозревателе решений** в контекстном меню тестируемого проекта выберите пункт **Свойства**. Откроется окно **свойств** проекта.

  2. Выберите **Свойства конфигурации** > **Общие**.

  3. Установите для свойства **Тип конфигурации** значение **Статическая библиотека (.lib)**.

  Продолжите выполнение процедуры [Связывание тестов с объектным файлом или файлом библиотеки](#objectRef).

### <a name="to-reference-exported-dll-functions-from-the-test-project"></a><a name="projectRef"></a> Создание ссылки на экспортируемые функции библиотеки DLL из тестового проекта

- Если проект библиотеки DLL экспортирует функции, которые необходимо протестировать, можно добавить ссылку на проект кода из тестового проекта.

  1. Создание проекта машинного модульного теста

      ::: moniker range=">=vs-2019"

      1. В меню **Файл** последовательно выберите пункты **Создать** > **Проект**. В диалоговом окне **Добавление нового проекта** задайте **Язык** как C++ и введите "тест" в поле поиска. Выберите шаблон **Проект машинного модульного теста**.

      ::: moniker-end

      ::: moniker range="vs-2017"

      1. В меню **Файл** выберите **Создать** > **Проект** > **Visual C++** > **Тест** > **Проект модульного теста C++**.

      ::: moniker-end

  1. В **обозревателе решений** щелкните правой кнопкой мыши тестовый проект и выберите **Добавить** > **Ссылка**.

  1. Выберите **Проекты**, а затем тестируемый проект.

       Выберите кнопку **Добавить**.

  1. В свойствах тестового проекта добавьте расположение тестируемого проекта в каталоги включения.

       Выберите **Свойства конфигурации** > **Каталоги VC++**  > **Каталоги включаемых файлов**.

       Выберите **Изменить**, а затем добавьте каталог заголовков тестируемого проекта.

  Перейдите к разделу [Написание модульных тестов](#addTests).

### <a name="to-link-the-tests-to-the-object-or-library-files"></a><a name="objectRef"></a> Связывание тестов с объектным файлом или файлом библиотеки

- Если библиотека DLL не экспортирует функции, которые необходимо протестировать, можно добавить файл выходных данных *OBJ* или *LIB* в зависимости тестового проекта.

  1. Создание проекта машинного модульного теста

      ::: moniker range=">=vs-2019"

      1. В меню **Файл** последовательно выберите пункты **Создать** > **Проект**. В диалоговом окне **Добавление нового проекта** задайте **Язык** как C++ и введите "тест" в поле поиска. Выберите шаблон **Проект машинного модульного теста**.

      ::: moniker-end

      ::: moniker range="vs-2017"

      1. В меню **Файл** выберите **Создать** > **Проект** > **Visual C++** > **Тест** > **Проект модульного теста C++**.

      ::: moniker-end

  1. В **обозревателе решений** в контекстном меню тестового проекта выберите пункт **Свойства**.

  1. Выберите **Свойства конфигурации** > **Компоновщик** > **Ввод** > **Дополнительные зависимости**.

       Выберите **Изменить** и добавьте имена файлов **.obj** или **.lib**. Не используйте полные пути.

  1. Выберите **Свойства конфигурации** > **Компоновщик** > **Общие** > **Дополнительные каталоги библиотек**.

       Выберите **Изменить** и добавьте путь к каталогу файлов **.obj** или **.lib**. Путь обычно находится внутри папки построения тестируемого проекта.

  1. Выберите **Свойства конфигурации** > **Каталоги VC++**  > **Каталоги включаемых файлов**.

       Выберите **Изменить**, а затем добавьте каталог заголовков тестируемого проекта.

  Перейдите к разделу [Написание модульных тестов](#addTests).

### <a name="to-add-unit-tests-in-the-same-project"></a><a name="sameProject"></a> Добавление модульных тестов в тот же проект

1. Измените свойства проекта кода продукта для того, чтобы он включал заголовки и файлы библиотек, которые необходимы для модульного тестирования.

   1. В **обозревателе решений** в контекстном меню тестируемого проекта выберите пункт **Свойства**. Откроется окно **свойств** проекта.

   1. Выберите **Свойства конфигурации** > **Каталоги VC++** .

   1. Измените каталоги включения и библиотек:

       |Каталог|Свойство.|
       |-|-|
       |**Каталоги включаемых файлов** | **$(VCInstallDir)Auxiliary\VS\UnitTest\include** |
       |**Каталоги библиотек** | **$(VCInstallDir)Auxiliary\VS\UnitTest\lib** |

1. Добавьте файл модульного тестирования С++:

   1. Щелкните правой кнопкой мыши узел проекта в **обозревателе решений** и последовательно выберите **Добавить** > **Новый элемент**.

   1. В диалоговом окне **Добавление нового элемента** выберите **Файл C++ (CPP)** , присвойте ему имя и нажмите **Добавить**.

   Перейдите к разделу [Написание модульных тестов](#addTests).

## <a name="write-the-unit-tests"></a><a name="addTests"></a> Написание модульных тестов

1. В каждом файле кода модульного теста добавьте оператор `#include` для заголовков тестируемого проекта.

1. Добавьте тестовые классы и методы в файлы кода модульного теста. Пример:

    ```cpp
    #include "stdafx.h"
    #include "CppUnitTest.h"
    #include "MyProjectUnderTest.h"
    using namespace Microsoft::VisualStudio::CppUnitTestFramework;
    namespace MyTest
    {
      TEST_CLASS(MyTests)
      {
      public:
          TEST_METHOD(MyTestMethod)
          {
              Assert::AreEqual(MyProject::Multiply(2,3), 6);
          }
      };
    }
    ```

## <a name="run-the-tests"></a>Запуск тестов

1. В меню **Тест** выберите пункт **Windows** > , а затем пункт **Обозреватель тестов**.

1. Если в окне видны не все тесты, выполните сборку тестового проекта, щелкнув его узел в **обозревателе решений** правой кнопкой мыши и выбрав пункт **Сборка** или **Перестроить**.

1. В **обозревателе тестов** нажмите **Запустить все** или выберите тесты, которые следует запустить. Щелкните тест правой кнопкой мыши, чтобы получить доступ к другим командам, например, для запуска теста в режиме отладки с включенными точками останова.

## <a name="see-also"></a>См. также раздел

- [Написание модульных тестов для C/C++](writing-unit-tests-for-c-cpp.md)
- [Справочник по API Microsoft.VisualStudio.TestTools.CppUnitTestFramework](../test/microsoft-visualstudio-testtools-cppunittestframework-api-reference.md)
- [Отладка машинного кода](../debugger/debugging-native-code.md)
- [Пошаговое руководство. Создание и использование библиотеки DLL (C++)](/cpp/build/walkthrough-creating-and-using-a-dynamic-link-library-cpp)
- [Импорт и экспорт](/cpp/build/importing-and-exporting)
- [Краткое руководство. Разработка на основе тестирования с помощью обозревателя тестов](../test/quick-start-test-driven-development-with-test-explorer.md)
