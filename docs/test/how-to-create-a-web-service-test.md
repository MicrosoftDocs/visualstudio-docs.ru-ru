---
title: Создание теста веб-службы
description: Сведения о том, как использовать тесты производительности для веб-служб и настроить запросы в редакторе веб-тестов производительности для нахождения страниц веб-служб.
ms.custom: SEO-VS-2020
ms.date: 06/30/2020
ms.topic: how-to
helpviewer_keywords:
- Web performance tests, creating Web service tests
- Web services [Visual Studio ALM], creating
- service tests, Web
ms.assetid: fbcd57ee-06ad-4260-8694-09f8e0f93e39
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.openlocfilehash: 2d368ca7cbe64f2c0e8c8dc5e18e5f3c7145274c
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99949848"
---
# <a name="how-to-create-a-web-service-test"></a>Практическое руководство. Практическое руководство. Создание теста веб-службы

Для проверки веб-служб можно использовать веб-тесты производительности. С помощью параметров **Вставить запрос** и **Вставить запрос веб-службы** можно настроить отдельные запросы в **редакторе веб-тестов производительности**, чтобы найти страницы веб-службы. Обычно эти страницы не отображаются в веб-приложениях. Поэтому для получения доступа к этим страницам нужно настроить запрос.

>[!NOTE]
> Функция веб-тестов производительности и нагрузочных тестов признана нерекомендуемой в Visual Studio 2019. Для Application Insights многошаговые веб-тесты зависят от файлов веб-тестов в Visual Studio. Как было [объявлено](https://devblogs.microsoft.com/devops/cloud-based-load-testing-service-eol/) ранее, Visual Studio 2019 станет последней версией с поддержкой веб-тестов. При этом важно отметить следующее. Несмотря на отсутствие новых возможностей, предоставляемые возможности веб-тестов будут доступными в Visual Studio 2019 в течение всего жизненного цикла поддержки этого продукта. Группа разработчиков Azure Monitor ответила на многие вопросы о перспективах многоэтапных тестов доступности — см. [здесь](https://github.com/MicrosoftDocs/azure-docs/issues/26050#issuecomment-468814101).

**Требования**

Visual Studio Enterprise

## <a name="to-create-a-simple-web-service"></a>Создание простой веб-службы

Для тестирования можно использовать собственную веб-службу или шаблон базовой веб-службы (ASMX), входящий в состав Visual Studio. Чтобы создать простую веб-службу с помощью этого шаблона, выполните приведенные ниже действия.

1. В Visual Studio создайте проект, используя шаблон веб-приложения ASP.NET (.NET Framework), и при появлении запроса выберите шаблон **Пустой**. Введите имя и создайте проект.

1. В обозревателе решений щелкните узел проекта правой кнопкой мыши и выберите **Добавить** > **Новый элемент**, а затем выберите **Веб-служба (ASMX)** . Добавьте веб-службу.

1. Откройте файл *WebService1.asmx* и замените веб-метод по умолчанию `HelloWorld` на следующий код.

   ```csharp
   public string HelloWorld(string str)
   {
      return "Hello, " + str;
   }
   ```

## <a name="install-the-load-testing-component"></a>Установка компонента нагрузочного тестирования

Если у вас еще не установлен компонент инструментов веб-тестирования производительности и нагрузочного тестирования, необходимо сделать это с помощью установщика Visual Studio Installer.

1. **Visual Studio Installer** можно также открыть из меню **Пуск** в Windows. Кроме того, это приложение можно запустить из Visual Studio. Для этого откройте диалоговое окно "Новый проект" или выберите **Сервис** > **Получить средства и компоненты** в строке меню.

1. В приложении **Visual Studio Installer** перейдите на вкладку **Отдельные компоненты** и выполните прокрутку вниз до раздела **Отладка и тестирование**. Выберите **Инструменты веб-тестирования производительности и нагрузочного тестирования**.

   ![Компонент "Инструменты веб-тестирования производительности и нагрузочного тестирования"](media/web-perf-load-testing-tools-component.png)

1. Нажмите кнопку **Изменить**.

   Будет установлен компонент "Инструменты веб-тестирования производительности и нагрузочного тестирования".

## <a name="create-a-web-test-project"></a>Создание проекта веб-теста

Для веб-теста требуется шаблон "Проект веб-тестов производительности и нагрузочных тестов". В этом разделе мы создадим проект нагрузочного тестирования C#. При необходимости вы также можете создать проект нагрузочного тестирования Visual Basic.

::: moniker range="vs-2017"

1. Запустите Visual Studio.

   Если вы используете пример шаблона веб-службы (ASMX), проект веб-теста можно добавить в то же решение.

2. В строке меню щелкните **Файл** > **Создать** > **Проект**.

   Откроется диалоговое окно **Новый проект** .

3. В диалоговом окне **Новый проект** разверните узлы **Установленные** и **Visual C#** , после чего выберите категорию **Тест**. Выберите шаблон **Проект веб-тестов производительности и нагрузочных тестов**.

   ![Шаблон "Проект веб-тестов производительности и нагрузочных тестов"](media/web-perf-load-test-project-template.png)

4. Если вы не хотите использовать предлагаемое по умолчанию имя проекта, введите нужное имя и нажмите кнопку **ОК**.

::: moniker-end

::: moniker range=">=vs-2019"

1. Запустите Visual Studio.

   Если вы используете пример шаблона веб-службы (ASMX), проект веб-теста можно добавить в то же решение.

2. На начальном экране выберите **Создать проект**.

3. На странице **Создание проекта** введите **веб-тест** в поле поиска и в результатах выберите шаблон для C# **Проект веб-тестов производительности и нагрузочных тестов \[Нерекомендуемое]** . Нажмите кнопку **Далее**.

4. Если вы не хотите использовать предлагаемое по умолчанию имя проекта, введите нужное имя и нажмите кнопку **Создать**.

::: moniker-end

   Visual Studio создаст проект и отобразит его файлы в **обозревателе решений**. Изначально проект содержит один файл веб-теста с именем *WebTest1.webtest*.

## <a name="to-test-a-web-service"></a>Тестирование веб-службы

1. Запустите веб-службу и при необходимости выберите **Остановить**, чтобы приостановить работу службы.

1. В проекте веб-теста щелкните *WebTest1.webtest*, который откроется в редакторе веб-тестов производительности. В редакторе тестов щелкните правой кнопкой мыши веб-тест производительности и выберите **Добавить запрос веб-службы**.

1. В свойстве **URL-адрес** нового запроса введите имя веб-службы, например **https://localhost:44318/WebService1.asmx** .

1. В веб-службе откройте отдельный сеанс браузера и введите URL-адрес страницы *.asmx* в панели инструментов **Адрес**. В верхней части веб-страницы выберите метод, который нужно протестировать, и прочтите сообщение SOAP. (В примере веб-службы используется метод HelloWorld.) При открытии метода вы увидите, что он содержит `SOAPAction`.

1. В **редакторе веб-тестов производительности** щелкните запрос правой кнопкой мыши и выберите команду **Добавить заголовок**. В поле **Имя** введите `SOAPAction`. В поле **Значение** введите значение, которое отображается в `SOAPAction`, например *http://tempuri.org/HelloWorld* .

1. Разверните узел URL-адреса в редакторе тестов, выберите узел **Текст строки** и для свойства **Тип содержимого** введите значение `text/xml`.

1. Вернитесь в браузере к шагу 4, выберите XML-часть запроса SOAP на странице описания веб-службы и скопируйте ее в буфер обмена.

   XML-содержимое будет выглядеть примерно так:

     ```xml
     <?xml version="1.0" encoding="utf-8"?>
     <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
       <soap:Body>
         <HelloWorld xmlns="http://tempuri.org/">
           <str>string</str>
         </HelloWorld>
       </soap:Body>
     </soap:Envelope>
     ```

1. Вернитесь в редактор веб-тестов производительности и нажмите кнопку с многоточием **(…)** в свойстве **Текст строки**. Вставьте содержимое буфера обмена в свойство.

1. Для успешного выполнения теста замените все подстановочные значения в XML на действительные. В предыдущем примере нужно заменить экземпляр `string` именем.

1. Щелкните веб-службу правой кнопкой мыши и выберите команду **Добавить параметр URL QueryString**.

1. Присвойте параметру строки запроса имя и значение. В предыдущем примере имя равно `op`, а значение — `HelloWorld`. Таким образом определяется выполняемая операция веб-службы.

    > [!NOTE]
    > В тексте SOAP можно использовать привязку данных для замены всех подстановочных значений данными с помощью синтаксиса `{{DataSourceName.TableName.ColumnName}}`.

1. Запустите тест. В верхней области **средства просмотра результатов веб-тестов производительности** выберите запрос веб-службы. В нижней части окна перейдите на вкладку **Веб-браузер**. Будет показан XML-код, возвращенный веб-службой, и результаты всех операций.

   Найдите результаты для запроса веб-службы.

## <a name="see-also"></a>См. также

- [Создание пользовательского кода и подключаемых модулей для нагрузочных тестов](../test/create-custom-code-and-plug-ins-for-load-tests.md)
