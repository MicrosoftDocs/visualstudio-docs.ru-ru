---
title: Написание модульных тестов для C/C++
description: Вы можете писать модульные тесты для C++ в Visual Studio с помощью различных платформ тестирования, включая CTest, Boost.Test и Google Test.
ms.date: 04/01/2021
ms.topic: conceptual
ms.author: corob
manager: markl
ms.workload:
- cplusplus
author: corob-msft
ms.openlocfilehash: 877c9163d05f458ce45a46d6b3e6d14e354df591
ms.sourcegitcommit: 4b2b6068846425f6964c1fd867370863fc4993ce
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/12/2021
ms.locfileid: "112042891"
---
# <a name="write-unit-tests-for-cc-in-visual-studio"></a>Написание модульных тестов для C/C++ в Visual Studio

С помощью окна **Обозреватель тестов** вы можете создавать и выполнять модульные тесты для C++. Делается это так же, как и для других языков. Дополнительные сведения об использовании **обозревателя тестов** см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

> [!NOTE]
> Некоторые функции, такие как Live Unit Testing, закодированные тесты пользовательского интерфейса и IntelliTest, не поддерживаются для C++.

В состав Visual Studio входят следующие платформы тестирования C++ (скачивать их не требуется):

- Платформа модульного тестирования Майкрософт для C++
- Google Test
- Boost.Test
- CTest

Помимо использования установленных платформ, вы можете создавать собственные адаптеры тестов для платформ, которые вы хотели бы использовать в Visual Studio. Адаптер теста позволяет интегрировать модульные тесты с окном **Обозреватель тестов**. В [Visual Studio Marketplace](https://marketplace.visualstudio.com) доступно несколько адаптеров сторонних поставщиков. Дополнительные сведения см. в разделе [Установка платформ модульного тестирования сторонних поставщиков](install-third-party-unit-test-frameworks.md).

**Visual Studio 2017 и более поздних версий (Professional и Enterprise)**

Проекты модульных тестов для C++ поддерживают [CodeLens](../ide/find-code-changes-and-other-history-with-codelens.md).

**Visual Studio 2017 и более поздних версий (все выпуски)**

- **Адаптер Google Test** включен по умолчанию в рабочую нагрузку **Разработка классических приложений на C++** . Он содержит шаблон проекта, который можно добавить в решение. Чтобы добавить его, в **обозревателе решений** щелкните узел решения правой кнопкой мыши и выберите пункт **Добавить новый проект**. Параметры адаптера также можно настроить в окне **Сервис** > **Параметры**. Дополнительные сведения см. в разделе [Практическое руководство. Использование Google Test для C++ в Visual Studio](how-to-use-google-test-for-cpp.md).

- Компонент **Boost.Test** включен по умолчанию в рабочую нагрузку **Разработка классических приложений на C++** . Он интегрирован с **обозревателем тестов**, но в настоящее время не имеет шаблона проекта. Его необходимо настроить вручную. Дополнительные сведения см. в разделе [Практическое руководство. Использование Boost.Test для C++ в Visual Studio](how-to-use-boost-test-for-cpp.md).

- Поддержка **CTest** включена в компонент **Средства CMake C++** , который входит в рабочую нагрузку **Разработка классических приложений на C++** . Дополнительные сведения см. в разделе [Практическое руководство. Использование CTest для C++ в Visual Studio 2017 и более поздних версиях](how-to-use-ctest-for-cpp.md).

**Visual Studio 2015 и более ранние версии**

Вы можете скачать расширения "Адаптер Google Test" и "Адаптер Boost.Test" в Visual Studio Marketplace. Найти их можно на страницах [Test Adapter for Boost.Test](https://marketplace.visualstudio.com/items?itemName=VisualCPPTeam.TestAdapterforBoostTest) (Адаптер теста для Boost.Test) и [Test Adapter for Google Test](https://marketplace.visualstudio.com/items?itemName=VisualCPPTeam.TestAdapterforGoogleTest) (Адаптер теста для Google Test).

## <a name="basic-test-workflow"></a>Базовый процесс тестирования

В следующих разделах описываются основные действия по началу модульного тестирования для C++. Базовая настройка для платформ Майкрософт и Google Test схожа. Boost.Test требует создать тестовый проект вручную.

::: moniker range=">=vs-2019"

### <a name="create-a-test-project-in-visual-studio-2019"></a>Создание тестового проекта в Visual Studio 2019

Тесты определяются и выполняются в одном или нескольких тестовых проектах. Проекты создаются в том же решении, что и тестируемый код. Чтобы добавить новый тестовый проект в существующее решение, в **обозревателе решений** щелкните узел решения правой кнопкой мыши. Во всплывающем меню выберите пункты **Добавить** > **Новый проект**. Задайте **Язык** как C++ и введите "тест" в поле поиска. На приведенном ниже рисунке показаны тестовые проекты, доступные при установке рабочей нагрузки **Разработка классических приложений на C++** и **Разработка для универсальной платформы Windows**.

![Тестовые проекты на C++ в Visual Studio 2019](media/vs-2019/cpp-new-test-project-vs2019.png)

::: moniker-end

::: moniker range="vs-2017"

### <a name="create-a-test-project-in-visual-studio-2017"></a>Создание тестового проекта в Visual Studio 2017

Тесты определяются и выполняются в одном или нескольких тестовых проектах. Проекты создаются в том же решении, что и тестируемый код. Чтобы добавить новый тестовый проект, в **обозревателе решений** щелкните узел решения правой кнопкой мыши и выберите пункты **Добавить** > **Новый проект**. В области слева выберите пункт **Тест Visual C++** . В центральной области выберите один из типов проектов. На приведенном ниже рисунке показаны тестовые проекты, доступные при установке рабочей нагрузки **Разработка классических приложений на C++** .

![Тестовые проекты C++](media/cpp-new-test-project.png)

::: moniker-end

### <a name="create-references-to-other-projects-in-the-solution"></a>Создание ссылок на другие проекты в решении

Чтобы обеспечить доступ к функциям в тестируемом проекте, добавьте ссылку на проект в тестовый проект. Щелкните правой кнопкой мыши узел тестового проекта в **обозревателе решений**. Во всплывающем меню выберите пункты **Добавить** > **Ссылка**. В диалоговом окне "Добавление ссылки" выберите проекты, которые нужно тестировать.

![Добавление ссылки](media/cpp-add-ref-test-project.png)

### <a name="link-to-object-or-library-files"></a>Ссылка на объектный файл или файл библиотеки

Если тестовый код не экспортирует функции, которые необходимо проверить, можно добавить выходной OBJ- или LIB-файл в зависимости тестового проекта. Дополнительные сведения см. в разделе [Связывание тестов с объектным файлом или файлом библиотеки](how-to-use-microsoft-test-framework-for-cpp.md#object_files).

### <a name="add-include-directives-for-header-files"></a>Добавление директив #include для файлов заголовков

Далее в *CPP*-файле модульного теста добавьте директивы `#include` для всех файлов заголовков, в которых объявляются тестируемые типы и функции. Введите `#include "`, после чего технология IntelliSense поможет вам выбрать файл. Повторите эти действия для всех нужных заголовков.

![Снимок экрана: Обозреватель решений, в окне которого показано добавление директивы #include с помощью IntelliSense. Выделен файл заголовка для включения.](media/cpp-add-includes-test-project.png)

Чтобы не вводить полный путь в каждой инструкции include в исходном файле, можно добавить необходимые папки в разделе **Проект** > **Свойства** > **C/C++**  > **Общие** > **Дополнительные каталоги включаемых файлов**.

### <a name="write-test-methods"></a>Написание методов теста

> [!NOTE]
> В этом разделе представлен синтаксис при использовании платформы модульного тестирования Майкрософт для C/C++. Он описан здесь: [Справочник по API Microsoft.VisualStudio.TestTools.CppUnitTestFramework](microsoft-visualstudio-testtools-cppunittestframework-api-reference.md). Документацию по Google Test см. на странице [Google Test Primer](https://github.com/google/googletest/blob/master/docs/primer.md) (Начало работы с Google Test). Сведения о Boost.Test см. на странице [Библиотека Boost.Test: среда модульного тестирования](https://www.boost.org/doc/libs/1_46_0/libs/test/doc/html/utf.html).

В *CPP*-файле в тестовом проекте определены класс-заглушка и метод-заглушка. Они служат примером того, как следует писать код теста. В сигнатурах используются макросы TEST_CLASS и TEST_METHOD, что позволяет обнаруживать методы в окне **обозревателя тестов**.

![Снимок экрана: окно Обозревателя тестов, в котором показан файл кода unittest1.cpp, содержащий заглушку класса и метода при использовании макросов TEST CLASS и TEST_METHOD.](media/cpp-write-test-methods.png)

TEST_CLASS и TEST_METHOD являются частью [собственной платформы тестирования Microsoft](microsoft-visualstudio-testtools-cppunittestframework-api-reference.md). **Обозреватель тестов** обнаруживает методы теста в других поддерживаемых платформах аналогичным образом.

TEST_METHOD возвращает пустое значение. Чтобы получить результат теста, используйте статические методы класса `Assert` для сравнения фактических результатов с ожидаемыми. В приведенном ниже примере предполагается, что `MyClass` имеет конструктор, принимающий `std::string`. Мы можем проверить, правильно ли конструктор инициализирует класс, следующим образом:

```cpp
TEST_METHOD(TestClassInit)
{
    std::string name = "Bill";
    MyClass mc(name);
    Assert::AreEqual(name, mc.GetName());
}
```

В предыдущем примере результат вызова `Assert::AreEqual` определяет, пройден ли тест успешно. Класс Assert содержит множество других методов для сравнения ожидаемых и фактических результатов.

В методы теста можно добавлять *признаки*, определяющие владельцев теста, приоритет и другие характеристики. Затем с помощью этих значений можно сортировать и группировать тесты в **обозревателе тестов**. Дополнительные сведения см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

### <a name="run-the-tests"></a>Запуск тестов

1. В меню **Тест** выберите пункт **Windows** > , а затем пункт **Обозреватель тестов**. На рисунке ниже показан тестовый проект, тесты которого еще не выполнялись.

   ![Обозреватель тестов до выполнения тестов](media/cpp-test-explorer.png)

   > [!NOTE]
   > Интеграция CTest с **обозревателем тестов** пока не доступна. Запустите тесты CTest в главном меню CMake.

1. Если в окне видны не все тесты, выполните сборку тестового проекта, щелкнув его узел в **обозревателе решений** правой кнопкой мыши и выбрав пункт **Сборка** или **Перестроить**.

1. В **обозревателе тестов** нажмите **Запустить все** или выберите тесты, которые следует запустить. Щелкните тест правой кнопкой мыши, чтобы получить доступ к другим командам, включая запуск в режиме отладки с включенными точками останова. После выполнения всех тестов в окне будет показано, какие из них были пройдены успешно, а какие — неудачно.

![Обозреватель тестов после выполнения тестов](media/cpp-test-explorer-passed.png)

Для неудачных тестов приводятся подробные сведения, которые могут помочь установить причину. Щелкните неудачный тест правой кнопкой мыши. Во всплывающем меню выберите команду **Отладить выбранные тесты** для пошагового выполнения функции, в которой произошел сбой.

Дополнительные сведения об использовании **обозревателя тестов** см. в разделе [Выполнение модульных тестов с помощью обозревателя тестов](run-unit-tests-with-test-explorer.md).

Дополнительные сведения о модульном тестировании см. в статье [Основные сведения о модульных тестах](unit-test-basics.md).

## <a name="use-codelens"></a>Использование CodeLens

**Visual Studio 2017 и более поздних версий (выпуски Professional и Enterprise)**

[CodeLens](../ide/find-code-changes-and-other-history-with-codelens.md) позволяет быстро просмотреть состояние модульного теста, не выходя из редактора кода.

Инициализировать CodeLens для проекта модульного теста C++ можно любым из перечисленных ниже способов.

- Отредактировать и собрать тестовый проект или решение.
- Перестроить проект или решение.
- Запустить тесты из окна **обозревателя тестов**.

После инициализации значки состояния тестов отобразятся над каждым модульным тестом.

![Значки CodeLens для C++](media/cpp-test-codelens-icons.png)

Щелкните значок для получения дополнительных сведений либо для запуска или отладки модульного теста:

![Запуск и отладка CodeLens для C++](media/cpp-test-codelens-run-debug.png)

## <a name="see-also"></a>См. также

- [Модульное тестирование кода](unit-test-your-code.md)
