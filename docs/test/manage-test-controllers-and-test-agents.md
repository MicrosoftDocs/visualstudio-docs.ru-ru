---
title: Управление контроллерами и агентами тестирования
description: Узнайте, как управлять контроллерами и агентами тестирования после их установки и первоначальной настройки.
ms.custom: SEO-VS-2020
ms.date: 09/18/2018
ms.topic: how-to
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 88298cf9fecdb6ce3862ee289d63c4f31b748449
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99955805"
---
# <a name="manage-test-controllers-and-test-agents"></a>Управление контроллерами и агентами тестирования

Если требуется использовать Visual Studio для удаленного выполнения тестов, распределения тестов по нескольким компьютерам или выполнения нагрузочных тестов, необходимо настроить контроллер тестирования, агенты тестирования и файл параметров тестирования. В этом разделе описано управление контроллерами и агентами тестирования после их установки и первоначальной настройки.

[!INCLUDE [web-load-test-deprecated](includes/web-load-test-deprecated.md)]

::: moniker range="vs-2017"
Если вы используете Microsoft Test Manager для выполнения тестов в лабораторных средах, управление контроллерами тестирования и их агентами производится с помощью области **Диспетчер контроллеров тестирования** в разделе **Центр лабораторий** Microsoft Test Manager. Этот раздел применим только при использовании Visual Studio для выполнения тестов.
::: moniker-end

Сведения об установке и настройке агентов тестирования и контроллеров тестирования для выполнения тестов в Visual Studio см. в разделе [Настройка агентов и контроллеров тестирования](../test/configure-test-agents-and-controllers-for-load-tests.md).

Для настройки и отслеживания контроллера тестирования и зарегистрированных агентов файл параметров тестирования должен содержаться в тестовом проекте, который содержит выполняемые тесты. Откройте файл параметров тестирования, в раскрывающемся меню в поле **Контроллер** выберите **Роль**, а затем **Управление контроллерами тестирования**.

Для проекта тестирования нагрузки также можно выбрать **Управление контроллерами тестирования** в меню **Нагрузочный тест**.

## <a name="add-a-test-agent-to-a-test-controller"></a>Добавление агента тестирования к контроллеру.

Может потребоваться добавить агент тестирования к другому контроллеру или к вновь созданному контроллеру.

### <a name="to-add-a-test-agent-to-a-test-controller"></a>Чтобы добавить агента тестирования к контроллеру выполните следующие действия.

1. Выберите **Пуск** > **Средство настройки агента тестирования**.

     Откроется диалоговое окно **Настройка агента тестирования**.

    > [!NOTE]
    > Для добавления агента тестирования к контроллеру он должен быть предварительно установлен. Дополнительные сведения об установке агента тестирования см. в разделе [Установка и настройка агентов тестирования](../test/lab-management/install-configure-test-agents.md).

2. Вы можете выбрать один из двух вариантов запуска агента тестирования:

   - **Служба**. Если нет необходимости запускать автоматические тесты, взаимодействующие с рабочим столом, например закодированные тесты пользовательского интерфейса, или вести видеозапись выполнения тестов, для параметра **Агент тестирования должен выполняться как** выберите значение **Служба**. Агент тестирования будет запущен как служба. Нажмите кнопку **Далее**.

      Теперь, когда агент запущен как служба, можно ввести подробные сведения о пользователе.

      1. Введите имя в поле **Имя пользователя**.

      2. Введите пароль в поле **Пароль**.

        |**Важная информация об учетных записях пользователей**|
        |-|
        |— Пароли NULL для учетных записей пользователей не поддерживаются.|
        |— Если необходимо использовать сборщик данных IntelliTrace или эмуляцию сети, учетная запись должна принадлежать группе администраторов.|
        |— Если имя пользователя агента отсутствует в службе агента, будет предпринята попытка добавить его, для чего требуются соответствующие разрешения на контроллере тестирования.|
        |— Пользователь, который пытается использовать контроллер тестирования, должен принадлежать к учетной записи пользователей контроллера тестирования; в противном случае ему не удастся запускать тесты с помощью этого контроллера.|

   - **Интерактивный процесс**. Если необходимо запускать автоматические тесты, взаимодействующие с рабочим столом, например закодированные тесты пользовательского интерфейса, или вести видеозапись выполнения тестов, выберите параметр **Интерактивный процесс**. Агент тестирования будет запущен как интерактивный процесс, а не как служба.

      На следующей странице введите сведения о пользователе, необходимые для запуска агента в качестве процесса, а также задайте прочие параметры.

      1. Введите имя в поле **Имя пользователя**.

      2. Введите пароль в поле **Пароль**.

        > [!NOTE]
        > Если агент тестирования настроен для выполнения как интерактивный процесс с другим пользователем, не являющимся в данный момент активным, необходимо перезапустить компьютер и выполнить вход с использованием учетной записи другого пользователя. Кроме этого, пароли NULL для учетных записей пользователей не поддерживаются. Если необходимо использовать сборщик данных IntelliTrace или эмуляцию сети, учетная запись должна принадлежать группе администраторов.

      3. Чтобы убедиться, что компьютер, на котором размещен агент тестирования, может запускать тесты после перезагрузки, можно настроить компьютер на автоматический вход в качестве пользователя агента тестирования. Выберите параметр **Автоматический вход**. Это позволит сохранить имя пользователя и пароль в зашифрованной форме в реестре.

      4. Чтобы убедиться, что заставка выключена, поскольку может мешать автоматическим тестам, взаимодействующим с рабочим столом, выберите **Обеспечить отключение программы-заставки**.

        > [!WARNING]
        > При автоматическом входе или отключении заставки есть вероятность угрозы безопасности. Включая автоматический вход, вы разрешаете другим пользователям включать компьютер и использовать учетную запись автоматического входа. Если отключить заставку, компьютер может не отобразить запрос для ввода учетных данных для разблокирования компьютера. Это позволит любому, находящемуся рядом, получить доступ к компьютеру. Если эти функции включаются, необходимо предотвратить возможный физический доступ посторонних к компьютеру. Например, расположите компьютеры в закрываемой лаборатории. (Снятие флажка **Обеспечить выключение заставки** не приводит к включению заставки.)

3. Чтобы зарегистрировать этот агент с другим контроллером тестирования, выберите **Зарегистрировать с контроллером тестирования.** Укажите имя контроллера тестирования, указав после него двоеточие ( **:** ) и номер порта, используемый в поле **Зарегистрировать агент тестирования в следующем контроллере тестирования**. Например, введите **agent1:6901**.

    > [!NOTE]
    > По умолчанию используется порт 6901.

4. Чтобы сохранить изменения, нажмите кнопку **Применить параметры**. Закройте диалоговое окно **Сводка по конфигурации** и закройте **средство настройки агента тестирования**.

> [!WARNING]
> Если агент в настоящий момент настроен для выполнения в другом контроллере, его необходимо перенастроить для работы в текущем контроллере.

## <a name="remove-a-test-agent-from-a-test-controller"></a>Удаление агента тестирования из контроллера.

Перед удалением агент тестирования следует перевести в автономный режим.

::: moniker range="vs-2017"
> [!NOTE]
> Эту процедуру невозможно использовать для удаления агентов, зарегистрированных на контроллере в рамках лабораторной среды. Чтобы удалить эти агенты из контроллера, необходимо удалить среду с помощью Microsoft Test Manager.
::: moniker-end
::: moniker range=">=vs-2019"
> [!NOTE]
> Эту процедуру невозможно использовать для удаления агентов, зарегистрированных на контроллере в рамках лабораторной среды.
::: moniker-end

### <a name="to-remove-a-test-agent-from-a-test-controller"></a>Удаление агента тестирования из контроллера

::: moniker range=">=vs-2019"
В Visual Studio 2019 невозможно удалить агент тестирования, если контроллер тестирования зарегистрирован в проекте.
::: moniker-end
Если контроллер тестирования не зарегистрирован в проекте, выполните следующие действия.

1. В Visual Studio откройте файл параметров тестирования для тестового проекта, в раскрывающемся меню в поле **Контроллер** выберите **Роль**, а затем **Управление контроллерами тестирования**.

   Откроется диалоговое окно **Администрирование контроллеров тестов**.

2. В поле с раскрывающимся списком **Контроллер** введите имя компьютера, на котором установлен контроллер. Если определенный контроллер тестирования использовался ранее, его имя можно выбрать из списка.

3. В области **Агенты** выберите имя агента тестирования. Если агент все еще в сети, нажмите кнопку **Вне сети**. Чтобы удалить его, нажмите кнопку **Удалить**.

   > [!NOTE]
   > Удаление агента тестирования предполагает лишь отмену связи агента и контроллера. Чтобы полностью удалить агент тестирования, воспользуйтесь компонентом **Программы и компоненты** на панели управления компьютера с агентом тестирования.

::: moniker range="vs-2017"
Если контроллер тестирования зарегистрирован с проектом, для удаления агента используйте Microsoft Test Manager.
::: moniker-end

## <a name="change-the-settings-for-a-test-agent"></a>Изменение параметров агента тестирования.

Состоянию агента тестирования может быть присвоено одно из следующих значений:

|Status|Описание|
|-|-----------------|
|Выполнение теста|Выполнение тестов|
|Готово|Доступен для выполнения тестов и сбора данных и диагностики|
|Offline|Недоступен для выполнения тестов и сбора данных и диагностики|
|Отключен|Агент тестирования не запущен|

Состояние и другие параметры агента тестирования можно изменить с помощью следующих процедур.

### <a name="to-change-the-settings-of-a-test-agent"></a>Изменение параметров агента тестирования

::: moniker range="vs-2017"
> [!NOTE]
> Если агент тестирования зарегистрирован с контроллером тестирования, зарегистрированным с проектом, измените параметры в Microsoft Test Manager.
::: moniker-end

1. Чтобы настроить и отслеживать контроллер тестирования и зарегистрированные агенты для нагрузочного теста, в меню **Нагрузочный тест** в Visual Studio выберите пункт **Управление контроллерами тестирования**. Для остальных тестов откройте файл параметров тестирования для тестового проекта, в раскрывающемся меню в поле **Контроллер** выберите **Роль**, а затем **Управление контроллерами тестирования**.

   Откроется диалоговое окно **Управление контроллерами тестирования**.

1. В списке контроллеров выберите имя контроллера тестирования, агенты которого требуется изменить. Если контроллер тестирования отсутствует в списке, убедитесь, что он правильно зарегистрирован. Дополнительные сведения о настройке контроллеров см. в следующей процедуре.

1. В области **Агенты тестирования** выберите компьютер агента тестирования, для которого необходимо изменить свойства (необязательно).

1. Выберите **Свойства**.

1. Если необходимо, измените, следующие свойства агента тестирования:

|Свойство агента тестирования|Описание|
|-|-----------------|
|**Весовой коэффициент**|Используется для распределения нагрузки при работе с агентами тестирования, имеющими разные уровни производительности. Например, агент тестирования с весовым коэффициентом 100 получает удвоенную нагрузку по сравнению с агентом, весовой коэффициент которого равен 50.|
|**Переключение IP**|Используется для настройки переключения IP-адресов. Переключение IP-адресов позволяет агенту тестирования отправлять запросы на сервер с помощью диапазона IP-адресов. При этом моделируются вызовы, исходящие от множества клиентских компьютеров.<br /><br /> Переключение IP-адресов имеет большое значение при обращении нагрузочного теста к веб-ферме. Большинство подсистем балансировки нагрузки устанавливают соответствие между клиентом и определенным веб-сервером с помощью IP-адреса клиента. Если все запросы исходят от одного клиента, подсистема не выполняет балансировку нагрузки. Для оптимального распределения нагрузки в веб-ферме крайне важно, чтобы запросы исходили от диапазона IP-адресов. **Примечание.**  Можно указать сетевой адаптер или использовать параметр **(значения не присвоены)** , чтобы автоматически выбрать один из неиспользуемых в настоящий момент адаптеров. <br /><br /> Для использования функции переключения IP-адресов служба агента тестирования Visual Studio должна работать от имени члена группы "Администраторы" компьютера агента. Пользователь выбирается во время установки агента, но может быть изменен позднее в свойствах службы (после изменения свойств требуется перезапуск службы).<br /><br /> Чтобы проверить работу функции переключения IP-адресов, включите ведение журнала IIS на веб-сервере и воспользуйтесь функцией ведения журнала IIS, чтобы проверить поступление запросов с заданных IP-адресов.|
|**Атрибуты**|Набор пар "имя-значение", который может использоваться при выборе агента тестирования. Например, для теста может требоваться определенная ОС. Можно добавлять атрибуты на вкладке **Роли** файла параметров тестирования, и их можно использовать для выбора агента тестирования, имеющего соответствующие атрибуты. Если требуется выполнить тест на нескольких компьютерах, создайте атрибут в роли параметров тестирования, настроенной для выполнения тестов, а затем настройте соответствующий атрибут для каждого агента тестирования, который следует использовать в этой роли. **Примечание.**  Этот параметр доступен только для агентов тестирования, зарегистрированных в контроллере тестирования, который не зарегистрирован в проекте, так как эти атрибуты используются только в параметрах тестирования для Visual Studio.|

Изменения весового коэффициента и атрибута агента тестирования вступают в силу сразу же, но не затрагивают выполняющиеся тесты. Параметр "Диапазон IP-адресов" вступает в силу после перезапуска контроллера тестирования.

(Необязательно) Чтобы изменить состояние агента тестирования, выберите агент в списке и выделите одно из действий, доступных в зависимости от текущего состояния агента.

> [!NOTE]
> Если агент тестирования выполняется как процесс, управление состояние агента осуществляется с помощью значка области уведомлений, выполняемой на компьютере, на котором установлен агент тестирования. Он отображает состояние агента тестирования. С помощью данного средства можно запустить, остановить или перезапустить агент, если он выполняется в качестве процесса.

## <a name="configure-a-test-controller"></a>Настройка контроллера тестирования.

Чтобы настроить контроллер тестирования, необходимо воспользоваться **средством конфигурации Team Test Controller**. При настройке контроллер тестирования можно зарегистрировать в другой коллекции проектов или отменить регистрацию в текущей коллекции.

При необходимости регистрации контроллера тестирования в коллекции проектов Team Foundation Server учетная запись, используемая для службы контроллера тестирования, должна быть членом группы служб тестирования коллекции проектов, а учетная запись, используемая для запуска средства настройки контроллера тестирования, должна иметь права администратора коллекции проектов.

> [!NOTE]
> При отмене регистрации контроллера тестирования в коллекции проектов, где имеются существующие среды, поддержка этих сред все же будет осуществляться, если вы перенесете данную коллекцию проектов и зарегистрируете контроллер тестирования в перенесенной коллекции еще раз.

### <a name="to-configure-a-test-controller"></a>Настройка контроллера тестирования

1. Для запуска средства с целью повторной настройки контроллера тестирования можно в любое время выбрать **Пуск** > **Test Controller Configuration Tool**.

     Откроется диалоговое окно **Настройка контроллера тестирования**.

2. Выберите для службы контроллера тестирования учетную запись для входа в систему.

    > [!NOTE]
    > Пароли NULL для учетных записей пользователей не поддерживаются.

4. Если вам не нужно использовать контроллер тестирования с лабораторной средой и вы хотите запускать тесты только из Visual Studio, снимите флажок **Зарегистрировать контроллер тестирования в коллекции командных проектов** (необязательно).

5. Чтобы настроить контроллер тестирования для нагрузочного тестирования, выберите **Настроить контроллер тестирования для нагрузочного тестирования** (необязательно). Затем укажите экземпляр SQL Server в поле **Создать базу данных результатов нагрузочного тестирования в следующем экземпляре SQL Server**.

> [!NOTE]
> Дополнительные сведения об устранении неполадок в контроллерах тестирования см. в разделе [Установка и настройка агентов тестирования](../test/lab-management/install-configure-test-agents.md).

## <a name="manage-your-agents-when-you-run-your-tests-with-a-test-controller"></a>Управление агентами во время выполнения тестов с использованием контроллера тестирования

При добавлении ролей приложения в параметры тестирования для Visual Studio можно также добавить свойства агента для каждой из ролей. Определяет, какие агенты тестирования доступны для данной роли. При выполнении тестов с этими параметрами тестирования контроллер, выбранный для параметров тестирования, определяет доступность требуемых агентов. При определении доступности агента возможны следующие ситуации:

- Для роли, которая должна выполнять тест, агент недоступен. Запуск теста невозможен. Можно выполнить следующие действия и повторить запуск тестов:

  - Можно подождать, пока агент станет доступен для данной роли и повторить запуск тестов.

  - Если есть автономные агенты, которые могут быть использованы для данной роли, можно перезапустить один из них, чтобы он стал доступен.

  - Можно добавить в контроллер тестирования другой агент с соответствующими роли свойствами.

  - Можно изменить свойства агента для данной роли в параметрах тестирования, чтобы включить другие агенты.

- Отсутствует агент для одной или нескольких ролей, выполняющих адаптер диагностических данных. Выполнение теста возможно, но запуск адаптера диагностических данных невозможен. Можно выполнить тестирование без адаптера диагностических данных или выполнить одно из следующих действий и повторно запустить тест:

  - Можно подождать, пока агент станет доступен для данной роли.

  - Если имеется агент в автономном состоянии, который может быть использован для данной роли, необходимо изменить состояние агента на интерактивное с помощью команды **Администрирование контроллеров тестирования** в меню **Тест**. Кроме этого, если агент был отключен от контроллера, его можно перезапустить.

  - Убедитесь, что агенты, необходимые для тестового запуска, не заняты выполнением тестов. Состояния агентов можно проверить с помощью команды **Администрирование контроллеров тестирования** в меню **Тест**.

  - Можно добавить в контроллер тестирования другой агент с соответствующими роли свойствами.

  - Можно изменить свойства агента для данной роли в параметрах тестирования, чтобы включить другие агенты.

## <a name="load-tests-from-delay-signed-assemblies"></a>Загрузка тестов из тестовых сборок с отложенной подписью

Контроллер тестирования и агенты тестирования могут загружать только тестовые сборки, являющиеся сборками со строгой подписью или сборками без подписи. Для некоторых тестовых сборок используется отложенная подпись, поскольку им требуется доступ к рабочим сборкам для приложения. Однако эти сборки не имеют строгой подписи, поскольку они являются тестовыми и не предназначены для распределения. Загрузка таких сборок невозможна, так как они являются сборками с отложенной подписью, поэтому необходимо отключить проверку строгих имен для таких сборок на всех компьютерах, на которых будет загружаться сборка, включая компьютер контроллера тестирования. Чтобы отключить проверку отложенной подписи, используйте программу *sn.exe*. Также может потребоваться приложить токен открытого ключа сборки с отложенной подписью, для которой запрашивается пропуск проверки строгого имени.

Чтобы отключить проверку с отложенной подписью, используйте средство строгих имен (*Sn.exe*).

Проверка строго имени отключится для указанной сборки только для компьютера, на котором выполняется команда. Для этого необходимо иметь соответствующие разрешения.

После завершения тестового запуска следует с помощью команды *SN.exe* снова разрешить проверку отложенной подписи.

Для отключения и повторного включения проверки сигнатур рекомендуется использовать команду *SN.exe* в скриптах. Отключать проверку можно в скрипте установки, а повторно включать в скрипте очистки.

## <a name="see-also"></a>См. также

- [Установка и настройка агентов тестирования](../test/lab-management/install-configure-test-agents.md)
