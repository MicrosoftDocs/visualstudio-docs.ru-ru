---
title: Наборы счетчиков и правило порога для нагрузочного тестирования
description: Узнайте, как указать наборов счетчиков и правил порогов в нагрузочном тесте. Добавьте серверы, на которых выполняется тестирование, в список компьютеров для сбора данных счетчиков.
ms.custom: SEO-VS-2020
ms.date: 10/19/2016
ms.topic: conceptual
helpviewer_keywords:
- counters, counter sets
- load tests, thresholds
- counter sets
- load tests, performance
- load tests, counter sets
- load tests, threshold rules
ms.assetid: 9e14d955-f3a4-4717-bbfe-7f08cdda5678
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.openlocfilehash: fda390640d627a91d4ab534192cba9bd9e30f00f
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99962643"
---
# <a name="specify-counter-sets-and-threshold-rules-for-computers-in-a-load-test"></a>Указание наборов счетчиков и правил порогов для компьютеров в нагрузочном тесте

Нагрузочные тесты предоставляют именованные наборы счетчиков, которые могут быть полезны при анализе данных счетчика производительности. Наборы счетчиков упорядочены по технологии и включают в себя приложение, ASP.NET, приложение .NET, IIS и SQL. Начальный набор счетчиков добавляется при создании нагрузочного теста с помощью **мастера тестовой нагрузки**. Набор состоит из предопределенных и важных счетчиков для нагрузочного теста. Управление счетчиками осуществляется в **редакторе тестовой нагрузки**.

[!INCLUDE [web-load-test-deprecated](includes/web-load-test-deprecated.md)]

> [!NOTE]
> Если нагрузочные тесты распределены по удаленным компьютерам, счетчики контроллера и агента сопоставляются с наборами счетчиков контроллера и агента. Дополнительные сведения об использовании удаленных компьютеров в нагрузочном тесте см. в статье [Контроллеры и агенты тестирования](configure-test-agents-and-controllers-for-load-tests.md).

Данные наборов счетчиков собираются на указанных компьютерах. Связь между набором счетчиков и компьютером, используемым во время нагрузочного теста, называется *сопоставлением набора счетчиков*. Например, тестируемый веб-сервер может располагать сопоставлениями набора счетчиков приложений ASP.NET, IIS и .NET.

По умолчанию данные счетчиков производительности собираются на контроллере и агентах. Дополнительные сведения см. в статье [Контроллеры и агенты тестирования](configure-test-agents-and-controllers-for-load-tests.md).

Добавление серверов, на которых выполняется тестирование, в список компьютеров для сбора данных счетчиков является важным моментом. Затем все значимые системные данные собираются и отслеживаются во время нагрузочного теста.

## <a name="tasks"></a>Задания

|Задания|Связанные разделы|
|-|-----------------------|
|**Управление наборами счетчиков для нагрузочного теста**. После создания нагрузочного теста набор счетчиков можно изменить в редакторе тестовой нагрузки. Управление наборами счетчиков включает в себя выбор набора компьютеров, на которых требуется собирать данные о производительности, и назначение каждому отдельному компьютеру набора наборов счетчиков для сбора данных. Управление счетчиками осуществляется в редакторе тестовой нагрузки.|-   [Практическое руководство. Управление наборами счетчиков](../test/how-to-manage-counter-sets-using-the-load-test-editor.md)|
|**Добавление наборов счетчиков в нагрузочный тест**. При создании нагрузочного теста с помощью **мастера тестовой нагрузки** добавляется начальный наборов счетчиков. Таким образом создаются предварительно определенные наборы счетчиков для нагрузочного теста. После создания нагрузочного теста к существующим наборам счетчиков можно с помощью редактора тестовой нагрузки добавить новые счетчики.|-   [Практическое руководство. Добавление счетчиков в наборы счетчиков](../test/how-to-add-counters-to-counter-sets-using-the-load-test-editor.md)<br />-   [Практическое руководство. Добавление пользовательских наборов счетчиков](../test/how-to-add-custom-counter-sets-using-the-load-test-editor.md)|
|**Указание порогового правила с использованием счетчиков для нагрузочного теста**. Пороговое правило устанавливается для отдельного счетчика производительности с целью отслеживания использования системных ресурсов во время нагрузочного теста. В определения набора счетчиков содержатся предварительно определенные правила пороговых значений для многих основных счетчиков производительности. Правила порогов в нагрузочных тестах сравнивают значение счетчика производительности со значением константы или другого счетчика производительности.|-   [Практическое руководство. Добавление правила порога](../test/how-to-add-a-threshold-rule-using-the-load-test-editor.md)|
|**Присвоение понятных имен компьютерам, с которыми сопоставлены наборы счетчиков**. Можно добавить теги компьютеров, которые позволяют применять легко узнаваемые имена к компьютерам. Теги отображаются в узле **Сопоставление набора счетчиков** дерева редактора тестовой нагрузки. Что более важно, эти теги отображаются в отчетах Excel, что позволяет заинтересованным лицам видеть, какую роль выполняет тот или иной компьютер в нагрузочном тесте, например "Веб-сервер в лаборатории 2" или "Сервер SQL Server 2 в офисе в Финиксе".<br /><br /> Дополнительные сведения см. в статье [Создание отчетов о результатах нагрузочных тестов для сравнения тестов или анализа трендов](../test/compare-load-test-results.md).||

## <a name="use-counter-sets"></a>Использование наборов счетчиков

Средства нагрузочного тестирования с помощью счетчиков собирают данные о производительности и отображают их на диаграмме. Данные счетчика снимаются через определенные пользователем интервалы во время выполнения нагрузочного теста. Дополнительные сведения см. в разделе [Практическое руководство. Задание частоты выборки](../test/how-to-specify-the-sample-rate-for-a-load-test.md). Счетчики можно просматривать во время выполнения или по завершении запуска нагрузочного теста с помощью *анализатора тестовой нагрузки*.

Данные счетчиков собираются на сервере и на компьютере, где выполняется тест. Если для выполнения тестов установлен набор агентских компьютеров, данные счетчиков будут собраны и на них.

Существует три категории счетчиков: "Проценты", "Количество" и "Средние значения". Их примеры: "Загрузка ЦП: %", "Количество блокировок SQL Server" и "Количество запросов IIS в секунду".

![Наборы счетчиков нагрузочных тестов](../test/media/loadtestcountersets.png)

Данные о производительности для отдельных HTTP-запросов выводятся на компьютере, на котором выполняется тест, например на компьютере агента. Для запросов отслеживаются такие данные, как среднее время до получения первого байта, время ответа и число запросов в секунду.

Для упрощения сбора данных о производительности на веб-сервере в Visual Studio Enterprise предоставляются предопределенные именованные наборы счетчиков, основанные на технологии, используемой в нагрузочных тестах. Эти наборы можно использовать при анализе работы сервера с IIS, ASP.NET или сервера SQL Server. Счетчики, не указанные в наборе счетчиков по умолчанию, можно добавить с помощью редактора тестовой нагрузки. Добавление компьютеров или серверов, на которых выполняется тестирование, в нагрузочный тест для отслеживания ресурсов, используемых на этих компьютерах, является важным моментом. Дополнительные сведения см. в статье [Практическое руководство. Управление наборами счетчиков](../test/how-to-manage-counter-sets-using-the-load-test-editor.md).

Для анализа результатов нагрузочных тестов часто требуются специальные сведения о конкретной области, определяющие, какие данные нужно собрать, где установить правила пороговых значений и каким образом сообщить о проблеме в приложении. Дополнительные сведения см. в статье [О правилах порогов](#about-threshold-rules).

### <a name="performance-counter-sampling-interval-considerations"></a>Особенности определения интервала выборки счетчика производительности

Выберите соответствующее значение свойства **Частота выборки** в параметрах запуска нагрузочного теста в соответствии с длительностью нагрузочного теста. Для более низкой частоты выборки, например для значения по умолчанию, равного 5 секундам, требуется больше места в базе данных результатов нагрузочного тестирования. Для более длинных нагрузочных тестов увеличение частоты выборки приводит к уменьшению объема собираемых данных. Дополнительные сведения см. в разделе [Практическое руководство. Задание частоты выборки](../test/how-to-specify-the-sample-rate-for-a-load-test.md).

Ниже приведено несколько рекомендаций по определению частоты выборки.

|Длительность нагрузочного теста|Рекомендуемая частота выборки|
|-|-----------------------------|
|\< 1 ч|5 с|
|1–8 часов|15 секунд|
|8–24 часа|30 секунд|
|> 24 часов|60 секунд|

## <a name="store-performance-data"></a>Хранение данных о производительности

При выполнении нагрузочного теста данные счетчиков производительности собираются и сохраняются в *репозитории результатов нагрузочных тестов*. Дополнительные сведения см. в статье [Управление результатами нагрузочного теста в репозитории результатов нагрузочного теста](../test/manage-load-test-results-in-the-load-test-results-repository.md).

## <a name="about-threshold-rules"></a>О правилах порогов

*Правило порогового значения* устанавливается для отдельного счетчика производительности для отслеживания использования системных ресурсов во время нагрузочного теста. В определения набора счетчиков содержатся предварительно определенные правила пороговых значений для многих основных счетчиков производительности. Дополнительные сведения см. в статье [Использование наборов счетчиков для улучшения анализа данных счетчиков производительности в нагрузочных тестах](../test/specify-counter-sets-and-threshold-rules-for-load-testing.md).

## <a name="threshold-rules-and-levels"></a>Уровни и правила пороговых значений

При создании правил пороговых значений в нагрузочных тестах можно выбрать один из двух типов правил.

Сравнить с константой&mdash;Сравнение значения счетчика производительности с постоянным значением.

Сравнивать счетчики&mdash;Сравнение значения счетчика производительности со значением другого счетчика производительности.

При создании правил пороговых значений также устанавливаются уровни для правил. Эти уровни представляют собой пороговые значения предупреждений и критические пороговые значения. При отображении нагрузочных тестовых запусков нарушения пороговых значений предупреждений помечаются желтыми символами, а нарушения критических пороговых значений — красными символами.

## <a name="the-alert-if-over-property"></a>Свойство "Оповещать при превышении"

Если превышение порогового значения означает неполадку, необходимо установить для свойства **Оповещать при превышении** значение **True**. Например, если правило порогового значения устанавливается для счетчика **% загруженности процессора** и пользователю необходимо получать оповещения при превышении значения 90, то следует использовать тип правила **Сравнить с константой**, установить для **критического порогового значения** число 90 и задать для свойства **Оповещать при превышении** значение **True**.

Если неполадкой является получение данных ниже порогового значения, необходимо установить для свойства **Оповещать при превышении** значение **False**. Например, если правило порогового значения устанавливается для счетчика **Запросов/сек.** и пользователю необходимо получать оповещения при значениях ниже 50, то следует использовать тип правила **Сравнить с константой**, установить уровень **критического порогового значения** на 50 и задать для свойства **Оповещать при превышении** значение **False**.

## <a name="see-also"></a>См. также раздел

- [Практическое руководство. Добавление правила порога](../test/how-to-add-a-threshold-rule-using-the-load-test-editor.md)
- [Анализ нарушений правил порогов](../test/analyze-threshold-rule-violations-in-load-tests.md)
