---
title: Рабочие области R
description: Способы управления выполнением кода R с помощью рабочих областей в Visual Studio.
ms.date: 01/24/2018
ms.topic: conceptual
author: kraigb
ms.author: kraigb
manager: jmartens
ms.workload:
- data-science
ms.openlocfilehash: 3627a8944941fc77bb9b19fe3dd0a1549f41892a
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99961590"
---
# <a name="control-where-r-code-runs-with-workspaces"></a>Управление выполнением кода R с помощью рабочих областей

Рабочая область в инструментах R для Visual Studio (RTVS) позволяет указать, где выполняется сеанс R (на локальном и удаленном компьютерах). Цель этого — позволить работать на обоих компьютерах без каких-либо серьезных различий, что дает возможность воспользоваться преимуществами потенциально более производительных облачных компьютеров.

Чтобы открыть окно **Рабочие области**, выберите команду **Инструменты R** > **Окна** > **Рабочие области** или нажмите клавиши **CTRL**+**9**.

![Окно "Рабочие области" в инструментах R для Visual Studio (VS2017)](media/workspaces-window.png)

В этом окне зеленым флажком обозначается активная рабочая область, к которой привязаны RTVS. Выберите синюю стрелку, чтобы задать рабочую область в качестве активной. Щелкните значок параметров (шестеренки) справа от каждой рабочей области, чтобы переименовать рабочую область, изменить ее расположение и аргументы командной строки. Красный значок X позволяет удалить рабочую область, добавленную вручную.

## <a name="save-and-reset-a-workspace"></a>Сохранение и сброс рабочей области

По умолчанию RTVS не сохраняет состояние рабочей области при закрытии и повторном открытии проекта. Однако это поведение можно изменить в разделе [Параметры рабочей области](options-for-r-tools-in-visual-studio.md#workspace).

Чтобы в любое время сбросить состояние рабочей области, можно воспользоваться командой **Инструменты R** > **Сеанс** > **Сброс** и кнопкой сброса в интерактивном окне. В случае с удаленными рабочими областями сброс приводит к удалению профиля пользователя, созданного при первом подключении к удаленному серверу, что фактически удаляет все накопленные в профиле файлы.

## <a name="local-workspaces"></a>Локальные рабочие области

В списке локальных рабочих областей отображаются все интерпретаторы R, которые установлены на компьютере.

При запуске Visual Studio пытается автоматически определить все установленные версии R, обращаясь к разделу реестра **HKEY_LOCAL_MACHINE\Software\R-Core\\** . Так как проверка выполняется только при запуске, после установки нового интерпретатора R нужно перезапустить Visual Studio.

RTVS может не обнаружить интерпретатор R, установленный нестандартным способом (например, путем простого копирования файлов в папку вместо запуска установщика). В этом случае вручную создайте новую локальную рабочую область R следующим образом.

1. В окне "Рабочие области" нажмите кнопку **Добавить**.
1. Присвойте имя новой рабочей области.
1. Введите путь к корневой папке R (в которой находится папка *bin* с интерпретатором) и любые дополнительные аргументы командной строки, передаваемые интерпретатору при запуске RTVS.
1. По завершении нажмите **Сохранить**.

![Добавление новой рабочей области](media/workspaces-add-new.png)

## <a name="remote-workspaces"></a>Удаленные рабочие области

Удаленные рабочие области позволяют подключаться к сеансу R на удаленном компьютере. (Сведения о настройке компьютера для этой цели см. в разделе [Настройка удаленных рабочих областей](setting-up-remote-r-workspaces.md).)

Visual Studio не определяет автоматически удаленные рабочие области, поэтому нужно добавить их вручную с помощью кнопки **Добавить** в окне "Рабочие области", как описано в предыдущем разделе. В этом случае введите URI удаленного компьютера, а не локальный путь.

> [!Important]
> Для идентификации удаленных рабочих областей используются URI, которые *должны использовать протокол HTTPS* для обеспечения конфиденциальности и целостности связи с удаленным компьютером. Visual Studio не может подключиться к удаленному компьютеру, который не поддерживает протокол HTTPS.

> [!Note]
> Удаленные рабочие области позволяют организовать эффективный предварительный просмотр. Мы работаем над более эффективной синхронизацией файлов, которая будет реализована в будущих выпусках, и с радостью рассмотрим ваши отзывы.

## <a name="remote-workspace-logon"></a>Вход в удаленную рабочую область

Для входа в удаленную рабочую область необходимо использовать имя пользователя и пароль.

### <a name="logon-to-windows-workspace"></a>Вход в рабочую область Windows

Если удаленный компьютер настроен для использования учетной записи домена, для доступа к удаленной рабочей области можно применять вход в домен. В противном случае следует использовать формат `machine-name\username` для входа с помощью учетной записи компьютера на удаленном компьютере.

### <a name="logon-to-linux-workspace"></a>Вход в рабочую область Linux

Для входа в учетную запись Linux используйте формат `<<unix>>\username`. Например, если имеется учетная запись с именем `ruser`, введите имя пользователя в форме `<<unix>>\ruser`.

## <a name="switch-between-workspaces"></a>Переключение между рабочими областями

RTVS привязывается только к одной рабочей области одновременно. Привязанная рабочая область обозначается в окне "Рабочие области" небольшой зеленой галочкой. По умолчанию RTVS привязывается к последней локальной рабочей области, открытой в предыдущем сеансе.

Чтобы изменить активную рабочую область, щелкните синюю стрелку рядом с требуемой рабочей областью. При этом появится запрос на сохранение сеанса, работа с текущей рабочей областью будет прекращена, а затем вы переключитесь на новую рабочую область.

> [!Tip]
> Чтобы отключить запрос на сохранение, выберите команду **Инструменты R** > **Параметры**, а затем задайте для параметра **Показать диалоговое окно подтверждения перед переключением рабочих областей** значение `No`. См. раздел [Параметры рабочей области](options-for-r-tools-in-visual-studio.md#workspace).

При попытке переключиться на локальную рабочую область, которая была удалена, или на удаленную рабочую область, которая недоступна, RTVS невозможно привязать ни к одной рабочей области. В результате при вводе кода в интерактивном окне или при попытке иным образом выполнить код может появиться сообщение об ошибке:

![Сообщение об ошибке при отсутствии рабочих областей, привязанных к RTVS](media/workspaces-disconnected-interactive-window.png)

Чтобы исправить это, переключитесь на другую рабочую область в окне "Рабочие области". Если не доступна ни одна из рабочих областей, нужно установить интерпретатор R. Можно также попытаться перезапустить программу Visual Studio, если интерпретатор был установлен во время работы Visual Studio.

### <a name="switch-to-a-remote-workspace"></a>Переключение на удаленную рабочую область

При первом подключении к удаленной рабочей области RTVS запрашивает учетные данные, а затем кэширует их (с помощью безопасного хранилища учетных данных Windows) для последующих сеансов. Подключение к удаленному серверу осуществляется защищенным способом по протоколу HTTPS (который является обязательным).

В зависимости от конфигурации сервера при подключении может появиться предупреждение о сертификате: "Сертификат безопасности, предоставленный удаленными службами R Services, не позволяет нам удостовериться, что вы действительно подключаетесь к компьютеру (имя компьютера)".

![Предупреждение о самозаверяющем сертификате при подключении к удаленной рабочей области](media/workspaces-remote-self-signed-certificate-warning.png)

Сертификат — это документ, предоставляемый RTVS компьютером, к которому вы пытаетесь подключиться. Сертификат содержит поле, указывающее URI этого компьютера. Предупреждение появляется в случае, когда RTVS обнаруживает несоответствие между URI в сертификате и URI, который используется для подключения к компьютеру, что указывает на потенциальный взлом системы безопасности сервера.

Однако это предупреждение также отображается в случае, когда для включения протокола HTTPS на удаленном компьютере вместо сертификата от одного из доверенных поставщиков использовался *самозаверяющий сертификат*. Дополнительные сведения см. в разделе [Настройка удаленных рабочих областей](setting-up-remote-r-workspaces.md).

## <a name="directories-on-local-and-remote-computers"></a>Каталоги на локальных и удаленных компьютерах

По умолчанию при запуске нового интерпретатора R в локальной рабочей области текущим рабочим каталогом становится *%userprofile%\Documents*. Этот каталог можно в любое время изменить, воспользовавшись командами в меню **Инструменты R** > **Рабочий каталог** или щелкнув правой кнопкой мыши проект в обозревателе решений Visual Studio и выбрав команду **Задать текущий каталог в качестве рабочего**.

При первом подключении к удаленному компьютеру RTVS автоматически создает профиль пользователя на основе учетных данных, при этом рабочим каталогом назначается папка *Documents* в этом профиле. Она применяется для всех последующих сеансов удаленного доступа, в которых используются те же учетные данные.

В результате точное расположение, где выполняется код, может различаться для локальных и удаленных рабочих областей. В коде используйте только относительные пути к файлам данных и т. п., чтобы код можно было перенести в другие рабочие области.

Обратите внимание, что в удаленных рабочих областях все файлы в рабочем каталоге остаются во всех сеансах для одного профиля пользователя. Как отмечалось ранее, эти файлы можно удалить с помощью команды **Инструменты R** > **Сеанс** > **Сброс** (или кнопки сброса в интерактивном окне) при использовании удаленной рабочей области. Команда удаляет профиль пользователя с сервера, а при повторном подключении он создается заново.

## <a name="copy-project-files-to-remote-workspaces"></a>Копирование файлов проекта в удаленные рабочие области

При работе с проектами R в Visual Studio на локальном компьютере всегда имеются актуальные версии файлов проекта, даже при использовании удаленной рабочей области. То есть при открытии проекта в Visual Studio (что обычно означает открытие решения, содержащего проект) RTVS предполагает, что содержимое проекта находится на локальном компьютере. По сути, удаленная рабочая область является только временным хранилищем для файлов проекта и всех выходных данных в коде. Это означает, например, что при загрузке файла с помощью `source` в интерактивном окне этот файл должен уже находиться на удаленном компьютере по указанному вами пути или в текущем рабочем каталоге удаленного интерпретатора R (задается с помощью функции `setwd()`).

Файлы копируются на удаленный сервер следующим образом.

- Для удаленной работы с файлами в интерактивном окне их нужно сначала скопировать вручную, щелкнув эти файлы (или проект) правой кнопкой мыши в обозревателе решений и выбрав **Использовать выбранные файлы в качестве источника**. Отдельные файлы копируются в рабочий каталог на сервере; при копировании проекта RTVS создает папку для проекта.

- Также можно скопировать файлы, выделив их в обозревателе решений и выбрав **Использовать выбранные файлы в качестве источника**. После этого они загружаются в интерактивное окно и выполняются там. Если сеанс подключен к удаленному компьютеру, файлы первым делом копируются туда.

- Когда RTVS привязаны к удаленной рабочей области, при нажатии клавиши **F5**, выборе команды **Отладка** > **Начать отладку** или запуске кода иным способом RTVS по умолчанию автоматически копируют файл проекта в удаленную рабочую область (способ управления этим поведением указан ниже).

- Все файлы, которые уже существуют на сервере, перезаписываются.

> [!Note]
> Так как RTVS не обеспечивают надежный перехват всех вызовов функций R, вызов таких функций, как `source()` или `runApp()` (для приложений Shiny) из интерактивного окна, *не* приводит к копированию файлов в удаленную рабочую область.

Настройка того, следует ли RTVS копировать файлы при выполнении проекта, а также точное указание копируемых файлов осуществляются с помощью [свойств проекта](r-projects-in-visual-studio.md#project-properties). Чтобы открыть страницу свойств, выберите команду **Проект** > **Свойства** (название проекта) или щелкните проект в обозревателе решений правой кнопкой мыши и выберите **Свойства**.

![Окно свойств проекта со вкладкой "Выполнение" и настройками передачи файлов](media/workspaces-remote-file-transfer-filter-settings.png)

Здесь свойство **Передать файлы при запуске** определяет, следует ли RTVS автоматически копировать файлы проекта. В поле **Файлы для передачи** указываются типы файлов для передачи. По умолчанию копируются только файлы *R*, *RMD*, *SQL*, *MD* и *CPP* Это позволяет избежать случайного копирования на сервер больших файлов данных при каждом выполнении.

## <a name="copy-files-from-a-remote-workspace"></a>Копирование файлов из удаленной рабочей области

Если ваш скрипт R создает файлы на сервере, эти файлы можно скопировать обратно на клиент с помощью функции `rtvs::fetch_file`. В этой функции необходимо как минимум указать удаленный путь к файлу, который требуется скопировать на компьютер, и при необходимости — целевой путь на вашем компьютере. Если путь не указан, файл копируется в папку *%userprofile%\Downloads*.
