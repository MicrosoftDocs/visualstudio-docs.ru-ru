---
title: Обновление сетевой установки
description: Сведения об обновлении сетевой установки Visual Studio с помощью команды --layout
ms.date: 05/26/2021
ms.custom: seodec18
ms.topic: conceptual
helpviewer_keywords:
- '{{PLACEHOLDER}}'
- '{{PLACEHOLDER}}'
ms.assetid: 1AF69C0E-0AC9-451B-845D-AE4EDBCEA65C
author: j-martens
ms.author: jmartens
manager: jmartens
ms.workload:
- multiple
ms.prod: visual-studio-windows
ms.technology: vs-installation
ms.openlocfilehash: b833551d00f4bd8fb158c848d3bf5b48173e563b
ms.sourcegitcommit: 5fb4a67a8208707e79dc09601e8db70b16ba7192
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2021
ms.locfileid: "112306661"
---
# <a name="update-a-network-based-installation-of-visual-studio"></a>Обновление сетевой установки Visual Studio

Вы можете обновлять макет сетевой установки Visual Studio до последних обновлений продуктов, что позволяет использовать его не только в качестве точки установки обновлений Visual Studio, но и для поддержки уже развернутых установок на клиентских рабочих станциях.

## <a name="how-to-update-a-network-layout"></a>Обновление сетевого макета

> [!IMPORTANT]
> В этих инструкциях предполагается, что вы уже создали макет установки сети и приняли некоторые решения о том, как клиент будет получать обновления. Дополнительные сведения о том, как это сделать, см. на страницах [Создание сетевой установки Visual Studio](create-a-network-installation-of-visual-studio.md) и [Управление обновлением развертываний Visual Studio](../install/controlling-updates-to-visual-studio-deployments.md).

Чтобы актуализировать общий ресурс сетевой установки, включив в него последние обновления, запустите начальный загрузчик с параметром `--layout` для скачивания обновленных пакетов.

Если при [первоначальном создании сетевого макета](create-a-network-installation-of-visual-studio.md) вы выбрали частичный макет, эти параметры сохраняются. Все будущие команды макета используют прежние параметры, а также любые указанные новые параметры.

Если макет размещается в общей папке, следует обновить закрытую копию макета (например, c:\VSLayout) и только после скачивания всех обновлений скопировать обновленные данные в общую папку (например, \\server\products\VS). В противном случае повышается вероятность, что кто-то из пользователей запустит программу установки во время обновления макета и не сможет получить полное содержимое макета, так как его обновление не завершено.

Рассмотрим несколько примеров создания и обновления макета:

* Ниже приведен пример создания макета с одной рабочей нагрузкой только для английского языка.

  ```shell
  vs_enterprise.exe --layout c:\VSLayout --add Microsoft.VisualStudio.Workload.ManagedDesktop --lang en-US
  ```

* Здесь показано, как можно обновить этот же макет до более новой версии. Дополнительные параметры командной строки указывать не нужно. Предыдущие параметры были сохранены и будут использоваться во всех последующих командах макета в этой папке макета.

  ```shell
  vs_enterprise.exe --layout c:\VSLayout
  ```

* Ниже показано, как можно автоматически обновить макет до более поздней версии. Операция макета запускает процесс установки в новом окне консоли. Это окно остается открытым, так что пользователи могут видеть итоговый результат и сводку ошибок, которые могли произойти. Если вы выполняете автоматическую операцию макета (например, если макет регулярно обновляется до последней версии с помощью скрипта), используйте параметр `--passive`, чтобы процесс автоматически закрывал окно.

  ```shell
  vs_enterprise.exe --layout c:\VSLayout --passive
  ```

* Далее показано добавление дополнительной рабочей нагрузки и языка локализации.  (Эта команда добавляет рабочую нагрузку *Разработка Azure*.)  Теперь в этот макет включены управляемый рабочий стол и Azure.  Для всех этих рабочих нагрузок также будут включены языковые ресурсы для английского и немецкого языков.  И макет обновляется до последней доступной версии.

  ```shell
  vs_enterprise.exe --layout c:\VSLayout --add Microsoft.VisualStudio.Workload.Azure --lang de-DE
  ```

    > [!IMPORTANT]
    > Операция обновления не скачивает или не устанавливает дополнительные необязательные компоненты в макет, либо на клиент. Если требуются добавить или изменить необязательные компоненты, удалите старые необязательные компоненты из [файла ответов](automated-installation-with-response-file.md) `Layout.JSON` и включите необходимые компоненты в разделе "Добавление" `Layout.JSON`. Затем при выполнении команды обновления в макете вновь добавленные компоненты будут загружены в макет. 
    >
    > Чтобы установить эти новые компоненты на клиентском компьютере, выполните три следующих действия. Сначала убедитесь, что макет содержит новые компоненты, как описано выше. Затем обновите клиент до последних битов в макете.  Наконец, снова на клиенте выполните операцию изменения, которая установит новые компоненты (добавленные в макет) на клиентский компьютер.

* Наконец, вот как можно добавить дополнительную нагрузку и язык локализации без обновления версии. (Эта команда добавляет рабочую нагрузку *Разработка ASP.NET и веб-приложений*.)  Теперь в этот макет включены рабочие нагрузки управляемого рабочего стола, Azure и ASP.NET и разработки веб-приложений. Для всех этих рабочих нагрузок также включены языковые ресурсы для английского, немецкого и французского языков.  Но при выполнении этой команды макет не был обновлен до последней доступной версии. Он остается в существующей версии.

  ```shell
  vs_enterprise.exe --layout c:\VSLayout --add Microsoft.VisualStudio.Workload.NetWeb --lang fr-FR --keepLayoutVersion
  ```

## <a name="deploy-an-update-to-client-machines"></a>Развертывание обновления на клиентских компьютерах

В зависимости от настроек сетевой среды обновление могут разворачивать администраторы предприятия или пользователи с клиентского компьютера.

* Пользователи могут обновлять экземпляр Visual Studio, установленный из папки установки в автономном режиме.
  * Запустите установщик Visual Studio.
  * Затем нажмите кнопку **Обновить**.

::: moniker range="vs-2017"

* Администраторы могут обновлять клиентские развертывания Visual Studio без взаимодействия с пользователем, выполняя две отдельные команды.
  * Сначала нужно обновить установщик Visual Studio: <br>```vs_enterprise.exe --quiet --update```
  * Теперь обновите само приложение Visual Studio: <br>```vs_enterprise.exe update --installPath "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise" --quiet --wait --norestart```

::: moniker-end

::: moniker range="vs-2019"

* Администраторы могут обновлять клиентские развертывания Visual Studio без взаимодействия с пользователем, выполняя две отдельные команды.
  * Сначала нужно обновить установщик Visual Studio: <br>```vs_enterprise.exe --quiet --update```
  * Теперь обновите само приложение Visual Studio: <br>```vs_enterprise.exe update --installPath "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise" --quiet --wait --norestart```

::: moniker-end

::: moniker range=">=vs-2022"

* Администраторы могут обновлять клиентские развертывания Visual Studio без взаимодействия с пользователем, выполняя две отдельные команды.
  * Сначала нужно обновить установщик Visual Studio: <br>```vs_enterprise.exe --quiet --update```
  * Теперь обновите само приложение Visual Studio: <br>```vs_enterprise.exe update --installPath "C:\Program Files\Microsoft Visual Studio\2022\Enterprise" --quiet --wait --norestart```

::: moniker-end

> [!NOTE]
> Используйте [команду vswhere.exe](tools-for-managing-visual-studio-instances.md), чтобы узнать путь установки существующего экземпляра Visual Studio на клиентском компьютере.
>
> [!TIP]
> Дополнительные сведения о настройке уведомлений пользователям об обновлениях есть в статье [Control updates to network-based Visual Studio deployments](controlling-updates-to-visual-studio-deployments.md) (Управление обновлениями для сетевых развертываний Visual Studio).

## <a name="verify-a-layout"></a>Проверка макета

Используйте команду `--verify` для выполнения проверки в предоставленном автономном кэше. Она проверяет отсутствующие или недопустимые файлы пакетов. В конце проверки выводится список отсутствующих и недопустимых файлов.

```shell
vs_enterprise.exe --layout <layoutDir> --verify
```

vs_enterprise.exe можно вызвать внутри layoutDir.

> [!NOTE]
> В автономном кэше макета должны находиться некоторые важные файлы метаданных, которые требуются параметру `--verify`. Если эти файлы метаданных отсутствуют, команду "--verify" выполнить невозможно, и программа установки сообщит об ошибке. При возникновении этой ошибки повторно создайте автономный макет в другой папке (или в той же папке автономного кэша). Для этого выполните ту же команду макета, которая использовалась для создания первоначального автономного макета. Например, `vs_enterprise.exe --layout <layoutDir>`.

Корпорация Майкрософт периодически предоставляет обновления для Visual Studio, поэтому версия нового создаваемого макета может отличаться от версии первоначального макета.

> [!NOTE]
> Проверка работает только для последней версии определенного дополнительного номера версии Visual Studio. Сразу после выпуска новой версии проверка не будет работать для более ранних выпусков уровня исправлений того же дополнительного номера версии.

## <a name="fix-a-layout"></a>Исправление ошибок макета

Используйте команду `--fix` для выполнения той же проверки, что и `--verify`, а также попытайтесь устранить выявленные проблемы. Для процесса `--fix` требуется подключение к Интернету, поэтому перед вызовом `--fix` убедитесь, что компьютер подключен к Интернету.

```shell
vs_enterprise.exe --layout <layoutDir> --fix
```

vs_enterprise.exe можно вызвать внутри layoutDir.

## <a name="remove-older-versions-from-a-layout"></a>Удаление предыдущих версий из макета

После применения обновлений макета к автономному кэшу в папке кэша макета может находиться ряд устаревших пакетов, которые больше не требуются в последней установке Visual Studio. Используйте параметр `--clean`, чтобы удалить устаревшие пакеты из папки автономного кэша.

Для этого вам потребуются пути к файлам к манифестам каталога, содержащим эти устаревшие пакеты. Манифесты каталога можно найти в папке "Archive" в автономном кэше макета. Они сохраняются там при обновлении макета. В папке "Archive" находится одна или несколько папок "GUID", каждая из которых содержит устаревший манифест каталога. Количество папок "GUID" должно совпадать с количеством обновлений, внесенных в автономный кэш.

Внутри каждой папки "GUID" сохранено несколько файлов. Наибольший интерес представляют два файла — файл "version.txt" и файл "catalog.json". Файл "catalog.json" является устаревшим манифестом каталога, который потребуется для передачи в параметр `--clean`. Другой файл ("version.txt") содержит версию этого устаревшего манифеста каталога. На основе номера версии можно решить, следует ли удалять устаревшие пакеты из этого манифеста каталога. То же самое можно сделать при переходе по другим папкам "GUID". Приняв решение по поводу каталогов, которые необходимо очистить, выполните команду `--clean`, указав пути к файлам в этих каталогах.

Далее приведены несколько примеров использования параметра --clean.

```shell
vs_enterprise.exe --layout <layoutDir> --clean <file-path-of-catalog1> <file-path-of-catalog2> …
```

```shell
vs_enterprise.exe --layout <layoutDir> --clean <file-path-of-catalog1> --clean <file-path-of-catalog2> …
```

vs_enterprise.exe можно также вызвать внутри &lt;layoutDir&gt;. Ниже приведен пример:

```shell
c:\VSLayout\vs_enterprise.exe --layout c:\VSLayout --clean c:\VSLayout\Archive\1cd70189-fc55-4583-8ad8-a2711e928325\Catalog.json --clean c:\VS2017Layout\Archive\d420889f-6aad-4ba4-99e4-ed7833795a10\Catalog.json
```

При выполнении этой команды программа установки анализирует папку автономного кэша, чтобы найти список файлов, которые будут удалены. Затем вы сможете просмотреть файлы, которые будут удалены, и подтвердить удаление.

## <a name="get-support-for-your-offline-installer"></a>Техническая поддержка по вопросам, связанным с автономным установщиком

Если что-то во время автономной установки возникнет проблема, мы очень хотим узнать об этом. Передайте нам информацию с помощью средства [сообщения о проблеме](../ide/how-to-report-a-problem-with-visual-studio.md). Это средство позволяет отправлять нам данные телеметрии и журналы, которые помогут диагностировать и устранить возникшую проблему.

Также доступен [**чат поддержки в реальном времени**](https://visualstudio.microsoft.com/vs/support/#talktous), предназначенный для оказания помощи при проблемах с установкой (только на английском языке).

У нас есть и другие возможности технической поддержки. Список можно найти на нашей странице [отзывов](../ide/feedback-options.md).

## <a name="see-also"></a>См. также

* [Установка Visual Studio](install-visual-studio.md)
* [Руководство администратора Visual Studio](visual-studio-administrator-guide.md)
* [Использование параметров командной строки для установки Visual Studio](use-command-line-parameters-to-install-visual-studio.md)
* [Средства для обнаружения экземпляров Visual Studio и управления ими](tools-for-managing-visual-studio-instances.md)
* [Управление обновлением сетевых развертываний Visual Studio](controlling-updates-to-visual-studio-deployments.md)
* [Жизненный цикл и обслуживание продуктов Visual Studio](/visualstudio/releases/2019/servicing/)
