---
title: Конфигурация анализатора
ms.date: 09/02/2020
description: Узнайте, как настроить правила анализатора Roslyn. См. раздел Настройка серьезности анализатора, отключение нарушений и назначение файлов в виде созданного кода.
ms.custom: SEO-VS-2020
ms.topic: conceptual
helpviewer_keywords:
- code analysis, managed code
- analyzers
- Roslyn analyzers
author: mikadumont
ms.author: midumont
manager: jmartens
ms.workload:
- dotnet
ms.openlocfilehash: 956e63384619a82b7f0abb7dd3771ed2db9cba01
ms.sourcegitcommit: 5654b7a57a9af111a6f29239212d76086bc745c9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101684384"
---
# <a name="overview"></a>Обзор

Каждое *диагностическое* средство Roslyn Analyzer или правило имеет серьезность по умолчанию и состояние подавления, которые могут быть перезаписаны и настроены для проекта. В этой статье рассматривается настройка серьезности анализатора и подавление нарушений анализатора.

## <a name="configure-severity-levels"></a>Настройка уровней серьезности

::: moniker range=">=vs-2019"

Начиная с Visual Studio 2019 версии 16,3, можно настроить уровень серьезности правил анализатора или *диагностики* в [файле EditorConfig](#set-rule-severity-in-an-editorconfig-file)из [меню лампочки](#set-rule-severity-from-the-light-bulb-menu)и из списка ошибок.

::: moniker-end

::: moniker range="vs-2017"

При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet можно настроить серьезность правил анализатора или *диагностики*. Серьезность правила можно изменить [с Обозреватель решений](#set-rule-severity-from-solution-explorer) или [в файле набора правил](#set-rule-severity-in-the-rule-set-file).

::: moniker-end

В следующей таблице показаны различные параметры серьезности.

| Уровень серьезности (Обозреватель решений) | Уровень серьезности (файл EditorConfig) | Реакция на событие во время сборки | Реакция на событие редактора |
|-|-|-|
| Ошибка | `error` | Нарушения отображаются как *ошибки* в списке ошибок и в выходных данных сборки из командной строки и приводят к сбою сборок.| Соответствующий код ошибки подчеркнут красной волнистой линией и отмечен небольшой красной рамкой в полосе прокрутки. |
| Предупреждение | `warning` | Нарушения отображаются как *предупреждения* в списке ошибок и в выходных данных сборки из командной строки, но не приводят к сбою сборок. | Соответствующий код подчеркнут зеленой волнистой линией и отмечен небольшой зеленой рамкой в полосе прокрутки. |
| Сведения | `suggestion` | Нарушения отображаются как *сообщения* в списке ошибок и отсутствуют в выходных данных сборки из командной строки. | Соответствующий код подчеркнут серой волнистой линией и отмечен небольшой серой рамкой в полосе прокрутки. |
| Скрытый | `silent` | Невидимая для пользователя. | Невидимая для пользователя. Тем не менее данные диагностики передаются в обработчик диагностики IDE. |
| Нет | `none` | Полностью подавлена. | Полностью подавлена. |
| По умолчанию | `default` | Соответствует стандартному уровню серьезности правила. Чтобы определить, какое значение по умолчанию используется для правила, просмотрите окно свойств. | Соответствует стандартному уровню серьезности правила. |

Если анализатор обнаруживает нарушения правил, они помечаются в редакторе кода (*волнистая линия* под соответствующим кодом) и в окне "Список ошибок".

Нарушения анализаторов, приведенные в списке ошибок, соответствуют [уровню серьезности](../code-quality/use-roslyn-analyzers.md#configure-severity-levels) правила. Нарушения анализаторов выделяются в редакторе кода с помощью волнистых линий под соответствующим кодом. На следующем рисунке показаны три нарушения &mdash; одна ошибка (красная волнистая линия), одно предупреждение (зеленая волнистая линия) и одно предложение (три серые точки):

![Волнистые линии в редакторе кода в Visual Studio](media/diagnostics-severity-colors.png)

На следующем снимке экрана показаны те же три нарушения, которые отображаются в список ошибок:

![Ошибка, предупреждение и нарушение сведений в список ошибок](media/diagnostics-severities-in-error-list.png)

Многие правила анализатора или *диагностические средства* имеют одно или несколько связанных *исправлений кода*, которые можно применить для устранения нарушения правила. Исправления кода отображаются в меню со значком лампочки вместе с другими типами [быстрых действий](../ide/quick-actions.md). Сведения об этих исправлениях кода см. в разделе [Распространенные быстрые действия](../ide/quick-actions.md).

![Нарушение анализа и исправление кода быстрого действия](../code-quality/media/built-in-analyzer-code-fix.png)

### <a name="hidden-severity-versus-none-severity"></a>"Hidden" серьезность и серьезность "нет"

`Hidden` правила серьезности, включенные по умолчанию, отличаются от правил "отключено" или " `None` серьезность" несколькими способами.

- Если для правила серьезности было зарегистрировано какое-либо исправление кода `Hidden` , то исправление предлагается как действие рефакторинга кода лампочки в Visual Studio, даже если скрытая диагностика не видна пользователю. Это не так для отключенных `None` правил серьезности.
- `Hidden` правила серьезности можно настроить с помощью записей, которые [определяют серьезность правила для нескольких правил анализатора одновременно в файле EditorConfig](#set-rule-severity-of-multiple-analyzer-rules-at-once-in-an-editorconfig-file). `None` правила серьезности не могут быть настроены таким образом. Вместо этого они должны быть настроены с помощью записей, которые [задают серьезность правила в файле EditorConfig для каждого идентификатора правила](#set-rule-severity-in-an-editorconfig-file).

::: moniker range=">=vs-2019"

### <a name="set-rule-severity-in-an-editorconfig-file"></a>Задание серьезности правила в файле EditorConfig

(Visual Studio 2019 версии 16,3 и более поздних версий)

Можно задать серьезность предупреждений компилятора или правил анализатора в файле EditorConfig с помощью следующего синтаксиса:

`dotnet_diagnostic.<rule ID>.severity = <severity>`

Настройка степени серьезности правила в файле EditorConfig имеет приоритет над любым уровнем серьезности, установленным в наборе правил или в обозреватель решений. Можно [вручную](#manually-configure-rule-severity-in-an-editorconfig-file) настроить серьезность в файле EditorConfig или [автоматически](#set-rule-severity-from-the-light-bulb-menu) с помощью лампочки, отображаемой рядом с нарушением.

### <a name="set-rule-severity-of-multiple-analyzer-rules-at-once-in-an-editorconfig-file"></a>Задание серьезности правила с несколькими анализаторами одновременно в файле EditorConfig

(Visual Studio 2019 версии 16,5 и более поздних версий)

Можно задать уровень серьезности для определенной категории правил анализатора или для всех правил анализатора с одной записью в файле EditorConfig.

- Задайте серьезность правила для категории правил анализатора:

`dotnet_analyzer_diagnostic.category-<rule category>.severity = <severity>`

- Задать серьезность правила для всех правил анализатора:

`dotnet_analyzer_diagnostic.severity = <severity>`

> [!NOTE]
> Записи для настройки нескольких правил анализатора одновременно применяются только к правилам, *включенным по умолчанию*. Правила анализатора, отмеченные как отключенные по умолчанию в пакете анализатора, должны быть включены через явные `dotnet_diagnostic.<rule ID>.severity = <severity>` записи.

При наличии нескольких записей, применимых к определенному ИДЕНТИФИКАТОРу правила, для выбора применимой записи используется следующий порядок приоритета:

- Запись серьезности для отдельного правила по ИДЕНТИФИКАТОРу имеет приоритет над записью степени серьезности для категории.
- Запись серьезности для категории имеет приоритет над записью степени серьезности для всех правил анализатора.

Рассмотрим следующий пример EditorConfig, где [CA1822](/dotnet/fundamentals/code-analysis/quality-rules/ca1822) имеет категорию "производительность":

   ```ini
   [*.cs]
   dotnet_diagnostic.CA1822.severity = error
   dotnet_analyzer_diagnostic.category-performance.severity = warning
   dotnet_analyzer_diagnostic.severity = suggestion
   ```

В предыдущем примере все три записи применимы к CA1822. Однако при использовании указанных правил приоритета запись с уровнем серьезности на основе идентификатора правила WINS передается на следующие записи. В этом примере CA1822 будет иметь действительную серьезность "ошибка". Все остальные правила с категорией "производительность" будут иметь серьезность "предупреждение". Все оставшиеся правила анализатора, у которых нет категории "производительность", будут иметь серьезность "предложение".

#### <a name="manually-configure-rule-severity-in-an-editorconfig-file"></a>Настройка важности правила вручную в файле EditorConfig

1. Если у вас еще нет файла EditorConfig для проекта, [добавьте его](../ide/create-portable-custom-editor-options.md#add-an-editorconfig-file-to-a-project).

2. Добавьте запись для каждого правила, которое требуется настроить, с соответствующим расширением файла. Например, чтобы задать для [CA1822](/dotnet/fundamentals/code-analysis/quality-rules/ca1822) уровень серьезности для `error` файлов C#, запись будет выглядеть следующим образом:

   ```ini
   [*.cs]
   dotnet_diagnostic.CA1822.severity = error
   ```

> [!NOTE]
> Для анализаторов кода интегрированной среды разработки можно также настроить их в файле EditorConfig, используя другой синтаксис, например `dotnet_style_qualification_for_field = false:suggestion` . Однако если задать серьезность с помощью `dotnet_diagnostic` синтаксиса, он имеет приоритет. Дополнительные сведения см. в разделе [языковые соглашения для EditorConfig](/dotnet/fundamentals/code-analysis/style-rules/language-rules).

### <a name="set-rule-severity-from-the-light-bulb-menu"></a>Установка серьезности правила из меню лампочки

Visual Studio предоставляет удобный способ настройки серьезности правила из меню лампочки [быстрые действия](../ide/quick-actions.md) .

1. После возникновения нарушения наведите указатель мыши на нарушение в редакторе и откройте меню лампочки. Или наведите курсор на строку и нажмите клавишу **CTRL** + **.** (точка).

2. В меню лампочки выберите **Настройка или отключение проблем** > **Настройка \<rule ID> серьезности**.

   ![Настройка серьезности правила из меню лампочки в Visual Studio](media/configure-rule-severity.png)

3. В нем выберите один из вариантов серьезности.

   ![Настройка серьезности правила в качестве предложения](media/configure-rule-severity-suggestion.png)

   Visual Studio добавляет запись в файл EditorConfig, чтобы настроить правило на запрошенном уровне, как показано в поле предварительного просмотра.

   > [!TIP]
   > Если в проекте еще нет файла EditorConfig, Visual Studio создаст его.

### <a name="set-rule-severity-from-the-error-list-window"></a>Задание серьезности правила в окне список ошибок

Visual Studio также предоставляет удобный способ настройки серьезности правила из контекстного меню списка ошибок.

1. После возникновения нарушения щелкните правой кнопкой мыши запись диагностики в списке ошибок.

2. В контекстном меню выберите **задать серьезность**.

   ![Настройка серьезности правила из списка ошибок в Visual Studio](media/configure-rule-severity-error-list.png)

3. В нем выберите один из вариантов серьезности.

   Visual Studio добавляет запись в файл EditorConfig, чтобы настроить правило на запрошенном уровне.

   > [!TIP]
   > Если в проекте еще нет файла EditorConfig, Visual Studio создаст его.

::: moniker-end

### <a name="set-rule-severity-from-solution-explorer"></a>Установка серьезности правила с обозреватель решений

Большую часть настройки диагностики анализатора можно выполнить из **Обозреватель решений**. При [установке анализаторов](../code-quality/install-roslyn-analyzers.md) в качестве пакета NuGet узел **анализаторов** отображается в узле **ссылки** или **зависимости** в **Обозреватель решений**. Если развернуть **анализаторы**, а затем развернуть одну из сборок анализатора, отобразятся все диагностические сведения в сборке.

![Узел «Анализаторы» в обозреватель решений](media/analyzers-expanded-in-solution-explorer.png)

Свойства диагностики, включая ее описание и серьезность по умолчанию, можно просмотреть в окне **Свойства** . Чтобы просмотреть свойства, щелкните правило правой кнопкой мыши и выберите пункт **Свойства** или выберите правило, а затем нажмите клавишу **ALT** + **Ввод**.

![Свойства диагностики в окно свойств](media/analyzer-diagnostic-properties.png)

Чтобы просмотреть электронную документацию по диагностике, щелкните правой кнопкой мыши диагностику и выберите команду **просмотреть справку**.

Значки рядом с каждой диагностикой в **Обозреватель решений** соответствуют значкам, отображаемым в наборе правил при его открытии в редакторе:

- "x" в окружности обозначает [серьезность](#configure-severity-levels) **ошибки**
- знак "!" в треугольнике указывает на [серьезность](#configure-severity-levels) **предупреждения**
- "i" в окружности обозначает [серьезность](#configure-severity-levels) **информации**
- «i» в круге на светло-цветном фоне указывает на [серьезность](#configure-severity-levels) **скрытого**
- направленная вниз стрелка в окружности означает, что диагностика подавлена

![Значки диагностики в обозреватель решений](media/diagnostics-icons-solution-explorer.png)

::: moniker range=">=vs-2019"

#### <a name="convert-an-existing-ruleset-file-to-editorconfig-file"></a>Преобразование существующего файла набора правил в файл EditorConfig

Начиная с Visual Studio 2019 версии 16,5, файлы RuleSet не рекомендуются в пользу файла EditorConfig для настройки анализатора для управляемого кода. Большая часть конфигурации серьезности правил анализатора Visual Studio была обновлена для работы с файлами EditorConfig вместо RuleSet Files. Файлы EditorConfig позволяют настраивать серьезность правил и параметры анализатора, включая параметры стиля кода интегрированной среды разработки Visual Studio. Настоятельно рекомендуется преобразовать существующий RuleSet-файл в файл EditorConfig. Также рекомендуется сохранить файл EditorConfig в корне репозитория или в папке решения. Используя корневой каталог репозитория или папки решения, вы убедитесь, что параметры серьезности из этого файла автоматически применяются ко всему репозиторию или решению соответственно.

Существует несколько способов преобразования существующего RuleSet-файла в файл EditorConfig:

- В редакторе набора правил в Visual Studio (требуется Visual Studio 2019 16,5 или более поздней версии). Если в проекте уже используется конкретный файл RuleSet `CodeAnalysisRuleSet` , его можно преобразовать в эквивалентный файл EditorConfig из редактора набора правил в Visual Studio.

    1. Дважды щелкните файл RuleSet в обозреватель решений.

       Файл набора правил должен быть открыт в редакторе набора правил. В верхней части редактора набора правил должна отобразиться отображаемая **информационная панель** .

       ![Преобразование набора правил в файл EditorConfig в редакторе набора правил](media/convert-ruleset-to-editorconfig-file-ruleset-editor.png)

    2. Щелкните ссылку на **информационную панель** .

       Откроется диалоговое окно **Сохранить как** , в котором можно выбрать каталог, в котором нужно создать файл EditorConfig.

    3. Нажмите кнопку **сохранить** , чтобы создать файл EditorConfig.

       Созданный EditorConfig должен быть открыт в редакторе. Кроме того, свойство MSBuild `CodeAnalysisRuleSet` обновляется в файле проекта, чтобы оно больше не ссылалось на исходный файл RuleSet.

- Из командной строки.

    1. Установите пакет NuGet [Microsoft. CodeAnalysis. рулесеттоедиторконфигконвертер](https://www.nuget.org/packages/Microsoft.CodeAnalysis.RulesetToEditorconfigConverter).

    2. Выполните `RulesetToEditorconfigConverter.exe` из установленного пакета с путями к файлу набора правил и файлом EditorConfig в качестве аргументов командной строки.

   ```
   Usage: RulesetToEditorconfigConverter.exe <%ruleset_file%> [<%path_to_editorconfig%>]
   ```

Ниже приведен пример RuleSet-файла для преобразования:

```xml
<?xml version="1.0" encoding="utf-8"?>
<RuleSet Name="Rules for ConsoleApp" Description="Code analysis rules for ConsoleApp.csproj." ToolsVersion="16.0">
  <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
    <Rule Id="CA1001" Action="Warning" />
    <Rule Id="CA1821" Action="Warning" />
    <Rule Id="CA2213" Action="Warning" />
    <Rule Id="CA2231" Action="Warning" />
  </Rules>
</RuleSet>
```

Ниже приведен преобразованный файл EditorConfig:

```ini
# NOTE: Requires **VS2019 16.3** or later

# Rules for ConsoleApp
# Description: Code analysis rules for ConsoleApp.csproj.

# Code files
[*.{cs,vb}]


dotnet_diagnostic.CA1001.severity = warning

dotnet_diagnostic.CA1821.severity = warning

dotnet_diagnostic.CA2213.severity = warning

dotnet_diagnostic.CA2231.severity = warning
```
::: moniker-end

### <a name="set-rule-severity-from-solution-explorer"></a>Установка серьезности правила с обозреватель решений

1. В Обозреватель решений разверните узел   >  **анализаторы** ссылок (или   >  **анализаторы** зависимостей для проектов .NET Core).

2. Разверните сборку, содержащую правило, для которого нужно задать серьезность.

::: moniker range=">=vs-2019"
3. Щелкните правило правой кнопкой мыши и выберите пункт **задать серьезность**. В контекстном меню выберите один из параметров серьезности.

   Visual Studio добавляет запись в файл EditorConfig, чтобы настроить правило на запрошенном уровне. Если в проекте используется файл набора правил вместо EditorConfig-файла, запись о серьезности добавляется в RuleSet-файл.

   > [!TIP]
   > Если в проекте еще нет файла EditorConfig или RuleSet, Visual Studio создаст для вас новый файл EditorConfig.
::: moniker-end

::: moniker range="vs-2017"
3. Щелкните правило правой кнопкой мыши и выберите пункт **задать серьезность набора правил**. В контекстном меню выберите один из параметров серьезности.

   Уровень серьезности для правила сохраняется в файле активного набора правил.
::: moniker-end

### <a name="set-rule-severity-in-the-rule-set-file"></a>Задание серьезности правила в файле набора правил

![Файл набора правил в обозреватель решений](media/ruleset-in-solution-explorer.png)

1. Откройте активный файл набора правил одним из следующих способов:

- В **Обозреватель решений** дважды щелкните файл, щелкните правой кнопкой мыши узел   >  **анализаторы** ссылок и выберите команду **Открыть активный набор правил**.
- На странице свойств **анализ кода** для проекта выберите **Открыть** .

  Если вы изменяете набор правил в первый раз, Visual Studio создает копию файла набора правил по умолчанию, присваивает ему имя *\<projectname> . RuleSet* и добавляет его в проект. Этот настраиваемый набор правил также станет активным набором правил для вашего проекта.

   > [!NOTE]
   > Проекты .NET Core и .NET Standard не поддерживают команды меню для наборов правил в **Обозреватель решений**, например **Открыть активный набор правил**. Чтобы указать набор правил, не используемый по умолчанию для проекта .NET Core или .NET Standard, [добавьте свойство **кодеаналисисрулесет**](using-rule-sets-to-group-code-analysis-rules.md#specify-a-rule-set-for-a-project) в файл проекта вручную. Вы по-прежнему можете настроить правила в наборе правил в пользовательском интерфейсе редактора набора правил Visual Studio.

1. Перейдите к правилу, развернув его содержащую его сборку.

1. В столбце **действие** выберите значение, чтобы открыть раскрывающийся список, и выберите нужную важность из списка.

   ![Файл набора правил открыт в редакторе](media/ruleset-file-in-editor.png)

::: moniker range=">=vs-2019"

## <a name="configure-generated-code"></a>Настройка созданного кода

Анализаторы выполняются на всех исходных файлах в проекте и сообщают о нарушениях на них. Однако эти нарушения не применяются к созданным файлам кода, таким как файлы кода, созданные конструктором, временные исходные файлы, созданные системой сборки и т. д. Пользователи не могут вручную изменять эти файлы и (или) не беспокоиться об устранении нарушений в таких файлах, созданных с помощью инструментария.

По умолчанию драйвер анализатора, который выполняет анализаторы, обрабатывает файлы с определенным именем, расширением или автоматически созданным заголовком файла в виде созданных файлов кода. Например, имя файла, завершающее `.designer.cs` или `.generated.cs` , считается сгенерированным кодом. Однако эти эвристики могут не иметь возможности определять все пользовательские файлы кода, созданные в исходном коде пользователя.

Начиная с Visual Studio 2019 16,5, конечные пользователи могут настраивать определенные файлы и (или) папки для обработки в виде сформированного кода в [файле EditorConfig](https://editorconfig.org/). Чтобы добавить такую конфигурацию, выполните следующие действия.

1. Если у вас еще нет файла EditorConfig для проекта, [добавьте его](../ide/create-portable-custom-editor-options.md#add-an-editorconfig-file-to-a-project).

2. Добавление `generated_code = true | false` записи для конкретных файлов и папок. Например, чтобы обрабатывать все файлы, имена которых заканчиваются на `.MyGenerated.cs` сформированном коде, запись будет выглядеть следующим образом:

   ```ini
   [*.MyGenerated.cs]
   generated_code = true
   ```

::: moniker-end

## <a name="suppress-violations"></a>Подавлять нарушения

Существует несколько способов подавления нарушений правил.

::: moniker range=">=vs-2019"

- В **файле EditorConfig**

  Задайте уровень серьезности `none` , например `dotnet_diagnostic.CA1822.severity = none` .

- В меню **анализ**

  Выберите **анализировать**  >  **сборку и подавлять активные проблемы** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

::: moniker-end

::: moniker range="vs-2017"

- В меню **анализ**

  Выберите **анализ**  >  **выполнение анализа кода и подавление активных проблем** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

::: moniker-end

- Из **Обозреватель решений**

  Задайте для правила серьезность **нет**.

- Из **редактора набора правил**

  Снимите флажок рядом с его именем или **действием** задать значение **нет**.

- В **редакторе кода**

  Поместите курсор в строку кода с нарушением и нажмите клавишу **CTRL** + **(.)** , чтобы открыть меню **быстрые действия** . Установите флажок **подавлять какскскскс**  >  **в файле источника/в подавлении**.

  ![Подавлять диагностику в меню быстрых действий](media/suppress-diagnostic-from-editor.png)

- Из **Список ошибок**

  Выберите правила, которые необходимо отключить, и щелкните правой кнопкой мыши и выберите пункт **подавлять**  >  **в файле источника/в подавлении**.

  - При подавлении **в исходном** коде открывается диалоговое окно **предварительного просмотра изменений** , в котором отображается предварительная версия C# [#pragma warning](/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-pragma-warning) или Visual Basic [#Disable предупреждения](/dotnet/visual-basic/language-reference/directives/directives) , добавленные в исходный код.

    ![Предварительный просмотр добавления #pragma предупреждения в файл кода](media/pragma-warning-preview.png)

  - Если выбрать параметр **в файле подавления**, откроется диалоговое окно **Предварительный просмотр изменений** , в котором будет показан предварительный просмотр <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибута, добавленного в глобальный файл подавления.

    ![Предварительный просмотр добавления атрибута SuppressMessage в файл подавления](media/preview-changes-in-suppression-file.png)

  В диалоговом окне **Просмотр изменений** нажмите кнопку **Применить**.

  > [!NOTE]
  > Если в **Обозреватель решений** не отображается пункт **подавить** , то, скорее всего, это произошло из-за сборки, а не для интерактивного анализа. **Список ошибок** отображает диагностические или нарушения правил, как в реальном коде, так и в сборке. Так как диагностика сборки может быть устаревшей, например, если вы изменили код, чтобы устранить нарушение, но оно не было перестроено, вы не сможете отключить эти диагностические данные от **Список ошибок**. Диагностика из интерактивного анализа или IntelliSense всегда актуальны с текущими источниками и могут быть подавлены из **Список ошибок**. Чтобы исключить диагностику *сборки* из выбора, переключите фильтр источника **Список ошибок** с **сборки + IntelliSense** на **IntelliSense**. Затем выберите диагностику, которую необходимо отключить, и продолжайте, как описано выше.
  >
  > ![Фильтр источника список ошибок в Visual Studio](media/error-list-filter.png)

## <a name="command-line-usage"></a>Использование командной строки

При сборке проекта в командной строке нарушения правил появляются в выходных данных сборки, если выполняются следующие условия.

- Анализаторы устанавливаются вместе с пакетом SDK для .NET или как пакет NuGet, а не как расширение VSIX.

  Для анализаторов, установленных с помощью пакета SDK для .NET, может потребоваться [включить анализаторы](../code-quality/install-net-analyzers.md). Для стилей кода можно также [Применить стили кода при сборке](/dotnet/fundamentals/code-analysis/overview#code-style-analysis) , задав свойство MSBuild.

- В коде проекта нарушается одно или несколько правил.

- [Серьезность](#configure-severity-levels) нарушенного правила задана как **предупреждение**, и в этом случае нарушения не приводят к сбою сборки, или **Ошибка**, в этом случае нарушения могут привести к сбою сборки.

Уровень детализации выходных данных сборки не влияет на отображение нарушений правил. Даже при **неавтоматическом** уровне детализации нарушения правил появляются в выходных данных сборки.

> [!TIP]
> Если вы привыкли выполнять анализ прежних версий из командной строки с помощью *FxCopCmd.exe* или с помощью MSBuild с флагом **рункодеаналисис** , это можно сделать с помощью анализаторов кода.

Чтобы просмотреть нарушения анализатора в командной строке при сборке проекта с помощью MSBuild, выполните следующую команду:

```cmd
msbuild myproject.csproj /target:rebuild /verbosity:minimal
```

На следующем изображении показаны выходные данные сборки из командной строки для создания проекта, содержащего нарушение правила анализа:

![Выходные данные MSBuild с нарушением правила](media/command-line-build-analyzers.png)

## <a name="dependent-projects"></a>Зависимые проекты

В проекте .NET Core при добавлении ссылки на проект, который содержит анализаторы NuGet, эти анализаторы автоматически добавляются в зависимый проект. Чтобы отключить такое поведение, например, если зависимый проект является проектом модульного теста, пометьте пакет NuGet как частный в *CSPROJ* -или *VBPROJ* -файле проекта, на который указывает ссылка, установив атрибут **PrivateAssets** :

```xml
<PackageReference Include="Microsoft.CodeAnalysis.NetAnalyzers" Version="5.0.0" PrivateAssets="all" />
```

## <a name="see-also"></a>См. также раздел

- [Обзор анализаторов кода в Visual Studio](../code-quality/roslyn-analyzers-overview.md)
- [Отправка ошибки анализатора кода](https://github.com/dotnet/roslyn-analyzers/issues)
- [Использование наборов правил](../code-quality/using-rule-sets-to-group-code-analysis-rules.md)
- [Подавлять предупреждения анализа кода](../code-quality/in-source-suppression-overview.md)
- [Параметры конфигурации для анализа кода (.NET)](/dotnet/fundamentals/code-analysis/configuration-options)
