---
title: Подавление нарушений анализа кода
ms.date: 05/10/2021
description: Сведения о подавлении нарушений анализа кода в Visual Studio. Узнайте, как использовать атрибут Суппрессмессажеаттрибуте для подавления в исходном источнике.
ms.custom: SEO-VS-2020
ms.topic: conceptual
helpviewer_keywords:
- source suppression, code analysis
- code analysis, source suppression
author: mikadumont
ms.author: midumont
manager: jmartens
dev_langs:
- CSharp
- VB
- CPP
ms.workload:
- multiple
ms.openlocfilehash: fd177a96b8789760927933fad5c0320553a72f57
ms.sourcegitcommit: 162be102d2c22a1c4ad2c447685abd28e0e85d15
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2021
ms.locfileid: "109973347"
---
# <a name="suppress-code-analysis-violations"></a>Подавление нарушений анализа кода

Часто бывает полезно указать, что предупреждение неприменимо. Это указывает членам команды, что код был проверен, и что предупреждение можно подавлять. В этой статье описываются различные способы отключения нарушений анализа кода с помощью интегрированной среды разработки Visual Studio.

::: moniker range=">=vs-2019"

## <a name="suppress-violations-using-the-editorconfig-file"></a>Подавлять нарушения с помощью файла EditorConfig

В **файле EditorConfig** задайте уровень серьезности `none` , например `dotnet_diagnostic.CA1822.severity = none` . Сведения о добавлении файла EditorConfig см. в разделе [Добавление файла EditorConfig в проект](../ide/create-portable-custom-editor-options.md#add-and-remove-editorconfig-files).

::: moniker-end

## <a name="suppress-violations-in-source-code"></a>Подавлять нарушения в исходном коде

Можно подавлять нарушения в коде с помощью директивы препроцессора, [#pragma warning (C#)](/dotnet/csharp/language-reference/preprocessor-directives.md#pragma-warning) или [Disable (Visual Basic)](/dotnet/visual-basic/language-reference/directives/disable-enable.md) , чтобы подавлять предупреждение только для определенной строки кода. Или можно использовать [атрибут SuppressMessage](#in-source-suppression-and-the-suppressmessage-attribute).

- В **редакторе кода**

  Поместите курсор в строку кода с нарушением и нажмите клавишу **CTRL** + **(.)** , чтобы открыть меню **быстрые действия** . Выберите **ПОДАВЛЯТЬ какскскскс**, а затем выберите **в источнике** или **в источнике (атрибут)**.

  При выборе **в поле Источник** вы увидите предварительную версию директивы препроцессора, которая будет добавлена в код.

  ::: moniker range="vs-2017"
  :::image type="content" source="media/suppress-diagnostic-from-editor.png" alt-text="Подавлять диагностику в меню быстрых действий":::
  ::: moniker-end
  ::: moniker range=">=vs-2019"
  :::image type="content" source="media/vs-2019/suppress-diagnostic-from-editor.png" alt-text="Подавлять диагностику в меню быстрых действий":::

  При выборе **в поле Источник (атрибут)** отображается предварительный просмотр [атрибута SuppressMessage](#in-source-suppression-and-the-suppressmessage-attribute) , который будет добавлен в код.

  :::image type="content" source="media/vs-2019/suppress-diagnostic-from-editor-attribute.png" alt-text="Подавлять диагностику в меню быстрых действий с помощью атрибута":::
  ::: moniker-end

- Из **Список ошибок**

  Выберите правила, которые необходимо отключить, и щелкните правой кнопкой мыши и выберите **подавлять**  >  **в источнике**.

  - При подавлении **в исходном** коде открывается диалоговое окно **предварительного просмотра изменений** , в котором отображается предварительная версия C# [#pragma warning](/dotnet/csharp/language-reference/preprocessor-directives/preprocessor-pragma-warning) или Visual Basic [#Disable предупреждения](/dotnet/visual-basic/language-reference/directives/directives) , добавленные в исходный код.

    ![Предварительный просмотр добавления #pragma предупреждения в файл кода](media/pragma-warning-preview.png)

  В диалоговом окне **Просмотр изменений** нажмите кнопку **Применить**.

  > [!NOTE]
  > Если в **Обозреватель решений** не отображается пункт **подавить** , то, скорее всего, это произошло из-за сборки, а не для интерактивного анализа. **Список ошибок** отображает диагностические или нарушения правил, как в реальном коде, так и в сборке. Так как диагностика сборки может быть устаревшей, например, если вы изменили код, чтобы устранить нарушение, но оно не было перестроено, вы не сможете отключить эти диагностические данные от **Список ошибок**. Диагностика из интерактивного анализа или IntelliSense всегда актуальны с текущими источниками и могут быть подавлены из **Список ошибок**. Чтобы исключить диагностику *сборки* из выбора, переключите фильтр источника **Список ошибок** с **сборки + IntelliSense** на **IntelliSense**. Затем выберите диагностику, которую необходимо отключить, и продолжайте, как описано выше.
  >
  > ![Фильтр источника список ошибок в Visual Studio](media/error-list-filter.png)

## <a name="suppress-violations-using-a-global-suppression-file"></a>Подавлять нарушения с помощью файла глобального подавления

В [глобальном файле подавления](#global-level-suppressions) используется [атрибут SuppressMessage](#in-source-suppression-and-the-suppressmessage-attribute).

- На **Список ошибок** выберите правила, которые необходимо отключить, а затем щелкните правой кнопкой мыши и выберите пункт **подавлять**  >  **в файле подавления**. Откроется диалоговое окно **Просмотр изменений** , в котором будет показан предварительный просмотр <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибута, добавляемого в глобальный файл подавления.

  ![Предварительный просмотр добавления атрибута SuppressMessage в файл подавления](media/preview-changes-in-suppression-file.png)

- В **редакторе кода** поместите курсор в строку кода с нарушением и нажмите клавиши **быстрого действия и рефакторинга** (или нажмите клавишу **CTRL** + **period (...)**), чтобы открыть меню **быстрые действия** . Выберите **ПОДАВЛЯТЬ какскскскс**, а затем выберите **в файле подавления**. Вы увидите предварительную версию [файла глобального подавления](#global-level-suppressions) , который будет создан или изменен.

::: moniker range=">=vs-2019"

- В меню **анализ** выберите пункт **анализировать**  >  **сборку и подавлять активные проблемы** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".

::: moniker-end
::: moniker range="vs-2017"

- В меню **анализ** выберите **анализ**  >  **выполнение анализа кода и подавление активных проблем** в строке меню, чтобы отключить все текущие нарушения. Иногда это называется "задания базовых показателей".
::: moniker-end

## <a name="suppress-violations-using-project-settings"></a>Подавлять нарушения с помощью параметров проекта

В **Обозреватель решений** откройте свойства проекта (щелкните проект правой кнопкой мыши и выберите **свойства** (или нажмите клавиши **ALT + ВВОД**) и настройте параметры с помощью вкладки **анализ кода** . Например, можно отключить интерактивный анализ кода или отключить анализаторы .NET.

## <a name="suppress-violations-using-a-rule-set"></a>Подавлять нарушения с помощью набора правил

В **редакторе набора правил** снимите флажок рядом с его именем или **действием** задать значение **нет**.

## <a name="in-source-suppression-and-the-suppressmessage-attribute"></a>Подавление в исходном код и атрибут SuppressMessage

Подавление в исходном код (ISS) использует <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибут для подавления предупреждения. Атрибут можно поместить ближе к сегменту кода, вызвавшему предупреждение. Можно добавить <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибут в исходный файл, введя его в, или можно использовать контекстное меню предупреждения в **Список ошибок** , чтобы добавить его автоматически.

<xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute>Атрибут является условным атрибутом, включенным в метаданные Il сборки управляемого кода, только если символ компиляции CODE_ANALYSIS определен во время компиляции.

В C++/CLI для добавления атрибута используйте ЦС макросов \_ Отключить \_ сообщение или \_ глобальный \_ SUPPRESS_MESSAGE CA в файле заголовка.

> [!NOTE]
> Не следует использовать подавления в исходном виде в сборках выпуска, чтобы предотвратить случайное пересылку метаданных подавления в исходном источнике. Кроме того, из-за затрат на обработку подавления в исходном коде производительность приложения может снизиться.

::: moniker range="vs-2017"

> [!NOTE]
> Если вы переносите проект в Visual Studio 2017, вы можете внезапно столкнуться с большим количеством предупреждений анализа кода. Если вы не готовы устранить предупреждения, их можно отключить, выбрав пункт **анализ**  >  **выполнения анализа кода и подавлять активные проблемы**.
>
> ![Выполнение анализа кода и отключение проблем в Visual Studio](media/suppress-active-issues.png)

::: moniker-end

::: moniker range=">=vs-2019&quot;

> [!NOTE]
> Если вы переносите проект в Visual Studio 2019, вы можете внезапно столкнуться с большим количеством предупреждений анализа кода. Если вы не готовы устранить предупреждения, их можно отключить, выбрав пункт **анализировать**  >  **сборку и подавлять активные проблемы**.

::: moniker-end

### <a name=&quot;suppressmessage-attribute&quot;></a>SuppressMessage - атрибут

При выборе параметра **подавлять** в контекстном меню или щелчке правой кнопкой мыши предупреждения анализа кода в **Список ошибок** <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибут добавляется либо в код, либо в глобальный файл подавления проекта.

<xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute>Атрибут имеет следующий формат:

```vb
<Scope:SuppressMessage(&quot;Rule Category&quot;, &quot;Rule Id&quot;, Justification = &quot;Justification&quot;, MessageId = &quot;MessageId&quot;, Scope = &quot;Scope&quot;, Target = &quot;Target")>
```

```csharp
[Scope:SuppressMessage("Rule Category", "Rule Id", Justification = "Justification", MessageId = "MessageId", Scope = "Scope", Target = "Target")]
```

```cpp
CA_SUPPRESS_MESSAGE("Rule Category", "Rule Id", Justification = "Justification", MessageId = "MessageId", Scope = "Scope", Target = "Target")
```

К свойствам атрибута относятся:

- **Category** — Категория, в которой определено правило. Дополнительные сведения о категориях правил анализа кода см. в разделе [предупреждения управляемого кода](/dotnet/fundamentals/code-analysis/quality-rules/index).

- **CheckId** — идентификатор правила. Поддержка включает короткое и длинное имя для идентификатора правила. Короткое имя — КАКСКСКСКС; длинное имя — КАКСКСКСКС: Фриендлитипенаме.

- **Обоснование** — текст, который используется для документирования причины подавления сообщения.

- **MessageId** — уникальный идентификатор проблемы для каждого сообщения.

- **Scope** — целевой объект, в котором предупреждение подавляется. Если целевой объект не указан, ему присваивается значение целевого объекта атрибута. В число поддерживаемых [областей](xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute.Scope) входят следующие.

  - [`module`](#module-suppression-scope) — Эта область подавляет предупреждения для сборки. Это глобальное подавление, которое применяется ко всему проекту.

  - `resource` -(только для[устаревшей версии FxCop](../code-quality/static-code-analysis-for-managed-code-overview.md) ) Эта область подавляет предупреждения в диагностических сведениях, записанных в файлы ресурсов, которые являются частью модуля (сборки). Эта область не считывается и не учитывается в компиляторах C#/VB для диагностики анализатора Roslyn, которая анализирует только исходные файлы.

  - `type` — Эта область подавляет предупреждения для типа.

  - `member` — Эта область подавляет предупреждения для элемента.

  - `namespace` — Эта область подавляет предупреждения относительно пространства имен. Он не отключает предупреждения для типов в пространстве имен.

  - `namespaceanddescendants` -(Требуется компилятор версии 3. x или выше и Visual Studio 2019) Эта область подавляет предупреждения в пространстве имен и всех его дочерних символах. `namespaceanddescendants`Значение игнорируется устаревшим анализом.

- **Target** — идентификатор, который используется для указания целевого объекта, в котором предупреждение подавляется. Он должен содержать полное имя элемента.

При отображении предупреждений в Visual Studio можно просмотреть примеры `SuppressMessage` , [добавив подавление в глобальный файл подавления](../code-quality/use-roslyn-analyzers.md#suppress-violations). Атрибут подавления и его обязательные свойства отображаются в окне предварительного просмотра.

### <a name="suppressmessage-usage"></a>Использование SuppressMessage

Предупреждения анализа кода подавляются на уровне, к которому <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> применяется атрибут. Например, атрибут можно применить на уровне сборки, модуля, типа, члена или параметра. Целью этого является тесное связывание информации о подавлении с кодом, в котором происходит нарушение.

Общая форма подавления включает категорию правила и идентификатор правила, который содержит необязательное удобное для восприятия представление имени правила. Пример:

`[SuppressMessage("Microsoft.Design", "CA1039:ListsAreStrongTyped")]`

При наличии достаточной производительности для минимизации метаданных подавления в исходном виде имя правила можно опустить. Категория правила и идентификатор его правила вместе составляют достаточно уникальный идентификатор правила. Пример:

`[SuppressMessage("Microsoft.Design", "CA1039")]`

В целях удобства обслуживания не рекомендуется указывать имя правила.

### <a name="suppress-selective-violations-within-a-method-body"></a>Подавлять выборочные нарушения внутри тела метода

К методу могут применяться атрибуты подавления, но они не могут быть внедрены в тело метода. Это означает, что все нарушения конкретного правила подавляются при добавлении <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибута в метод.

В некоторых случаях может потребоваться отключить определенный экземпляр нарушения, например таким образом, чтобы будущий код не выводился автоматически из правила анализа кода. Некоторые правила анализа кода позволяют сделать это с помощью `MessageId` свойства <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибута. В общем случае устаревшие правила для нарушений в конкретном символе (локальная переменная или параметр) учитывают `MessageId` свойство. [CA1500: вариабленамесшаулднотматчфиелднамес](../code-quality/ca1500.md) — это пример такого правила. Однако устаревшие правила нарушения работы исполняемого кода (не символа) не учитывают `MessageId` свойство. Кроме того, анализаторы .NET Compiler Platform ("Roslyn") не учитывают `MessageId` свойство.

Чтобы отключить определенное нарушение правила, укажите имя символа для `MessageId` свойства <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute> атрибута. В следующем примере показан код с двумя нарушениями [CA1500: вариабленамесшаулднотматчфиелднамес](../code-quality/ca1500.md) &mdash; один для `name` переменной и другой для `age` переменной. Подавляется только нарушение для `age` символа.

```vb
Public Class Animal
    Dim age As Integer
    Dim name As String

    <CodeAnalysis.SuppressMessage("Microsoft.Maintainability", "CA1500:VariableNamesShouldNotMatchFieldNames", MessageId:="age")>
    Sub PrintInfo()
        Dim age As Integer = 5
        Dim name As String = "Charlie"

        Console.WriteLine("Age {0}, Name {1}", age, name)
    End Sub

End Class
```

```csharp
public class Animal
{
    int age;
    string name;

    [System.Diagnostics.CodeAnalysis.SuppressMessage("Microsoft.Maintainability", "CA1500:VariableNamesShouldNotMatchFieldNames", MessageId = "age")]
    private void PrintInfo()
    {
        int age = 5;
        string name = "Charlie";

        Console.WriteLine($"Age {age}, Name {name}");
    }
}
```

### <a name="global-level-suppressions"></a>Подавления на глобальном уровне

Средство анализа управляемого кода проверяет `SuppressMessage` атрибуты, которые применяются на уровне сборки, модуля, типа, члена или параметра. Он также вызывает нарушения для ресурсов и пространств имен. Эти нарушения должны применяться на глобальном уровне, а их область и Целевая. Например, следующее сообщение подавляет нарушение пространства имен:

`[module: SuppressMessage("Microsoft.Design", "CA1020:AvoidNamespacesWithFewTypes", Scope = "namespace", Target = "MyNamespace")]`

> [!NOTE]
> При подавлении предупреждения с `namespace` областью предупреждение подавляется по самому пространству имен. Предупреждение не подавляется по типам в пространстве имен.

Все подавления можно выразить, указав явную область. Эти подавления должны находиться на глобальном уровне. Подавление на уровне члена нельзя указать путем оформления типа.

Запреты глобального уровня — это единственный способ отключить сообщения, ссылающиеся на созданный компилятором код, который не сопоставлен с явно предоставленным источником пользователя. Например, следующий код подавляет нарушение в конструкторе, созданном компилятором:

`[module: SuppressMessage("Microsoft.Design", "CA1055:AbstractTypesDoNotHavePublicConstructors", Scope="member", Target="Microsoft.Tools.FxCop.Type..ctor()")]`

> [!NOTE]
> `Target` всегда содержит полное имя элемента.

#### <a name="global-suppression-file"></a>Файл глобального подавления

В глобальном файле подавления хранятся подавленные подавления или подавления на глобальном уровне, не указывающие цель. Например, подавление для нарушений уровня сборки хранится в этом файле. Кроме того, некоторые подавления ASP.NET хранятся в этом файле, так как параметры уровня проекта недоступны для кода, который находится под формой. Файл глобального подавления создается и добавляется в проект при первом выборе параметра **в файле подавления проекта** команды **подавлять** в окне **Список ошибок** .

#### <a name="module-suppression-scope"></a>Область подавления модуля

Нарушения качества кода для всей сборки можно отключить с помощью области **модуля** .

Например, следующий атрибут в файле проекта _глобалсуппрессионс_ будет подавлять нарушение ConfigureAwait для проекта ASP.NET Core:

`[assembly: System.Diagnostics.CodeAnalysis.SuppressMessage("Reliability", "CA2007:Consider calling ConfigureAwait on the awaited task", Justification = "ASP.NET Core doesn't use thread context to store request context.", Scope = "module")]`

### <a name="generated-code"></a>Созданный код

Компиляторы управляемого кода и некоторые сторонние средства создают код для упрощения разработки кода. Созданный компилятором код, который отображается в исходных файлах, обычно отмечается `GeneratedCodeAttribute` атрибутом.

Для анализа исходного кода можно подавить сообщения в созданном коде в `.editorconfig` файле. Дополнительные сведения см. в разделе [исключение созданного кода](/dotnet/fundamentals/code-analysis/configuration-options#exclude-generated-code).

Для традиционного анализа кода можно выбрать, следует ли подавлять предупреждения и ошибки анализа кода для созданного кода. Сведения о подавлении таких предупреждений и ошибок см. [в разделе как отключить предупреждения для созданного кода](../code-quality/how-to-suppress-code-analysis-warnings-for-generated-code.md).

> [!NOTE]
> Анализ кода игнорируется `GeneratedCodeAttribute` при применении к целой сборке или одному параметру.

## <a name="see-also"></a>См. также раздел

- <xref:System.Diagnostics.CodeAnalysis.SuppressMessageAttribute.Scope>
- <xref:System.Diagnostics.CodeAnalysis>
- [Использование анализаторов кода](../code-quality/use-roslyn-analyzers.md)
