---
title: 'Схемы зависимостей: рекомендации'
description: Узнайте, как описать архитектуру приложения на высоком уровне, создав схемы зависимостей в Visual Studio.
ms.custom: SEO-VS-2020
ms.date: 09/28/2018
ms.topic: conceptual
helpviewer_keywords:
- architecture, dependency diagrams
- dependency diagrams
- diagrams - modeling, layer
- constraints, architectural
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: f46e2b774cd4da2ef9cdb9ddef7efd19f731ade7
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112391027"
---
# <a name="dependency-diagrams-guidelines"></a>Схемы зависимостей: рекомендации

Опишите архитектуру приложения на высоком уровне, создавая *схемы зависимостей* в Visual Studio. Убедитесь, что код остается согласованным с этим дизайном, проверив код с помощью схемы зависимостей. В процесс сборки также можно включить проверку слоев. См. [видео Channel 9: проектирование и проверка архитектуры с помощью схем зависимостей](https://channel9.msdn.com/Series/Visual-Studio-2012-Premium-and-Ultimate-Overview/Visual-Studio-Ultimate-2012-Using-layer-diagrams-to-design-and-validate-your-architecture).

Чтобы узнать, какие выпуски Visual Studio поддерживают эту функцию, см. раздел [Поддержка инструментов моделирования и архитектуры в различных выпусках](../modeling/analyze-and-model-your-architecture.md#VersionSupport).

> [!NOTE]
> Схемы зависимостей для проектов .NET Core поддерживаются начиная с Visual Studio 2019 версии 16,2.

## <a name="what-is-a-dependency-diagram"></a>Что такое схема зависимостей?

Как и в традиционной схеме архитектуры, схема зависимостей определяет основные компоненты и функциональные единицы проектирования и их взаимозависимости. Каждый узел на схеме, называемый *слоем*, представляет логическую группу пространств имен, проектов или других артефактов. Можно нарисовать зависимости для своей разработки. В отличие от традиционной схемы архитектуры, можно проверить, соответствуют ли действительные зависимости заданным вами предполагаемым зависимостям. Делая проверку частью стандартного построения в [!INCLUDE[esprtfs](../code-quality/includes/esprtfs_md.md)], можно добиться того, чтобы программный код продолжал придерживаться архитектуры системы при дальнейших изменениях. См. раздел [схемы зависимостей: Справочник](../modeling/layer-diagrams-reference.md).

## <a name="how-to-design-or-update-your-app-with-dependency-diagrams"></a>Разработка и обновление приложений с помощью схем зависимостей

Следующие шаги позволяют получить общие сведения об использовании схем зависимостей в процессе разработки. Каждый шаг более подробно описан в последующих подразделах данного раздела. Если ведется разработка нового проекта, можно пропустить шаги, которые относятся к существующему коду.

> [!NOTE]
> Эти шаги приведены в примерном порядке. Возможно, понадобится перекрыть задачи, заново упорядочить их, чтобы они подходили по ситуации, а также возвратиться к ним в начале каждой итерации в проекте.

1. [Создайте схему зависимостей](#Create) для всего приложения или для слоя внутри него.

2. [Определите слои, представляющие основные функциональные области или компоненты](#CreateLayers) приложения. Дайте этим слоям имена согласно их функциям, например "Презентация" или "Службы". Если у вас есть решение Visual Studio, каждый слой можно связать с коллекцией *артефактов*, таких как проекты, пространства имен, файлы и т. д.

3. [Обнаружение существующих зависимостей](#Generate) между слоями.

4. [Измените слои и зависимости](#EditArchitecture) , чтобы показать обновленный проект, который должен отражаться в коде.

5. [Разрабатывать новые области приложения](#NewAreas) можно путем создания слоев, представляющих основные архитектурные блоки или компоненты и определяющие зависимости, чтобы продемонстрировать, как каждый из уровней использует другие.

6. [Измените макет и внешний вид диаграммы](#EditLayout) , чтобы помочь вам обсудить ее с коллегами.

7. [Проверьте код на соответствие схеме зависимостей](#Validate) , чтобы выделить конфликты между кодом и необходимой архитектурой.

8. [Обновите код, чтобы он соответствовал новой архитектуре](#UpdateCode). Итерационно разрабатывайте и оптимизируйте код до тех пор, пока проверка не укажет, что конфликты отсутствуют.

9. [Включите проверку слоев в процессе сборки](#BuildValidation) , чтобы код продолжал соответствовать вашей структуре.

## <a name="create-a-dependency-diagram"></a><a name="Create"></a> Создание схемы зависимостей

Схема зависимостей должна быть создана внутри проекта моделирования. Новую диаграмму зависимостей можно добавить в существующий проект моделирования, создать проект моделирования для схемы зависимостей или скопировать существующую диаграмму зависимостей в тот же проект моделирования.

> [!IMPORTANT]
> Не добавляйте, не перетаскивайте и не копируйте существующую схему зависимостей из проекта моделирования в другой проект моделирования или в другое расположение в решении. Схема зависимостей, скопированная таким образом, будет иметь те же ссылки, что и исходная диаграмма, даже при изменении схемы. Это может привести к тому, что проверка схемы будет работать неправильно, а также к другим потенциальным проблемам, таким как отсутствующие элементы или другие ошибки при попытке открыть схему.

См. раздел [Создание схем зависимостей из кода](../modeling/create-layer-diagrams-from-your-code.md).

## <a name="define-layers-to-represent-functional-areas-or-components"></a><a name="CreateLayers"></a> Определение слоев для представления функциональных областей или компонентов

Слои представляют логические группы *артефактов*, такие как проекты, файлы кода, пространства имен, классы и методы. Можно создавать слои из артефактов из Visual C# и Visual Basic проектов, а также прикреплять спецификации или планы к слою, связывая документы, такие как файлы Word или презентации PowerPoint. Каждый слой представляет собой прямоугольник на схеме и показывает количество артефактов, связанных с ним. Слой может содержать вложенные слои, описывающие более конкретные задачи.

Рекомендуется называть слои согласно их функциям, например "Презентация" или "Службы". Если артефакты тесно взаимосвязаны, поместите их в один слой. Если артефакты могут быть обновлены отдельно или использованы в разных приложениях, поместите их на разные слои. Чтобы узнать о шаблонах уровней, посетите веб-узел Patterns & Practices по адресу [http://go.microsoft.com/fwlink/?LinkId=145794](https://archive.codeplex.com/?p=apparch) .

> [!TIP]
> Существуют определенные типы артефактов, которые можно связать с слоями, но не поддерживают проверку схемы зависимостей. Чтобы проверить, поддерживает ли артефакт проверку, откройте **Обозреватель слоев** , чтобы просмотреть свойство **Поддержка проверки** в ссылке артефакт. См. раздел [Обнаружение существующих зависимостей между слоями](#Generate).

При обновлении незнакомого приложения можно также создать карты кода. Они помогают обнаружить закономерности и зависимости при анализе кода. Воспользуйтесь обозревателем решений, чтобы изучить пространства имен и классы, которые часто находятся в точном соответствии с существующими слоями. Назначьте эти артефакты кода слоям, перетащив их из обозреватель решений в схемы зависимостей. Затем можно использовать схемы зависимостей, которые помогут обновить код и обеспечить его соответствие дизайну.

См.

- [Создание схем зависимостей на основе кода](../modeling/create-layer-diagrams-from-your-code.md)

- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)

- [Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)

## <a name="discover-existing-dependencies-between-layers"></a><a name="Generate"></a> Обнаружение существующих зависимостей между слоями

Зависимости существуют там, где артефакт, связанный с одним слоем, ссылается на артефакт, связанный с другим слоем. Например, класс в одном слое объявляет переменную, которая имеет класс в другом слое. Существующие зависимости можно обнаружить путем их реконструирования.

> [!NOTE]
> Для определенных видов артефактов реконструировать зависимости невозможно. Например, зависимости не могут быть реконструированы из или в слой, связанный с текстовым файлом. Чтобы узнать, какие артефакты имеют зависимости, которые можно реконструировать, щелкните правой кнопкой мыши один или несколько слоев и выберите команду **Просмотреть ссылки**. В **обозревателе слоев** изучите столбец **поддерживает проверку** . Зависимости не будут реконструированы для артефактов, для которых в этом столбце указано **значение false**.

### <a name="to-reverse-engineer-existing-dependencies-between-layers"></a>Чтобы выполнить реконструирование существующих зависимостей между слоями

Выберите один или несколько слоев, щелкните правой кнопкой мыши выбранный слой и выберите команду **создать зависимости**.

Как правило, на этом этапе можно увидеть некоторые зависимости, которых быть не должно. Эти зависимости можно изменить для соответствия предполагаемой структуре.

## <a name="edit-layers-and-dependencies-to-show-the-intended-design"></a><a name="EditArchitecture"></a> Изменение слоев и зависимостей для отображения предполагаемого дизайна

Чтобы описать изменения, которые вы планируете внести в систему или предполагаемую архитектуру, выполните следующие действия, чтобы изменить схему зависимостей. Можно также сделать некоторые оптимизационные изменения для улучшения структуры кода перед его расширением. См. раздел [улучшение структуры кода](#Improving).

|**Чтобы**|**Выполните следующие действия**|
|-|-|
|Удаление зависимости, которой не должно существовать|Щелкните зависимость, а затем нажмите клавишу **Delete**.|
|Изменить или ограничить направление зависимости|Задайте свойство **Direction** .|
|Создать новые зависимости|Используйте средства **зависимости** и **двунаправленной зависимости** .<br /><br /> Чтобы нарисовать несколько зависимостей, дважды щелкните средство. По завершении щелкните инструмент **указатель** или клавишу **ESC** .|
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве " **Запрещенные зависимости пространства имен** слоя". Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве **Запрещенные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве **обязательные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|

### <a name="improving-the-structure-of-the-code"></a><a name="Improving"></a> Улучшение структуры кода

Оптимизация изменений — это улучшения, которые не влияют на поведение приложения, но помогают сделать код более легким для изменения или расширения в будущем. Хорошо структурированный код имеет конструкцию, легко абстрактную на схеме зависимостей.

Например, если создается слой для каждого пространства имен в коде и затем разбираются зависимости, то необходимо, чтобы был минимальный набор односторонних зависимостей между слоями. Если создается более детальная схема с использованием классов или методов в качестве слоев, то результат должен иметь такие же характеристики.

Если это не так, код будет труднее изменять на протяжении его жизненного цикла и будет менее пригоден для проверки с использованием схем зависимостей.

## <a name="design-new-areas-of-your-application"></a><a name="NewAreas"></a> Разработка новых областей приложения

При начале разработки нового проекта или новой области в новом проекте, можно нарисовать слои и зависимости, чтобы облегчить определение основных компонентов перед началом разработки кода.

- По возможности **Продемонстрируйте идентифицируемые архитектурные шаблоны** на схемах зависимостей. Например, схема зависимостей, описывающая классическое приложение, может включать такие слои, как презентация, логика домена и хранилище данных. Схема зависимостей, охватывающая одну функцию в приложении, может иметь такие слои, как модель, представление и контроллер. Дополнительные сведения об этих шаблонах см. в разделе [patterns & Practices: Architecture (архитектура приложения](https://archive.codeplex.com/?p=apparch)).

- **Создайте артефакт кода для каждого слоя** , такого как пространство имен, класс или компонент. Это облегчит отслеживание кода и поможет связывать артефакты кода со слоями. Сразу после создания артефакта свяжите его с соответствующим слоем.

- Нет необходимости **связывать большинство классов и других артефактов с слоями** , так как они попадают в более крупные артефакты, такие как пространства имен, которые уже связаны с слоями.

- **Создайте новую диаграмму для новой функции**. Как правило, существует одна или несколько схем зависимости, описывающих все приложение. Если вы разрабатываете новую возможность в приложении, то не добавляйте и не изменяйте существующие схемы. Вместо этого создайте свою схему, которая отражает новые части кода. Слои в новой схеме могут включать в себя презентацию, доменную логику и слои базы данных для новой возможности.

     При построении приложения код будет проверяться как в отношении всей схемы , так и в отношении более детальной схемы возможности.

## <a name="edit-the-layout-for-presentation-and-discussion"></a><a name="EditLayout"></a> Изменение макета для представления и обсуждения

Чтобы облегчить определение слоев и зависимостей или обсудить их с членами команды, измените вид и разметку схемы следующим образом.

- Измените размеры, формы и положение слоев.

- Измените цвета слоев и зависимостей.

  - Выберите один или несколько слоев или зависимостей, щелкните правой кнопкой мыши и выберите пункт **Свойства**. В окне **Свойства** измените свойство **Color** .

## <a name="validate-the-code-against-the-diagram"></a><a name="Validate"></a> Проверка кода на соответствие схеме

После изменения схемы ее можно проверить на соответствие коду вручную в любое время или автоматически при каждой сборке.

Пример

- [Проверка кода по схемам зависимостей](../modeling/validate-code-with-layer-diagrams.md)

- [Включение проверки слоев в процесс построения](#BuildValidation)

## <a name="update-the-code-to-conform-to-the-new-architecture"></a><a name="UpdateCode"></a> Обновление кода для соответствия новой архитектуре

Как правило, ошибки появляются при первой проверке кода на соответствие обновленной схеме зависимостей. Ошибки могут возникать вследствие нескольких причин.

- Артефакт назначен неправильному слою. В этом случае следует переместить артефакт.

- Способ использования артефактом (например, классом) другого класса конфликтует с имеющейся архитектурой. В этом случае необходимо выполнить рефакторинг кода, чтобы устранить зависимость.

Для устранения этих ошибок следует обновлять код до тех пор, пока в процессе проверки не перестанут происходить ошибки. Обычно это итерационный процесс. Дополнительные сведения об этих ошибках см. [в разделе Проверка кода с помощью схем зависимостей](../modeling/validate-code-with-layer-diagrams.md).

> [!NOTE]
> При разработке или реструктуризации кода у вас могут быть новые артефакты для связи с диаграммой зависимостей. Однако это может не потребоваться, например, когда слои представляют собой существующие пространства имен, а новый код только добавляет больше материала для них.

В процессе разработки может понадобиться подавить некоторые конфликты, выявленные в ходе проверки. Например, можно подавлять ошибки, над которыми уже ведется работа, а также ошибки, не имеющие отношения к конкретному сценарию. При подавлении ошибки рекомендуется вести журнал рабочего элемента в Team Foundation. Сведения о выполнении этой задачи см. в разделе [Проверка кода с помощью схем зависимостей](../modeling/validate-code-with-layer-diagrams.md).

## <a name="include-layer-validation-in-the-build-process"></a><a name="BuildValidation"></a> Включить проверку слоев в процессе сборки

Чтобы обеспечить соответствие будущих изменений в коде схемам зависимостей, включите проверку слоев в стандартный процесс сборки решения. Каждый раз, когда другие члены команды создают решение, любые различия между зависимостями в коде и схемой зависимостей будут отображаться как ошибки сборки. Дополнительные сведения о включении проверки слоев в процесс сборки см. в разделе [Проверка кода с помощью схем зависимостей](../modeling/validate-code-with-layer-diagrams.md).

## <a name="see-also"></a>См. также

- [Схемы зависимостей: справочные материалы](../modeling/layer-diagrams-reference.md)
- [Создание схем зависимостей на основе кода](../modeling/create-layer-diagrams-from-your-code.md)
