---
title: Создание пользовательских обработчиков директив для текстовых шаблонов T4
description: Сведения о процессе преобразования текстовых шаблонов и о создании пользовательского обработчика директив текстовых шаблонов T4.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, custom directive processors
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 59644275f17eac197074351a777959bb1826a5de
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112389505"
---
# <a name="create-custom-t4-text-template-directive-processors"></a>Создание пользовательских обработчиков директив для текстовых шаблонов T4

*Процесс преобразования текстовых шаблонов* принимает текстовый файл *шаблона* в качестве входных данных и создает текстовый файл в качестве выходных данных. *Обработчик преобразования текстовых шаблонов* управляет процессом, а обработчик взаимодействует с узлом преобразования текстового шаблона и одним или несколькими *обработчиками директив* текстового шаблона для завершения процесса. Дополнительные сведения см. [в разделе процесс преобразования текстовых шаблонов](../modeling/the-text-template-transformation-process.md).

Для создания пользовательского процессора директив создается класс, наследующий <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> либо <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor>.

Разница между этими двумя методами заключается в том, что <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> реализует минимальный интерфейс, необходимый для получения параметров от пользователя и для создания кода, который создает выходной файл шаблона. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> реализует шаблон разработки Requires/предоставляет. <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> обрабатывает два специальных параметра: `requires` и `provides` .  Например, пользовательский обработчик директив может принять имя файла от пользователя, открыть и прочитать файл, а затем сохранить текст файла в переменной с именем `fileText` . Подкласс <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> класса может принимать имя файла от пользователя в качестве значения `requires` параметра и имя переменной, в которой будет храниться текст в качестве значения `provides` параметра. Этот обработчик открывает и считывает файл, а затем сохраняет текст файла в указанной переменной.

Перед вызовом пользовательского обработчика директив из текстового шаблона в Visual Studio необходимо зарегистрировать его.

Дополнительные сведения о том, как добавить раздел реестра, см. [в разделе Развертывание пользовательского обработчика директив](../modeling/deploying-a-custom-directive-processor.md).

## <a name="custom-directives"></a>Пользовательские директивы

Пользовательская директива выглядит следующим образом:

`<#@ MyDirective Processor="MyDirectiveProcessor" parameter1="value1" ... #>`

Можно использовать пользовательский обработчик директив, если требуется получить доступ к внешним данным или ресурсам из текстового шаблона.

Различные текстовые шаблоны могут совместно использовать функциональные возможности, предоставляемые процессором с одними директивами, поэтому процессоры директив предоставляют способ факторинга кода для повторного использования. Встроенная `include` директива аналогична, так как ее можно использовать для разложения кода и совместного использования с другими текстовыми шаблонами. Разница заключается в том, что все функциональные возможности, `include` предоставляемые директивой, являются фиксированными и не принимают параметры. Если требуется предоставить общий набор функций для текстового шаблона и разрешить шаблону передавать параметры, необходимо создать пользовательский обработчик директив.

Ниже приведены некоторые примеры пользовательских обработчиков директив.

- Обработчик директив, возвращающий данные из базы данных, которые принимают имя пользователя и пароль в качестве параметров.

- Обработчик директив для открытия и чтения файла, принимающего имя файла в качестве параметра.

### <a name="principal-parts-of-a-custom-directive-processor"></a>Основные части пользовательского обработчика директив

Для разработки обработчика директив необходимо создать класс, наследующий от <xref:Microsoft.VisualStudio.TextTemplating.DirectiveProcessor> или <xref:Microsoft.VisualStudio.TextTemplating.RequiresProvidesDirectiveProcessor> .

`DirectiveProcessor`Ниже перечислены наиболее важные методы, которые необходимо реализовать.

- `bool IsDirectiveSupported(string directiveName)` — Возвращает `true` , если процессор директив может работать с именованной директивой.

- `void ProcessDirective (string directiveName, IDictionary<string, string> arguments)` — Обработчик шаблонов вызывает этот метод для каждого вхождения директивы в шаблоне. Ваш процессор должен сохранить результаты.

После всех вызовов Процессдирективе () подсистема шаблонов будет вызывать следующие методы:

- `string[] GetReferencesForProcessingRun()` — Возврат имен сборок, необходимых коду шаблона.

- `string[] GetImportsForProcessingRun()` — Возврат пространств имен, которые могут использоваться в коде шаблона.

- `string GetClassCodeForProcessingRun()` — Возврат кода методов, свойств и других объявлений, которые может использовать код шаблона. Самый простой способ сделать это — создать строку, содержащую код C# или Visual Basic. Чтобы процессор директив мог быть вызван из шаблона, использующего любой язык среды CLR, можно создать инструкции в виде дерева CodeDom, а затем вернуть результат сериализации дерева на языке, используемом шаблоном.

- Дополнительные сведения см. [в разделе Пошаговое руководство. Создание пользовательского обработчика директив](../modeling/walkthrough-creating-a-custom-directive-processor.md).

## <a name="see-also"></a>См. также

- [Развертывание пользовательского обработчика директив](../modeling/deploying-a-custom-directive-processor.md) объясняет, как зарегистрировать пользовательский обработчик директив.
- [Пошаговое руководство. Создание пользовательского обработчика директив](../modeling/walkthrough-creating-a-custom-directive-processor.md) описывает создание пользовательского обработчика директив, регистрацию и тестирование процессора директив, а также форматирование выходного файла в формате HTML.
