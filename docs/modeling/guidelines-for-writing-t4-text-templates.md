---
title: Рекомендации по написанию текстовых шаблонов T4
description: Ознакомьтесь с общими рекомендациями, которые полезны при создании программного кода или других ресурсов приложения в Visual Studio.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 5418013898f24b15cf51926022d974d23f4a7215
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99966361"
---
# <a name="guidelines-for-writing-t4-text-templates"></a>Рекомендации по написанию текстовых шаблонов T4

Эти общие рекомендации могут оказаться полезными при создании программного кода или других ресурсов приложения в Visual Studio. Они не являются фиксированными правилами.

## <a name="guidelines-for-design-time-t4-templates"></a>Рекомендации по использованию шаблонов T4 Design-Time

Шаблоны T4 во время разработки — это шаблоны, которые создают код в проекте Visual Studio во время разработки. Дополнительные сведения см. в статье [Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md).

Создание переменных аспектов приложения.

Создание кода наиболее полезно для тех аспектов приложения, которые могут изменяться во время проекта или будут меняться между различными версиями приложения. Отделяйте эти переменные аспекты от более инвариантных аспектов, чтобы можно было легко определить, что должно быть создано. Например, если приложение предоставляет веб-сайт, разделите стандартные функции, обслуживающие страницы, от логики, определяющей пути перехода с одной страницы на другую.

Кодирование переменных аспектов в одной или нескольких исходных моделях.

Модель — это файл или база данных, которые каждый шаблон считывает для получения конкретных значений для переменных частей создаваемого кода. Модели могут быть базами данных, XML-файлами собственного дизайна, схем или доменных языков. Как правило, одна модель используется для создания нескольких файлов в проекте Visual Studio. Каждый файл создается на основе отдельного шаблона.

В проекте можно использовать более одной модели. Например, можно определить модель для навигации между веб-страницами и отдельную модель для макета страниц.

Сосредоточьтесь на модели в соответствии с потребностями и словарем пользователей, а не на вашей реализации.

Например, в приложении веб-сайта модель будет ссылаться на веб-страницы и гиперссылки.

В идеале следует выбирать форму представления, соответствующую типу информации, которую представляет модель. Например, модель путей перехода через веб-сайт может быть схемой прямоугольников и стрелок.

Протестируйте созданный код.

Используйте ручные или автоматические тесты, чтобы убедиться, что полученный код работает по мере необходимости пользователям. Избегайте создания тестов из той же модели, из которой создается код.

В некоторых случаях для модели можно выполнять общие тесты напрямую. Например, можно написать тест, гарантирующий, что каждая страница на веб-сайте будет доступна для перехода с любого другого.

Разрешить использовать пользовательский код: создавать разделяемые классы.

Разрешить написание кода вручную в дополнение к созданному коду. Схема создания кода нетипична для того, чтобы иметь возможность учитывать все возможные варианты, которые могут возникнуть. Поэтому следует дождаться добавления или переопределения некоторых созданных кодов. Когда созданный материал относится к языку .NET, например C# или Visual Basic, особенно полезны две стратегии:

- Создаваемые классы должны быть частичными. Это позволяет добавлять содержимое в созданный код.

- Классы должны создаваться парами, один из которых наследуется от другого. Базовый класс должен содержать все созданные методы и свойства, а производный класс должен содержать только конструкторы. Это позволяет написанному вручную коду переопределять любой из созданных методов.

В других созданных языках, таких как XML, используйте `<#@include#>` директиву для создания простых сочетаний письменного и генерируемого содержимого. В более сложных случаях может потребоваться выполнить поэтапную обработку, объединяющую созданный файл с любыми файлами, написанными вручную.

Переместите общий материал в включаемые файлы или шаблоны времени выполнения.

Чтобы избежать повторения похожих блоков текста и кода в нескольких шаблонах, используйте `<#@ include #>` директиву. Дополнительные сведения см. в разделе [директива T4 include](../modeling/t4-include-directive.md).

Можно также создавать текстовые шаблоны времени выполнения в отдельном проекте, а затем вызывать их из шаблона времени разработки. Для этого используйте `<#@ assembly #>` директиву для доступа к отдельному проекту.

Рассмотрите возможность перемещения больших блоков кода в отдельную сборку.

При наличии больших блоков кода и блоков функций класса может оказаться полезным переместить часть этого кода в методы, компилируемые в отдельном проекте. Директиву можно использовать `<#@ assembly #>` для доступа к коду в шаблоне. Дополнительные сведения см. в разделе [директива сборки T4](../modeling/t4-assembly-directive.md).

Методы можно разместить в абстрактном классе, который может наследоваться шаблоном. Абстрактный класс должен наследовать от <xref:Microsoft.VisualStudio.TextTemplating.TextTransformation?displayProperty=fullName> . Дополнительные сведения см. в разделе [Директива template T4](../modeling/t4-template-directive.md).

Создание кода, а не файлов конфигурации.

Одним из способов написания переменного приложения является написание универсального программного кода, который принимает файл конфигурации. Приложение, написанное таким способом, является очень гибким и может быть перенастроено при изменении бизнес-требований без перестроения приложения. Однако недостаток этого подхода заключается в том, что приложение будет работать менее хорошо, чем более конкретное приложение. Кроме того, программный код будет труднее считывать и обслуживать, частично потому, что он всегда имеет дело с наиболее универсальными типами.

Напротив, приложение, переменные части которого создаются до того, как компиляция может быть строго типизирована. Это делает гораздо более простым и надежным написание кода, написанного вручную, и интегрирует его с созданными частями программного обеспечения.

Чтобы получить полное преимущество создания кода, попробуйте создать программный код вместо файлов конфигурации.

Используйте созданную папку с кодом.

Поместите шаблоны и созданные файлы в папку проекта с именем **generated code (созданный код**), чтобы убедиться, что они не являются файлами, которые следует редактировать напрямую. Если вы создаете пользовательский код для переопределения или добавления в создаваемые классы, поместите эти классы в папку с именем **Пользовательский код**. Структура типичного проекта выглядит следующим образом:

```
MyProject
   Custom Code
      Class1.cs
      Class2.cs
   Generated Code
      Class1.tt
          Class1.cs
      Class2.tt
          Class2.cs
   AnotherClass.cs
```

## <a name="guidelines-for-run-time-preprocessed-t4-templates"></a>Рекомендации по Run-Timeам (предварительно обработанным) шаблонам T4

Перемещение общего материала в унаследованные шаблоны.

Наследование можно использовать для совместного использования методов и текстовых блоков между текстовыми шаблонами T4. Дополнительные сведения см. в разделе [Директива template T4](../modeling/t4-template-directive.md).

Также можно использовать включаемые файлы с шаблонами времени выполнения.

Переместите большие тексты кода в разделяемый класс.

Каждый шаблон времени выполнения создает частичное определение класса, имя которого совпадает с именем шаблона. Можно написать файл кода, содержащий другое частичное определение того же класса. Таким образом можно добавить методы, поля и конструкторы в класс. Эти члены можно вызывать из блоков кода в шаблоне.

Преимуществом этого является то, что код проще писать, поскольку доступна технология IntelliSense. Кроме того, можно добиться лучшего разделения между презентацией и базовой логикой.

Например, в **MyReportText.TT**:

`The total is: <#= ComputeTotal() #>`

В **MyReportText-Methods.CS**:

`private string ComputeTotal() { ... }`

Разрешить использовать пользовательский код: Укажите точки расширения.

Рассмотрите возможность создания виртуальных методов в \<#+ class feature blocks #> . Это позволяет использовать один шаблон во многих контекстах без изменения. Вместо изменения шаблона можно создать производный класс, который предоставляет минимальную дополнительную логику. Производный класс может быть либо обычным кодом, либо шаблоном времени выполнения.

Например, в MyStandardRunTimeTemplate.tt:

```
This page is copyright <#= CompanyName() #>.
<#+ protected virtual string CompanyName() { return ""; } #>
```

В коде приложения:

```
class FabrikamTemplate : MyStandardRunTimeTemplate
{
  protected override string CompanyName() { return "Fabrikam"; }
}
...
  string PageToDisplay = new FabrikamTemplate().TextTransform();
```

## <a name="guidelines-for-all-t4-templates"></a>Рекомендации по всем шаблонам T4

Отделите сбор данных от создания текста.

Старайтесь не смешивать вычислительные и текстовые блоки. В каждом текстовом шаблоне используйте первый \<# code block #> для задания переменных и выполнения сложных вычислений. Из первого блока текста вниз до конца шаблона или первого \<#+ class feature block #> , избегайте длинных выражений и избегайте циклов и условных условий, если они не содержат текстовые блоки. Такой подход упрощает чтение и обслуживание шаблона.

Не используйте `.tt` для включаемых файлов.

Используйте другое расширение имени файла, например `.ttinclude` для включаемых файлов. Используйте `.tt` только для файлов, которые необходимо обработать как текстовые шаблоны времени выполнения или времени разработки. В некоторых случаях Visual Studio распознает `.tt` файлы и автоматически задает их свойства для обработки.

Запустите каждый шаблон как фиксированный прототип.

Напишите пример кода или текста, который необходимо создать, и убедитесь, что он указан правильно. Затем измените расширение на TT и последовательно вставьте код, который изменяет содержимое, прочитав модель.

Рассмотрите возможность использования типизированных моделей.

Несмотря на то, что можно создать схему XML или базы данных для моделей, может быть полезно создать доменный язык (DSL). Преимущество DSL заключается в том, что он создает класс для представления каждого узла в схеме и свойства для представления атрибутов. Это означает, что вы можете программировать с точки зрения бизнес-модели. Пример:

```
Team Members:
<# foreach (Person p in team.Members)
 { #>
    <#= p.Name #>
<# } #>
```

Рассмотрите возможность использования схем для моделей.

Многие модели наиболее эффективно представляются и управляются просто как текстовые таблицы, особенно если они очень велики.

Однако для некоторых видов бизнес-требований важно уточнять сложные наборы отношений и рабочих процессов, а диаграммы — наиболее подходящим способом. Преимуществом схемы является то, что его легко обсудить с пользователями и другими заинтересованными лицами. Создавая код из модели на уровне бизнес-требований, вы делает код более гибким при изменении требований.

Вы также можете разработать собственный тип схемы в качестве доменного языка (DSL). Код может быть создан как на основе UML, так и на DSL. Дополнительные сведения см. в разделе [Анализ архитектуры и моделирования](../modeling/analyze-and-model-your-architecture.md).

## <a name="see-also"></a>См. также раздел

- [Создание кода во время разработки с помощью текстовых шаблонов T4](../modeling/design-time-code-generation-by-using-t4-text-templates.md)
- [Создание текста во время выполнения с помощью текстовых шаблонов T4](../modeling/run-time-text-generation-with-t4-text-templates.md)
