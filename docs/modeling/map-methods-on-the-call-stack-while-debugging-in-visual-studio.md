---
title: Сопоставление методов в визуализации стека вызовов при отладке
description: Узнайте, как создать карту кода для визуальной трассировки стека вызовов во время отладки. Кроме того, вы узнаете, что вы можете делать заметки на карте, чтобы отслеживание выполняемого кода.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
f1_keywords:
- vs.progression.debugwithcodemaps
dev_langs:
- FSharp
- VB
- CSharp
- C++
helpviewer_keywords:
- call stacks, code maps
- Call Stack window, mapping calls
- debugging [Visual Studio], diagramming the call stack
- call stacks, mapping
- Call Stack window, visualizing
- debugging code visually
- debugging [Visual Studio], mapping the call stack
- call stacks, visualizing
- debugging, code maps
- Call Stack window, tracing calls visually
- Call Stack window, show on code map
- debugging [Visual Studio], tracing the call stack visually
- debugging [Visual Studio], visualizing the call stack
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 08fa0ff028140ebad421dd43fdfa53cc36b77804
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112387493"
---
# <a name="map-methods-on-the-call-stack-while-debugging-in-visual-studio"></a>Сопоставление методов в визуализации стека вызовов при отладке в Visual Studio

Для визуального отслеживания стека вызовов при отладке можно создать карту кода. В это сопоставление можно вносить примечания для отслеживания операций, выполняемых кодом. Таким образом, вы сможете сосредоточиться на поиске ошибок.

 ![Отладка со стеками вызовов на картах кода](../debugger/media/debuggermap_overview.png)

 Что вам понадобится:

 ::: moniker range="vs-2017"

- [Visual Studio Enterprise](https://visualstudio.microsoft.com/vs/older-downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=vs+2017+download)

::: moniker-end

::: moniker range=">=vs-2019"

- [Visual Studio Enterprise](https://visualstudio.microsoft.com/downloads)

::: moniker-end

- Код, который можно отладить, например Visual C#, Visual Basic, C++, JavaScript или X + +.

  Пример

- [Видео. Отладка с помощью отладчика карт кода (канал 9)](https://channel9.msdn.com/Series/Visual-Studio-2012-Premium-and-Ultimate-Overview/Visual-Studio-Ultimate-2012Debug-visually-with-Code-Map-debugger-integration)

- [Сопоставьте стек вызовов](#MapStack)

- [Создание заметок о коде](#MakeNotes)

- [Обновить карту со следующим стеком вызовов](#UpdateMap)

- [Добавление связанного кода в карту](#AddRelatedCode)

- [Поиск ошибок с помощью Map](#FindBugs)

- [ВОПРОСЫ И ОТВЕТЫ](#QA)

  Дополнительные сведения о командах и действиях, которые можно использовать при работе с картами кода, см. в разделе [Обзор и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md).

## <a name="map-the-call-stack"></a><a name="MapStack"></a> Сопоставление стека вызова

1. Запустите отладку. (Клавиатура: **F5**)

2. После того как приложение переходит в режим приостановки выполнения или вы выполняете шаг с заходом в функцию, выберите **карту кода**. (Клавиатура: **CTRL**  +  **SHIFT**  +  **`** )

     ![Выберите "Карта кода", чтобы начать формирование карты для стека вызовов](../debugger/media/debuggermap_choosecodemap.png)

     Текущий стек вызовов выделен в новой карте кода оранжевым цветом:

     ![См. стек вызовов на карте кода](../debugger/media/debuggermap_seeundocallstack.png)

     Эта карта будет автоматически обновляться в ходе отладки. См. раздел [обновление схемы с помощью следующего стека вызовов](#UpdateMap).

## <a name="make-notes-about-the-code"></a><a name="MakeNotes"></a> Добавление примечаний к коду

 Добавьте комментарии для трассировки того, что происходит в коде. Чтобы добавить новую строку в комментарий, нажмите клавиши **Shift + Return**.

 ![Добавление комментария к стеку вызовов на карте кода](../debugger/media/debuggermap_addcomment.png)

## <a name="update-the-map-with-the-next-call-stack"></a><a name="UpdateMap"></a> Обновление сопоставления путем добавления следующего стека вызовов

 Выполните приложение до следующей точки останова или зайдите в функцию. В сопоставление будет добавлен новый стек вызовов.

 ![Обновление карты кода следующим стеком вызовов](../debugger/media/debuggermap_addclearcallstack.png)

## <a name="add-related-code-to-the-map"></a><a name="AddRelatedCode"></a> Добавление связанного кода в сопоставление

 Теперь у вас есть Map-то, что дальше? Если вы работаете с C# или Visual Basic, добавьте элементы, такие как поля, свойства и другие методы, чтобы отвестися о том, что происходит в коде.

 Дважды щелкните метод для просмотра его определения кода или используйте контекстное меню метода. (Клавиатура: выберите метод на карте и нажмите клавишу **F12**)

 ![Переход к определению кода метода на карте кода](../debugger/media/debuggermap_gotocodedefinition.png)

 Добавьте элементы, которые необходимо отслеживать в сопоставлении.

 ![Отображение полей в методе на карте кода со стеком вызовов](../debugger/media/debuggermap_showfields.png)

> [!NOTE]
> По умолчанию при добавлении элементов в сопоставление также добавляются узлы родительской группы, соответствующие, например, классу, пространству имен или сборке. Хотя это и полезно, можно сделать карту простой, отключив эту функцию с помощью кнопки **включить родителей** на панели инструментов Map или нажав **клавишу CTRL** при добавлении элементов.

 ![Поля, связанные с методом на карте кода со стеком вызовов](../debugger/media/debuggermap_showedfields.png)

 Нетрудно определить, какие методы используют одинаковые поля. Последние добавленные элементы отображаются зеленым цветом.

 Продолжайте формировать сопоставление, чтобы увидеть дополнительный код.

 ![См. методы, использующие поле: карта кода со стеком вызовов](../debugger/media/debuggermap_findallreferences.png)

 ![Методы, использующие поле на карте кода со стеком вызовов](../debugger/media/debuggermap_foundallreferences.png)

## <a name="find-bugs-using-the-map"></a><a name="FindBugs"></a> Поиск ошибок с помощью сопоставления

 Визуализация кода поможет вам быстрее находить ошибки. Например, предположим, что вы изучаете ошибку в программе рисования. Когда вы создаете линию и пробуете отменить ее создание, ничего не происходит до тех пор, пока не будет нарисована следующая линия.

 Установив точки останова в методах `clear`, `undo` и `Repaint`, вы начинаете отладку и создаете сопоставление, аналогичное представленному ниже:

 ![Добавление другого стека вызовов на карту кода](../debugger/media/debuggermap_addpaintobjectcallstack.png)

 Учтите, что все жесты пользователя в сопоставлении вызывают метод `Repaint`, за исключением `undo`. Возможно, именно поэтому функция `undo` срабатывает не сразу.

 Когда вы исправите ошибку и продолжите выполнение программы, в сопоставление будет добавлен новый вызов из `undo` в `Repaint`.

 ![Добавление нового вызова метода в стек вызовов на карте кода](../debugger/media/debuggermap_addnewcallforrepaint.png)

## <a name="q--a"></a><a name="QA"></a> Вопросы и ответы

- **На карте отображаются не все вызовы. Важно?**

   По умолчанию в сопоставлении отображается только ваш код. Чтобы просмотреть внешний код, включите его в окне **Стек вызовов** :

   ![Окно "Отображение внешнего кода с помощью стека вызовов"](../debugger/media/debuggermap_callstackmenu.png)

   или отключите параметр **включить только мой код** в вариантах отладки Visual Studio:

   ![Диалоговое окно "Отображение внешнего кода с помощью параметров"](../debugger/media/debuggermap_debugoptions.png)

- **Изменение сопоставления влияет на код?**

   Изменение схемы не влияет на код каким бы то ни было образом. Можно свободно переименовать, изменить или удалить любой элемент в сопоставлении.

- **Что означает это сообщение: "схема может основываться на более старой версии кода"?**

   С момента последнего обновления сопоставления код мог измениться. Например, вызов в сопоставлении может уже не существовать в коде. Закройте сообщение, а затем попытайтесь повторить сборку решения, прежде чем повторно обновлять сопоставление.

- **Разделы справки управлять макетом схемы?**

   Откройте меню **Макет** на панели инструментов Map:

  - Изменить макет по умолчанию.

  - Чтобы отключить автоматическое перераспределение карт, отключите **Автоматический макет при отладке**.

  - Чтобы изменить расположение на карте как можно меньше при добавлении элементов, отключите **добавочный макет**.

- **Можно ли использовать сопоставление совместно с другими пользователями?**

   Вы можете экспортировать карту, отправить ее другим пользователям, если у вас есть Microsoft Outlook, или сохранить ее в решении, чтобы вы могли вернуть его в систему управления версиями.

   ![Предоставление другим пользователям доступа к карте кода со стеком вызовов](../debugger/media/debuggermap_sharewithothers.png)

- **Как не допустить, чтобы сопоставление добавляло новые стеки вызова автоматически?**

   Нажмите ![ кнопку &#45; отображать стек вызовов на карте кода автоматически ](../debugger/media/debuggermap_automaticupdateicon.gif) на панели инструментов Map. Чтобы вручную добавить текущий стек вызовов на карту, нажмите клавиши **CTRL** + **SHIFT** +  **`** .

   Эта схема будет продолжать выделять существующие стеки вызовов на карте во время отладки.

- **Что означают значки элементов и стрелки?**

   Чтобы получить дополнительные сведения об элементе, наведите на него указатель мыши и взгляните на подсказку элемента. Вы также можете просмотреть **Условные обозначения** , чтобы узнать, что означает каждый значок.

   ![Расшифровка значков на карте кода со стеком вызовов](../debugger/media/debuggermap_showlegend.png)

  Пример

- [Сопоставьте стек вызовов](#MapStack)

- [Создание заметок о коде](#MakeNotes)

- [Обновить карту со следующим стеком вызовов](#UpdateMap)

- [Добавление связанного кода в карту](#AddRelatedCode)

- [Поиск ошибок с помощью Map](#FindBugs)

## <a name="see-also"></a>См. также

- [Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)
- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)
- [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)
- [Просмотр и реорганизация карт кода](../modeling/browse-and-rearrange-code-maps.md)
