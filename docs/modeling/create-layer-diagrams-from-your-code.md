---
title: Создание схем зависимостей на основе кода
description: Узнайте, как создать схему зависимостей в Visual Studio для визуализации логической архитектуры программной системы.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
helpviewer_keywords:
- architecture, dependency diagrams
- dependency diagrams
- diagrams - modeling, layer
- constraints, architectural
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 38e357ca4aa715861839f7f5ca168eafdc66f5ed
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99957443"
---
# <a name="create-dependency-diagrams-from-your-code"></a>Создание схем зависимостей на основе кода

Для визуализации высокоуровневой логической архитектуры программной системы Создайте *схему зависимостей* в Visual Studio. Чтобы убедиться в том, что код остается согласованным с этой структурой, проверьте код с помощью схемы зависимостей. Вы можете создавать схемы зависимостей для проектов Visual C# и Visual Basic. Чтобы узнать, какие выпуски Visual Studio поддерживают эту функцию, см. раздел [Поддержка инструментов моделирования и архитектуры в различных выпусках](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools).

![Создание схемы зависимостей](../modeling/media/layerdiagramvisualizecode.png)

Схема зависимостей позволяет организовывать элементы решений Visual Studio в логические, абстрактные группы, называемые *слоями*. Слои можно использовать для описания основных задач, выполняемых этими артефактами, или основных компонентов системы. Каждый слой может содержать другие слои, описывающие более подробные задачи. Можно также указать предполагаемые или существующие *зависимости* между слоями. Эти зависимости, представленные в виде стрелок, указывают, какие слои могут использовать или в настоящее время используют функциональные возможности, представленные другими слоями. Для поддержки архитектурного контроля кода добавьте предполагаемые зависимости в схему, а затем проверьте код по схеме.

[Видео. Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)

## <a name="create-a-dependency-diagram"></a><a name="CreateDiagram"></a> Создание схемы зависимостей

Перед созданием схемы зависимостей убедитесь, что в решении есть проект моделирования.

> [!IMPORTANT]
> Не добавляйте, не перетаскивайте и не копируйте существующую схему зависимостей из проекта моделирования в другой проект моделирования или в другое место в решении. Это позволит сохранить ссылки из исходной схемы при изменении схемы. Кроме того, это может привести к тому, что проверка схемы будет работать неправильно, и к другим потенциальным проблемам, таким как отсутствующие элементы или другие ошибки при попытке открыть схему.
>
> Вместо этого добавьте новую диаграмму зависимостей в проект моделирования. Скопируйте элементы из исходной схемы в новую схему. Сохраните как проект моделирования, так и новую диаграмму зависимостей.

### <a name="add-a-new-dependency-diagram-to-a-modeling-project"></a>Добавление новой схемы зависимостей в проект моделирования

> [!NOTE]
> Схемы зависимостей для проектов .NET Core поддерживаются начиная с Visual Studio 2019 версии 16,2.

1. В меню **архитектура** выберите пункт **создать диаграмму зависимостей**.

2. В разделе **шаблоны** выберите **Схема зависимостей**.

3. Назовите схему.

4. В окне **Добавить в проект моделирования** найдите и выберите существующий проект моделирования в решении.

     -или-

     Выберите **создать новый проект моделирования** , чтобы добавить в решение новый проект моделирования.

    > [!NOTE]
    > Схема зависимостей должна существовать в проекте моделирования. Однако ее можно связать с элементами в любом месте решения.

5. Обязательно сохраните как проект моделирования, так и схему зависимостей.

## <a name="drag-and-drop-or-copy-and-paste-from-a-code-map"></a>Перетаскивание, копирование и вставка из схемы кода

1. Создать карту кода для решения с помощью меню " **архитектура** ".

2. Рассмотрите возможность применения фильтра карт кода для удаления папок решений и "тестовых ресурсов", если требуется только применить зависимости в коде продукта.

3. На созданной карте кода удалите "External" узел или разверните его, чтобы отобразить внешние сборки, в зависимости от того, требуется ли применять зависимости пространства имен, и удалите необязательные сборки из схемы кода.

4. Создание новой схемы зависимостей для решения с помощью меню " **архитектура** "

5. Выберите все узлы на карте кода (используйте _сочетание клавиш CTRL_  +  _A_ или используйте выбор с резиновой полосой, нажав клавишу _SHIFT_ перед нажатием, перетаскиванием и выпуском.

6. Перетащите или скопируйте и вставьте выбранные элементы в новую схему проверки зависимостей.

7. В этом примере показана текущая архитектура приложения. Определите, какая архитектура должна быть архитектурой, и измените схему зависимостей соответствующим образом.

![Схема зависимостей, созданная из схемы кода](media/dependency-validation-01.png)

## <a name="create-layers-from-artifacts"></a><a name="CreateLayers"></a> Создание слоев на основе артефактов
 Слои можно создать из элементов решения Visual Studio, таких как проекты, файлы кода, пространства имен, классы и методы. При этом автоматически создаются связи между слоями и элементами, которые включаются в процесс проверки слоев.

 Слои также можно связывать с элементами, которые не поддерживают проверку, такими как документы Word или презентации PowerPoint, чтобы можно было связать слой со спецификациями или планами. Кроме того, слои можно связать с файлами в проектах, которые являются общими для нескольких приложений, но в процесс проверки не войдут слои, которые отображаются с универсальными именами, например "Уровень 1" и "Уровень 2".

 Чтобы проверить, поддерживает ли связанный элемент проверку, откройте **Обозреватель слоев** и просмотрите свойство **Поддержка проверки** элемента. См. раздел [Управление связями с артефактами](#Managing).

|**Чтобы**|**Выполните эти действия**|
|-|-|
|Создать слой для одного артефакта|<ol><li>Перетащите элемент на схему зависимостей из следующих источников:<br /><br /> <ul><li>**Обозреватель решений**<br /><br />         Например, можно перетаскивать файлы или проекты.</li><li>Карты кода<br /><br />         См. раздел [сопоставление зависимостей в решениях](../modeling/map-dependencies-across-your-solutions.md) и [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md).</li><li>**Представление классов** или **Обозреватель объектов**</li></ul><br />     Слой отображается на схеме и связан с артефактом.</li><li>Переименуйте слой, чтобы отразить обязанности связанного кода или артефактов.</li></ol> **Важно.**  При перетаскивании двоичных файлов на схему зависимостей их ссылки не добавляются автоматически в проект моделирования. Необходимо вручную добавить двоичные файлы, которые нужно проверить, в проект моделирования. **Добавление двоичных файлов в проект моделирования** <ol><li>В **Обозреватель решений** откройте контекстное меню проекта моделирования и выберите команду **Добавить существующий элемент**.</li><li>В диалоговом окне **Добавление существующего элемента** перейдите к двоичным файлам, выберите их и нажмите кнопку **ОК**.     Двоичные файлы отображаются в проекте моделирования.</li><li>В **Обозреватель решений** выберите добавленный двоичный файл и нажмите клавишу **F4** , чтобы открыть окно « **Свойства** ».</li><li>Для каждого двоичного файла задайте для свойства **действие сборки** значение **Проверка**.</li></ol>|
|Создание единственного слоя для всех выбранных артефактов|Перетащите все артефакты в схему зависимостей одновременно.<br /><br /> Слой отображается в схеме и связан со всеми артефактами.|
|Создание слоя для каждого выбранного артефакта|При одновременном перетаскивании всех артефактов в схему зависимостей нажмите и удерживайте клавишу **SHIFT** . **Примечание.**  Если для выбора диапазона элементов используется клавиша **SHIFT** , отпустите клавишу после выбора артефактов. Нажмите и удерживайте ее снова при перетаскивании артефактов в схему. <br /><br /> Слой для каждого артефакта отображается в схеме и связан с каждым артефактом.|
|Добавление артефакта в слой|Перетащите артефакт в слой.|
|Создание нового несвязанного слоя|На **панели элементов** разверните раздел **Схема зависимостей** и перетащите **слой** на схему зависимости.<br /><br /> Чтобы добавить несколько слоев, дважды щелкните средство. По завершении выберите инструмент **указатель** или нажмите клавишу **ESC** .<br /><br /> -или-<br /><br /> Откройте контекстное меню схемы зависимостей, выберите **Добавить**, а затем выберите **слой**.|
|Создание вложенных слоев|Перетащите существующий слой в другой слой.<br /><br /> -или-<br /><br /> Откройте контекстное меню слоя, выберите **Добавить**, а затем выберите **слой**.|
|Создание нового слоя, который содержит два или более существующих слоев|Выберите слои, откройте контекстное меню для выбранного элемента и выберите **Группа**.|
|Изменение цвета слоя|Задайте для свойства **Цвет** значение нужного цвета.|
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве **Запрещенные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве " **Запрещенные зависимости пространства имен** слоя". Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве **обязательные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|

 Число на слое обозначает количество артефактов, связанных со слоем. Однако при считывании этого числа учитывайте следующее.

- Если слой связан с артефактом, содержащим другие артефакты, но слой не связан с другими артефактами напрямую, то число включает только связанный артефакт. Однако для анализа в ходе проверки слоя включаются другие артефакты.

     Например, если слой связан с одним пространством имен, то число связанных артефактов равно 1, даже если пространство имен содержит классы. Если слой также связан с каждым классом в пространстве имен, то число будет включать эти связанные классы.

- Если слой содержит другие слои, связанные с артефактами, то слой-контейнер также связан с этими артефактами, даже если число в слое-контейнере не включает эти артефакты.

## <a name="manage-links-between-layers-and-artifacts"></a><a name="Managing"></a> Управление связями между слоями и артефактами

1. На схеме зависимостей откройте контекстное меню слоя и выберите **Просмотреть ссылки**.

     **Обозреватель слоев** отображает ссылки артефактов для выбранного слоя.

2. Для управления этими ссылками можно использовать следующие задачи:

|**Чтобы**|**В обозревателе слоев**|
|-|-|
|Удалить ссылку между слоем и артефактом|Откройте контекстное меню для ссылки артефакт и выберите команду **Удалить**.|
|Переместить ссылку из одного слоя в другой|Перетащите ссылку артефакта в существующий слой на схеме.<br /><br /> -или-<br /><br /> 1. Откройте контекстное меню для ссылки артефакт, а затем выберите **Вырезать**.<br />2. на схеме зависимостей откройте контекстное меню слоя и выберите команду **Вставить**.|
|Скопировать ссылку из одного слоя в другой|1. Откройте контекстное меню для ссылки артефакта и выберите команду **Копировать**.<br />2. на схеме зависимостей откройте контекстное меню слоя и выберите команду **Вставить**.|
|Создать новый слой из существующей ссылки артефакта|Перетащите ссылку артефакта в пустую область на схеме.|
|Убедитесь, что связанный артефакт поддерживает проверку на соответствие схеме зависимостей.|Просмотрите столбец **Поддержка проверки** для ссылки артефакт.|

## <a name="reverse-engineer-existing-dependencies"></a><a name="Discovering"></a> Реконструировать существующие зависимости
 Зависимости существуют там, где артефакт, связанный с одним слоем, ссылается на артефакт, связанный с другим слоем. Например, класс в одном слое объявляет переменную, которая имеет класс в другом слое. Реконструировать существующие зависимости можно для артефактов, связанных со слоями в схеме.

> [!NOTE]
> Для определенных видов артефактов реконструировать зависимости невозможно. Например, зависимости не могут быть реконструированы из или в слой, связанный с текстовым файлом. Чтобы узнать, какие артефакты имеют зависимости, которые можно реконструировать, откройте контекстное меню для одного или нескольких слоев, а затем выберите **Просмотреть ссылки**. В **обозревателе слоев** изучите столбец **поддерживает проверку** . Зависимости не будут реконструированы для артефактов, для которых в этом столбце указано **значение false**.

- Выберите один или несколько слоев, откройте контекстное меню для выбранного слоя, а затем выберите **создать зависимости**.

  Как правило, на этом этапе можно увидеть некоторые зависимости, которых быть не должно. Эти зависимости можно изменить для соответствия предполагаемой структуре.

## <a name="edit-layers-and-dependencies-to-show-the-intended-design"></a><a name="EditDependencies"></a> Изменение слоев и зависимостей для отображения предполагаемого дизайна
 Чтобы описать изменения, которые вы планируете внести в систему или предполагаемую архитектуру, измените схему зависимостей.

|**Чтобы**|**Выполните следующие действия**|
|-|-|
|Изменить или ограничить направление зависимости|Задайте свойство **Direction** .|
|Создать новые зависимости|Используйте средства **зависимости** и **двунаправленной зависимости** .<br /><br /> Чтобы нарисовать несколько зависимостей, дважды щелкните средство. По завершении выберите инструмент **указатель** или нажмите клавишу **ESC** .|
|Указание, что артефакт, связанный со слоем, не может зависеть от указанного пространства имен|Введите пространства имен в свойстве " **Запрещенные зависимости пространства имен** слоя". Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, не должен более принадлежать указанному пространству имен|Введите пространства имен в свойстве **Запрещенные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|
|Указание, что артефакт, связанный со слоем, должен принадлежать одному из указанных пространств имен|Введите пространство имен в свойстве **обязательные пространства имен** слоя. Для разделения пространств имен используйте точку с запятой (**;**).|

## <a name="change-how-elements-appear-on-the-diagram"></a><a name="EditLayout"></a> Изменение отображения элементов на схеме
 Можно изменить размер, фигуру, цвет, положение слоев или цвет зависимостей, изменив их свойства.

## <a name="discover-patterns-and-dependencies-on-a-code-map"></a><a name="Codemaps"></a> Обнаружение шаблонов и зависимостей на карте кода
 При создании схем зависимостей вы также можете создавать **карты кода**. Они помогают обнаружить закономерности и зависимости при анализе кода. Воспользуйтесь обозревателем решений, представлением классов или обозревателем объектов, чтобы изучить сборки, пространства имен и классы, которые часто находятся в точном соответствии с существующими слоями. Подробнее о картах кода читайте в следующих разделах:

- [Сопоставление зависимостей во всех решениях](../modeling/map-dependencies-across-your-solutions.md)

- [Использование карт кода для отладки приложений](../modeling/use-code-maps-to-debug-your-applications.md)

- [Поиск потенциальных проблем с помощью анализаторов карт кода](../modeling/find-potential-problems-using-code-map-analyzers.md)

## <a name="see-also"></a>См. также раздел

- [Поддержка выпуска для средств моделирования и архитектуры](../modeling/what-s-new-for-design-in-visual-studio.md#edition-support-for-architecture-and-modeling-tools)
- [Видео. Проверка зависимостей архитектуры в режиме реального времени](https://sec.ch9.ms/sessions/69613110-c334-4f25-bb36-08e5a93456b5/170ValidateArchitectureDependenciesWithVisualStudio.mp4)
- [Схемы зависимостей: справочные материалы](../modeling/layer-diagrams-reference.md)
- [Схемы зависимостей: рекомендации](../modeling/layer-diagrams-guidelines.md)
- [Проверка кода по схемам зависимостей](../modeling/validate-code-with-layer-diagrams.md)
- [Визуализация кода](../modeling/visualize-code.md)
