---
title: Вычисляемые и пользовательские свойства хранилища
description: Узнайте, как все свойства домена в доменном языке (DSL) могут отображаться для пользователя на схеме и в обозревателе языка.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- Domain-Specific Language, programming domain properties
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: f98dca6759b9e4a77e71139b6d9ec9b394d99b04
ms.sourcegitcommit: e3a364c014ccdada0860cc4930d428808e20d667
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/19/2021
ms.locfileid: "112385426"
---
# <a name="calculated-and-custom-storage-properties"></a>Вычисляемые и пользовательские свойства хранилища
Все свойства домена в доменном языке (DSL) могут отображаться для пользователя на схеме и в обозревателе языка, и к ним можно получить доступ программный код. Однако свойства отличаются способом хранения их значений.

## <a name="kinds-of-domain-properties"></a>Типы свойств домена
 В определении DSL можно задать **тип** свойства домена, как указано в следующей таблице.

|Тип свойства предметной области|Описание|
|-|-|
|**Standard** (по умолчанию)|Свойство домена, которое сохраняется в *хранилище* и сериализуется в файл.|
|**вычисляемые**|Доступное только для чтения свойство домена, которое не сохраняется в хранилище, но вычисляется на основе других значений.<br /><br /> Например, `Person.Age` можно вычислить из `Person.BirthDate` .<br /><br /> Необходимо предоставить код, выполняющий вычисление. Как правило, значение вычисляется из других свойств домена. Однако можно также использовать внешние ресурсы.|
|**Настраиваемое хранилище**|Свойство домена, которое не сохраняется непосредственно в хранилище, но может быть и Get, и Set.<br /><br /> Необходимо предоставить методы, которые получают и задают значение.<br /><br /> Например, `Person.FullAddress` может храниться в `Person.StreetAddress` , `Person.City` и `Person.PostalCode` .<br /><br /> Можно также получить доступ к внешним ресурсам, например, чтобы получать и задавать значения из базы данных.<br /><br /> Код не должен задавать значения в хранилище, если `Store.InUndoRedoOrRollback` имеет значение true. См. раздел [Transactions and Custom Setters](#setters).|

## <a name="providing-the-code-for-a-calculated-or-custom-storage-property"></a>Предоставление кода для вычисляемого или пользовательского свойства хранилища
 Если для свойства предметной области задано значение вычисляемое или пользовательское хранилище, необходимо предоставить методы доступа. При сборке решения отчет об ошибке сообщит вам, что требуется.

#### <a name="to-define-a-calculated-or-custom-storage-property"></a>Определение вычисляемого или пользовательского свойства хранилища

1. В DslDefinition. DSL выберите свойство Domain либо на схеме, либо в **обозревателе DSL**.

2. В окне **Свойства** задайте для поля **тип** значение **вычисляемое** или **пользовательское хранилище**.

     Убедитесь, что для его **типа** также заданы нужные значения.

3. Щелкните **преобразовать все шаблоны** на панели инструментов **Обозреватель решений**.

4. В меню **Сборка** выберите **Собрать решение**.

     Появится следующее сообщение об ошибке: "*йоуркласс* не содержит определение для Get *YourProperty*".

5. Дважды щелкните сообщение об ошибке.

     Откроется Дсл\женератедкоде\домаинклассес.КС или Домаинрелатионшипс. cs. Над выделенным вызовом метода комментарий предложит предоставить реализацию Get *YourProperty*().

    > [!NOTE]
    > Этот файл создается из DslDefinition. DSL. Если изменить этот файл, изменения будут потеряны при следующем нажатии кнопки **преобразовать все шаблоны**. Вместо этого добавьте требуемый метод в отдельный файл.

6. Создайте или откройте файл класса в отдельной папке, например значение CustomCode \\ *йоурдомаинкласс*. cs.

     Убедитесь, что пространство имен совпадает с именем в созданном коде.

7. В файле класса напишите частичную реализацию доменного класса. В классе напишите определение для отсутствующего `Get` метода, которое напоминает следующий пример:

    ```
    namespace Company.FamilyTree
    {  public partial class Person
       {  int GetAgeValue()
          { return System.DateTime.Today.Year - this.BirthYear; }
    }  }
    ```

8. Если для параметра **тип** выбрать значение **настраиваемое хранилище**, то также потребуется предоставить `Set` метод. Пример.

    ```
    void SetAgeValue(int value)
    { if (!Store.InUndoRedoOrRollback)
        this.BirthYear =
            System.DateTime.Today.Year - value; }
    ```

     Код не должен задавать значения в хранилище, если `Store.InUndoRedoOrRollback` имеет значение true. См. раздел [Transactions and Custom Setters](#setters).

9. Выполните сборку и запуск решения.

10. Проверьте свойство. Убедитесь, что вы попробуете **отменить** и **повторить** операцию.

## <a name="transactions-and-custom-setters"></a><a name="setters"></a> Транзакции и пользовательские методы задания
 В методе Set пользовательского свойства хранилища нет необходимости открывать транзакцию, так как метод обычно вызывается внутри активной транзакции.

 Однако метод Set может также вызываться, если пользователь вызывает Undo или Redo или если выполняется откат транзакции. Если <xref:Microsoft.VisualStudio.Modeling.Store.InUndoRedoOrRollback%2A> имеет значение true, метод Set должен вести себя следующим образом:

- Он не должен вносить изменения в хранилище, например назначать значения другим свойствам домена. Диспетчер отмены задаст свои значения.

- Однако он должен обновлять все внешние ресурсы, такие как база данных или содержимое файлов, или объекты, находящиеся за пределами хранилища. Это позволит убедиться, что они хранятся в синчронисм со значениями в магазине.

  Пример.

```
void SetAgeValue(int value)
{
  // If we are in Undo, no changes to Store objects:
  if (!this.Store.InUndoRedoOrRollback)
  {
    this.BirthYear = System.DateTime.Today.Year - value;
  }
  // But always update external objects:
  System.IO.File.WriteAllText(AgeFile, value);
}
```

 Дополнительные сведения о транзакциях см. [в разделе Навигация и обновление модели в программном коде](../modeling/navigating-and-updating-a-model-in-program-code.md).

## <a name="see-also"></a>См. также

- [Перемещение по модели и обновление модели в коде программы](../modeling/navigating-and-updating-a-model-in-program-code.md)
- [Свойства доменных свойств](../modeling/properties-of-domain-properties.md)
- [Определение доменного языка](../modeling/how-to-define-a-domain-specific-language.md)
