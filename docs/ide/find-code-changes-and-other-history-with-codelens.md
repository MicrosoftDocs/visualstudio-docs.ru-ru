---
title: Поиск изменений кода и других журналов с помощью CodeLens
description: Сведения о CodeLens и о том, как использовать эту функцию для изучения журнала кода без выхода из редактора.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
f1_keywords:
- VS.ToolsOptionsPages.Text_Editor.All_Languages.CodeLens
author: TerryGLee
ms.author: tglee
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 59df5a4b0b0c873de69c5e574ad5c2cccbc43567
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99945881"
---
# <a name="find-code-changes-and-other-history-with-codelens"></a>Поиск изменений кода и других журналов с помощью CodeLens

CodeLens позволяет вам получать дополнительные сведения о коде, не отрываясь от работы и не выходя из редактора. Вы можете найти ссылки на фрагмент кода, изменения кода, связанные ошибки, рабочие элементы, проверки кода и модульные тесты.

::: moniker range=">=vs-2019"

> [!NOTE]
> CodeLens доступен в версии сообщества Visual Studio Community, однако в этой версии индикаторы управления *source control* недоступны.

::: moniker-end

::: moniker range="vs-2017"

> [!NOTE]
> Средство CodeLens доступно только в выпусках Visual Studio Enterprise и Professional. Оно не доступно в выпуске Visual Studio Community.

::: moniker-end

Посмотрите, где и как отдельные части вашего кода используются в решении.

![Индикаторы CodeLens в редакторе кода](../ide/media/codelens-overview.png)

Сообщите рабочей группе об изменениях в коде, не выходя из редактора.

![CodeLens - обращение к команде](../ide/media/codelens-contact-info.png)

Чтобы выбрать, какие индикаторы должны отображаться, или чтобы включить или выключить средство CodeLens, последовательно выберите пункты **Инструменты** > **Параметры** > **Текстовый редактор** > **Все языки** > **CodeLens**.

## <a name="find-references-to-your-code"></a>Поиск ссылок на код

Можно находить ссылки в коде Visual Basic или C#.

1. Выберите индикатор **ссылок** или нажмите **ALT**+**2**.

   ![Ссылки в CodeLens](../ide/media/codelens-view-references.png)

   > [!NOTE]
   > Если в индикаторе отображается **0 ссылок**, это значит, что ссылки из кода C# или Visual Basic отсутствуют. Однако могут существовать ссылки из других элементов, таких как *XAML*- и *ASPX*-файлы.

2. Чтобы просмотреть код ссылки, наведите указатель мыши на ссылку в списке.

   ![CodeLens - быстрый просмотр ссылки](../ide/media/codelens-peek-reference.png)

3. Чтобы открыть файл, который содержит ссылку, дважды щелкните эту ссылку.

### <a name="code-maps"></a>Карты кода

Чтобы просмотреть отношения между этим кодом и его ссылками, [создайте карту кода](../modeling/map-dependencies-across-your-solutions.md). В контекстном меню карты кода выберите **Показать все ссылки**.

![CodeLens - ссылки на карте кода](../ide/media/codelensmappedreferences.png)

## <a name="find-changes-in-your-code"></a>Поиск изменений в коде

Изучите журнал кода, чтобы узнать, что случилось. Можно также изучить изменения до их внедрения в ваш код, чтобы понять, как изменения в других ветвях могут повлиять на него.

Вам необходимы:

- Visual Studio Enterprise или Visual Studio Professional.

- Azure DevOps Services, Team Foundation Server 2013 или более поздней версии или Git.

- [Skype для бизнеса](/skypeforbusiness/) для связи с коллегами без выхода из редактора кода

Для кода на C# или Visual Basic, который хранится вместе с системой управления версиями Team Foundation (TFVC) или Git, сведения CodeLens предоставляются на уровнях класса и метода (индикаторы *уровня кода элемента*). Если репозиторий Git находится в TfGit, можно также получить ссылки на рабочие элементы TFS.

![Индикаторы кода на уровне элемента](../ide/media/codelens-element-level-indicators.png)

Для типов файлов, отличных от *.cs* и *.vb*, сведения о CodeLens по всему файлу приводятся в одном месте — в нижней части окна (индикаторы *уровня файла*).

![Индикаторы CodeLens уровня файлов](../ide/media/almcodelensfilelevelindicators.png)

### <a name="code-element-level-indicators"></a>Индикаторы кода на уровне элемента

Индикаторы кода на уровне элемента позволяют увидеть, кто изменил ваш код и какие изменения были внесены. Индикаторы на уровне элемента кода доступны для кода на C# и Visual Basic.

При использовании системы управления версиями Team Foundation (TFVC) в Team Foundation Server или Azure DevOps Services отображается следующее:

![CodeLens: получение журнала изменений для кода в TFVC](../ide/media/codelens-code-changes.png)

Период времени по умолчанию — последние 12 месяцев. Если код хранится в Team Foundation Server, то этот период можно изменить, выполнив [команду TFSConfig](/azure/devops/server/command-line/tfsconfig-cmd) вместе с [командой CodeIndex](../ide/codeindex-command.md) и флагом **/indexHistoryPeriod**.

Чтобы просмотреть подробный журнал всех изменений, включая сделанные более года назад, выберите параметр **Показать все изменения файла**:

![Показать все изменения кода](../ide/media/codelens-show-all-file-changes.png)

Откроется окно **Журнал**:

![Окно журнала для всех изменений кода](../ide/media/codelenscodechangeshistory.png)

Если ваши файлы хранятся в репозитории Git и вы выбираете индикатор изменений на уровне элемента кода, отображается следующее:

![CodeLens: получение журнала изменений для кода в Git](../ide/media/codelens-code-changes-git.png)

### <a name="file-level-indicators"></a>Индикаторы уровня файлов

Просмотрите изменения для всего файла на индикаторах уровня файла в нижней части окна:

![CodeLens: получение сведений о файле кода](../ide/media/codelens-file-level.png)

> [!NOTE]
> Индикаторы на уровне файла недоступны для файлов C# и Visual Basic.

Чтобы получить дополнительные сведения об изменении, щелкните этот элемент правой кнопкой мыши. В зависимости от того, используется TFVC или Git, существуют различные варианты сравнения версий файла, просмотра сведений и отслеживания изменений, получения выбранной версии файла и уведомления автора об изменениях по электронной почте. Некоторые из этих сведений отображаются в **Team Explorer**.

Также можно узнать, кто вносил изменения в код в течение определенного времени. Это поможет обнаружить закономерности во вносимых рабочей группой изменениях и оценить их влияние.

![CodeLens: просмотр журнала изменений кода в виде графа](../ide/media/codelens.png)

### <a name="find-changes-in-your-current-branch"></a>Поиск изменений в текущем подразделении

Ваша группа может работать с несколькими ветвями (например, с основной и дочерней ветвями разработки) для снижения риска нарушения стабильности кода.

![CodeLens. Поиск изменений в текущем подразделении](../ide/media/codelensfirstbranchconceptual.png)

Можно узнать, сколько пользователей вносили изменения в код и сколько изменений было сделано в основной ветви, нажав **ALT**+**6**:

![CodeLens: узнайте, сколько изменений в вашей ветви](../ide/media/codelens-branch-changes.png)

### <a name="find-when-your-code-was-branched"></a>Поиск разветвления кода

Чтобы определить, когда ваш код был разделен на ветви, перейдите к коду в дочерней ветви. Затем выберите индикатор **изменений** или нажмите сочетание клавиш **ALT**+**6**.

![CodeLens: узнайте, когда ваш код был разветвлен](../ide/media/codelens-first-branch.png)

### <a name="find-incoming-changes-from-other-branches"></a>Поиск входящих изменений от других подразделений

![CodeLens: поиск изменений кода в других ветвях](../ide/media/codelensbranchchangecheckinconceptual.png)

Вы можете просмотреть входящие изменения. В примере, изображенном на рисунке ниже, была исправлена ошибка в ветви "Dev":

![CodeLens: изменение, зарегистрированное в другой ветви](../ide/media/codelens-branch-changes-dev.png)

Вы можете просмотреть это изменение, не покидая текущей ветви ("Main"):

![CodeLens: просмотр изменения, поступившего от другой ветви](../ide/media/codelens-branch-changes-main.png)

### <a name="find-when-changes-got-merged"></a>Поиск объединения изменений

Вы можете просмотреть слияния изменений, поэтому можно определить, какие изменения были добавлены в вашу ветвь:

![CodeLens — поиск объединения изменений](../ide/media/codelensbranchmergedconceptual.png)

Например, код в ветви "Main" теперь содержит исправление ошибки из ветви "Dev":

![CodeLens: слияние изменений между ветвями](../ide/media/codelens-branch-merged.png)

### <a name="compare-an-incoming-change-with-your-local-version"></a>Сравнение входящего изменения с локальной версией

Сравните входящее изменение с локальной версией, нажав сочетание клавиш **SHIFT**+**F10** или дважды щелкнув набор изменений.

![CodeLens: сравнение поступившего изменения с локальным](../ide/media/codelens-branch-incoming-change-menu.png)

### <a name="branch-icons"></a>Значки ветвей

Значок в столбце **Ветвь** показывает связь с ветвью, в которой вы работаете.

|**Значок**:|**Откуда пришли изменения:**|
|--------------| - |
|![CodeLens: значок "Изменение от текущей ветви"](../ide/media/codelensbranchcurrenticon.png)|Текущее подразделение|
|![CodeLens: значок "Изменение от родительской ветви"](../ide/media/codelensbranchparenticon.png)|Родительское подразделение|
|![CodeLens: значок "Изменение от дочерней ветви"](../ide/media/codelensbranchchildicon.png)|Дочернее подразделение|
|![CodeLens: значок "Изменение от одноранговой ветви"](../ide/media/codelensbranchpeericon.png)|Одноранговое подразделение|
|![CodeLens: значок "Изменение от дальней ветви"](../ide/media/codelensbranchfurtherawayicon.png)|Подразделение, отличное от родительского, дочернего или однорангового|
|![CodeLens: значок "Слияние от родительской ветви"](../ide/media/codelensbranchmergefromparenticon.png)|Слияние с данными от родительского подразделения с дочерним подразделением|
|![CodeLens: значок "Слияние от дочерней ветви"](../ide/media/codelensbranchmergefromchildicon.png)|Слияние с данными от дочернего подразделения с родительским подразделением|
|![CodeLens: значок "Слияние от несвязанной ветви"](../ide/media/codelensbranchmergefromunrelatedicon.png)|Слияние с данными от несвязанного подразделения (слияние без базовой версии)|

## <a name="linked-work-items"></a>Связанные рабочие элементы

Найдите связанные рабочие элементы, выбрав индикатор **рабочие элементы** или нажав **ALT**+**8**.

![CodeLens - поиск рабочих элементов для конкретного кода](../ide/media/codelens-work-items.png)

## <a name="linked-code-reviews"></a>Связанные проверки кода

Найдите связанные проверки кода, выбрав индикатор **проверки**. Чтобы перемещаться по индикаторам с помощью клавиатуры, при нажатой клавише **ALT** нажимайте **СТРЕЛКУ ВЛЕВО** или **СТРЕЛКУ ВПРАВО**.

![CodeLens - просмотр запросов на проверку кода](../ide/media/codelens-code-reviews.png)

## <a name="linked-bugs"></a>Связанные ошибки

Найдите связанные ошибки, выбрав индикатор **ошибки** или нажав **ALT**+**7**.

![CodeLens - поиск ошибок, связанных с наборами изменений](../ide/media/codelens-bugs-changesets.png)

## <a name="contact-the-owner-of-an-item"></a>Обращение к владельцу элемента

Найдите автора элемента, выбрав индикатор **авторы** или нажав **ALT**+**5**.

![Обращение к владельцу элемента](../ide/media/codelens-contact-item-owner.png)

Откройте контекстное меню элемента, чтобы увидеть параметры контакта. Если на компьютере установлено приложение Lync или Skype для бизнеса, отобразятся следующие параметры:

![Параметры контакта для элемента](../ide/media/codelens-item-contact-menu.png)

## <a name="associated-unit-tests"></a>Связанные модульные тесты

Вы можете узнать, какие имеются модульные тесты для вашего кода C# или Visual Basic, не открывая **обозреватель тестов**.

1. Перейдите к коду приложения, содержащему связанный [код модульного теста](../test/unit-test-your-code.md).

2. Если вы еще этого не сделали, создайте приложение для загрузки индикаторов тестов CodeLens.

3. Просмотрите тесты для кода, нажав сочетание клавиш **ALT**+**3**.

     ![CodeLens - выбор индикатора состояния тестирования в редакторе кода](../ide/media/codelens-choose-test-indicator.png)

4. Если отображается значок предупреждения ![значок предупреждения](../ide/media/codelenstestwarningicon.png), то тесты еще не выполнялись, поэтому запустите их.

     ![CodeLens - просмотр еще не запускавшихся модульных тестов](../ide/media/codelens-tests-not-yet-run.png)

5. Чтобы просмотреть определение теста, откройте файл кода в редакторе, дважды щелкнув элемент теста в окне индикаторов CodeLens.

     ![CodeLens - переход к определению модульного теста](../ide/media/codelens-unit-test-definition.png)

6. Чтобы просмотреть результаты теста, выберите индикатор состояния теста (![значок сбоя теста](../ide/media/codelenstestfailedicon.png) или ![значок успешного завершения теста](../ide/media/codelenstestpassedicon.png)) или нажмите **ALT**+**1**.

     ![CodeLens- просмотр результатов модульного теста](../ide/media/codelens-unit-test-result.png)

7. Чтобы увидеть, сколько пользователей изменяло данный тест, кто именно изменял тест или сколько изменений было внесено в тест, [найдите журнал кода](#find-changes-in-your-code) и связанные элементы.

## <a name="keyboard-shortcuts"></a>сочетания клавиш

Чтобы выбрать индикатор с помощью клавиатуры, нажмите и удерживайте клавишу **ALT** для отображения номеров индикаторов, а затем нажмите цифру с номером индикатора, который необходимо выбрать.

![Номера для выбора с клавиатуры](../ide/media/codelens-alt-keys.png)

> [!NOTE]
> Чтобы выбрать индикатор **проверки**, удерживайте нажатой клавишу **ALT** и нажимайте клавиши со стрелками влево и вправо для перехода.

## <a name="q--a"></a>Вопросы и ответы

### <a name="q-how-do-i-turn-codelens-off-or-on-or-choose-which-indicators-to-see"></a>Вопрос: Как включать и отключать CodeLens и как выбирать отображаемые индикаторы?

**Ответ.**  Включать и выключать можно все индикаторы, кроме индикатора ссылок. Последовательно выберите пункты **Сервис** > **Параметры** > **Текстовый редактор** > **Все языки** > **CodeLens**.

Если индикаторы включены, параметры CodeLens можно также открыть из индикаторов.

![Включение или выключение индикаторов CodeLens](../ide/media/codelensturnoffonindicatorsfromcode.png)

Индикаторы CodeLens уровня файла включаются и отключаются с помощью значка шеврона в нижней части окна редактора.

![Включение и выключение индикаторов на уровне файла](../ide/media/codelensfilelevelonandoff.png)

### <a name="q-where-is-codelens"></a>Вопрос. Где находится CodeLens?

**Ответ.** CodeLens отображается в коде C# и Visual Basic на уровне метода, класса, индексатора и свойства. Для всех других типов файлов CodeLens отображается на уровне файла.

- Включите CodeLens. Последовательно выберите пункты **Сервис** > **Параметры** > **Текстовый редактор** > **Все языки** > **CodeLens**.

- Если код хранится в TFS, с помощью [команды CodeIndex](../ide/codeindex-command.md) и [команды TFS Config](/azure/devops/server/command-line/tfsconfig-cmd)убедитесь, что индексирование кода включено.

- Индикаторы, связанные с DevOps, отображаются, только когда рабочие элементы связаны с кодом и имеются разрешения на открытие связанных рабочих элементов. Убедитесь в наличии [разрешений члена команды](/azure/devops/organizations/security/view-permissions?view=vsts&preserve-view=true).

- Индикаторы модульных тестов не отображаются, если в коде приложения отсутствуют модульные тесты. Индикаторы состояния теста отображаются автоматически в тестовых проектах. Если известно, что код приложения имеет модульные тесты, но индикаторы тестов не отображаются, попробуйте выполнить сборку решения (**CTRL**+**SHIFT**+**B**).

::: moniker range=">=vs-2019"

> [!TIP]
> CodeLens доступен в версии сообщества Visual Studio Community, однако в этой версии индикаторы управления *source control* недоступны.

::: moniker-end

::: moniker range="vs-2017"

> [!TIP]
> Средство CodeLens не доступно в выпуске Visual Studio Community.

::: moniker-end

### <a name="q-why-dont-i-see-the-work-item-details-for-a-commit"></a>Вопрос: Почему я не вижу сведения рабочего элемента для фиксации?

**Ответ.** Это может происходить, когда CodeLens не может найти рабочие элементы в Azure Boards или TFS. Проверьте, что вы подключены к проекту, который имеет эти рабочие элементы, и что имеются разрешения для просмотра этих рабочих элементов. Сведения о рабочих элементах могут также не отображаться, если описание фиксации содержит неверные сведения об идентификаторах рабочих элементов в Azure Boards или TFS.

### <a name="q-why-dont-i-see-the-skype-indicators"></a>Вопрос. Почему не отображаются индикаторы Skype?

**Ответ.** Индикаторы Skype не отображаются, если вы не вошли в Skype для бизнеса, если он не установлен или вы используете неподдерживаемую конфигурацию. Однако вы по-прежнему можете отправлять почту:

![CodeLens - обращение к владельцу набора изменений по почте](../ide/media/codelenscodesendmailchangesetnolync1.png)

**Какие конфигурации Skype и Lync поддерживаются?**

- Skype для бизнеса (32- или 64-разрядная версия)

- Lync 2010 или более поздняя версия отдельно (32- или 64-разрядная), но не Lync Basic 2013 с Windows 8.1

CodeLens не поддерживает наличие нескольких установленных версий Lync или Skype. Они могут быть не локализованы для всех локализованных версий Visual Studio.

### <a name="q-how-do-i-change-the-font-and-color-for-codelens"></a>Вопрос. Как изменить шрифт и цвет CodeLens?

**Ответ**. Последовательно выберите пункты **Сервис** > **Параметры** > **Среда** > **Шрифты и цвета**.

![CodeLens - изменение параметров шрифта и цвета](../ide/media/codelensoptionsfontscolorssettings.png)

Для использования клавиатуры выполните следующие действия.

1. Нажмите **ALT**+**T**+**O**, чтобы открыть диалоговое окно **Параметры**.

2. Нажмите клавишу **СТРЕЛКА ВВЕРХ** или **СТРЕЛКА ВНИЗ** , чтобы перейти к узлу **Среда** , а затем нажмите клавишу **СТРЕЛКА ВЛЕВО** , чтобы развернуть узел.

3. Нажмите клавишу **СТРЕЛКА ВНИЗ** , чтобы перейти к пункту **Шрифты и цвета**.

4. Нажмите клавишу **TAB**, чтобы перейти к списку **Параметры для**, после чего нажмите клавишу **СТРЕЛКА ВНИЗ**, чтобы выбрать **CodeLens**.

### <a name="q-can-i-move-the-codelens-heads-up-display"></a>В. Можно ли переместить HUD-элемент CodeLens?

**Ответ.** Да, щелкните ![значок закрепления](../ide/media/codelensdockwindow.png), чтобы закрепить CodeLens как окно.

![Кнопка закрепления окна индикаторов CodeLens](../ide/media/codelensselectdockwindow.png)

![Закрепленное окно ссылок CodeLens](../ide/media/codelensreferencesdockedwindow.png)

### <a name="q-how-do-i-refresh-the-indicators"></a>В. Как обновить индикаторы?

**Ответ.** Это зависит от индикатора.

- **Ссылки**: этот индикатор обновляется автоматически при изменении кода. Если индикатор **Ссылки** закреплен в отдельном окне, его можно обновить, нажав на **Обновить**:

   ![Кнопка "Обновить" в ссылках CodeLens](../ide/media/codelensviewreferencesdocked.png)

- **Команда**: эти индикаторы можно обновить, выбрав **Обновить командные индикаторы CodeLens** из контекстного меню:

   ![Пункт меню "Обновить командные индикаторы CodeLens"](../ide/media/codelensrefreshindicatorsfromcode.png)

- **Тест**: [найдите модульные тесты для кода](#associated-unit-tests), чтобы обновить индикатор **Тест**.

### <a name="q-whats-local-version"></a>Вопрос. Что такое "Локальная версия"?

**Ответ.** Стрелка **Локальная версия** указывает на последний набор изменений в локальной версии файла. Если на сервере находятся более новые наборы изменений, они отображаются над или под стрелкой **Локальная версия** в зависимости от порядка сортировки наборов изменений.

### <a name="q-can-i-manage-how-codelens-processes-code-to-show-history-and-linked-items"></a>Вопрос. Можно ли управлять тем, как CodeLens обрабатывает код для отображения журнала и связанных элементов?

**Ответ.** Да. Если код находится в TFS, используйте [команду CodeIndex](../ide/codeindex-command.md) с [командой TFS Config](/azure/devops/server/command-line/tfsconfig-cmd).

### <a name="q-my-codelens-test-indicators-no-longer-appear-in-my-file-when-i-first-open-my-solution-how-can-i-load-them"></a>Вопрос. Мои индикаторы тестов CodeLens больше не отображаются в файле, когда я впервые открываю решение. Как их загрузить?

**Ответ**. Перестройте проект, чтобы индикаторы тестов CodeLens загружались в файл. Для повышения производительности Visual Studio больше не получает сведения об источнике для индикаторов тестов при загрузке файлов кода. Индикаторы тестов загружаются после сборки или при переходе к тесту двойным щелчком в **обозревателе тестов**.

## <a name="see-also"></a>См. также

- [Возможности редактора кода](../ide/writing-code-in-the-code-and-text-editor.md)
