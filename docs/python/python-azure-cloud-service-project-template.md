---
title: Шаблон проекта облачной службы Azure для Python
description: Visual Studio предоставляет шаблоны облачных служб Azure, написанных на языке Python, в том числе развертывание роли, зависимости и устранение неполадок.
ms.date: 11/12/2018
ms.topic: conceptual
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.custom: seodec18
monikerRange: vs-2017
ms.workload:
- python
- data-science
- azure
ms.openlocfilehash: 2de0f255da54d5bd8abf865f6534041d88bbbca3
ms.sourcegitcommit: 4908561809ad397c99cf204f52d5e779512e502c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2021
ms.locfileid: "112254840"
---
# <a name="azure-cloud-service-projects-for-python"></a>Проекты облачных служб Azure для Python

Visual Studio предоставляет шаблоны, которые помогут быстро начать разработку облачных служб Azure с использованием Python.

[Облачная служба](/azure/cloud-services/) состоит из произвольного числа *рабочих ролей* и *веб-ролей*, каждая из которых выполняет концептуально независимую задачу и может реплицироваться на несколько виртуальных машин для масштабирования. Веб-роли служат для размещения интерфейсных веб-приложений. При использовании Python для создания такого приложения подходит любая веб-платформа с поддержкой WSGI (поддерживаемая [шаблоном веб-проекта](python-web-application-project-templates.md)). Рабочие роли предназначены для длительных рабочих процессов, которые не взаимодействуют с пользователями напрямую. Они обычно используют пакеты из состава пакета azure, который устанавливается с помощью команды [`pip install azure`](https://pypi.org/project/azure).

Эта статья содержит сведения о шаблоне проекта и других возможностях Visual Studio 2017 и более поздних версий (в более ранних версиях эти функции также доступны, но с некоторыми отличиями). Дополнительные сведения о работе с Azure в Python вы найдете в [центре Azure для разработчиков Python](/azure/python/).

## <a name="create-a-project"></a>Создание проекта

1. Установите [пакет SDK Azure .NET для Visual Studio](https://visualstudio.microsoft.com/vs/azure-tools/), который потребуется для использования шаблона облачной службы.
1. В Visual Studio выберите **Файл** > **Новый** > **Проект**, выполните поиск по запросу "Python Azure" и выберите в списке результатов **Облачная служба Azure**:

    ![Шаблон облачного проекта Azure для Python](media/template-azure-cloud-project.png)

1. Выберите одну или несколько ролей, которые вы хотите включить в проект. Облачные проекты могут объединять роли, написанные на разных языках, поэтому каждую часть приложения вы можете создавать на том языке, который для нее подходит лучше всего. Чтобы добавить в проект новые роли позже, когда вы уже закроете это диалоговое окно, щелкните правой кнопкой мыши **Роли** в **обозревателе решений** и выберите один из элементов в разделе **Добавить**.

    ![Добавление ролей в шаблон облачного проекта Azure](media/template-azure-cloud-service-project-wizard.png)

1. При создании отдельных проектов ролей может потребоваться установка дополнительных пакетов Python, например платформы Django, Bottle или Flask, если выбранная роль использует одну из них.

1. После добавление новой роли в проект отображаются инструкции по ее настройке. Обычно изменения конфигурации не требуются, но настройка может пригодиться для персонализации некоторых проектов. Обратите внимание, что при одновременном добавлении нескольких ролей остаются открытыми только инструкции для настройки последней из них. Инструкции и советы по устранению неполадок для других ролей вы можете найти в соответствующих файлах *readme.mht*, которые располагаются в корневом каталоге роли или в папке *bin*.

1. Папка проекта *bin* содержит один или два скрипта PowerShell, которые позволяют настроить удаленную виртуальную машину, например, установить на ней Python, изменить файл [*requirements.txt*](#dependencies) для проекта или настроить службу IIS, если это потребуется. Вы можете изменять эти файлы для вашего развертывания. Но учтите, что основные параметры можно изменять другими способами (см. раздел [Настройка развертывания роли](#configure-role-deployment) ниже). Мы не рекомендуем удалять эти файлы, поскольку при их отсутствии используются прежние версии скриптов настройки.

    ![Файлы поддержки рабочей роли](media/template-azure-cloud-service-worker-role-support-files.png)

    Чтобы добавить скрипты настройки в новый проект, щелкните проект правой кнопкой мыши, выберите **Установка** > **Новый элемент** и выберите **Файлы поддержки веб-роли** или **Файлы поддержки рабочей роли**.

## <a name="configure-role-deployment"></a>Настройка развертывания роли

Скрипты PowerShell, размещенные в папке *bin* проекта роли, управляют развертыванием этой роли. Их можно изменять для настройки конфигурации.

- *ConfigureCloudService.ps1* используется для веб-ролей и рабочих ролей, чаще всего для установки и настройки зависимостей и указания версии Python.
- *LaunchWorker.ps1* используется только для рабочих ролей. Этот скрипт позволяет изменить поведение при запуске, добавить аргументы командной строки и (или) добавить переменные среды.

Оба файла содержат инструкции для настройки. Также вы можете установить любую версию Python на ваше усмотрение, добавив другую задачу в основной файл проекта облачной службы *ServiceDefinition.csdef* и указав для переменной `PYTHON` значение пути к файлу *python.exe* (или его аналогу). Если задано значение `PYTHON`, Python не устанавливается из NuGet.

Вот как можно выполнить дополнительные настройки.

1. Установите пакеты с помощью `pip`, обновив файл *requirements.txt* в корневом каталоге проекта. Скрипт *ConfigureCloudService.ps1* устанавливает этот файл при развертывании.
1. Задайте переменные среды, изменив файл *web.config* (для веб-ролей) или раздел `Runtime` файла *ServiceDefinition.csdef* (для рабочих ролей).
1. Укажите скрипт и аргументы для рабочей роли, изменив командную строку в разделе `Runtime/EntryPoint` файла *ServiceDefinitions.csdef*.
1. Укажите основной скрипт обработчика для веб-роли в файле *web.config*.

## <a name="test-role-deployment"></a>Тестирование развертывания роли

При создании ролей вы можете протестировать облачный проект локально с помощью эмулятора облачной службы. Этот эмулятор включен в средства пакета SDK для Azure и представляет собой ограниченную версию среды, в которой облачная служба публикуется в Azure.

Чтобы запустить эмулятор, следует указать облачный проект в качестве стартового проекта для вашего решения. Для этого щелкните проект правой кнопкой мыши и выберите **Назначить запускаемым проектом**. Затем выберите **Отладка** > **Начать отладку** (**F5**) или **Отладка** > **Запустить без отладки** (**CTRL**+**F5**).

Обратите внимание, что ограничения эмулятора не позволяют выполнять отладку кода Python. Поэтому мы рекомендуем для отладки ролей запускать их независимо друг от друга, а эмулятор использовать только для интеграционного тестирования перед публикацией.

## <a name="deploy-a-role"></a>Развертывание роли

Чтобы открыть **Мастер публикации**, выберите проект роли в **обозревателе решений** и запустите из главного меню команду **Сборка** > **Публикация** или щелкните проект правой кнопкой мыши и выберите **Опубликовать**.

Процесс публикации включает два этапа. Сначала Visual Studio создает один пакет, содержащий все роли облачной службы. Именно этот пакет развертывается в Azure, чтобы инициализировать одну или несколько виртуальных машин для каждой роли и развернуть источник.

При активации каждой виртуальной машины она выполняет скрипт *ConfigureCloudService.ps1* и устанавливает все зависимости. По умолчанию скрипт устанавливает последнюю версию Python из [NuGet](https://www.nuget.org/packages?q=Tags%3A%22python%22+Authors%3A%22Python+Software+Foundation%22) и все пакеты, указанные в файле *requirements.txt*.

Если это рабочая роль, в конце развертывания она выполняет *LaunchWorker.ps1*, который запускает настроенный скрипт Python. Веб-роль инициализирует службу IIS и начинает обработку веб-запросов.

## <a name="dependencies"></a>Зависимости

Для облачных служб скрипт *ConfigureCloudService.ps1* использует `pip` для установки набора зависимостей Python. Их следует указать в файле с именем *requirements.txt* (это имя можно изменить в файле *ConfigureCloudService.ps1*). Этот файл исполняется командой `pip install -r requirements.txt` в процессе инициализации.

Обратите внимание, что экземпляры облачной службы не содержат компилятор C, поэтому все библиотеки с расширениями C должны содержать предварительно скомпилированные двоичные файлы.

PIP и его зависимости, а также указанные в файле *requirements.txt* пакеты скачиваются автоматически и могут создавать оплачиваемый сетевой трафик. В руководстве по [управлению необходимыми пакетами с помощью requirements.txt](managing-required-packages-with-requirements-txt.md) подробно описаны правила работы с файлами *requirements.txt*.

## <a name="troubleshooting"></a>Устранение неполадок

Если веб-роль или рабочая роль неправильно работают после развертывания, проверьте следующее.

- Проект Python содержит папку *bin\\*, где содержатся по меньшей мере следующие файлы:

  - *ConfigureCloudService.ps1*
  - *LaunchWorker.ps1* (для рабочих ролей);
  - *Файл ps.cmd*

- Проект Python должен содержать файл *requirements.txt* со списком всех зависимостей (или набор файлов колеса).
- Включите удаленный рабочий стол для облачной службы и проверьте файлы журнала.
- Журналы для *ConfigureCloudService.ps1* и файл *LaunchWorker.ps1* хранятся в папке *C:\Resources\Directory\%RoleId%.DiagnosticStore\LogFiles* на удаленном компьютере.
- Веб-роли могут создавать дополнительные журналы в папке, путь к которой задается в файле *web.config* в параметре appSetting `WSGI_LOG`. Также работает обычное ведение журналов IIS или FastCGI.
- Сейчас выходные данные или сообщения об ошибках, которые выводит рабочая роль Python, можно просмотреть только в файле *LaunchWorker.ps1.log*.
