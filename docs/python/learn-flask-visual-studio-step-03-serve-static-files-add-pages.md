---
title: Руководство по Flask в Visual Studio. Шаг 3. Статические файлы и страницы
titleSuffix: ''
description: Пошаговое руководство по основам Flask в контексте проектов Visual Studio, в частности демонстрация обработки статических файлов, добавление страниц в приложение и использование наследования шаблонов
ms.date: 01/07/2019
ms.topic: tutorial
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.custom: seodec18
ms.workload:
- python
- data-science
ms.openlocfilehash: d474236aca50a74b96689001a56e7d0701caae30
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99942390"
---
# <a name="step-3-serve-static-files-add-pages-and-use-template-inheritance-with-flask-app"></a>Шаг 3. Обработка статических файлов, добавление страниц и использование наследования шаблонов с помощью приложения Flask

**Предыдущий шаг. [Создание приложения Flask с представлениями и шаблонами страниц](learn-flask-visual-studio-step-02-create-app.md)**

В предыдущих шагах этого руководства рассматривалось создание минимального приложения Flask с одной страницей автономного HTML. Современные веб-приложения обычно состоят из многих страниц и используют общие ресурсы, такие как файлы CSS и JavaScript, для обеспечения согласованного стиля и реакции на события.

На этом шаге вы научитесь делать следующее:

> [!div class="checklist"]
> - с помощью шаблонов элементов Visual Studio быстро добавлять новые файлы различных типов с удобным стереотипным кодом (шаг 3.1);
> - обрабатывать статические файлы из кода (шаг 3.2, дополнительный);
> - добавлять дополнительные страницы в приложение (шаг 3–3);
> - использовать наследование шаблона для создания заголовка и панели навигации, которая используется на разных страницах (шаг 3–4).

## <a name="step-3-1-become-familiar-with-item-templates"></a>Шаг 3–1. Знакомство с шаблонами элементов

По мере разработки приложения Flask обычно добавляется гораздо больше дополнительных файлов Python, HTML, CSS и JavaScript. Для каждого типа файла (а также других файлов, таких как *web.config*, которые могут понадобиться для развертывания) Visual Studio предоставляет удобные [шаблоны элементов](python-item-templates.md) для начала работы.

Чтобы просмотреть доступные шаблоны, перейдите к **обозревателю решений**, щелкните правой кнопкой мыши папку, в которой необходимо создать элемент, выберите **Добавить** > **Новый элемент**:

![Диалоговое окно ''Добавление нового элемента'' в Visual Studio](media/flask/step03-add-new-item-dialog.png)

Чтобы использовать шаблон, выберите нужный шаблон, укажите имя файла и нажмите кнопку **ОК**. При добавлении элемента таким образом автоматически добавляется файл в проект Visual Studio и отмечает изменения для системы управления версиями.

### <a name="question-how-does-visual-studio-know-which-item-templates-to-offer"></a>Вопрос. Как Visual Studio определяет, какой шаблон элемента предложить?

Ответ. Файл проекта Visual Studio (*PYPROJ*) содержит идентификатор типа проекта, который помечает его как проект Python. Visual Studio использует этот тип идентификатора для отображения шаблонов элементов, подходящих для типа проекта. Таким образом Visual Studio может предоставлять богатый набор шаблонов элементов для многих типов проектов, который не требуется отсортировывать каждый раз.

## <a name="step-3-2-serve-static-files-from-your-app"></a>Шаг 3–2. Обработка статических файлов из приложения

В веб-приложении, созданном с помощью Python (с помощью любой платформы), файлы Python всегда выполняются на сервере веб-узла и никогда не передаются на компьютер пользователя. Однако другие файлы, такие как каскадные таблицы стилей и JavaScript, используются исключительно браузером, поэтому сервер узла просто доставляет их без изменений всякий раз, когда они запрашиваются. Такие файлы называются статическими файлами, Flask может доставлять их автоматически без необходимости написания кода. В HTML-файлах, например, можно просто ссылаться на статические файлы, используя относительный путь в проекте. Первый раздел в этом шаге служит для добавления файла CSS в существующий шаблон страницы.

Если статический файл требуется предоставлять из кода, например через реализацию конечной точки API, Flask предоставляет удобный метод, который позволяет ссылаться на файлы, используя относительные пути в папке с именем *static* (в корневом каталоге проекта). Во втором разделе этого шага демонстрируется работа этого метода с помощью простого статического файла данных.

В любом случае можно упорядочить файлы в *static* так, как вам удобно.

### <a name="use-a-static-file-in-a-template"></a>Использование статического файла в шаблоне

1. В **обозревателе решений** в проекте Visual Studio щелкните папку **HelloFlask** правой кнопкой мыши, выберите **Добавить** > **Новая папка** и назовите папку `static`.

1. Щелкните папку **static** правой кнопкой мыши и выберите **Добавить** > **Новый элемент**. В открывшемся диалоговом окне выберите шаблон **Таблица стилей**, назовите файл `site.css` и нажмите кнопку **ОК**. Файл **site.css** появится в проекте и откроется в редакторе. Структура папки должна выглядеть похоже на структуру на следующем рисунке:

    ![Структура статического файла, показанная в обозревателе решений](media/flask/step03-static-file-structure.png)

1. Замените все содержимое *site.css* следующим кодом и сохраните файл:

    ```css
    .message {
        font-weight: 600;
        color: blue;
    }
    ```

1. Замените содержимое файла *templates/index.html* приложения приведенным ниже кодом, который заменяет элемент `<strong>`, используемый в шаге 2, элементом `<span>`, ссылающимся на класс стиля `message`. Использование класса стиля таким образом дает большую гибкость в стилизации элемента.

    ```html
    <html>
        <head>
            <title>{{ title }}</title>
            <link rel="stylesheet" type="text/css" href="/static/site.css" />
        </head>
        <body>
            <span class="message">{{ message }}</span>{{ content }}
        </body>
    </html>
    ```

1. Запустите проект для просмотра результатов. Остановите приложение после выполнения и зафиксируйте изменения в системе управления версиями, если это необходимо (как описано в [шаге 2](learn-flask-visual-studio-step-02-create-app.md#commit-to-source-control)).

### <a name="serve-a-static-file-from-code"></a>Обслуживание статического файла из кода

Flask предоставляет функцию с именем `serve_static_file`, которую можно вызвать из кода для ссылки на любой файл в папке *static* проекта. В рамках следующей процедуры создается простая конечная точка API, которая возвращает статический файл данных.

1. Создайте папку *static*, если это еще не сделано: в **обозревателе решений** в проекте Visual Studio щелкните папку **HelloFlask** правой кнопкой мыши, выберите **Добавить** > **Новая папка** и назовите папку `static`.

1. В папке *static* создайте статический файл данных JSON с именем *data.json* со следующим содержимым (бессмысленный пример данных):

    ```json
    {
        "01": {
            "note" : "Data is very simple because we're demonstrating only the mechanism."
        }
    }
    ```

1. Во *views.py* добавьте функцию с маршрутом /api/data, которая возвращает статический файл данных с помощью метода `send_static_file`:

    ```python
    @app.route('/api/data')
    def get_data():
      return app.send_static_file('data.json')
    ```

1. Запустите приложение и перейдите к конечной точке маршрута, API или данных, чтобы убедиться, что статический файл возвращается. По завершении остановите приложение.

### <a name="question-are-there-any-conventions-for-organizing-static-files"></a>Вопрос. Существуют ли соглашения для организации статических файлов?

Ответ. Вы можете добавить другие файлы CSS, JavaScript и HTML в свою папку *static* любым способом. Типичный способ организации статических файлов — это создание вложенных папок *fonts*, *scripts* и *content* (для таблиц стилей и других файлов).

### <a name="question-how-do-i-handle-url-variables-and-query-parameters-in-an-api"></a>Вопрос. Как обрабатывать переменные URL-адреса и параметры запроса в API?

Ответ. См. ответ в шаге 1–4 для вопроса [Как Flask обрабатывает переменные маршруты URL-адресов и параметры запроса?](learn-flask-visual-studio-step-01-project-solution.md#qa-url-variables)

## <a name="step-3-3-add-a-page-to-the-app"></a>Шаг 3–3. Добавление страницы в приложение

Добавление еще одной страницы в приложение означает:

- добавление функции Python, которая определяет представление;
- добавление шаблона для исправления страницы;
- добавление необходимой маршрутизации в файл *urls.py* проекта Flask.

Следующие действия добавляются на странице "Дополнительные сведения" проекта HelloFlask и связывают эту страницу с домашней страницей:

1. В **обозревателе решений** щелкните правой кнопкой мыши папку **templates**, выберите **Добавить** > **Новый элемент**, щелкните шаблон элемента **HTML-страница**, назовите файл `about.html` и нажмите кнопку **ОК**.

    > [!Tip]
    > Если команда **Новый элемент** не появляется в меню **Добавить**, убедитесь, что вы остановили приложение, чтобы среда Visual Studio вышла из режима отладки.

1. Замените содержимое *about.html* следующей разметкой (вы замените явную ссылку на домашнюю страницу простой навигационной панелью в шаге 3–4):

    ```html
    <html>
        <head>
            <title>{{ title }}</title>
            <link rel="stylesheet" type="text/css" href="/static/site.css" />
        </head>
        <body>
            <div><a href="home">Home</a></div>
            {{ content }}
        </body>
    </html>
    ```

1. Откройте файл *views.py* приложения и добавьте функцию с именем `about`, которая использует шаблон:

    ```python
    @app.route('/about')
    def about():
        return render_template(
            "about.html",
            title = "About HelloFlask",
            content = "Example app page for Flask.")
    ```

1. Откройте файл *templates/index.html* и добавьте следующую строку прямо в элемент `<body>`, чтобы связать страницу сведений (опять же, вы заменяете эту ссылку навигационной панелью в шаге 3–4):

    ```html
    <div><a href="about">About</a></div>
    ```

1. Сохраните все файлы с помощью команды меню **Файл** > **Сохранить все** или просто нажмите клавиши **CTRL**+**SHIFT**+**S**. (Технически этот шаг не требуется, так как при запуске проекта в Visual Studio файлы автоматически сохраняются. Однако об этой команде лучше знать.)

1. Выполните проект, чтобы просмотреть результаты и проверьте перемещение по страницам. После завершения остановите выполнение приложения.

### <a name="question-does-the-name-of-a-page-function-matter-to-flask"></a>Вопрос. Имеет ли имя функции страницы значение в Flask?

Ответ. Нет, так как URL-адреса, для которых Flask вызывает функцию для получения ответа, определяет декоратор `@app.route`. Разработчики обычно подбирают имя функции в соответствии с маршрутом, но такое сопоставление необязательно.

## <a name="step-3-4-use-template-inheritance-to-create-a-header-and-nav-bar"></a>Шаг 3–4. Использование наследования шаблона для создания заголовка и навигационной панели

Вместо создания явных навигационных ссылок на каждой странице современные веб-приложения обычно используют заголовок фирменной символики и панель навигации, которая предоставляет самые важные ссылки на страницы, всплывающие меню и т. д. Убедитесь, что заголовок и навигационная панель одинаковы на всех страницах, но не повторяйте один и тот же код в каждом шаблоне страницы. Вместо этого необходимо определить общие компоненты всех страниц в одном месте.

Система шаблонов Flask (по умолчанию Jinja) предоставляет два способа повторного использования определенных элементов в нескольких шаблонах: включение и наследование.

- *Включение*. Это другие шаблоны страниц, которые вставляются в определенное место в ссылочном шаблоне, используя синтаксис `{% include <template_path> %}`. Кроме того, можно использовать переменную, если необходимо динамически изменять путь в коде. Включение обычно используется в тексте страницы для извлечения общего шаблона в определенном расположении на странице.

- *Наследование*. В начале шаблона страницы используется `{% extends <template_path> %}` для определения общего базового шаблона, на основе которого затем создается ссылочный шаблон. Наследование обычно используется для определения общего макета, навигационной панели и других структур для страниц приложения, так что ссылочным шаблонам необходимо только добавлять или изменять определенные области базового шаблона, называемые *блоками*.

В обоих случаях `<template_path>` относится к папке *templates* приложения (`../` или `./` также разрешены).

Базовый шаблон отделяет *блоки* с помощью тегов `{% block <block_name> %}` и `{% endblock %}`. Если ссылающийся на него шаблон использует теги с тем же именем блока, содержимое его блока переопределяет содержимое базового шаблона.

Далее демонстрируется наследование:

1. В папке *templates* приложения создайте HTML-файл (с помощью пункта контекстного меню **Добавить** > **Новый элемент** или **Добавить** > **HTML-страница**) с именем *layout.html* и замените его содержимое приведенным ниже кодом. Вы увидите, что этот шаблон содержит блок под названием content, который должен быть заменен для всех ссылающихся страниц:

    ```html
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>{{ title }}</title>
        <link rel="stylesheet" type="text/css" href="/static/site.css" />
    </head>

    <body>
        <div class="navbar">
            <a href="/" class="navbar-brand">Hello Flask</a>
            <a href="{{ url_for('home') }}" class="navbar-item">Home</a>
            <a href="{{ url_for('about') }}" class="navbar-item">About</a>
        </div>

        <div class="body-content">
            {% block content %}
            {% endblock %}
            <hr/>
            <footer>
                <p>&copy; 2018</p>
            </footer>
        </div>
    </body>
    </html>
    ```

1. Добавьте следующие стили в файл *static/site.css* приложения (в этом пошаговом руководстве мы не пытаемся продемонстрировать гибкость дизайна; эти стили просто позволяют получить интересные результаты):

    ```css
    .navbar {
        background-color: lightslategray;
        font-size: 1em;
        font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        color: white;
        padding: 8px 5px 8px 5px;
    }

    .navbar a {
        text-decoration: none;
        color: inherit;
    }

    .navbar-brand {
        font-size: 1.2em;
        font-weight: 600;
    }

    .navbar-item {
        font-variant: small-caps;
        margin-left: 30px;
    }

    .body-content {
        padding: 5px;
        font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    ```

1. Измените *templates/index.html* для ссылки на базовый шаблон и переопределения блока content. Можно увидеть, что с помощью наследования этот шаблон упрощается:

    ```html
    {% extends "layout.html" %}
    {% block content %}
    <span class="message">{{ message }}</span>{{ content }}
    {% endblock %}
    ```

1. Измените файл *templates/about.html* так, чтобы он тоже ссылался на базовый шаблон и блок content в нем переопределялся:

    ```html
    {% extends "layout.html" %}
    {% block content %}
    {{ content }}
    {% endblock %}
    ```

1. Запустите сервер для просмотра результатов. Закройте сервер после завершения.

    ![Выполнение приложения, показывающего панель навигации](media/flask/step03-nav-bar.png)

1. Так как в приложение были внесены значительные изменения, самое время [зафиксировать изменения в системе управления версиями](learn-django-in-visual-studio-step-02-create-an-app.md#commit-to-source-control).

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Использование полного шаблона веб-проекта Flask](learn-flask-visual-studio-step-04-full-flask-project-template.md)

## <a name="go-deeper"></a>Дополнительные подробности

- [Развертывание веб-приложения в Службе приложений Azure](publishing-python-web-applications-to-azure-from-visual-studio.md)
- Сведения о дополнительных возможностях шаблонов Jinja, таких как поток управления, см. в [документации по конструктору шаблонов Jinja](http://jinja.palletsprojects.com/en/2.10.x/templates/) (jinja.pocoo.org).
- Дополнительные сведения об использовании `url_for` см. в разделе [url_for](https://flask.palletsprojects.com/en/1.0.x/api/#flask.url_for) в документации по объекту приложения Flask (flask.pocoo.org).
- Исходный код, используемый в руководстве, на сайте GitHub: [Microsoft/python-sample-vs-learning-flask](https://github.com/Microsoft/python-sample-vs-learning-flask)
