---
title: Руководство по Flask в Visual Studio. Шаг 1. Основные сведения о Flask
titleSuffix: ''
description: В этом пошаговом руководстве приводятся основные сведения о Flask в контексте проектов Visual Studio, в том числе описание предварительных требований, Git и виртуальных сред.
ms.date: 01/07/2019
ms.topic: tutorial
author: JoshuaPartlow
ms.author: joshuapa
manager: jmartens
ms.custom: seodec18
ms.workload:
- python
- data-science
ms.openlocfilehash: e77d4ea1d46914962f0791af91ad6c1efe21825c
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99942520"
---
# <a name="tutorial-get-started-with-the-flask-web-framework-in-visual-studio"></a>Руководство. Начало работы с веб-платформой Flask в Visual Studio

[Flask](https://palletsprojects.com/p/flask/) — это упрощенная платформа Python для веб-приложений, которая обеспечивает основные возможности маршрутизации URL-адресов и визуализации страниц.

Flask называют "микро"-платформой, так как она не предоставляет напрямую такие функции, как проверка форм, абстракция базы данных, проверка подлинности и т. д. Эти функции предоставляются специальными пакетами Python, называемыми *расширениями* Flask. Расширения легко интегрируются с Flask и отображаются так, как будто являются частью самой среды Flask. Например, Flask не предоставляет модуль шаблонов страницы. Использование шаблонов обеспечивается расширениями, такими как Jinja и Jade, как демонстрируется в этом учебнике.

В этом руководстве описано следующее.

> [!div class="checklist"]
> - создавать базовый проект Flask в репозитории Git с помощью шаблона "Пустой веб-проект Flask" (шаг 1);
> - создавать приложение Flask с одной страницей и преобразовать эту страницу для просмотра с помощью шаблона (шаг 2);
> - обслуживать статические файлы, добавлять страницы и использовать наследование шаблонов (шаг 3);
> - использовать шаблон веб-проекта Flask для создания приложения с несколькими страницами и адаптивным дизайном (шаг 4).
> - Используйте шаблон "Веб-проект опроса Flask", чтобы создать приложение опроса, использующее различные варианты хранения (хранилище Azure, MongoDB или память).

Выполняя эту процедуру, вы создадите единое решение Visual Studio, которое содержит три отдельных проекта. Мы создадим проект, используя разные шаблоны проектов Flask, которые входят в состав Visual Studio. Сохраняя проекты в одном и том же решении, вы можете легко переключаться между различными файлами для сравнения.

> [!Note]
> Этот учебник отличается от [Краткого руководства Flask](../ide/quickstart-python.md?toc=/visualstudio/python/toc.json&bc=/visualstudio/python/_breadcrumb/toc.json), которое содержит дополнительные сведения о Flask, а также об использовании различных шаблонов проектов Flask, которые предоставляют более широкие возможности для создания собственных проектов. Например, шаблоны проектов автоматически устанавливают пакет Flask при создании проекта, вместо установки пакета вручную, как показано в кратком руководстве.

## <a name="prerequisites"></a>предварительные требования

- Visual Studio 2017 или более поздней версии в системе Windows со следующими параметрами:
  - Рабочая нагрузка **Разработка на Python** (вкладка **Рабочая нагрузка** в установщике). Инструкции см. в статье [Установка поддержки Python в Visual Studio](installing-python-support-in-visual-studio.md).
  - **Git для Windows** и **расширение GitHub для Visual Studio** на вкладке **Отдельные компоненты** в разделе **Средства кода**.

Шаблоны проектов Flask также входят в состав всех ранних версий инструментов Python для Visual Studio, хотя и могут незначительно отличаться от рассматриваемых в этом руководстве.

Разработка Python в настоящее время не поддерживается в Visual Studio для Mac. В системах Mac и Linux используйте [расширение Python в Visual Studio Code](https://code.visualstudio.com/docs/python/python-tutorial).

## <a name="step-1-1-create-a-visual-studio-project-and-solution"></a>Шаг 1–1. Создание проекта и решения Visual Studio

1. В Visual Studio выберите **Файл** > **Создать** > **Проект**, выполните поиск по запросу "Flask" и выберите шаблон **Пустой веб-проект Flask**. (Шаблон также можно найти в папке **Python** > **Интернет** в списке слева.)

    ![Диалоговое окно нового проекта в Visual Studio для пустого веб-проекта Flask](media/flask/step01-new-blank-project.png)

1. В нижней части диалогового окна в полях введите следующие сведения (как показано на предыдущем рисунке), а затем нажмите кнопку **ОК**.

    - **Имя**. В качестве имени проекта Visual Studio укажите **BasicProject**. Это имя используется также и для проекта Flask.
    - **Расположение**. Укажите расположение для создания решения и проекта Visual Studio.
    - **Имя решения**. Укажите **LearningFlask**. В этом руководстве данное имя подходит для решения как контейнер для нескольких проектов.
    - **Создать каталог для решения**. Оставьте флажок установленным (по умолчанию).
    - **Создать новый репозиторий Git**. Выберите этот параметр (по умолчанию флажок не установлен), чтобы при создании решения в Visual Studio был создан локальный репозиторий Git. Если этот параметр не отображается, запустите Visual Studio Installer и добавьте **Git для Windows** и **Расширение GitHub для Visual Studio** на вкладке **Отдельные компоненты** в разделе **Средства для работы с кодом**.

1. Через некоторое время в Visual Studio отобразится диалоговое окно с сообщением **Для этого проекта требуются внешние пакеты** (как показано ниже). Это диалоговое окно открывается, так как шаблон включает файл *requirements.txt*, ссылающийся на последнюю версию пакета Flask 1.x. (Выберите **Показать необходимые пакеты**, чтобы просмотреть точный список зависимостей.)

    ![Запрос внешних пакетов для проекта](media/tutorials-common/step01-requirements-prompt-install-myself.png)

1. Выберите параметр **I will install them myself** (Я установлю их самостоятельно). В ближайшее время вы можете создать виртуальное окружение и исключить его из системы управления версиями. (Окружение всегда можно создать из *requirements.txt*.)

## <a name="step-1-2-examine-the-git-controls-and-publish-to-a-remote-repository"></a>Шаг 1–2. Проверка элементов управления Git и публикация в удаленном репозитории

Так как вы выбрали **Создать новый репозиторий Git** в диалоговом окне **Новый проект**, проект уже был зафиксирован в локальной системе управления версиями сразу после завершения процесса создания. На этом шаге вы ознакомитесь с элементами управления Git в Visual Studio и окном **Team Explorer**, в котором вы будете работать с системой управления версиями.

1. Проверьте элементы управления Git в нижнем углу главного окна Visual Studio. Эти элементы управления отображаются в следующем порядке (слева направо): неотправленные фиксации, незафиксированные изменения, имя репозитория и текущая ветвь.

    ![Элементы управления Git в окне Visual Studio](media/flask/step01-git-controls.png)

    > [!Note]
    > Если вы не выбрали параметр **Создать новый репозиторий Git** в диалоговом окне **Новый проект**, элементы управления Git отображают только команду **Добавить в систему управления версиями**, которая создает локальный репозиторий.
    >
    > ![Добавление в систему управления версиями в Visual Studio (если не создан репозиторий)](media/tutorials-common/step01-git-add-to-source-control.png)

1. Нажмите кнопку "Изменить" и в Visual Studio на странице **изменений** откроется окно **Team Explorer**. Так как созданный проект уже зафиксирован в системе управления версиями автоматически, ожидающие изменения не отобразятся.

    ![Окно Team Explorer на странице изменений](media/flask/step01-team-explorer-changes.png)

1. В строке состояния Visual Studio нажмите кнопку фиксации (стрелка вверх со значением **2**), чтобы открыть страницу **Синхронизация** в **Team Explorer**. Так как у вас есть только локальный репозиторий, страница предоставляет простые варианты для публикации репозитория для разных удаленных репозиториев.

    ![Окно Team Explorer с доступными вариантами репозитория Git для системы управления версиями](media/flask/step01-team-explorer.png)

    Для своих проектов вы можете выбрать любую службу. В этом руководстве используется GitHub. Завершенный пример кода для работы см. в репозитории [Microsoft/python-sample-vs-learning-flask](https://github.com/Microsoft/python-sample-vs-learning-flask).

1. При выборе любого из элементов управления **Публикация** **Team Explorer** предложит проверить зависимости для получения дополнительной информации. Например, при публикации примера для этого руководства сначала нужно было создать репозиторий, и в этом случае параметр **Отправить в удаленный репозиторий** использовался с URL-адресом репозитория.

    ![Окно Team Explorer для отправки в имеющийся удаленный репозиторий](media/flask/step01-push-to-github.png)

    Если у вас нет репозитория, параметры **Опубликовать в GitHub** и **Отправить в Azure DevOps** позволяют создать его непосредственно из Visual Studio.

1. При работе с этим руководством вы будете периодически использовать элементы управления в Visual Studio для фиксации и отправки изменений. Мы напомним вам об этом при необходимости.

> [!Tip]
> Для быстрого перемещения в **Team Explorer** выберите заголовок (**Изменения** или **Отправить**), чтобы открыть контекстное меню доступных страниц.

### <a name="question-what-are-some-advantages-of-using-source-control-from-the-beginning-of-a-project"></a>Вопрос. Каковы преимущества использования системы управления версиями с самого начала проекта?

Ответ. Прежде всего использование системы управления версиями с самого начала, особенно если вы также используете удаленный репозиторий, обеспечивает регулярное резервное копирование вашего проекта. В отличие от поддержки проекта только в локальной файловой системе, система управления версиями также предоставляет полную историю изменений и возможность отменить изменения одного файла или всего проекта. История изменений помогает определить причину регрессий (сбои при тестировании). Кроме того, система управления версиями необходима в случае, если над проектом работают несколько человек. Она управляет перезаписыванием и обеспечивает разрешение конфликтов. Наконец, система управления версиями, которая является формой автоматизации, отлично подходит для автоматизации сборки, тестирования и управления выпусками. Это первый шаг в использовании DevOps для проекта, и так как барьеры для входа настолько низки, нет оснований не использовать систему управления версиями с самого начала.

Дополнительные сведения о системе управления версиями как средства автоматизации см. в статье [Mobile DevOps - The Source of Truth: The Role of Repositories in DevOps](/archive/msdn-magazine/2016/september/mobile-devops-the-source-of-truth-the-role-of-repositories-in-devops) (DevOps для мобильных устройств. Источник правды. Роль репозиториев в DevOps) в журнале MSDN. Эта статья написана для мобильных приложений, однако она применима также и к веб-приложениям.

### <a name="question-can-i-prevent-visual-studio-from-auto-committing-a-new-project"></a>Вопрос. Можно ли отменить автоматическую фиксацию нового проекта в Visual Studio?

Ответ. Да. Чтобы отключить автоматическую фиксацию, перейдите на страницу **Параметры** в **Team Explorer**, выберите **Git** > **Глобальные параметры**, снимите флажок **Commit changes after merge by default** (Фиксировать изменения после объединения по умолчанию), а затем нажмите кнопку **Обновить**.

## <a name="step-1-3-create-the-virtual-environment-and-exclude-it-from-source-control"></a>Шаг 1–3. Создание виртуального окружения и его исключение из системы управления версиями

Теперь, когда вы настроили систему управления версиями для своего проекта, можно создать виртуальное окружение для необходимых пакетов Flask. Затем с помощью **Team Explorer** вы сможете исключить папку окружения из системы управления версиями.

1. В **обозревателе решений** щелкните правой кнопкой мыши элемент **Окружения Python** и выберите **Добавление виртуального окружения**.

    ![Команда "Добавление виртуального окружения" в обозревателе решений](media/flask/step01-add-virtual-environment-command.png)

1. Откроется диалоговое окно **Добавление виртуального окружения** с сообщением **Найден файл requirements.txt**. Это сообщение указывает, что Visual Studio использует данный файл для настройки виртуального окружения.

    ![Диалоговое окно "Добавление виртуального окружения" с сообщением о наличии файла requirements.txt](media/tutorials-common/step01-add-virtual-environment-found-requirements.png)

1. Нажмите кнопку **Создать**, чтобы принять параметры по умолчанию. (При желании вы можете изменить имя виртуального окружения, просто изменив имя своей подпапки. Однако `env` является стандартным соглашением.)

1. Согласитесь с привилегиями администратора при появлении запроса, а затем подождите несколько минут, пока Visual Studio загружает и устанавливает пакеты. Для Flask и зависимостей этот процесс представляет собой расширение нескольких тысяч файлов и примерно 100 подпапок. Ход выполнения отображается в окне **Вывод** Visual Studio. Во время ожидания просмотрите раздел вопросов. Можно также просмотреть описание зависимостей Flask на странице [установки Flask](https://flask.palletsprojects.com/en/1.0.x/installation/#installation) (flask.pcocoo.org).

1. В элементах управления Visual Studio Git (в строке состояния) выберите индикатор изменений (со значением **99&#42;** ), который открывает страницу **Изменения** в **Team Explorer**.

    Создание виртуального окружения привело к многочисленным изменениям, но вам не нужно включать их в систему управления версиями, потому что вы (или кто-то еще, клонирующий проект) в любое время сможете воссоздать окружение из *requirements.txt*.

    Чтобы исключить виртуальное окружение, щелкните правой кнопкой мыши папку **env** и выберите **Игнорировать эти локальные элементы**.

    ![Игнорирование виртуального окружения в изменениях системы управления версиями](media/flask/step01-ignore-local-items.png)

1. После исключения виртуального окружения единственными оставшимися изменениями являются файл проекта и *.gitignore*. Файл *.gitignore* содержит добавленную запись для папки виртуального окружения. Вы можете дважды щелкнуть файл, чтобы увидеть различия.

1. Введите сообщение о фиксации и нажмите кнопку **Зафиксировать все**, а затем при желании отправьте фиксации в удаленный репозиторий.

### <a name="question-why-do-i-want-to-create-a-virtual-environment"></a>Вопрос. Зачем нужно создавать виртуальное окружение?

Ответ. Виртуальное окружение — это хороший способ изолировать конкретные зависимости вашего приложения. Такая изоляция позволяет избежать конфликтов в глобальном окружении Python и помогает как тестированию, так и совместной работе. Позже при разработке приложения вы неизменно используете множество необходимых пакетов Python. Сохраняя пакеты в виртуальном окружении, зависящем от проекта, вы сможете легко обновить файл *requirements.txt* проекта, описывающий это окружение в системе управления версиями. При копировании проекта на любые другие компьютеры, включая серверы сборки, серверы развертывания и другие компьютеры разработки, легко воссоздать окружение, используя только *requirements.txt* (поэтому окружение не должно находиться в системе управления версиями). См. дополнительные сведения о [виртуальных окружениях](selecting-a-python-environment-for-a-project.md#use-virtual-environments).

### <a name="question-how-do-i-remove-a-virtual-environment-thats-already-committed-to-source-control"></a>Вопрос. Как удалить виртуальное окружение, которое уже было привязано к системе управления версиями?

Ответ. Сначала измените файл *.gitignore*, чтобы исключить папку. Найдите раздел с комментарием `# Python Tools for Visual Studio (PTVS)` в конце и добавьте новую строку для папки виртуального окружения, например `/BasicProject/env`. (Так как в Visual Studio файл не отображается в **обозревателе решений**, откройте его напрямую с помощью команды меню **Файл** > **Открыть** > **Файл**. Вы также можете открыть файл из **Team Explorer**. На странице **Параметры** выберите **Параметры репозитория**, перейдите в раздел **Пропуск и файлы атрибутов**, а затем щелкните ссылку **Изменить** рядом с **.gitignore**.)

Во-вторых, откройте окно команд, перейдите к папке типа *BasicProject*, содержащей папку виртуального окружения, например *env*, и выполните команду `git rm -r env`. Затем скопируйте эти изменения из командной строки (`git commit -m 'Remove venv'`) или зафиксируйте на странице **изменений** в **Team Explorer**.

## <a name="step-1-4-examine-the-boilerplate-code"></a>Шаг 1–4. Изучение стереотипного кода

1. После завершения создания проекта вы увидите решение и проект в **обозревателе решений**, где проект содержит только два файла, *app.py* и *requirements.txt*:

    ![Файлы пустого проекта Flask в обозревателе решений](media/flask/step01-blank-flask-project-in-solution-explorer.png)

1. Как уже отмечалось, в файле *requirements.txt* указана зависимость пакета Flask. Этот файл предлагает создать виртуальное окружение при первом создании проекта.

1. Один файл *app.py* состоит из трех частей. Первая часть — инструкция `import` для Flask, создающая экземпляр класса `Flask`, который присваивается переменной `app`, а затем назначает переменную `wsgi_app` (она удобна при развертывании на веб-узле, но сейчас не используется):

    ```python
    from flask import Flask
    app = Flask(__name__)

    # Make the WSGI interface available at the top level so wfastcgi can get it.
    wsgi_app = app.wsgi_app
    ```

1. Вторая часть, в конце файла, — небольшой дополнительный фрагмент кода, который запускает сервер разработки Flask с определенными значениями узла и порта, полученными из переменных среды (по умолчанию localhost:5555):

    ```python
    if __name__ == '__main__':
        import os
        HOST = os.environ.get('SERVER_HOST', 'localhost')
        try:
            PORT = int(os.environ.get('SERVER_PORT', '5555'))
        except ValueError:
            PORT = 5555
        app.run(HOST, PORT)
    ```

1. Третья часть — короткий фрагмент кода, который назначает функцию маршруту URL-адресов, то есть функция предоставляет ресурс, определяемый URL-адресом. Маршруты определяются с помощью декоратора `@app.route` Flask, аргументом которого является относительный URL-адрес из корня сайта. Как видно в коде, здесь функция возвращает только строку текста, которая может использоваться для отображения в браузере. В последующих шагах отображаются более полные страницы с помощью HTML.

    ```python
    @app.route('/')
    def hello():
        """Renders a sample page."""
        return "Hello World!"
    ```

### <a name="question-what-is-the-purpose-of-the-__name__-argument-to-the-flask-class"></a>Вопрос. Для чего предназначен аргумент __name__ в классе Flask?

Ответ. Аргумент представляет имя модуля или пакет приложения и сообщает Flask, где следует искать шаблоны, статические файлы и другие ресурсы, относящиеся к приложению. Для приложений, содержащихся в одном модуле, `__name__` всегда имеет правильное значение. Он также важен для расширений, которым требуется отладочная информация. Дополнительные сведения и дополнительные аргументы см. в [документации по классу Flask](https://flask.palletsprojects.com/en/1.0.x/api/#flask.Flask) (flask.pocoo.org).

### <a name="question-can-a-function-have-more-than-one-route-decorator"></a>Вопрос. Может ли функция иметь несколько декораторов маршрута?

Ответ. Да, можно использовать любое необходимое число декораторов, если одна функция обслуживает несколько маршрутов. Например, чтобы использовать функцию `hello` для "/" и "/hello", используйте следующий код:

```python
@app.route('/')
@app.route('/hello')
def hello():
    """Renders a sample page."""
    return "Hello World!"
```

<a name="qa-url-variables"></a>

### <a name="question-how-does-flask-work-with-variable-url-routes-and-query-parameters"></a>Вопрос. Как Flask обрабатывает переменные маршруты URL-адресов и параметры запроса?

Ответ. В маршруте можно пометить любую переменную с помощью `<variable_name>`, и Flask передаст эту переменную в функцию с помощью именованного аргумента. Переменная может быть частью URL-пути или параметра запроса. Например, маршрут в виде `'/hello/<name>` формирует строковый аргумент `name` в функции и, используя `?message=<msg>` в маршруте, выполняет анализ значения, заданного для параметра запроса "message=", а затем передает его в функцию в качестве `msg`:

```python
@app.route('/hello/<name>?message=<msg>')
def hello(name, msg):
    return "Hello " + name + "! Message is " + msg + "."
```

Чтобы изменить тип, установите для переменной префикс `int`, `float`, `path` (принимает символы косой черты для разграничения имен папок) и `uuid`. Дополнительные сведения см. в разделе [Правила переменных](https://flask.palletsprojects.com/en/1.0.x/quickstart/#variable-rules) в документации по Flask.

Параметры запроса также доступны через свойство `request.args`, в частности, через метод `request.args.get`. Дополнительные сведения см. в разделе [Объект запроса](https://flask.palletsprojects.com/en/1.0.x/quickstart/#the-request-object) в документации по Flask.

### <a name="question-can-visual-studio-generate-a-requirementstxt-file-from-a-virtual-environment-after-i-install-other-packages"></a>Вопрос. Может ли Visual Studio создать файл requirements.txt из виртуального окружения после установки других пакетов?

Ответ. Да. Разверните узел **Окружения Python**, щелкните свое виртуальное окружение правой кнопкой мыши и выберите команду **Создать requirements.txt**. Эту команду хорошо использовать периодически при изменении окружения и фиксировать изменения в файле *requirements.txt* в системе управления версиями вместе с любыми другими изменениями кода, которые зависят от этого окружения. Если вы настроили непрерывную интеграцию на сервере сборки, каждый раз при изменении окружения необходимо создавать файл и фиксировать изменения.

## <a name="step-1-5-run-the-project"></a>Шаг 1.5. Запуск проекта

1. В Visual Studio выберите **Отладка** > **Начать отладку** (**F5**) или нажмите кнопку **Веб-сервер** на панели инструментов (браузер может отличаться).

    ![Кнопка панели инструментов запуска веб-сервера в Visual Studio](media/tutorials-common/run-web-server-toolbar-button.png)

1. Любая из команд назначает случайный номер порта переменной среды PORT, а затем выполняет `python app.py`. Код запускает приложение, используя этот порт в пределах сервера разработки Flask. Если в Visual Studio отображается **Не удалось запустить отладчик** с сообщением об отсутствии файла запуска, в **обозревателе решений** щелкните правой кнопкой мыши файл **app.py** и выберите пункт **Задать как файл запуска**.

1. При запуске сервера откроется окно консоли, в котором также отображается журнал сервера. Visual Studio автоматически открывает браузер на странице `http://localhost:<port>`, где должно появиться сообщение, подготовленное к просмотру функцией `hello`:

    ![Представление проекта Flask по умолчанию](media/flask/step01-first-run-success.png)

1. По окончании остановите сервер, закрыв консольное окно или используя команду **Отладка** > **Остановить отладку** в Visual Studio.

### <a name="question-whats-the-difference-between-using-the-debug-menu-commands-and-the-server-commands-on-the-projects-python-submenu"></a>Вопрос. В чем разница между использованием команд меню "Отладка" и команд сервера в подменю проекта Python?

Ответ. В дополнение к командам меню **Отладка** и кнопкам панели инструментов вы также можете запустить сервер с помощью команд **Python** > **Запуск сервера** или **Python** > **Запуск сервера отладки** в контекстном меню проекта. Обе команды открывают окно консоли, в котором содержится локальный URL-адрес (localhost:port) для работающего сервера. Однако вы должны вручную открыть браузер с этим URL-адресом. Запуск сервера отладки автоматически не запускает отладчик Visual Studio. При желании вы можете присоединить отладчик к процессу позже с помощью команды **Отладка** > **Присоединение к процессу**.

## <a name="next-steps"></a>Дальнейшие действия

На этом этапе базовый проект Flask содержит код запуска и код страницы в одном файле. Рекомендуется разделять эти два аспекта, а также разделять HTML и данные с помощью шаблонов.

> [!div class="nextstepaction"]
> [Создание приложения Flask с представлениями и шаблонами страниц](learn-flask-visual-studio-step-02-create-app.md)

## <a name="go-deeper"></a>Дополнительные подробности

- [Краткое руководство по Flask](https://flask.palletsprojects.com/en/1.0.x/quickstart/) (flask.pocoo.org)
- Исходный код, используемый в руководстве, на сайте GitHub: [Microsoft/python-sample-vs-learning-flask](https://github.com/Microsoft/python-sample-vs-learning-flask)