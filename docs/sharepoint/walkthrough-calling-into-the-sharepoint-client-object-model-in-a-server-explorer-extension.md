---
title: 'Обозреватель сервера: расширение узла подключений SharePoint'
titleSuffix: ''
description: В этом пошаговом руководстве описано, как вызвать клиентскую объектную модель SharePoint из расширения для узла "подключения SharePoint" в обозреватель сервера.
ms.custom: SEO-VS-2020
ms.date: 02/02/2017
ms.topic: how-to
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- SharePoint development in Visual Studio, client object model
- SharePoint commands [SharePoint development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: dee53642e042c8d4db88bdba7c093f327527798d
ms.sourcegitcommit: 80fc9a72e9a1aba2d417dbfee997fab013fc36ac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106217025"
---
# <a name="walkthrough-calling-into-the-sharepoint-client-object-model-in-a-server-explorer-extension"></a>Пошаговое руководство. вызов клиентской объектной модели SharePoint в расширении обозреватель сервера
  В этом пошаговом руководстве показано, как вызвать клиентскую объектную модель SharePoint из расширения для узла **подключений SharePoint** в **Обозреватель сервера**. Дополнительные сведения об использовании объектной модели клиента SharePoint см. в разделе [Вызов объектных моделей SharePoint](../sharepoint/calling-into-the-sharepoint-object-models.md).

 В этом пошаговом руководстве описаны следующие задачи.

- Создание [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] расширения, расширяющего узел **подключений SharePoint** **Обозреватель сервера** следующими способами:

  - Расширение добавляет узел **коллекции веб-частей** в каждый узел сайта SharePoint в **Обозреватель сервера**. Этот новый узел содержит дочерние узлы, представляющие каждую веб-часть в галерее веб-частей на сайте.

  - Расширение определяет новый тип узла, представляющий экземпляр веб-части. Этот новый тип узла является основанием для дочерних узлов в новом узле **коллекции веб-частей** . Новый тип узла веб-части отображает сведения в окне **Свойства** о веб-части, которую представляет узел.

- Создание пакета расширения Visual Studio (VSIX) для развертывания расширения.

- Отладка и тестирование расширения.

> [!NOTE]
> Расширение, создаваемое в этом пошаговом руководстве, напоминает расширение, созданное в [разделе Пошаговое руководство. расширение обозреватель сервера для показа веб-частей](../sharepoint/walkthrough-extending-server-explorer-to-display-web-parts.md). В этом пошаговом руководстве используется объектная модель сервера SharePoint, но в этом пошаговом руководстве выполняются те же задачи с помощью клиентской объектной модели.

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения этого пошагового руководства на компьютере разработчика потребуются следующие компоненты:

- Поддерживаемые выпуски Windows, SharePoint и Visual Studio.

- Пакет SDK для Visual Studio. В этом пошаговом руководстве используется шаблон **проекта VSIX** в пакете SDK для создания пакета VSIX для развертывания расширения. Дополнительные сведения см. [в разделе Расширение инструментов SharePoint в Visual Studio](../sharepoint/extending-the-sharepoint-tools-in-visual-studio.md).

Знания следующих концепций полезны, но не требуются для выполнения этого пошагового руководства.

- Использование клиентской объектной модели SharePoint. Дополнительные сведения см. в разделе [объектная модель управляемого клиента](/previous-versions/office/developer/sharepoint-2010/ee537247(v=office.14)).

- Веб-части в SharePoint. Дополнительные сведения см. в разделе [веб-части обзор](/previous-versions/office/ms432401(v=office.14)).

## <a name="create-the-projects"></a>Создание проектов
 Для выполнения этого пошагового руководства необходимо создать два проекта:

- Проект VSIX для создания пакета VSIX для развертывания расширения **Обозреватель сервера** .

- Проект библиотеки классов, реализующий расширение **Обозреватель сервера** .

  Начните пошаговое руководство, создав проекты.

#### <a name="to-create-the-vsix-project"></a>Создание проекта VSIX

1. Запустите среду [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].

2. В строке меню выберите **Файл** > **Создать** > **Проект**.

3. В диалоговом окне **Новый проект** разверните узлы **Visual C#** или **Visual Basic** , а затем выберите **расширяемость**.

    > [!NOTE]
    > Узел **расширяемости** доступен только при установке пакета SDK для Visual Studio. Дополнительные сведения см. в разделе Предварительные требования ранее в этом разделе.

4. В верхней части диалогового окна выберите **платформа .NET Framework 4,5** в списке версий платформа .NET Framework.

     Для расширений инструментов SharePoint требуются функции в этой версии платформа .NET Framework.

5. Выберите шаблон **проекта VSIX** .

6. В поле **имя** введите **вебпартноде**, а затем нажмите кнопку **ОК** .

     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] Добавляет проект **вебпартноде** в **Обозреватель решений**.

#### <a name="to-create-the-extension-project"></a>Создание проекта расширения

1. В **Обозреватель решений** откройте контекстное меню узла решения, выберите **Добавить**, а затем выберите **Новый проект**.

2. В диалоговом окне  **Новый проект** разверните узлы **Visual C#** или **Visual Basic** , а затем выберите **Windows**.

3. В верхней части диалогового окна выберите **платформа .NET Framework 4,5** в списке версий платформа .NET Framework.

4. В списке шаблонов проектов выберите **Библиотека классов**.

5. В поле **имя** введите **вебпартнодикстенсион**, а затем нажмите кнопку **ОК** .

     [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] Добавляет проект **вебпартнодикстенсион** в решение и открывает файл кода Class1 по умолчанию.

6. Удалите файл кода Class1 из проекта.

## <a name="configure-the-extension-project"></a>Настройка проекта расширения
 Перед написанием кода для создания расширения необходимо добавить в проект файлы кода и ссылки на сборки. необходимо обновить пространство имен по умолчанию.

#### <a name="to-configure-the-project"></a>Настройка проекта

1. В проекте **вебпартнодикстенсион** добавьте два файла кода с именами Ситенодикстенсион и вебпартнодетипепровидер.

2. Откройте контекстное меню проекта Вебпартнодикстенсион и выберите команду **Добавить ссылку**.

3. В диалоговом окне **Диспетчер ссылок — вебпартнодикстенсион** выберите узел **Framework** , а затем установите флажки для сборок System. ComponentModel. композиция и System. Windows. Forms.

4. Выберите узел **расширения** , установите флажки для каждой из следующих сборок, а затем нажмите кнопку **ОК** :

    - Microsoft. SharePoint. Client

    - Microsoft. SharePoint. Client. Runtime

    - Microsoft. VisualStudio. SharePoint

5. Откройте контекстное меню проекта **вебпартнодикстенсион** и выберите пункт **свойства**.

     Открывается **Конструктор проектов**.

6. Перейдите на вкладку **Приложение**.

7. В поле **пространства имен по умолчанию** (C#) или **корневое пространство имен** (Visual Basic) введите **ServerExplorer. шарепоинтконнектионс. вебпартноде**.

## <a name="create-icons-for-the-new-nodes"></a>Создание значков для новых узлов
 Создайте два значка для расширения **Обозреватель сервера** : значок для нового узла **коллекции веб-частей** и другой значок для каждого дочернего узла веб-части в узле **коллекции веб-частей** . Далее в этом пошаговом руководстве будет написан код, связывающий эти значки с узлами.

#### <a name="to-create-icons-for-the-nodes"></a>Создание значков для узлов

1. В **конструкторе проектов** для проекта вебпартнодикстенсион перейдите на вкладку **ресурсы** .

2. Выберите ссылку **этот проект не содержит файл ресурсов по умолчанию. Щелкните здесь, чтобы создать его.**

     Visual Studio создаст файл ресурсов и откроет его в конструкторе.

3. В верхней части конструктора щелкните стрелку в меню **Добавить ресурс** , а затем выберите команду **Добавить новый значок**.

4. Введите **вебпартсноде** в поле имя нового значка, а затем нажмите кнопку **Добавить** .

     В **редакторе изображений** откроется новый значок.

5. Измените значок значка 16x16, чтобы он был понятен для проекта.

6. Откройте контекстное меню для версии 32x32 значка, а затем выберите **удалить тип изображения**.

7. Повторите шаги с 3 по 7, чтобы добавить второй значок в ресурсы проекта, и назовите эту **веб-часть** значка.

8. В **Обозреватель решений** в папке **Resources** для проекта **вебпартнодикстенсион** выберите *вебпартсноде. ico*.

9. В окне **Свойства** откройте список **действие сборки** и выберите пункт **внедренный ресурс**.

10. Повторите последние два шага для *WebPart. ico*.

## <a name="add-the-web-part-gallery-node-to-server-explorer"></a>Добавление узла коллекции веб-частей в обозреватель сервера
 Создайте класс, который добавляет новый узел **коллекции веб-частей** на каждый узел сайта SharePoint. Чтобы добавить новый узел, класс реализует <xref:Microsoft.VisualStudio.SharePoint.Explorer.IExplorerNodeTypeExtension> интерфейс. Реализуйте этот интерфейс всякий раз, когда требуется расширить поведение существующего узла в **Обозреватель сервера**, например добавить новый дочерний узел в узел.

#### <a name="to-add-the-web-part-gallery-node-to-server-explorer"></a>Добавление узла коллекции веб-частей в обозреватель сервера

1. Вставьте следующий код в файл кода **ситенодикстенсион** для проекта **вебпартнодикстенсион** .

    > [!NOTE]
    > После добавления этого кода в проекте будут обнаружены ошибки компиляции. Эти ошибки исчезнут при добавлении кода в последующих шагах.

     :::code language="csharp" source="../sharepoint/codesnippet/CSharp/webpartnode/webpartnodeextension/sitenodeextension.cs" id="Snippet1":::
     :::code language="vb" source="../sharepoint/codesnippet/VisualBasic/spextensibility.spexplorer.webpartnode.webpartnode/webpartnodeextension/sitenodeextension.vb" id="Snippet1":::

## <a name="define-a-node-type-that-represents-a-web-part"></a>Определение типа узла, представляющего веб-часть
 Создайте класс, определяющий новый тип узла, представляющий веб-часть. Visual Studio использует этот новый тип узла для отображения дочерних узлов в узле **коллекции веб-частей** . Каждый из этих дочерних узлов представляет собой отдельную веб-часть на сайте SharePoint.

 Чтобы определить новый тип узла, класс реализует <xref:Microsoft.VisualStudio.SharePoint.Explorer.IExplorerNodeTypeProvider> интерфейс. Реализуйте этот интерфейс всякий раз, когда нужно определить новый тип узла в **Обозреватель сервера**.

#### <a name="to-define-the-web-part-node-type"></a>Определение типа узла веб-части

1. Вставьте следующий код в файл кода **вебпартнодетипепровидер** для проекта **вебпартнодикстенсион** .

     :::code language="csharp" source="../sharepoint/codesnippet/CSharp/webpartnode/webpartnodeextension/webpartnodetypeprovider.cs" id="Snippet2":::
     :::code language="vb" source="../sharepoint/codesnippet/VisualBasic/spextensibility.spexplorer.webpartnode.webpartnode/webpartnodeextension/webpartnodetypeprovider.vb" id="Snippet2":::

## <a name="checkpoint"></a>Контрольная точка
 На этом этапе в этом пошаговом руководстве весь код для узла **коллекции веб-частей** теперь находится в проекте. Выполните сборку проекта **вебпартнодикстенсион** , чтобы убедиться, что компиляция выполняется без ошибок.

#### <a name="to-build-the-project"></a>Построение проекта

1. В **Обозреватель решений** откройте контекстное меню проекта **вебпартнодикстенсион** и выберите пункт **Сборка**.

## <a name="create-a-vsix-package-to-deploy-the-extension"></a>Создание пакета VSIX для развертывания расширения
 Чтобы развернуть расширение, используйте проект VSIX в решении для создания пакета VSIX. Сначала настройте пакет VSIX, изменив файл Source. extension. vsixmanifest, который входит в проект. Затем создайте пакет VSIX, создав решение.

#### <a name="to-configure-the-vsix-package"></a>Настройка пакета VSIX

1. В **Обозреватель решений** в проекте **вебпартноде** откройте файл **source. extension. vsixmanifest** в редакторе манифеста.

     Файл Source. extension. vsixmanifest является основанием для файла Extension. vsixmanifest, который требуются для всех пакетов VSIX. Дополнительные сведения об этом файле см. в разделе [Справочник по схеме расширения VSIX 1,0](/previous-versions/dd393700(v=vs.110)).

2. В поле **имя продукта** введите **узел коллекции веб-частей для обозреватель сервера**.

3. В поле **Author (автор** ) введите **contoso**.

4. В поле **Описание** введите **Добавление пользовательского узла коллекции веб-частей в узел подключения SharePoint в обозреватель сервера**.

5. На вкладке **ресурсы** редактора нажмите кнопку **создать** .

6. В диалоговом окне **Добавление нового ресурса** в списке **Тип** выберите **Microsoft. VisualStudio. MefComponent**.

    > [!NOTE]
    > Это значение соответствует `MefComponent` элементу в файле Extension. vsixmanifest. Этот элемент задает имя сборки расширения в пакете VSIX. Дополнительные сведения см. в разделе [элемент MEFComponent (Схема VSX)](/previous-versions/visualstudio/visual-studio-2010/dd393736\(v\=vs.100\)).

7. В списке **источник** выберите **проект в текущем решении**.

8. В списке **проект** выберите **вебпартнодикстенсион**, а затем нажмите кнопку **ОК** .

9. В строке меню выберите **Сборка**  >  **сборка решения** и убедитесь, что решение компилируется без ошибок.

10. Убедитесь, что папка выходных данных сборки для проекта Вебпартноде теперь содержит файл Вебпартноде. VSIX.

     По умолчанию выходной папкой сборки является.. \bin\Debug в папке, содержащей файл проекта.

## <a name="test-the-extension"></a>Тестирование расширения
 Теперь вы можете протестировать новый узел **коллекции веб-частей** в **Обозреватель сервера**. Сначала начните отладку проекта расширения в экспериментальном экземпляре Visual Studio. Затем используйте новый узел **веб-части** в экспериментальном экземпляре Visual Studio.

#### <a name="to-start-debugging-the-extension"></a>Запуск отладки расширения

1. Перезапустите Visual Studio с учетными данными администратора, а затем откройте решение **вебпартноде** .

2. В проекте Вебпартнодикстенсион откройте файл кода **ситенодикстенсион** , а затем добавьте точку останова в первую строку кода в `NodeChildrenRequested` `CreateWebPartNodes` методах и.

3. Нажмите клавишу **F5** , чтобы начать отладку.

     Visual Studio устанавливает расширение для расширения узла коллекции частей%UserProfile%\AppData\Local\Microsoft\VisualStudio\11.0Exp\Extensions\Contoso\Web для сервера Explorer\1.0 и запускает экспериментальный экземпляр Visual Studio. Вы протестируете элемент проекта в этом экземпляре Visual Studio.

#### <a name="to-test-the-extension"></a>Тестирование расширения

1. В экспериментальном экземпляре Visual Studio в строке меню выберите **Просмотреть**  >  **Обозреватель сервера**.

2. Убедитесь, что сайт SharePoint, который вы хотите использовать для тестирования, отображается в узле **подключения SharePoint** в **Обозреватель сервера**. Если он отсутствует в списке, выполните следующие действия.

    1. Откройте контекстное меню **подключений SharePoint** и выберите команду **Добавить подключение**.

    2. В диалоговом окне **Добавление подключения SharePoint** введите URL-адрес сайта SharePoint, к которому необходимо подключиться, а затем нажмите кнопку **ОК** .

         Чтобы указать сайт SharePoint на компьютере разработки, введите **http://localhost** .

3. Разверните узел подключение к сайту (который отображает URL-адрес сайта), а затем разверните узел дочернего сайта (например, **сайт группы**).

4. Убедитесь, что код в другом экземпляре Visual Studio остановлен в точке останова, заданной ранее в `NodeChildrenRequested` методе, а затем нажмите клавишу **F5** , чтобы продолжить отладку проекта.

5. В экспериментальном экземпляре Visual Studio разверните узел **Коллекция веб-частей** , который отображается под узлом сайта верхнего уровня.

6. Убедитесь, что код в другом экземпляре Visual Studio остановлен в точке останова, заданной ранее в `CreateWebPartNodes` методе, а затем нажмите клавишу **F5** , чтобы продолжить отладку проекта.

7. В экспериментальном экземпляре Visual Studio убедитесь, что все веб-части на подключенном сайте отображаются в узле **Галерея веб-частей** в **Обозреватель сервера**.

8. Откройте контекстное меню веб-части и выберите пункт **Свойства**.

9. В окне **Свойства** убедитесь, что отображаются сведения о веб-части.

10. В **Обозреватель сервера** откройте контекстное меню той же веб-части и выберите пункт **Показать сообщение**.

     В появившемся окне сообщения нажмите кнопку **ОК** .

## <a name="uninstall-the-extension-from-visual-studio"></a>Удаление расширения из Visual Studio
 После завершения тестирования расширения удалите его из Visual Studio.

#### <a name="to-uninstall-the-extension"></a>Удаление расширения

1. В экспериментальном экземпляре Visual Studio в строке меню выберите **инструменты**  >  **расширения и обновления**.

     Появится диалоговое окно **Расширения и обновления**.

2. В списке расширений выберите **узел Коллекция веб-частей для обозреватель сервера**, а затем нажмите кнопку **Удалить** .

3. В появившемся диалоговом окне нажмите кнопку **Да** .

4. Нажмите кнопку **Перезагрузить сейчас** , чтобы завершить удаление.

     Элемент проекта также удаляется.

5. Закройте оба экземпляра Visual Studio (экспериментальный экземпляр и экземпляр Visual Studio, в котором открыто решение Вебпартноде).

## <a name="see-also"></a>См. также раздел
- [Вызов объектных моделей SharePoint](../sharepoint/calling-into-the-sharepoint-object-models.md)
- [Расширение узла подключений SharePoint в обозревателе сервера](../sharepoint/extending-the-sharepoint-connections-node-in-server-explorer.md)
- [Пошаговое руководство. расширение обозреватель сервера для показа веб-частей](../sharepoint/walkthrough-extending-server-explorer-to-display-web-parts.md)
- [Редактор изображений для значков](/cpp/windows/image-editor-for-icons)
- [Создание значка или другого изображения &#40;редактора изображений для значков&#41;](/cpp/windows/creating-an-icon-or-other-image-image-editor-for-icons)