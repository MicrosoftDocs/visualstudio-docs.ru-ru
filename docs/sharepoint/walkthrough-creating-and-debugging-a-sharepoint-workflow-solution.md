---
title: Создание & отладки решения для рабочих процессов SharePoint
description: В этом пошаговом руководстве описывается создание и отладка решения для рабочих процессов SharePoint. Создайте базовый шаблон последовательного рабочего процесса. Создание действий рабочего процесса и обработку событий.
ms.custom: SEO-VS-2020
ms.date: 02/02/2017
ms.topic: how-to
f1_keywords:
- VS.SharePointTools.Workflow.WorkflowConditions
- VS.SharePointTools.Workflow.WorkflowList
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- SharePoint development in Visual Studio, workflows
- workflows [SharePoint development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: 637d46eaa9ac9306d63befed1c011c278b46af24
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99952724"
---
# <a name="walkthrough-create-and-debug-a-sharepoint-workflow-solution"></a>Пошаговое руководство: Создание и отладка решения рабочих процессов SharePoint
  В этом пошаговом руководстве показано, как создать базовый шаблон последовательного рабочего процесса. Рабочий процесс проверяет свойство библиотеки общих документов, чтобы определить, проверен ли документ. Если документ был проверен, Рабочий процесс завершается.

 В этом пошаговом руководстве описаны следующие задачи:

- Создание проекта последовательного рабочего процесса определения списка SharePoint в [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] .

- Создание действий рабочего процесса.

- Обработка событий действий рабочего процесса.

> [!NOTE]
> Хотя в этом пошаговом руководстве используется проект последовательного рабочего процесса, этот процесс идентичен проекту рабочего процесса конечного автомата.
>
> Кроме того, на компьютере могут отображаться разные имена или расположения для некоторых элементов пользовательского интерфейса Visual Studio в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).

## <a name="prerequisites"></a>Предварительные требования
 Для выполнения этого пошагового руководства требуются следующие компоненты:

- Поддерживаемые редакции Microsoft Windows и SharePoint.

- приведенному.

## <a name="add-properties-to-the-sharepoint-shared-documents-library"></a>Добавление свойств в библиотеку общих документов SharePoint
 Для трассировки состояния проверки документов в библиотеке **общих документов** мы создадим три новых свойства для общих документов на нашем сайте SharePoint: `Status` , `Assignee` и `Review Comments` . Эти свойства определяются в библиотеке " **Общие документы** ".

#### <a name="to-add-properties-to-the-sharepoint-shared-documents-library"></a>Добавление свойств в библиотеку общих документов SharePoint

1. Откройте сайт SharePoint, например http:// \<system name> /ситепажес/Хоме.аспкс, в веб-браузере.

2. На панели быстрого запуска выберите **шареддокументс**.

3. Выберите **Библиотека** на ленте **средства библиотеки** , а затем нажмите кнопку **создать столбец** на ленте, чтобы создать новый столбец.

4. Назовите столбец **состояние документа**, задайте для него тип **Выбор (меню для выбора)**, укажите следующие три варианта, а затем нажмите кнопку **ОК** :

    - **Требуется проверка**

    - **Проверка завершена**

    - **Запрошенные изменения**

5. Создайте еще два столбца и назовите их **Assign** и **Ознакомьтесь с комментариями**. Установите тип столбца «Уполномоченный» в виде одной строки текста, а тип столбца «комментарии проверки» — в виде нескольких строк текста.

## <a name="enable-documents-to-be-edited-without-requiring-a-check-out"></a>Разрешить редактирование документов без необходимости извлечения
 Тестировать шаблон рабочего процесса проще, если вы можете редактировать документы без необходимости их извлечения. В следующей процедуре настраивается включение этого сайта SharePoint.

#### <a name="to-enable-documents-to-be-edited-without-checking-them-out"></a>Включение редактирования документов без их извлечения

1. На панели быстрого запуска выберите ссылку **Общие документы** .

2. На ленте **средства библиотеки** перейдите на вкладку **Библиотека** и нажмите кнопку **Параметры библиотеки** , чтобы открыть страницу **Параметры библиотеки документов** .

3. В разделе **Общие параметры** выберите ссылку **Параметры управления версиями** , чтобы отобразить страницу **Параметры управления версиями** .

4. Убедитесь, что параметр **требовать, чтобы документы были извлечены, прежде чем их можно будет редактировать** , — **нет**. Если это не так, измените его на " **нет** ", а затем нажмите кнопку " **ОК** ".

5. Закройте браузер.

## <a name="create-a-sharepoint-sequential-workflow-project"></a>Создание проекта последовательного рабочего процесса SharePoint
 Последовательный рабочий процесс — это набор шагов, выполняемых по порядку до завершения последнего действия. В этой процедуре мы создадим последовательный рабочий процесс, который будет применяться к нашему списку общих документов. Мастер рабочих процессов позволяет связать рабочий процесс с определением сайта или определением списка и позволяет определить время запуска рабочего процесса.

#### <a name="to-create-a-sharepoint-sequential-workflow-project"></a>Создание проекта последовательного рабочего процесса SharePoint

1. Запустите среду [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)].

2. В строке меню выберите **файл**  >  **создать**  >  **проект** , чтобы открыть диалоговое окно **Новый проект** .

3. Разверните узел **SharePoint** под управлением **Visual C#** или **Visual Basic**, а затем выберите узел **2010** .

4. В области **шаблоны** выберите шаблон **проекта SharePoint 2010** .

5. В поле **имя** введите **мишарепоинтворкфлов** , а затем нажмите кнопку **ОК** .

     Откроется **Мастер настройки SharePoint** .

6. На странице **Укажите сайт и уровень безопасности для отладки** выберите параметр **Развернуть как решение фермы** , а затем нажмите кнопку **Готово** , чтобы принять уровень доверия и сайт по умолчанию.

     На этом шаге устанавливается уровень доверия для решения в качестве решения фермы — единственный доступный параметр для проектов рабочих процессов. Дополнительные сведения см. в статье [рекомендации по изолированным решениям](../sharepoint/sandboxed-solution-considerations.md).

7. В **Обозреватель решений** выберите узел проекта, а затем в строке меню выберите **проект**  >  **Добавить новый элемент**.

8. В **Visual C#** или **Visual Basic** разверните узел **SharePoint** , а затем выберите узел **2010** .

9. В области **шаблоны** выберите шаблон **последовательный рабочий процесс (только для решения фермы)** , а затем нажмите кнопку **добавить** .

     Откроется **Мастер настройки SharePoint** .

10. На странице **Указание имени рабочего процесса для отладки** примите имя по умолчанию (**мишарепоинтворкфлов-Workflow1**). Сохраните значение типа шаблона рабочего процесса по умолчанию, **List Workflow**, а затем нажмите кнопку **Далее** .

11. **Если вы хотите, чтобы Visual Studio автоматически свяжет рабочий процесс в сеансе отладки?** нажмите кнопку **Далее** , чтобы принять все параметры по умолчанию.

     Этот шаг автоматически связывает рабочий процесс с библиотекой общих документов.

12. На странице **Укажите условия для запуска рабочего процесса** оставьте параметры по умолчанию, выбранные в разделе **как должен запускаться рабочий процесс?** и нажмите кнопку **Готово** .

     Эта страница позволяет указать время запуска рабочего процесса. По умолчанию рабочий процесс запускается либо при запуске пользователем в SharePoint вручную, либо при создании элемента, с которым связан рабочий процесс.

## <a name="create-workflow-activities"></a>Создание действий рабочего процесса
 Рабочие процессы содержат одно или несколько *действий* , представляющих выполняемые действия. Используйте конструктор рабочих процессов для упорядочения действий для рабочего процесса. В этой процедуре мы добавим в рабочий процесс два действия: HandleExternalEventActivity и OnWorkFlowItemChanged. Эти действия отслеживают состояние проверки документов в списке " **Общие документы** ".

#### <a name="to-create-workflow-activities"></a>Создание действий рабочего процесса

1. Рабочий процесс должен отображаться в конструкторе рабочих процессов. Если это не так, откройте либо **Workflow1.CS** , либо **Workflow1. vb** в **Обозреватель решений**.

2. В конструкторе выберите действие **OnWorkflowActivated1** .

3. В окне **Свойства** введите **OnWorkflowActivated** рядом с **вызываемым** свойством, а затем нажмите клавишу ВВОД.

     Откроется редактор кода, и в файл кода Workflow1 будет добавлен метод обработчика событий с именем onWorkflowActivated.

4. Вернитесь в конструктор рабочих процессов, откройте панель элементов, а затем узел **Windows Workflow v 3.0** .

5. В узле **Windows Workflow v 3.0** **панели элементов** выполните один из следующих наборов действий.

    1. Откройте контекстное меню действия **while** и выберите команду **Копировать**. В конструкторе рабочих процессов откройте контекстное меню для строки под действием **onWorkflowActivated1** и выберите **Вставить**.

    2. Перетащите действие **while** из **области элементов** в конструктор рабочих процессов и подключите действие к строке под действием **onWorkflowActivated1** .

6. Выберите действие **WhileActivity1** .

7. В окне **Свойства** присвойте **условию** условие Code.

8. Разверните свойство **Condition** , введите **isWorkflowPending** рядом со свойством дочернего **условия** , а затем нажмите клавишу ВВОД.

     Откроется редактор кода, и в файл кода Workflow1 будет добавлен метод с именем isWorkflowPending.

9. Вернитесь в конструктор рабочих процессов, откройте панель элементов, а затем узел **рабочего процесса SharePoint** .

10. В узле **Рабочий процесс SharePoint** **панели элементов** выполните один из следующих наборов действий.

    - Откройте контекстное меню действия **OnWorkflowItemChanged** и выберите команду **Копировать**. В конструкторе рабочих процессов откройте контекстное меню для строки внутри действия **whileActivity1** , а затем выберите **Вставить**.

    - Перетащите действие **OnWorkflowItemChanged** с **панели элементов** в конструктор рабочих процессов и подключите действие к строке внутри действия **whileActivity1** .

11. Выберите действие **onWorkflowItemChanged1** .

12. В окне **Свойства** задайте свойства, как показано в следующей таблице.

    |Свойство|Значение|
    |--------------|-----------|
    |**CorrelationToken**|**воркфловтокен**|
    |**Invoked**|**onWorkflowItemChanged**|

## <a name="handle-activity-events"></a>Обработчики событий действий
 Наконец, проверьте состояние документа для каждого действия. Если документ был проверен, Рабочий процесс завершается.

#### <a name="to-handle-activity-events"></a>Для управления событиями действий

1. В *Workflow1.CS* или *Workflow1. vb* добавьте следующее поле в начало `Workflow1` класса. Это поле используется в действии, чтобы определить, завершен ли рабочий процесс.

    ```vb
    Dim workflowPending As Boolean = True
    ```

    ```csharp
    Boolean workflowPending = true;
    ```

2. Добавьте следующий метод в класс `Workflow1`. Этот метод проверяет значение `Document Status` свойства в списке документов, чтобы определить, был ли документ проверен. Если `Document Status` свойство имеет значение `Review Complete` , `checkStatus` метод задает `workflowPending` для поля **значение false** , чтобы указать, что рабочий процесс готов к завершению.

    ```vb
    Private Sub checkStatus()
        If CStr(workflowProperties.Item("Document Status")) = "Review Complete" Then
            workflowPending = False
        End If
    End Sub
    ```

    ```csharp
    private void checkStatus()
    {
        if ((string)workflowProperties.Item["Document Status"] == "Review Complete")
        workflowPending = false;
    }
    ```

3. Добавьте следующий код в `onWorkflowActivated` `onWorkflowItemChanged` методы и для вызова `checkStatus` метода. При запуске рабочего процесса `onWorkflowActivated` метод вызывает `checkStatus` метод, чтобы определить, был ли документ уже проверен. Если он не был проверен, Рабочий процесс продолжится. При сохранении документа `onWorkflowItemChanged` метод `checkStatus` снова вызывает метод, чтобы определить, был ли документ проверен. Пока `workflowPending` поле имеет значение **true**, Рабочий процесс продолжит выполняться.

    ```vb
    Private Sub onWorkflowActivated(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)
        checkStatus()
    End Sub

    Private Sub onWorkflowItemChanged(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ExternalDataEventArgs)
        checkStatus()
    End Sub
    ```

    ```csharp
    private void onWorkflowActivated(object sender, ExternalDataEventArgs e)
    {
        // Check the status.
        checkStatus();
    }

    private void onWorkflowItemChanged(object sender, ExternalDataEventArgs e)
    {
        // Check the status.
        checkStatus();
    }
    ```

4. Добавьте следующий код в метод, `isWorkflowPending` чтобы проверить состояние `workflowPending` Свойства. При каждом сохранении документа действие **whileActivity1** вызывает `isWorkflowPending` метод. Этот метод проверяет <xref:System.Workflow.Activities.ConditionalEventArgs.Result%2A> свойство <xref:System.Workflow.Activities.ConditionalEventArgs> объекта, чтобы определить, следует ли продолжить или завершить действие **WhileActivity1** . Если свойство имеет значение **true**, действие продолжится. В противном случае действие завершается и рабочий процесс завершается.

    ```vb
    Private Sub isWorkflowPending(ByVal sender As System.Object, ByVal e As System.Workflow.Activities.ConditionalEventArgs)
        e.Result = workflowPending
    End Sub
    ```

    ```csharp
    private void isWorkflowPending(object sender, ConditionalEventArgs e)
    {
        e.Result = workflowPending;
    }
    ```

5. Сохраните проект.

## <a name="test-the-sharepoint-workflow-template"></a>Тестирование шаблона рабочего процесса SharePoint
 При запуске отладчика [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] развертывает шаблон рабочего процесса на сервере SharePoint и связывает рабочий процесс со списком " **Общие документы** ". Чтобы протестировать рабочий процесс, запустите экземпляр рабочего процесса из документа в списке " **Общие документы** ".

#### <a name="to-test-the-sharepoint-workflow-template"></a>Тестирование шаблона рабочего процесса SharePoint

1. В *Workflow1.CS* или *Workflow1. vb* установите точку останова рядом с методом **OnWorkflowActivated** .

2. Нажмите клавишу **F5** , чтобы создать и запустить решение.

     Откроется сайт SharePoint.

3. В области навигации в SharePoint щелкните ссылку **Общие документы** .

4. На странице **Общие документы** выберите ссылку **документы** на вкладке **средства библиотеки** , а затем нажмите кнопку **Отправить документ** .

5. В диалоговом окне **Отправка документа** нажмите кнопку **Обзор** , выберите любой файл документа, нажмите кнопку **Открыть** , а затем нажмите кнопку **ОК** .

     После этого выбранный документ будет загружен в список **общих документов** и запущен рабочий процесс.

6. В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] Убедитесь, что отладчик останавливается в точке останова рядом с `onWorkflowActivated` методом.

7. Нажмите клавишу **F5** , чтобы продолжить выполнение.

8. Здесь можно изменить параметры документа, но оставить для них значения по умолчанию, нажав кнопку **сохранить** .

     Откроется страница « **Общие документы** » веб-сайта SharePoint по умолчанию.

9. На странице **Общие документы** убедитесь, что для параметра в столбце **мишарепоинтворкфлов-Workflow1** задано значение **выполняется**. Это означает, что рабочий процесс выполняется и что документ ожидает проверки.

10. На странице **Общие документы** выберите документ, щелкните появившуюся стрелку, а затем выберите пункт меню **изменить свойства** .

11. Задайте для параметра **состояние документа** значение **Проверка завершено**, а затем нажмите кнопку **сохранить** .

     Откроется страница « **Общие документы** » веб-сайта SharePoint по умолчанию.

12. На странице **Общие документы** убедитесь, что в столбце **состояние документа** задано значение **Проверка завершена**. Обновите страницу " **Общие документы** " и убедитесь, что для значения в столбце **мишарепоинтворкфлов-Workflow1** установлено значение " **завершено**". Это означает, что рабочий процесс завершен и документ был проверен.

## <a name="next-steps"></a>Дальнейшие действия
 Дополнительные сведения о создании шаблонов рабочих процессов см. в следующих разделах:

- Дополнительные сведения о действиях рабочих процессов SharePoint см. в статье [действия рабочего процесса для SharePoint Foundation](/previous-versions/office/developer/sharepoint-2010/ms446847(v=office.14)).

- Дополнительные сведения о Windows Workflow Foundation действиях см. в разделе [пространство имен System. Workflow. activitys](/dotnet/api/system.windows.media.color).

## <a name="see-also"></a>См. также раздел
- [Создание решений рабочих процессов SharePoint](../sharepoint/creating-sharepoint-workflow-solutions.md)
- [Шаблоны проектов и элементов проектов SharePoint](../sharepoint/sharepoint-project-and-project-item-templates.md)
- [Сборка и отладка решений SharePoint](../sharepoint/building-and-debugging-sharepoint-solutions.md)
