---
title: Управление npm-пакетами
description: Visual Studio позволяет управлять пакетами с помощью диспетчера пакетов Node.js (npm)
ms.custom: seodec18
ms.date: 02/23/2021
ms.topic: how-to
ms.devlang: javascript
author: mikejo5000
ms.author: mikejo
manager: jmartens
dev_langs:
- JavaScript
ms.workload:
- nodejs
ms.openlocfilehash: 2fcf1bd9e9ef5c3ff0663cf12684e6e638d1e5e4
ms.sourcegitcommit: a0f5e7188838c5989c9cc78d99fb29bb2813501e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2021
ms.locfileid: "109729290"
---
# <a name="manage-npm-packages-in-visual-studio"></a>Управление пакетами npm в Visual Studio

npm позволяет устанавливать пакеты для приложений Node.js и управлять ими. Visual Studio позволяет легко взаимодействовать с npm и использовать команды npm через пользовательский интерфейс или напрямую. Если вы не знакомы с npm и хотите узнать больше, перейдите на страницу [документации npm](https://docs.npmjs.com/).

Интеграция Visual Studio с npm зависит от типа проекта.
* [Node.js](#nodejs-projects)
* [ASP.NET Core](#aspnet-core-projects)
* [Открытие папки (Node.js)](../javascript/develop-javascript-code-without-solutions-projects.md)

> [!Important]
> npm ожидает найти папку *node_modules* и файл *package.json* в корневом каталоге проекта. Если структура папок вашего приложения отличается, ее можно изменить, чтобы управлять пакетами npm с помощью Visual Studio.

## <a name="nodejs-projects"></a>Проекты Node.js

Для проектов Node.js можно выполнить следующие задачи:
* [Установка пакетов из обозревателя решений](#npmInstallWindow)
* [Управление установленными пакетами из обозревателя решений](#solutionExplorer)
* [Использование команды `.npm` в интерактивном окне Node.js](#interactive)

Эти функции работают вместе и синхронизируются с системой проекта и файлом *package.json* в проекте.

### <a name="prerequisites"></a>Предварительные требования

Чтобы добавить поддержку NPM в проект, вам потребуется **рабочая нагрузка разработки Node.js** и установленная среда выполнения Node.js. Подробные инструкции см. в разделе [Создание проекта Node.js](../ide/quickstart-nodejs.md?toc=%252fvisualstudio%252fjavascript%252ftoc.json).

> [!NOTE]
> Чтобы включить npm в существующем проекте Node.js, используйте шаблон решения **Из существующего кода Node.js** или тип проекта [Открыть папку (Node.js)](../javascript/develop-javascript-code-without-solutions-projects.md).

### <a name="install-packages-from-solution-explorer-nodejs"></a><a name="npmInstallWindow"></a> Установка пакетов из обозревателя решений (Node.js)

Самый простой способ установить пакеты npm в проекты Node.js — через окно установки пакетов npm. Чтобы открыть это окно, щелкните правой кнопкой мыши узел **npm** в проекте и выберите пункт **Установить новые пакеты npm**.

:::image type="content" source="../javascript/media/solution-explorer-install-package.png" alt-text="Установка нового пакета npm из обозревателя решений" border="true":::

В этом окне можно найти пакет, указать параметры и установить пакет.

![Снимок экрана: диалоговое окно "Установка новых пакетов npm". Выбран пакет Azure 2.2.1 (предварительная версия), для которого отображены сведения и параметры.](../javascript/media/search-package.png)

* **Тип зависимости** — выберите **Стандартный**, **Разработка** или **Необязательный**. Вариант "Стандартный" означает, что пакет является зависимостью среды выполнения, а вариант "Разработка" указывает, что пакет необходим только во время разработки.
* **Добавить в package.json** — рекомендуется. Этот настраиваемый параметр является устаревшим.
* **Выбранная версия** — выберите версию пакета, который вы хотите установить.
* **Другие аргументы npm** — укажите другие стандартные аргументы npm. Вы можете указать значение версии, например `@~0.8`, чтобы установить определенную версию, которая недоступна в списке версий.

Ход установки можно просмотреть в выходных данных **npm** в окне **Вывод**. Чтобы открыть окно, выберите **Вид** > **Вывод** или нажмите сочетание клавиш **CTRL** + **ALT** + **O**. Это может занять некоторое время.

![Выходные данные npm](../javascript/media/npm-output.png)

> [!TIP]
> Если вы хотите найти пакеты с заданной областью, добавьте в начало поискового запроса нужную область, например, введите `@types/mocha`, чтобы искать файлы определений TypeScript для mocha. Кроме того, при установке определений типов для TypeScript можно указать целевую версию TypeScript, добавив `@ts2.6` в поле аргумента npm.

### <a name="manage-installed-packages-in-solution-explorer-nodejs"></a><a name="solutionExplorer"></a>Управление установленными пакетами из обозревателя решений (Node.js)

Пакеты npm отображаются в обозревателе решений. Записи в узле **npm** повторяют зависимости в файле *package.json*.

![Снимок экрана: узел npm в Обозревателе решений, отображающий состояние установки пакетов npm.](../javascript/media/solution-explorer-status.png)

### <a name="package-status"></a>Состояние пакета

* ![Установленный пакет](../javascript/media/installed-npm.png) — установлен и указан в package.json
* ![Лишний пакет](../javascript/media/extraneous-npm.png) — установлен, но явно не указан в файле package.json
* ![Отсутствующий пакет](../javascript/media/missing-npm.png) — не установлен, но указан в package.json

::: moniker range=">=vs-2019"
Щелкните правой кнопкой мыши узел **npm**, чтобы выполнить одно из следующих действий:

* **Установка новых пакетов NPM** Открывает пользовательский интерфейс для установки новых пакетов.
* **Установка пакетов NPM** Запускает команду NPM install, чтобы установить все пакеты, перечисленные в *package.json*. (Запускаем `npm install`.)
* **Изменить пакеты npm**. Обновляет пакеты до последних версий в соответствии с диапазоном семантического управления версиями (SemVer), указанным в *package.json*. (Запускается `npm update --save`.). Диапазоны SemVer обычно задаются с помощью "~" или "^". Дополнительные сведения см. в разделе [Конфигурация package.json](../javascript/configure-packages-with-package-json.md).

Щелкните правой кнопкой мыши узел пакета или выполните одно из следующих действий:

* **Установка пакетов NPM** Запускает команду NPM install, чтобы установить версию пакетов, перечисленных в *package.json*. (Запускаем `npm install`.)
* **Изменить пакеты npm**. Обновляет пакеты до последних версий в соответствии с диапазоном SemVer, указанным в *package.json*. (Запустить `npm update --save`.) Диапазоны SemVer обычно задаются с помощью "~" или "^".
* **Удалить пакеты NPM** удалит пакет и удаляет его из *package.json* (Запускает `npm uninstall --save`.)
::: moniker-end
::: moniker range="vs-2017"
Щелкните правой кнопкой мыши узел пакета или узел **npm** и выполните одно из следующих действий:
* **Установите отсутствующие пакеты**, указанные в *package.json*
* **Обновите пакеты npm** до последней версии
* **Удалите пакет** и исключите его из *package.json*
::: moniker-end

>[!NOTE]
> Сведения о решении проблем с пакетами npm см. в разделе [устранение неполадок](#troubleshooting-npm-packages).

### <a name="use-the-npm-command-in-the-nodejs-interactive-window-nodejs"></a><a name="interactive"></a>Использование команды .npm в интерактивном окне Node.js (Node.js)

Вы также можете использовать команду `.npm` в интерактивном окне Node.js для выполнения команды npm. Чтобы открыть окно, в Обозревателе решений щелкните проект правой кнопкой мыши и выберите пункт **Открыть интерактивное окно Node.js** (или нажмите сочетание клавиш **CTRL** + **K**, **N**).

В этом окне вы можете использовать следующие команды для установки пакета:

`.npm install azure@4.2.3`

 > [!Tip]
 > По умолчанию npm будет выполняться в домашнем каталоге проекта. Если у вас несколько проектов в решении, укажите имя или путь к проекту в квадратных скобках.
 > `.npm [MyProjectNameOrPath] install azure@4.2.3`

 > [!Tip]
 > Если проект не содержит файл package.json, используйте `.npm init -y`, чтобы создать файл package.json со значениями по умолчанию.

 ## <a name="aspnet-core-projects"></a>Проекты ASP.NET Core

Поддержку npm можно интегрировать, например, в проекты ASP.NET Core, и использовать npm для установки пакетов.
* [Добавление поддержки npm в проект](#npmAdd)
* [Установка пакетов с помощью файла package.json](#npmInstallPackage)

>[!NOTE]
> Для установки клиентских файлов JavaScript и CSS в проектах ASP.NET Core вместо npm можно также использовать [диспетчер библиотек](/aspnet/core/client-side/libman/?view=aspnetcore-3.1&preserve-view=true) или yarn.

### <a name="add-npm-support-to-a-project-aspnet-core"></a><a name="npmAdd">Добавление поддержки npm в проект (ASP.NET Core)</a>

Если в проекте еще нет файла *package.json*, добавьте его, чтобы включить поддержку npm. Добавьте файл *package.json* в проект.

1. Если Node.js не установлен, мы рекомендуем установить версию LTS с веб-сайта [Node.js](https://nodejs.org/en/download/) для обеспечения наилучшей совместимости с внешними платформами и библиотеками.

   Для npm требуется Node.js.

1. Чтобы добавить файл *package.json*, щелкните правой кнопкой мыши проект в Обозревателе решений и выберите **Добавить** > **Новый элемент** (или нажмите сочетание клавиш **CTL** + **SHIFT** + **A**). Выберите **Файл конфигурации NPM**, оставьте имя по умолчанию и нажмите кнопку **Добавить**.

   ![Добавление файла package.json в проект](../javascript/media/npm-add-package-json.png)

   Если файл конфигурации npm отсутствует в списке, средства разработки Node. js не установлены. Вы можете использовать Visual Studio Installer для добавления рабочей нагрузки **Разработка Node.js**. Повторите предыдущий шаг.

1. Включите один или несколько пакетов npm в раздел `dependencies` или `devDependencies` файла *package.json*. Например, в файл можно добавить следующие пакеты:

   ```json
   "devDependencies": {
      "gulp": "4.0.2",
      "@types/jquery": "3.3.33"
   }
   ```

При сохранении файла Visual Studio добавляет пакет в узел **Зависимости / npm** в обозревателе решений. Если узел не отображается, щелкните правой кнопкой мыши файл **package.json** и выберите пункт **Восстановить пакеты**.

>[!NOTE]
> В некоторых сценариях обозреватель решений может не отображать правильное состояние для установленных пакетов npm. Дополнительные сведения см. в [руководстве по устранению неполадок](#troubleshooting-npm-packages).

### <a name="install-packages-using-packagejson-aspnet-core"></a><a name="npmInstallPackage"></a>Установка пакетов с помощью файла package.json (ASP.NET Core)

В проектах, уже содержащих npm, можно настроить пакеты npm с помощью `package.json`. Щелкните правой кнопкой мыши узел npm в обозревателе решений и выберите **Открыть файл package.json**.

![Снимок экрана: Обозреватель решений с выбранным узлом npm. Открыто контекстное меню и выбран параметр "Open package.json".](../javascript/media/npm-add-package.png)

IntelliSense в *package.json* помогает выбрать конкретную версию пакета npm.

:::image type="content" source="../javascript/media/npm-add-package-intellisense.png" alt-text="Выберите версию пакета npm" border="true":::

При сохранении файла Visual Studio добавляет пакет в узел **Зависимости / npm** в обозревателе решений. Если узел не отображается, щелкните правой кнопкой мыши файл **package.json** и выберите пункт **Восстановить пакеты**.

Установка пакета может занять несколько минут. Проверьте ход установки пакета, перейдя к выходным данным **npm** в окне **вывода**.

![Выходные данные npm](../javascript/media/npm-output.png)

## <a name="troubleshooting-npm-packages"></a>Устранение неполадок при работе с пакетами npm

* Для npm необходим Node.js. Если Node.js не установлен, мы рекомендуем установить версию LTS с веб-сайта [Node.js](https://nodejs.org/en/download/) для обеспечения наилучшей совместимости с внешними платформами и библиотеками.

* Для проектов Node. js необходимо установить рабочую нагрузку **разработки Node. js** для поддержки npm.

* В некоторых сценариях обозреватель решений может не отображать правильное состояние для установленных пакетов npm в связи с известной проблемой, описанной [здесь](https://github.com/aspnet/Tooling/issues/479). Например, при установке пакет может отображаться как неустановленный. В большинстве случаев обозреватель решений можно обновить, удалив файл *package.json*, перезапустив Visual Studio и повторно добавив файл *package.json*, как описано выше в этой статье. Или при установке пакетов можно использовать окно вывода npm для проверки состояния установки.

* В некоторых сценариях ASP.NET узел npm в Обозревателе решений Solution Explorer может не отображаться после сборки проекта. Чтобы снова сделать узел видимым, щелкните правой кнопкой мыши узел проекта и выберите команду **Выгрузить проект**. Затем щелкните правой кнопкой мыши узел проекта и выберите команду **Перезагрузить проект**.

* При возникновении ошибок при создании приложения или транскомпиляции кода TypeScript проверьте известные несовместимости пакета NPM, возможно они стали причиной ошибок. Чтобы определить ошибки, проверьте окно вывода npm при установке пакетов, как описано выше в этой статье. Например, если одна или несколько из версий пакетов npm стали нерекомендуемыми, из-за чего возникают ошибки, может потребоваться установить более поздние версии. Дополнительные сведения об использовании *package.json* для контроля версий пакетов npm см. в разделе [Конфигурация package.json](../javascript/configure-packages-with-package-json.md).
