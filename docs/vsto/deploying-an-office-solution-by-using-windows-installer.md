---
title: Развертывание решения Office с помощью установщик Windows
description: Сведения о создании установщик Windows с помощью Visual Studio можно развернуть решение Office, для которого требуется административный доступ на компьютере конечного пользователя.
ms.custom: SEO-VS-2020
ms.date: 08/14/2019
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- Office development in Visual Studio, setup project
- Office development in Visual Studio, MSI
- deploying applications [Office development in Visual Studio], setup project
- deploying applications [Office development in Visual Studio], MSI
- ClickOnce deployment [Office development in Visual Studio], MSI
- publishing Office solutions [Office development in Visual Studio], setup project
- Office applications [Office development in Visual Studio], MSI
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: f6dfa2bb4d3309420cf0a9a71e79b5d07b5477ce
ms.sourcegitcommit: 4b40aac584991cc2eb2186c3e4f4a7fcd522f607
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2021
ms.locfileid: "107828531"
---
# <a name="deploy-an-office-solution-by-using-windows-installer"></a>Развертывание решения Office с помощью установщик Windows

Узнайте, как создать файл установщика Windows для решения Office при помощи [!INCLUDE[vs_dev12](../vsto/includes/vs-dev12-md.md)].

Благодаря созданию установщика Windows при помощи Visual Studio можно развернуть решение Office, для которого требуется административный доступ на компьютере конечного пользователя. Например, файл установщика можно использовать для одновременной установки решения для всех пользователей компьютера. Решение Office можно также развернуть с помощью ClickOnce, но в таком случае решение придется установить отдельно для каждого пользователя компьютера.

[!include[Add-ins note](includes/addinsnote.md)]

## <a name="in-this-topic"></a>В этом разделе

- [Скачать примеры надстроек VSTO](#Download)

- [Получение InstallShield Limited Edition](#Obtain)

- [Выбор способа предоставления доверия решению](#ApplySecurity)

- [Создание проекта установки](#Create)

- [Добавление выходного элемента проекта](#Add)

- [Добавление манифестов развертывания и приложений](#AddD)

- [Настройка зависимых компонентов в качестве необходимых компонентов](#Configure)

- [Specify where you want to deploy the solution on the user's computer](#Location)

- [Настройка надстройки VSTO](#ConfigureRegistry)

- [Configure a document-level customization](#ConfigureDocument)

- [Build the setup project](#Build)

Дополнительные сведения о развертывании решения Office с помощью ClickOnce см. в статье [развертывание решения Office с помощью ClickOnce](../vsto/deploying-an-office-solution-by-using-clickonce.md).

Сведения о создании файла установщик Windows с помощью [!INCLUDE[vs_dev10_long](../sharepoint/includes/vs-dev10-long-md.md)] см. в разделе [развертывание решения Visual Studio 2010 Tools for Office с помощью установщик Windows](/previous-versions/visualstudio/visual-studio-2010/ff937654(v=msdn.10)).

## <a name="download-samples"></a><a name="Download"></a>Скачивание примеров
Этот раздел ссылается на следующие загружаемые примеры.

|Образец<br /><br />|Описание<br /><br />|
|----------|---------------|
|[ExcelAddIn](https://code.msdn.microsoft.com/VSTO-Deploy-an-Office-fbcc09ad)<br /><br />|Надстройка VSTO Excel, которую можно установить на компьютере, на котором запущена 32-разрядная или 64-разрядная версия Office.<br /><br />|
|[ExcelWorkbook](https://code.msdn.microsoft.com/VSTO-Deploy-a-Customization-f70fae33)<br /><br />|Настройка уровня документа Excel, которую можно установить на компьютере, на котором запущена 32-разрядная или 64-разрядная версия Office.<br /><br />|

## <a name="decide-how-to-grant-trust-to-the-solution"></a><a name="ApplySecurity"></a>Выбор способа предоставления доверия решению
Прежде чем решение можно будет запускать на компьютерах пользователей, необходимо предоставить доверие одним из следующих способов. В противном случае пользователи должны будут ответить на запрос о доверии при установке решения.

- Подписывание манифеста с помощью сертификата, который определяет известного и надежного издателя. Дополнительные сведения см. в разделе [доверие к решению путем подписания манифестов приложения и развертывания](../vsto/granting-trust-to-office-solutions.md#Signing).

- Установите решение в каталог Program Files на компьютере пользователя.

> [!NOTE]
> Для настроек уровня документа расположение документа также должно быть доверенным. Дополнительные сведения см. в разделе [Предоставление доверия документам](../vsto/granting-trust-to-documents.md).

## <a name="get-installshield-limited-edition"></a><a name="Obtain"></a>Получение InstallShield Limited Edition

Можно создать файл установщика Windows с помощью выпуска InstallShield Limited Edition (ISLE), который предоставляется бесплатно, если установлена система Visual Studio. ISLE заменяет функциональность шаблонов проектов для установки и развертывания, которые предлагались в предыдущих версиях Visual Studio.

### <a name="to-get-installshield-limited-edition"></a>Получение InstallShield Limited Edition

1. В строке меню выберите **Файл** > **Создать** > **Проект**.

   Откроется диалоговое окно **Новый проект** .

2. В области шаблонов разверните узел **Другие типы проектов** и выберите шаблон **Установка и развертывание** .

3. В списке типов проекта для шаблона **Установка и развертывание** выберите **Включение InstallShield Limited Edition**, а затем нажмите кнопку **ОК** .

   Откроется страница, которая содержит сведения о получении InstallShield Limited Edition.

4. На этой странице щелкните ссылку **Перейдите на веб-сайт загрузки** .

5. На странице загрузки выпуска InstallShield Limited Edition введите необходимые сведения в соответствующие поля, а затем щелкните ссылку **Загрузить сейчас** .

   После загрузки, установки и активации продукта в Visual Studio появляется шаблон **Проект InstallShield Limited Edition** .

## <a name="create-a-setup-project"></a><a name="Create"></a>Создание проекта установки

1. В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)]откройте развертываемый проект Office.

   Примеры надстройки VSTO, связанные с этим разделом, содержат проект с именем **ExcelAddIn**. Примеры настройки уровня документа содержат проект с именем **ExcelWorkbook**. Этом раздел будет ссылаться на проект Office в решении с помощью одного из этих двух имен.

2. В строке меню выберите **файл**  >  **добавить**  >  **Новый проект**.

   Откроется диалоговое окно **Добавить новый проект** .

3. В области шаблонов разверните узел **Другие типы проектов** и выберите шаблон **Установка и развертывание** .

4. В списке типов проекта для шаблона **Установка и развертывание** выберите **Проект InstallShield Limited Edition**, присвойте имя проекту и нажмите кнопку **ОК** .

   Созданный проект установки InstallShield появится в решении.

   Примеры этого раздела содержат проект установки с именем **OfficeAddInSetup**. Этот раздел будет ссылаться на проект установки в решении с помощью того же имени.

## <a name="add-the-project-output"></a><a name="Add"></a>Добавление выходного элемента проекта

Настройте проект **OfficeAddInSetup** для включения вывода проекта Office. Для проектов надстроек VSTO выходными данными является только сборка решения. Для проектов настройки уровня документа выходной элемент проекта содержит не только сборку решения, но также сам документ.

### <a name="to-add-the-project-output"></a>Добавление выходного элемента проекта

1. В **обозревателе решений** разверните узел проекта **OfficeAddInSetup** и выберите файл **Project Assistant** , как показано на следующем рисунке.

   ![Файл помощника по проекту в обозревателе решений](../vsto/media/installshield-projectassistant.png "Файл помощника по проекту в обозревателе решений")

2. В строке меню выберите **вид**  >  **Открыть**.

3. В нижней части страницы **Project assistant** , нажмите кнопку **Файлы приложения** , как показано на следующем рисунке.

   ![Кнопка файлов приложения.](../vsto/media/installshield-applicationfiles.png "Кнопка файлов приложения.")

4. На странице **Файлы приложения** нажмите кнопку **Добавление выходных элементов проекта** .

5. В диалоговом окне **Селектор вывода Visual Studio** установите флажок **Основные выходные файлы** , а затем нажмите кнопку **ОК** .

## <a name="add-the-deployment-and-application-manifests"></a><a name="AddD"></a>Добавление манифестов развертывания и приложения

1. На странице **Файлы приложения** нажмите кнопку **Добавить файлы** .

2. В диалоговом окне **Открыть** откройте папку выходных файлов проекта **ExcelAddIn** .

   Как правило, каталогом выходных файлов является подпапка **bin\release** корневого каталога проекта, в зависимости от выбранной конфигурации сборки.

3. В каталоге выходных файлов выберите файлы **ExcelAddIn.vsto** и **ExcelAddIn.dll.manifest** , а затем нажмите кнопку **Открыть** .

   Страница **Файлы приложения** теперь содержит выходной файл проекта, манифест развертывания и манифест приложения, как показано на следующем рисунке.

   ![Выходные файлы проекта установки.](../vsto/media/installshield-outputfiles.png "Выходные файлы проекта установки.")

## <a name="configure-the-dependent-components-as-prerequisites"></a><a name="Configure"></a>Настройка зависимых компонентов в качестве необходимых компонентов

В приложение установки необходимо включить не только следующие компоненты, но и все другие компоненты, необходимые для запуска решения.

- Версия платформы .NET Framework, для которой предназначено решение Office.

- Среда выполнения средств Microsoft Visual Studio 2010 для Office.

### <a name="add-the-net-framework-4-or-the-net-framework-45-as-a-prerequisite"></a>Добавьте платформа .NET Framework 4 или платформа .NET Framework 4,5 в качестве необходимого компонента.

1. В **обозревателе решений** последовательно разверните узел проекта **OfficeAddInSetup** и узел **Specify Application Data** и выберите файл **Redistributables** , как показано на следующем рисунке.

   ![Файл распространяемых компонентов в обозревателе решений](../vsto/media/installshield-redistributablesfile.png "Файл распространяемых компонентов в обозревателе решений")

2. В строке меню выберите **вид**  >  **Открыть**.

   Откроется страница **Redistributables** .

3. В списке распространяемых компонентов установите соответствующий флажок для версии платформы .NET Framework, для которой предназначено решение.

   Например, если решение предназначено для [!INCLUDE[net_v45](../vsto/includes/net-v45-md.md)], установите флажок **Microsoft .NET Framework 4.5 Full** . Может появиться диалоговое окно с запросом на подтверждение установки распространяемого компонента, которое требуется системе InstallShield, прежде чем можно будет добавить этот компонент в качестве необходимого компонента. Если это диалоговое окно не отображается, компонент уже существует на компьютере.

4. Если это диалоговое окно отображается, нажмите кнопку **Нет** .

### <a name="add-the-visual-studio-2010-tools-for-office-runtime"></a><a name="AddToolsForOffice"></a>Добавление среды выполнения средств Visual Studio 2010 для Office

Страница **Redistributables** содержит элемент с именем **Microsoft VSTO 2010 Runtime**, но он ссылается на более старую версию среды выполнения. Поэтому можно вручную создать файл конфигурации, который ссылается на самую последнюю версию. Затем необходимо поместить этот файл в один каталог с файлами конфигурации для всех других элементов, отображаемых на странице **Redistributables** .

#### <a name="to-add-the-visual-studio-2010-tools-for-office-runtime-as-a-prerequisite"></a>Добавление среды выполнения Visual Studio 2010 Tools for Office в качестве необходимого компонента

1. Откройте Блокнот и вставьте следующий XML-код в текстовый файл.

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <SetupPrereq>
   <conditions>
       <condition Type="32" Comparison="2" Path="HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VSTO Runtime Setup\v4R" FileName="Version" ReturnValue="10.0.50903" Bits="2"></condition>
   <condition Type="32" Comparison="2" Path="HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\VSTO Runtime Setup\v4R" FileName="Version" ReturnValue="10.0.50903" Bits="2"></condition>
   </conditions>
   <files>
       <file LocalFile="<ISProductFolder>\SetupPrerequisites\VSTOR\vstor_redist.exe" URL="http://download.microsoft.com/download/C/0/0/C001737F-822B-48C2-8F6A-CDE13B4B9E9C/vstor_redist.exe" CheckSum="88b8aa9e8c90818f98c80ac4dd998b88" FileSize=" 0,40117912"></file>
   </files>
   <execute file="vstor_redist.exe" returncodetoreboot="1641,3010" requiresmsiengine="1">
   </execute>
   <properties Id="{15965040-56BB-49B8-A88F-3525C48D9BA8}" Description="This prerequisite installs the most recent version of the Microsoft Visual Studio 2010 Tools for Office Runtime." >
   </properties>

   </SetupPrereq>
   ```

2. Создайте идентификатор GUID в Visual Studio. В меню **Сервис** выберите пункт **Создать GUID**.

3. В программе **Генератор GUID** выберите переключатель **Формат реестра** , нажмите кнопку **Копировать** , а затем кнопку **Выход** .

4. В Блокноте замените текст **Your GUID goes here** , вставив на его место идентификатор GUID.

   Элемент **&lt; Properties &gt;** файла выглядит следующим образом.

   ```xml
   <properties Id="{87989B73-21DC-4403-8FD1-0C68A41A6D8C}" Description="This prerequisite installs the most recent version of the Microsoft Visual Studio 2010 Tools for Office Runtime." >
   </properties>
   ```

5. В строке меню в блокноте выберите **файл**  >  **сохранить**.

6. В диалоговом окне **Сохранить как** перейдите в папку **Рабочий стол** .

7. В списке **Тип файла** выберите **все файлы (&#42;. &#42;)**.

8. В поле **Имя файла** введите **Visual Studio 2010 Tools for Office Runtime.prq**, а затем нажмите кнопку **Сохранить** .

   > [!NOTE]
   > Убедитесь, что вы добавили расширение **.prq** в конце имени файла, чтобы определить этот файл как необходимый компонент.

9. Закройте блокнот.

10. В папке **Desktop** скопируйте файл *Visual Studio 2010 Tools для Office Runtime. prQ* в один из следующих каталогов на компьютере.

   Для 32-разрядных операционных систем *: \\ %ProgramFiles%\InstallShield\2013LE\SetupPrerequisites*

   Для 64-разрядных операционных систем: *% ProgramFiles (x86)% \ 2013LE \ \\ сетуппререкуиситес*

11. На странице **Redistributables** проекта InstallShield, нажмите кнопку **Обновить** , чтобы обновить список распространяемых компонентов, как показано на следующем рисунке.

   ![Кнопка "Обновить".](../vsto/media/installshield-refreshbutton.png "Кнопка обновления.")

12. В списке распространяемых компонентов установите флажок **Среда выполнения средств Visual Studio 2010 для Office** .

   Может появиться диалоговое окно с запросом на подтверждение установки распространяемого компонента. Если это диалоговое окно не отображается, можно перейти к разделу [Укажите, где вы хотите развернуть решение на компьютере пользователя](#Location) этого раздела.

13. Если это диалоговое окно отображается, нажмите кнопку **Нет** .

## <a name="specify-where-to-install-the-solution-on-the-users-computer"></a><a name="Location"></a>Указание места развертывания решения на компьютере пользователя

1. В **обозревателе решений** последовательно разверните узлы **OfficeAddInSetup** и **Организация настройки** , а затем выберите файл **Общие сведения** .

2. В строке меню выберите **вид**  >  **Открыть**.

3. В списке свойств, нажмите кнопку **Обзор** рядом с свойством **INSTALLDIR** .

4. В диалоговом окне **Задание INSTALLDIR** выберите папку на компьютере пользователя, на котором нужно установить решение.

   > [!NOTE]
   > В диалоговом окне **Задать INSTALLDIR** можно также создать подкаталоги, открыв контекстное меню для любой папки в списке.

## <a name="configure-a-vsto-add-in"></a><a name="ConfigureRegistry"></a>Настройка надстройки VSTO

Вы можете указать, следует ли установить надстройку VSTO для всех пользователей компьютера (для компьютера) или только для пользователя, выполняющего установку (для пользователя).

Если необходимо обеспечить поддержку установки для компьютера, создайте два отдельных установщика. Разделение установщиков можно выполнить на основе версии Office (32-разрядная и 64-разрядная) или версии Windows (32-разрядная и 64-разрядная), в которой работает пользователь.

Для установки для отдельных пользователей требуется только один установщик независимо от версии Office или Windows.

> [!NOTE]
> Этот раздел применим только при развертывании надстройки VSTO. Если вы развертываете настройку на уровне документа, можно сразу переходить к разделу [Настройка настройки уровня документа](#ConfigureDocument) .

### <a name="to-specify-whether-you-want-to-support-per-user-or-per-computer-installations"></a>Указание поддерживаемого типа установки: для пользователя или для компьютера

1. В **обозревателе решений** последовательно разверните узел проекта **OfficeAddInSetup** и узел **Organize Your Setup** , а затем выберите файл **Общие сведения** .

2. В строке меню выберите **вид**  >  **Открыть**.

   Откроются свойства проекта установки.

3. В списке для свойства **AllUSERS** укажите, следует ли установить это решение для всех пользователей компьютера или только для пользователя, устанавливающего решение.

   Чтобы установить надстройку VSTO для текущего пользователя, выберите **ALLUSERS = "" (установка на пользователя)**. Чтобы установить надстройку VSTO для всех пользователей компьютера, выберите **ALLUSERS=1 (установка для компьютера)**.

   В следующей процедуре будут созданы разделы реестра, позволяющие приложению Office обнаруживать и загружать надстройку VSTO. См. [раздел записи реестра для надстроек VSTO](../vsto/registry-entries-for-vsto-add-ins.md).

### <a name="to-create-registry-keys"></a>Создание разделов реестра

1. В **обозревателе решений** выберите узел **Project Assistant** .

   В строке меню выберите **вид**  >  **Открыть**.

2. В нижней части страницы **Project Assistant** , нажмите кнопку **Application Registry** , как показано на следующем рисунке.

   ![Кнопка реестра приложения.](../vsto/media/installshield-applicationregistry.gif "Кнопка реестра приложения.")

   Откроется страница **Application Registry** .

3. В разделе **Do you want to configure the registry data that your application will install?**(Вы хотите настроить данные реестра, которые будут установлены приложением?) выберите переключатель **Да** .

4. В списке **представление реестра конечного компьютера** Добавьте иерархию ключей, включающую тип создаваемого установщика.

   Путь, который настраивается в этом разделе, зависит от того, какой установщик необходимо создать: для отдельного пользователя или для компьютера.

   **Установщик для отдельного пользователя**

   **HKEY_CURRENT_USER\Software\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**

   **Установщики для компьютера на основе версии Office**

| Версия Office<br /><br /> | Путь конфигурации InstallShield<br /><br /> |
|----------------------------| - |
| 32-разрядная система<br /><br /> | **HKEY_LOCAL_MACHINE\SOFTWARE(32-Bit)\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**<br /><br /> |
| 64-разрядная система<br /><br /> | **HKEY_LOCAL_MACHINE\SOFTWARE(64-Bit)\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**<br /><br /> |

   **Установщики для компьютера на основе версии Windows**

| Версия Windows<br /><br /> | Путь конфигурации InstallShield<br /><br /> |
|-----------------------------| - |
| 32-разрядная система<br /><br /> | **HKEY_LOCAL_MACHINE\SOFTWARE(32-Bit)\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**<br /><br /> |
| 64-разрядная система<br /><br /> | **HKEY_LOCAL_MACHINE\SOFTWARE(32-Bit)\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**<br /><br />**HKEY_LOCAL_MACHINE\SOFTWARE(64-Bit)\Microsoft\Office\Excel\Addins\SampleCompany.ExcelAddIn**<br /><br /> |

   > [!NOTE]
   > Установщик для 64-разрядной ОС Windows требует наличия двух путей реестра, поскольку пользователи могут запускать 32-и 64-разрядные версии Office на компьютере под управлением 64-bit Windows.

   > [!NOTE]
   > Рекомендуется, чтобы имя вашей надстройки VSTO начиналось с имени вашей компании. Это соглашение увеличивает вероятность того, что ключ будет уникальным и снизить вероятность конфликта с надстройкой VSTO от другого поставщика. Надстройки, имеющие одинаковые имена, могут, например, перезаписывать разделы реестра друг друга. Такой подход не может гарантировать, что раздел будет уникальным, но может уменьшить потенциальные конфликты имен.

5. После создания иерархии ключей откройте контекстное меню для ключа **самплекомпани. ExcelAddIn** , выберите **создать**, а затем выберите **строковое значение**.

   Новое строковое значение появится в списке **данных реестра конечного компьютера** . Имя строкового параметра выделяется, чтобы его можно было изменить.

6. Задайте параметру имя **Description**.

7. Повторите эту процедуру, чтобы создать следующие параметры.

|Тип значения<br /><br />|Имя<br /><br />|
|--------------|--------|
|Строковый параметр<br /><br />|**FriendlyName**<br /><br />|
|Параметр DWORD<br /><br />|**LoadBehavior**<br /><br />|
|Строковый параметр<br /><br />|**манифеста**<br /><br />|

8. Откройте контекстное меню для значения **Description** и выберите команду **Изменить**.

   Откроется диалоговое окно **Изменить данные** .

9. В текстовом поле **Значение** введите **Демонстрационная надстройка Excel** и нажмите кнопку **ОК** .

   Это описание отображается, когда пользователь запускает приложение Office, открывает диалоговое окно **Параметры** и затем выбирает надстройку VSTO в области **Надстройки** .

10. Откройте контекстное меню для параметра **FriendlyName** и выберите команду **Изменить**.

   Откроется диалоговое окно **Изменить данные** .

11. В текстовом поле **Значение** введите **Демонстрационная надстройка Excel** и нажмите кнопку **ОК** .

   Эта строка отображается в диалоговом окне **Надстройки COM** в приложении Office. По умолчанию значение строки представляет собой идентификатор надстройки VSTO.

12. Откройте контекстное меню для параметра **LoadBehavior** и выберите команду **Изменить**.

   Откроется диалоговое окно **Изменить данные** .

13. В текстовом поле **Значение** введите **3** и нажмите кнопку **ОК** .

   Значение 3 загружает надстройку VSTO при запуске приложения. Дополнительные сведения о значениях LoadBehavior см. в разделе [записи реестра для надстроек VSTO](../vsto/registry-entries-for-vsto-add-ins.md).

14. Откройте контекстное меню для параметра **Manifest** и выберите команду **Изменить**.

   Откроется диалоговое окно **Изменить данные** .

15. В текстовом поле **Значение** введите **file:///[INSTALLDIR]ExcelAddIn.vsto|vstolocal** и нажмите кнопку **ОК** .

   Среда выполнения средств Visual Studio 2010 для Office использует этот путь для поиска манифеста развертывания. Часть **[INSTALLDIR]** этого пути представляет собой макрос, который сопоставлен свойству **INSTALLDIR** на странице свойств **Общие сведения** проекта установки InstallShield. Это свойство определяет расположение на целевом компьютере для установки надстройки VSTO. Суффикс **|vstolocal** гарантирует загрузку решения из папки установки, а не кэша ClickOnce.

> [!IMPORTANT]
> При создании пользовательской области формы в надстройке VSTO для Outlook необходимо создать дополнительные записи реестра для регистрации региона в Outlook. Дополнительные сведения см. в разделе [записи реестра для областей формы Outlook](../vsto/registry-entries-for-vsto-add-ins.md#OutlookEntries).

## <a name="configure-a-document-level-customization"></a><a name="ConfigureDocument"></a>Configure a document-level customization

Этот раздел применим только в том случае, если выполняется развертывание настройки на уровне документа. Если вы развертываете надстройку VSTO, можно сразу же вернуться к разделу [Построение проекта установки](#Build) .

Настройки на уровне документа не используют разделы реестра. Вместо этого расположение манифеста развертывания хранится в настраиваемых свойствах документа.

Для изменения пользовательских свойств создается программа, которая удаляет из документа настройку на уровне документа, изменяет соответствующие свойства, а затем повторно Прикрепляет настройку к документу. Затем нужно создать настраиваемое действие, которое запускает программу, и добавить это действие в проект установки.

### <a name="to-create-a-program-that-modifies-document-properties"></a>Создание программы, изменяющей свойства документа

1. В строке меню выберите **файл**  >  **добавить**  >  **Новый проект**.

   Откроется диалоговое окно **Добавление нового проекта** .

2. В области шаблонов в узле используемого языка выберите папку **Windows** .

3. В списке типов проекта для шаблона **Windows** выберите шаблон **Консольное приложение** .

4. Присвойте проекту имя **SetExcelDocumentProperties** и нажмите кнопку **ОК** .

5. В **обозревателе решений** нажмите кнопку **Показать все файлы** , откройте контекстное меню для узла проекта **SetExcelDocumentProperties** и выберите пункт **Добавить ссылку**.

6. В диалоговом окне **Диспетчер ссылок** перейдите на вкладку **Расширения** , а затем установите флажки рядом со следующими сборками и нажмите кнопку **ОК** .

   - Microsoft.VisualStudio.Tools.Applications.Runtime

   - Microsoft.VisualStudio.Tools.Applications.ServerDocument

7. В **обозревателе решений** выберите файл **Program.cs** (для приложений C#) или файл **Module1.vb** (для приложений Visual Basic).

8. В строке меню выберите **вид**  >  **Открыть**.

9. Замените все содержимое этого файла следующим кодом.

:::code language="vb" source="../vsto/codesnippet/VisualBasic/setexceldocumentproperties/module1.vb" id="Snippet1":::
:::code language="csharp" source="../vsto/codesnippet/CSharp/setexceldocumentproperties/program.cs" id="Snippet1":::

10. Скомпилируйте проект.

### <a name="to-add-a-custom-action-that-runs-your-program"></a>Добавление настраиваемого действия, которое запускает программу

1. В **обозревателе решений** разверните узел проекта **OfficeAddInSetup** и выберите файл **Project Assistant** , как показано на следующем рисунке.

   ![Файл помощника по проекту в обозревателе решений](../vsto/media/installshield-projectassistant.png "Файл помощника по проекту в обозревателе решений")

2. В строке меню выберите **вид**  >  **Открыть**.

3. В нижней части страницы **Project assistant** , нажмите кнопку **Файлы приложения** , как показано на следующем рисунке.

   ![Кнопка файлов приложения.](../vsto/media/installshield-applicationfiles.png "Кнопка файлов приложения.")

4. На странице **Файлы приложения** нажмите кнопку **Добавление выходных элементов проекта** .

   Откроется диалоговое окно **Селектор вывода Visual Studio** .

5. В узле **SetExcelDocumentProperties** установите флажок **Основные выходные файлы** и нажмите кнопку **ОК** .

6. В **обозревателе решений** в узле **OfficeAddInSetup** разверните узел **Define Setup Requirements and Actions** (Определите требования и действия установки), а затем выберите папку **Настраиваемые действия** .

7. В строке меню выберите **вид**  >  **Открыть**.

   В боковой области экрана открывается список событий.

   > [!NOTE]
   > В выпуске InstallShield Limited Edition доступно только несколько событий, отображаемых в этом списке. В этой процедуре программа запускается с помощью события **диалога после завершения установки** .

8. В списке событий в разделе **Custom Actions During Installation**(Настраиваемые действия в процессе установки) откройте контекстное меню для события **After Setup Complete Success dialog** и выберите пункт **New EXE**(Новый EXE-файл).

   Под событием **After Setup Complete Success dialog** появится настраиваемое действие с именем **NewCustomAction1** . Набор свойств для настраиваемого действия отображается в области рядом с событиями.

   > [!IMPORTANT]
   > В списке событий отображаются два события **After Setup Complete Success dialog** . Убедитесь, что выбран экземпляр события **After Setup Complete Success dialog** , который отображается в узле **Custom Actions During Installation** .

9. В списке для свойства **Source Location** (Исходное расположение) выберите пункт **Installed with the Product**(Установлено вместе с продуктом).

10. Нажмите кнопку **Обзор** рядом с свойством **File Name** .

11. В диалоговом окне **Browse for a Destination File** (Поиск целевого файла) перейдите к файлу **SetExcelDocumentProperties.Primary.output** и нажмите кнопку **Открыть** .

    Расположение этого файла зависит от папки, указанной для свойства **INSTALLDIR** проекта установки. Например, если для этого свойства задана папка с именем **[PersonalFolder]DemoWorkbookApp**, файл **SetExcelDocumentProperties.Primary.output** можно найти, перейдя в папку **[ProgramFilesFolder]\DemoWorkbookApp**.

    В следующих шагах вы получите идентификатор решения для документа, а затем передадите этот идентификатор в качестве параметра консольному приложению. Вы также передадите расположение документа, манифест развертывания и сборку документа.

12. Откройте контекстное меню для проекта **ExcelWorkbook** и выберите команду **Открыть папку в проводнике Windows** или **Открыть папку в проводнике** в зависимости от вашей операционной системы.

    Откроется папка, содержащая решение.

13. Откройте файл проекта решения в Блокноте. Для проектов Visual Basic имя файла — *ExcelWorkbook. vbproj*. Для проектов C# имя файла — *ExcelWorkbook. csproj*.

14. В файле проекта найдите элемент **&lt; SolutionId &gt;** , скопируйте его значение в буфер обмена и закройте Блокнот.

    Это значение передается в консольное приложение как параметр.

15. На странице свойств **NewCustomAction1** задайте для свойства **Командная строка** значение следующей строки текста.

   ```cmd
   /assemblyLocation="[INSTALLDIR]ExcelWorkbook.dll" /deploymentManifestLocation="[INSTALLDIR]ExcelWorkbook.vsto" /documentLocation="[INSTALLDIR]ExcelWorkbook.xlsx" /solutionID="Your Solution ID"
   ```

16. Замените **Your Solution ID** идентификатором решения, копированным в буфер обмена.

   > [!IMPORTANT]
   > Проверьте установщик, чтобы убедиться, что консольное приложение, запускаемое этим пользовательским действием, имеет доступ к документам в каталоге [INSTALLDIR]. Для некоторых каталогов на компьютере пользователя может потребоваться административный доступ (например, каталог Program Files). При развертывании решения в каталоге, для которого требуется административный доступ, откройте диалоговое окно **Свойства** файла *setup.exe* , перейдите на вкладку **Совместимость** и установите флажок **запустить эту программу от имени администратора** перед распространением установщика. Если вы не хотите, чтобы пользователи запускают программу установки с правами администратора, задайте для свойства [INSTALLDIR] каталог, к которому пользователь, вероятно, уже имеет доступ, например каталог **документы** . Дополнительные сведения см. в разделе [Указание места установки решения на компьютере пользователя](#Location) этого раздела.

## <a name="build-the-setup-project"></a><a name="Build"></a>Build the setup project

1. В **обозревателе решений** разверните узел **Подготовка для выпуска** и выберите файл **Выпуски** .

2. В строке меню выберите **вид**  >  **Открыть**.

   В боковой области открывается обозреватель **Сборки** для выбора типа создаваемого выпуска.

3. В обозревателе **Сборки** выберите папку **SingleImage** .

4. В области рядом с обозревателем **Сборки** перейдите на вкладку **Setup.exe** .

5. На странице свойств **Setup.exe** в списке **Местоположение необходимых компонентов InstallShield** выберите **Загрузить из Интернета**.

6. В строке меню последовательно выберите пункты **Сборка** > **Диспетчер конфигураций**.

7. В списке **Активная конфигурация решения** выберите **SingleImage**.

8. В таблице **Конфигурации проектов** в столбце **Конфигурация** проекта **OfficeAddInSetup** и выберите **SingleImage**, а затем нажмите кнопку **Закрыть** .

9. В строке меню выберите Сборка Сборка   >  **OfficeAddInSetup**.

   После завершения сборки можно указать файл *setup.exe* проекта **OfficeAddInSetup** в следующем расположении: <em>оффицеаддинсетуппрожектрут</em>**\OfficeAddInSetup\Express\SingleImage\DiskImages\DISK1 \\**

## <a name="see-also"></a>См. также статью

- [Предварительные требования для развертывания решений Office](/previous-versions/bb608617(v=vs.110))
- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
- [Записи реестра для надстроек VSTO](../vsto/registry-entries-for-vsto-add-ins.md)
- [Общие сведения о настраиваемых свойствах документа](../vsto/custom-document-properties-overview.md)
- [Предоставление доверия решениям Office](../vsto/granting-trust-to-office-solutions.md)
- [Предоставление доверия документам](../vsto/granting-trust-to-documents.md)
- [Развертывание решения Visual Studio 2010 Tools for Office с помощью установщик Windows](/previous-versions/visualstudio/visual-studio-2010/ff937654(v=msdn.10))