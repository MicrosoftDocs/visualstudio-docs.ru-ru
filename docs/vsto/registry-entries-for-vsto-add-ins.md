---
title: Записи реестра для надстроек VSTO
description: Узнайте, как можно создать конкретный набор записей реестра при развертывании надстроек VSTO, созданных с помощью Visual Studio.
ms.custom: SEO-VS-2020
ms.date: 08/14/2019
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- LoadBehavior entry
- add-ins [Office development in Visual Studio], registry entries
- registry keys [Office development in Visual Studio]
- application-level add-ins [Office development in Visual Studio], registry entries
- registry entries [Office development in Visual Studio]
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: 8353965cf97b065bf0037b8d11ecf761e9bb6cec
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99963774"
---
# <a name="registry-entries-for-vsto-add-ins"></a>Записи реестра для надстроек VSTO
  При развертывании надстроек VSTO, созданных с помощью Visual Studio, необходимо создать определенный набор записей реестра. Эти записи реестра предоставляют сведения, позволяющие приложению Microsoft Office обнаружить и загрузить надстройку VSTO.

 [!INCLUDE[appliesto_allapp](../vsto/includes/appliesto-allapp-md.md)]

[!include[Add-ins note](includes/addinsnote.md)]

 При выполнении сборки проекта Visual Studio создает эти записи реестра на компьютере разработчика, упрощая запуск и отладку надстройки VSTO. Если вы используете ClickOnce для развертывания надстройки VSTO, записи реестра автоматически создаются на компьютере конечного пользователя. При использовании установщик Windows для развертывания надстройки VSTO необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечного пользователя.

 Дополнительные сведения об использовании записей реестра для надстроек VSTO во время процесса загрузки см. в разделе [Architecture of VSTO Add-ins](../vsto/architecture-of-vsto-add-ins.md).

> [!NOTE]
> В этом разделе текстовый *идентификатор надстройки* представляет собой уникальный идентификатор надстройки VSTO. По умолчанию идентификатором является имя сборки надстройки VSTO.

## <a name="register-vsto-add-ins-for-the-current-user-vs-all-users"></a>Регистрация надстроек VSTO для текущего пользователя и всех пользователей
 После установки надстройку VSTO можно зарегистрировать одним из двух способов.

- Только для текущего пользователя (т. е. он доступен только пользователю, который вошел в систему на компьютере при установке надстройки VSTO). В этом случае записи реестра создаются в **HKEY_CURRENT_USER**.

- Для всех пользователей (то есть любой пользователь, входящий в систему на компьютере, может использовать надстройку VSTO). В этом случае записи реестра создаются в разделе **HKEY_LOCAL_MACHINE**.

  Все надстройки VSTO, созданные с помощью Visual Studio, могут быть зарегистрированы для текущего пользователя. Однако для всех пользователей надстройки VSTO можно зарегистрировать только в определенных сценариях. Эти сценарии зависят от версии Microsoft Office на компьютере и способа развертывания надстройки VSTO.

### <a name="deployment-type"></a>Тип развертывания
 Надстройки VSTO, развернутые с использованием ClickOnce, можно зарегистрировать только для текущего пользователя. Это связано с тем, что ClickOnce поддерживает создание ключей только в **HKEY_CURRENT_USER**. Если вы хотите зарегистрировать надстройку VSTO для всех пользователей компьютера, разверните ее с использованием установщика Windows. Дополнительные сведения об этих типах развертывания см. в статье [развертывание решения Office с помощью ClickOnce](../vsto/deploying-an-office-solution-by-using-clickonce.md) и [развертывание решения office с помощью установщик Windows](../vsto/deploying-a-vsto-solution-by-using-windows-installer.md).

## <a name="registry-entries"></a>Записи реестра
 Необходимые записи реестра надстроек VSTO находятся в следующих разделах реестра, где *корневой* **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE** в зависимости от того, установлен ли экземпляр для текущего пользователя или для всех пользователей.

|Приложение Office|Путь конфигурации|
|------------------|------------------|
|Visio| \\  \\ *Идентификатор надстройки* корневого \софтваре\микрософт Visio \аддинс|
|Все остальные|Имя *корневого*\Софтваре\микрософт\оффице \\ *приложения Office* \\ *идентификатор надстройки* \аддинс|

> [!NOTE]
> Если установщик предназначен для всех пользователей в 64-разрядной системе Windows, рекомендуется включить в него две записи реестра: один под HKEY_LOCAL_MACHINE\Software\Microsoft и один в HKEY_LOCAL_MACHINE\Software\\ **WOW6432Node**\Microsoft Hive. Это связано с тем, что пользователи могут использовать как 32-разрядные, так и 64-разрядные версии Office на компьютере.
>
>Если установщик предназначен для текущего пользователя, его не нужно устанавливать в WOW6432Node, так как путь к HKEY_CURRENT_USER\Software является общим.
>
>Дополнительные сведения см. [в разделе данные о 32-разрядных и 64-битных приложениях в реестре](/windows/win32/sysinfo/32-bit-and-64-bit-application-data-in-the-registry) .

 В следующей таблице перечислены записи в данном разделе реестра.

|Ввод|Тип|Значение|
|-----------|----------|-----------|
|**Описание**|REG_SZ|Обязательный элемент. Краткое описание надстройки VSTO.<br /><br /> Это описание отображается, когда пользователь выбирает надстройку VSTO на панели **Надстройки** диалогового окна **Параметры** в приложении Microsoft Office.|
|**FriendlyName**|REG_SZ|Обязательный элемент. Описательное имя надстройки VSTO, которое отображается в диалоговом окне **Надстройки COM** в приложении Microsoft Office. Значением по умолчанию является идентификатор надстройки VSTO.|
|**LoadBehavior**|REG_DWORD|Обязательный элемент. Значение, указывающее, когда приложение пытается загрузить надстройку VSTO и текущее состояние надстройки VSTO («Загружена» или «Выгружена»).<br /><br /> По умолчанию эта запись имеет значение 3, которое означает, что надстройка VSTO загружается при запуске. Дополнительные сведения см. в разделе [значения LoadBehavior](#LoadBehavior). **Примечание.**  Если пользователь отключает надстройку VSTO, это действие изменяет значение **LoadBehavior** в кусте реестра **HKEY_CURRENT_USER** . Для каждого пользователя значение параметра **LoadBehavior** в HKEY_CURRENT_USER Hive переопределяет значение **LoadBehavior** по умолчанию, определенное в **HKEY_LOCAL_MACHINE** Hive.|
|**манифеста**|REG_SZ|Обязательный элемент. Полный путь манифеста развертывания для надстройки VSTO. Путь может быть расположением на локальном компьютере, в сетевой папке (UNC) или на веб-сервере (HTTP).<br /><br /> Если для развертывания решения используется установщик Windows, необходимо добавить префикс **file:///** в путь **манифеста** . Кроме того, необходимо добавить строку **&#124;vstolocal** (то есть символ вертикальной **&#124;** , за которым следует значение **vstolocal**) до конца этого пути. Это гарантирует загрузку решения из папки установки, а не из кэша ClickOnce. Дополнительные сведения см. в статье [развертывание решения Office с помощью установщик Windows](../vsto/deploying-a-vsto-solution-by-using-windows-installer.md). **Примечание.**  При создании надстройки VSTO на компьютере разработчика Visual Studio автоматически добавляет строку **&#124;vstolocal** в эту запись реестра.|

### <a name="registry-entries-for-outlook-form-regions"></a><a name="OutlookEntries"></a> Записи реестра для областей формы Outlook
 При создании настраиваемой области формы в надстройке VSTO для приложения Outlook для регистрации области формы в Outlook используются дополнительные записи реестра. Эти записи создаются в отдельном разделе реестра для каждого класса сообщений, поддерживаемого областью формы. Эти разделы реестра находятся в следующем расположении, где *root* — **HKEY_CURRENT_USER** или **HKEY_LOCAL_MACHINE**.

  \\ *Класс сообщений* root \софтваре\микрософт\оффице\аутлук\формрегионс

 Подобно другим записям реестра, общим для всех надстроек VSTO, Visual Studio создает записи реестра области формы на компьютере разработчика при выполнении сборки проекта. Если вы используете ClickOnce для развертывания надстройки VSTO, записи реестра автоматически создаются на компьютере конечного пользователя. При использовании установщик Windows для развертывания надстройки VSTO необходимо настроить проект InstallShield Limited Edition для создания записей реестра на компьютере конечного пользователя.

 Дополнительные сведения о записях реестра области формы см. [в разделе Указание расположения области формы в пользовательской форме](/office/vba/outlook/Concepts/Creating-Form-Regions/specify-the-location-of-a-form-region-in-a-custom-form). Дополнительные сведения о регионах форм Outlook см. в разделе [Создание областей формы Outlook](../vsto/creating-outlook-form-regions.md).

## <a name="loadbehavior-values"></a><a name="LoadBehavior"></a> Значения LoadBehavior
 Запись **LoadBehavior** в *корневом*\софтваре\микрософт\оффиценом \\ *имени приложения*\аддинс \\ ключ *идентификатора надстройки* содержит побитовое сочетание значений, определяющих поведение надстройки VSTO во время выполнения. Младший бит (значения 0 и 1) указывает, загружена ли надстройка VSTO в данный момент. Остальные биты указывают, когда приложение пытается загрузить надстройку VSTO.

 Как правило, запись **LoadBehavior** должна иметь значение 0, 3 или 16 (в десятичном формате) при установке надстройки VSTO на компьютерах конечных пользователей. По умолчанию при сборке или публикации надстройки VSTO Visual Studio устанавливает для записи **LoadBehavior** значение 3.

 В следующей таблице перечислены все возможные значения записи **LoadBehavior** . Некоторые описания в этой таблице относятся к загрузке надстройки VSTO вручную или программным путем. Чтобы загрузить надстройку VSTO вручную, установите флажок рядом с надстройкой VSTO в диалоговом окне **Надстройки COM** в приложении. Для загрузки надстройки VSTO программным способом укажите для свойства <xref:Microsoft.Office.Core.COMAddIn.Connect%2A> объекта <xref:Microsoft.Office.Core.COMAddIn> , представляющего надстройку VSTO, значение **true**.

|Значение (десятичное)|Состояние надстройки VSTO|Поведение при загрузке надстройки VSTO|Описание|
|--------------------------|-------------------------|--------------------------------|-----------------|
|0|Выгружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если настройка VSTO успешно загружена, значение **LoadBehavior** остается равным 0, но состояние надстройки VSTO в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена.|
|1|Загружен|Не загружать автоматически|Приложение никогда не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Несмотря на то что диалоговое окно **надстройки COM** указывает на то, что НАДСТРОЙКа VSTO загружается после запуска приложения, Надстройка VSTO не загружается до тех пор, пока она не будет загружена вручную или программным способом.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 0 и остается таким после закрытия приложения.|
|2|Выгружен|Загружать при запуске|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 3 и остается таким после закрытия приложения.|
|3|Загружен|Загружать при запуске|Приложение пытается загрузить надстройку VSTO при запуске приложения. Это значение используется по умолчанию при выполнении сборки или публикации надстройки в Visual Studio.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 3. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 2 и остается таким после закрытия приложения.|
|8|Выгружен|Загружать по запросу|Приложение не пытается загрузить надстройку VSTO автоматически. Пользователь может попытаться загрузить надстройку VSTO вручную или сделать это программными средствами.<br /><br /> Если приложение успешно загружает надстройку VSTO, значение **LoadBehavior** меняется на 9.|
|9|Загружен|Загружать по запросу|Надстройка VSTO будет загружаться только в том случае, если она требуется приложению, например, если пользователь щелкнет элемент пользовательского интерфейса, использующий функциональность этой надстройки VSTO (например, настраиваемую кнопку на ленте).<br /><br /> Если приложение загрузило надстройку VSTO, значение **LoadBehavior** остается равным 9, но состояние надстройки в диалоговом окне **Надстройки COM** обновляется, указывая, что надстройка VSTO загружена. Если при загрузке надстройки VSTO возникает ошибка, значение **LoadBehavior** меняется на 8.|
|16|Загружен|Загрузить в первый раз, в дальнейшем загружать по запросу|Установите это значение, если надстройку VSTO нужно загружать по запросу. Приложение загружает надстройку VSTO при первом запуске приложения пользователем. При следующем запуске приложения пользователем будут загружаться все элементы пользовательского интерфейса, определенные надстройкой VSTO, но сама надстройка VSTO не будет загружена, пока пользователь не щелкнет связанный с ней элемент пользовательского интерфейса.<br /><br /> Если приложение впервые успешно загружает надстройку VSTO, значение **LoadBehavior** остается равным 16 и надстройка загружается. После завершения работы приложения значение **LoadBehavior** меняется на 9.|

## <a name="see-also"></a>См. также раздел
- [Архитектура решений Office в Visual Studio](../vsto/architecture-of-office-solutions-in-visual-studio.md)
- [Architecture of VSTO Add-ins](../vsto/architecture-of-vsto-add-ins.md)
- [Создание решений Office](../vsto/building-office-solutions.md)
- [Развертывание решения Office](../vsto/deploying-an-office-solution.md)
 