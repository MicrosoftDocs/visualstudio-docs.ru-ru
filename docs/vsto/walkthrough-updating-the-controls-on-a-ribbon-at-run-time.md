---
title: Пошаговое руководство. Обновление элементов управления на ленте во время выполнения
description: Узнайте, как можно использовать объектную модель Ribbon для обновления элементов управления на ленте после загрузки ленты в приложение Office.
ms.custom: SEO-VS-2020
titleSuffix: ''
ms.date: 02/02/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- controls [Office development in Visual Studio], Ribbon
- Ribbon [Office development in Visual Studio], controls
- updating Ribbon controls
- Ribbon [Office development in Visual Studio], dynamic menu
- dynamic menus [Office development in Visual Studio]
- Ribbon [Office development in Visual Studio], updating
author: John-Hart
ms.author: johnhart
manager: jmartens
ms.workload:
- office
ms.openlocfilehash: 7cf9bbe73bd43fa01aec8e7d0dec42fd8301ff30
ms.sourcegitcommit: 4b40aac584991cc2eb2186c3e4f4a7fcd522f607
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2021
ms.locfileid: "107827530"
---
# <a name="walkthrough-update-the-controls-on-a-ribbon-at-run-time"></a>Пошаговое руководство. Обновление элементов управления на ленте во время выполнения

В этом пошаговом руководстве показано, как использовать объектную модель ленты для обновления элементов управления на ленте после загрузки ленты в приложение Office.

[!INCLUDE[appliesto_ribbon](../vsto/includes/appliesto-ribbon-md.md)]

В данном примере данные извлекаются из примера базы данных Northwind (Борей) для заполнения поля со списком и меню в Microsoft Office Outlook. Элементы, выбранные в этих элементах управления, автоматически заполняют поля **, такие как,** и **подпадают** под сообщение электронной почты.

В этом пошаговом руководстве описаны следующие задачи:

- Создайте новый проект надстройки VSTO для Outlook.

- Создание пользовательской группы ленты.

- Добавьте пользовательскую группу во встроенную вкладку.

- Обновление элементов управления на ленте во время выполнения.

> [!NOTE]
> Отображаемые на компьютере имена или расположения некоторых элементов пользовательского интерфейса Visual Studio могут отличаться от указанных в следующих инструкциях. Это зависит от имеющегося выпуска Visual Studio и используемых параметров. Дополнительные сведения см. в разделе [Персонализация интегрированной среды разработки Visual Studio](../ide/personalizing-the-visual-studio-ide.md).

## <a name="prerequisites"></a>Предварительные требования

Для выполнения этого пошагового руководства требуются следующие компоненты:

- [!INCLUDE[vsto_vsprereq](../vsto/includes/vsto-vsprereq-md.md)]

- Microsoft Outlook

## <a name="create-a-new-outlook-vsto-add-in-project"></a>Создание нового проекта надстройки VSTO для Outlook

Сначала создайте проект надстройки Outlook VSTO.

### <a name="to-create-a-new-outlook-vsto-add-in-project"></a>Порядок создания нового проекта надстройки Outlook VSTO

1. В [!INCLUDE[vsprvs](../sharepoint/includes/vsprvs-md.md)] Создайте проект надстройки VSTO для Outlook с именем **Ribbon_Update_At_Runtime**.

2. В диалоговом окне **Создание проекта** выберите **Создать каталог для решения**.

3. Сохраните проект в каталоге проекта по умолчанию.

     Дополнительные сведения см. в разделе [как создавать проекты Office в Visual Studio](../vsto/how-to-create-office-projects-in-visual-studio.md).

## <a name="design-a-custom-ribbon-group"></a>Создание пользовательской группы ленты

Лента для этого примера будет отображаться, когда пользователь создаст новое почтовое сообщение. Чтобы создать пользовательскую группу для ленты, сначала добавьте в проект элемент ленты, а затем Разработайте группу в конструкторе лент. Эта пользовательская группа поможет создавать сообщения электронной почты для клиентов, получая имена и заказы из базы данных.

### <a name="to-design-a-custom-group"></a>Порядок создания пользовательской группы

1. В меню **Проект** выберите **Добавить новый элемент**.

2. В диалоговом окне **Добавление нового элемента** выберите элемент **Лента (визуальный конструктор)**.

3. Измените имя новой ленты на **кустомерриббон** и нажмите кнопку **Добавить**.

     Файл *кустомерриббон. CS* или *кустомерриббон. vb* откроется в конструкторе ленты и отобразит вкладку и группу по умолчанию.

4. Щелкните конструктор лент, чтобы выбрать его.

5. В окне **Свойства** щелкните стрелку раскрывающегося списка рядом со свойством **RibbonType** и выберите **Microsoft. Outlook. mail. Сформируйте**.

     Это позволяет ленте отображаться, когда пользователь формирует новое почтовое сообщение в Outlook.

6. В конструкторе ленты щелкните **group1** (группа), чтобы выбрать ее.

7. В окне **Свойства** задайте для параметра **Метка** значение **покупки клиента**.

8. С вкладки **элементы управления ленты Office** **панели элементов** перетащите **поле со списком** в группу **Покупки заказчиков** .

9. Щелкните **ComboBox1** , чтобы выбрать его.

10. В окне **Свойства** задайте для параметра **Метка** значение **Клиенты**.

11. С вкладки **элементы управления ленты Office** **панели элементов** перетащите **меню** в группу **Покупки заказчиков** .

12. В окне **Свойства** задайте для параметра **Метка** значение **купленный продукт**.

13. Установите для **dynamic** значение **true**.

     Это позволяет добавлять и удалять элементы управления в меню во время выполнения после загрузки ленты в приложение Office.

## <a name="add-the-custom-group-to-a-built-in-tab"></a>Добавление пользовательской группы во встроенную вкладку

Встроенная вкладка — это вкладка, которая уже находится на ленте проводника или инспектора Outlook. В этой процедуре вы сможете добавить пользовательскую группу на встроенную вкладку, а затем указать положение этой группы на вкладке.

### <a name="to-add-the-custom-group-to-a-built-in-tab"></a>Порядок добавления пользовательской группы на встроенную вкладку

1. Щелкните вкладку **табаддинс (встроенная)** , чтобы выбрать ее.

2. В окне **Свойства** разверните свойство **ControlID** и установите для **оффицеид** значение **табневмаилмессаже**.

     При этом Группа " **покупки клиентов** " добавляется на вкладку **сообщения** ленты, которая отображается в новом сообщении электронной почты.

3. Щелкните группу **Покупки заказчиков** , чтобы выбрать ее.

4. В окне " **Свойства** " разверните свойство " **Расположение** ", щелкните стрелку раскрывающегося списка рядом со свойством **поситионтипе** и выберите **бефореоффицеид**.

5. Присвойте свойству **оффицеид** значение **граупклипбоард**.

     После этого в группе « **буфер обмена** » на вкладке « **сообщения** » размещается группа **покупок заказчиков** .

## <a name="create-the-data-source"></a>Создание источника данных

С помощью окна **Источники данных** добавьте типизированный набор данных в свой проект.

### <a name="to-create-the-data-source"></a>Создание источника данных

1. В меню **Данные** выберите команду **Добавить новый источник данных**.

     Запустится **Мастер настройки источника данных**.

2. Выберите **база данных**, а затем нажмите кнопку **Далее**.

3. Выберите **набор данных**, а затем нажмите кнопку **Далее**.

4. Выберите подключение к базе данных Northwind Microsoft SQL Server Compact 4,0 или добавьте новое соединение с помощью кнопки **создать подключение** .

5. После выбора или создания соединения нажмите кнопку **Далее**.

6. Нажмите кнопку **Далее** , чтобы сохранить строку подключения.

7. На странице **Выбор объектов базы данных** разверните узел **таблицы**.

8. Установите флажок рядом с каждой из следующих таблиц.

    1. **Клиенты**

    2. **Сведения о заказе**

    3. **Orders**

    4. **Продукты**

9. Нажмите кнопку **Готово**.

## <a name="update-controls-in-the-custom-group-at-run-time"></a>Обновление элементов управления в пользовательской группе во время выполнения

Используйте объектную модель ленты для выполнения следующих задач.

- Добавьте имена клиентов в поле со списком **заказчиков** .

- Добавьте элементы управления меню и кнопки в меню **приобретенные продукты** , представляющие продажи заказов и продуктов.

- Заполнение полей "Кому", "Тема" и "текст" новых сообщений электронной почты с помощью данных из поля со списком " **Клиенты** " и меню " **приобретенные продукты** ".

### <a name="to-update-controls-in-the-custom-group-by-using-the-ribbon-object-model"></a>Порядок обновления элементов управления в пользовательской группе с помощью объектной модели ленты

1. В меню **Проект** выберите пункт **Добавить ссылку**.

2. В диалоговом окне **Добавление ссылки** перейдите на вкладку **.NET** , выберите сборку **System. Data. LINQ** и нажмите кнопку **ОК**.

    Эта сборка содержит классы для использования запросов LINQ (Language-Integrated Queries). Запросы LINQ будут использоваться для заполнения элементов управления в пользовательской группе данными из базы данных Northwind.

3. В **Обозреватель решений** щелкните **кустомерриббон. CS** или **кустомерриббон. vb** , чтобы выбрать его.

4. В меню **Вид** выберите пункт **Код**.

    Файл кода ленты открывается в редакторе кода.

5. Добавьте следующие операторы в начало файла кода ленты. Эти операторы обеспечивают легкий доступ к пространствам имен LINQ и к пространству имен основной сборки взаимодействия Outlook.

    :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet1":::
    :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet1":::

6. Добавьте в класс следующий код `CustomerRibbon` . Этот код объявляет таблицу данных и адаптеры таблиц, которые будут использоваться для хранения информации из таблиц «Заказчики», «Заказы», «Сведения о заказе» и «Продукт» базы данных Northwind.

    :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet2":::
    :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet2":::

7. Добавьте следующий блок кода в класс `CustomerRibbon`. Этот код добавляет три вспомогательных метода, которые создают элементы управления для ленты во время выполнения.

    :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet3":::
    :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet3":::

8. Замените обработчик событий `CustomerRibbon_Load` следующим кодом. Этот код использует запрос LINQ для выполнения следующих задач.

   - Заполнение поля со списком **заказчиков** с помощью идентификатора и имени 20 клиентов в базе данных Northwind.

   - Вызов вспомогательного метода `PopulateSalesOrderInfo`. Этот метод обновляет меню **ProductsPurchased** , используя номера заказов на продажу, которые относятся к выбранному клиенту.

     :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet4":::
     :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet4":::

9. Добавьте в класс `CustomerRibbon` приведенный далее код. Этот код использует запросы LINQ для выполнения следующих задач.

   - Добавляет подменю в меню **ProductsPurchased** для каждого заказа на продажу, связанного с выбранным клиентом.

   - Добавление кнопок в каждое подменю для продуктов, относящихся к заказу на продажу.

   - Добавление обработчиков событий для каждой кнопки.

     :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet6":::
     :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet6":::

10. В **Обозреватель решений** дважды щелкните файл кода ленты.

     Открывается конструктор лент.

11. В конструкторе ленты дважды щелкните поле со списком **заказчиков** .

     В редакторе кода открывается файл кода ленты и появляется обработчик событий `ComboBox1_TextChanged`.

12. Замените обработчик событий `ComboBox1_TextChanged` следующим кодом. Этот код выполняет следующие задачи:

    - Вызов вспомогательного метода `PopulateSalesOrderInfo`. Этот метод обновляет меню **приобретенных продуктов** с заказами на продажу, относящимися к выбранному клиенту.

    - Вызов вспомогательного метода `PopulateMailItem` и передача текущего текста, представляющего собой имя выбранного заказчика. Этот метод заполняет поля "Кому", "Тема" и "текст" новых сообщений электронной почты.

      :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet5":::
      :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet5":::

13. Добавьте следующий обработчик событий `Click` в класс `CustomerRibbon` . Этот код добавляет имя выбранных продуктов в поле Body новых сообщений электронной почты.

     :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet8":::
     :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet8":::

14. Добавьте в класс `CustomerRibbon` приведенный далее код. Этот код выполняет следующие задачи:

    - Заполнение строки новых сообщений электронной почты с помощью адреса электронной почты выбранного в данный момент клиента.

    - Добавляет текст в поля Тема и текст новых сообщений электронной почты.

      :::code language="csharp" source="../vsto/codesnippet/CSharp/Ribbon_Update_At_Runtime/CustomerRibbon.cs" id="Snippet7":::
      :::code language="vb" source="../vsto/codesnippet/VisualBasic/Ribbon_Update_At_Runtime/CustomerRibbon.vb" id="Snippet7":::

## <a name="test-the-controls-in-the-custom-group"></a>Тестирование элементов управления в пользовательской группе

При открытии новой формы почты в Outlook на вкладке " **сообщения** " на ленте отображается пользовательская группа с именем " **покупки клиентов** ".

Чтобы создать следующее сообщение электронной почты клиента, выберите клиента, а затем выберите продукты, приобретенные клиентом. Элементы управления в группе « **покупки клиентов** » обновляются во время выполнения данными из базы данных «Борей».

### <a name="to-test-the-controls-in-the-custom-group"></a>Порядок тестирования элементов управления в пользовательской группе

1. Нажмите клавишу **F5** , чтобы запустить проект.

     Запускается Outlook.

2. В Outlook в меню **файл** выберите пункт **создать**, а затем пункт **сообщение электронной почты**.

     После этого будут выполнены указанные ниже действия:

    - Откроется новое окно инспектора сообщений электронной почты.

    - На вкладке " **сообщение** " на ленте Группа " **Покупки заказчиков** " отображается перед группой " **буфер обмена** ".

    - Поле со списком **заказчиков** в группе обновляется именами клиентов в базе данных Northwind.

3. На вкладке ленты **сообщение** в группе **покупки клиента** выберите клиента в поле со списком **Клиенты** .

     После этого будут выполнены указанные ниже действия:

    - Меню **приобретенных продуктов** обновляется для отображения каждого заказа на продажу для выбранного клиента.

    - Каждое подменю заказов на продажу обновится и будет показывать продукты, приобретенные в рамках данного заказа.

    - Адрес электронной почты выбранного клиента добавляется в строку " **Кому** " почтового сообщения, а тема и текст почтового сообщения заполняются текстом.

4. Щелкните меню **Покупка продуктов** , укажите любой заказ на продажу, а затем щелкните продукт в заказе на продажу.

     Имя продукта добавляется в тело сообщения электронной почты.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о настройке пользовательского интерфейса Office см. в следующих разделах:

- Добавление пользовательского интерфейса на основе контекста к настройкам уровня документа. Дополнительные сведения см. в разделе [Общие сведения о панели действий](../vsto/actions-pane-overview.md).

- Расширение стандартной или пользовательской формы Microsoft Office Outlook. Дополнительные сведения см. в разделе [Пошаговое руководство. Проектирование области формы Outlook](../vsto/walkthrough-designing-an-outlook-form-region.md).

- Добавление настраиваемой области задач в Outlook. Дополнительные сведения см. в разделе [настраиваемые области задач](../vsto/custom-task-panes.md).

## <a name="see-also"></a>См. также статью

- [Доступ к ленте во время выполнения](../vsto/accessing-the-ribbon-at-run-time.md)
- [Общие сведения о ленте](../vsto/ribbon-overview.md)
- [LINQ](/dotnet/csharp/linq/index)
- [Как приступить к настройке ленты](../vsto/how-to-get-started-customizing-the-ribbon.md)
- [Конструктор лент](../vsto/ribbon-designer.md)
- [Пошаговое руководство. Создание настраиваемой вкладки с помощью конструктора лент](../vsto/walkthrough-creating-a-custom-tab-by-using-the-ribbon-designer.md)
- [Общие сведения об объектной модели ленты](../vsto/ribbon-object-model-overview.md)
- [Настройка ленты для Outlook](../vsto/customizing-a-ribbon-for-outlook.md)
- [Как изменить позицию вкладки на ленте](../vsto/how-to-change-the-position-of-a-tab-on-the-ribbon.md)
- [Как настроить встроенную вкладку](../vsto/how-to-customize-a-built-in-tab.md)
- [Как добавить элементы управления в представление Backstage](../vsto/how-to-add-controls-to-the-backstage-view.md)
- [Как экспортировать ленту из конструктора лент в XML-ленту](../vsto/how-to-export-a-ribbon-from-the-ribbon-designer-to-ribbon-xml.md)
- [Пошаговое руководство. Отображение ошибок пользовательского интерфейса надстройки](../vsto/how-to-show-add-in-user-interface-errors.md)