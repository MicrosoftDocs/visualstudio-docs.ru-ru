---
title: Публикация приложения WPF с включенными стилями оформления
description: Узнайте, как опубликовать приложение WPF с включенными визуальными стилями, что позволяет изменять внешний вид элементов управления в зависимости от темы, выбранной пользователем.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
ms.assetid: 73b22b02-fc75-42aa-82d3-51fdcaf8e5c8
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: 285d624debed6dc498e3d274af2839137b5094d1
ms.sourcegitcommit: 4b323a8a8bfd1a1a9e84f4b4ca88fa8da690f656
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/05/2021
ms.locfileid: "102171283"
---
# <a name="how-to-publish-a-wpf-application-with-visual-styles-enabled"></a>Практическое руководство. Публикация приложения WPF с включенными визуальными стилями

Стили оформления позволяют изменять внешний вид общих элементов управления в зависимости от темы, выбранной пользователем. По умолчанию визуальные стили не включены для приложений Windows Presentation Foundation (WPF), поэтому их необходимо включить вручную. Однако включение визуальных стилей для приложения WPF и последующей публикации решения приводит к ошибке. В этом разделе описывается, как устранить эту ошибку и процесс публикации приложения WPF с включенными визуальными стилями. Дополнительные сведения о визуальных стилях см. в разделе [Общие сведения о стилях визуального](/windows/desktop/Controls/visual-styles-overview)элемента. Дополнительные сведения об этом сообщении об ошибке см. [в разделе Устранение конкретных ошибок в развертываниях ClickOnce](../deployment/troubleshooting-specific-errors-in-clickonce-deployments.md).

 Чтобы устранить эту ошибку и опубликовать решение, необходимо выполнить следующие задачи.

- [Опубликуйте решение без включенных стилей оформления](#publish-the-solution-without-visual-styles-enabled).

- [Создайте файл манифеста](#create-a-manifest-file).

- [Внедрите файл манифеста в исполняемый файл опубликованного решения](#embed-the-manifest-file-into-the-executable-file-of-the-published-solution).

- [Подпишите манифесты приложения и развертывания](#sign-the-application-and-deployment-manifests).

  Затем можно переместить опубликованные файлы в расположение, из которого конечные пользователи должны установить приложение.

## <a name="publish-the-solution-without-visual-styles-enabled"></a>Публикация решения без включенных стилей оформления

1. Убедитесь, что в проекте не включены визуальные стили. Сначала проверьте файл манифеста проекта на наличие следующего XML-кода. Затем, если имеется XML-код, заключите его в тег комментария.

     По умолчанию визуальные стили не включены.

    ```xml
    <dependency>
        <dependentAssembly>
            <assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls" version="6.0.0.0" processorArchitecture="*" publicKeyToken="6595b64144ccf1df" language="*" />
        </dependentAssembly>
    </dependency>
    ```

     В следующих процедурах показано, как открыть файл манифеста, связанный с проектом.

    **Открытие файла манифеста в проекте Visual Basic**

    1. В строке меню выберите **проект**, **Свойства** *имяПроекта* , где *имя_проекта* — это имя проекта WPF.

         Отобразятся страницы свойств проекта WPF.

    2. На вкладке **приложение** выберите **Просмотр параметров Windows**.

         Файл App. manifest откроется в **редакторе кода**.

    **Открытие файла манифеста в проекте C#**

    1. В строке меню выберите **проект**, **Свойства** *имяПроекта* , где *имя_проекта* — это имя проекта WPF.

         Отобразятся страницы свойств проекта WPF.

    2. На вкладке **приложение** запишите имя, которое отображается в поле манифест. Это имя манифеста, связанного с проектом.

        > [!NOTE]
        > Если в поле манифеста отображается **параметр внедрить манифест с параметрами по умолчанию** или **создать приложение без манифеста** , визуальные стили не будут включены. Если имя файла манифеста отображается в поле манифест, перейдите к следующему шагу этой процедуры.

    3. В **обозревателе решений** выберите **Показать все файлы**.

         Эта кнопка показывает все элементы проекта, включая те, которые были исключены и обычно скрыты. Файл манифеста отображается как элемент проекта.

2. Создайте и опубликуйте решение. Дополнительные сведения о публикации решения см. в разделе [инструкции. Публикация приложения ClickOnce с помощью мастера публикации](../deployment/how-to-publish-a-clickonce-application-using-the-publish-wizard.md).

## <a name="create-a-manifest-file"></a>Создание файла манифеста

1. Вставьте следующий XML-код в файл Блокнота.

     Этот XML-код описывает сборку, содержащую элементы управления, поддерживающие стили оформления.

    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <asmv1:assembly manifestVersion="1.0"
        xmlns="urn:schemas-microsoft-com:asm.v1"
        xmlns:asmv1="urn:schemas-microsoft-com:asm.v1"
        xmlns:asmv2="urn:schemas-microsoft-com:asm.v2"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
        <dependency>
            <dependentAssembly>
                <assemblyIdentity type="win32" name="Microsoft.Windows.Common-Controls" version="6.0.0.0" processorArchitecture="*" publicKeyToken="6595b64144ccf1df" language="*" />
            </dependentAssembly>
        </dependency>
    </asmv1:assembly>
    ```

2. В блокноте в меню **файл** выберите команду **Сохранить как**.

3. В диалоговом окне **Сохранить как** в раскрывающемся списке **Тип файла** выберите **все файлы**.

4. В поле **имя файла** введите имя файла и добавьте в конец имени файла *. manifest.* Например: *Themes. manifest*.

5. Нажмите кнопку **Обзор папок** , выберите любую папку и нажмите кнопку **сохранить**.

    > [!NOTE]
    > В остальных процедурах предполагается, что имя этого файла — *Themes. manifest* , а файл сохраняется в каталог *C:\temp* на компьютере.

## <a name="embed-the-manifest-file-into-the-executable-file-of-the-published-solution"></a>Внедрение файла манифеста в исполняемый файл опубликованного решения

1. Откройте **Командная строка разработчика для Visual Studio**.

    Дополнительные сведения о том, как открыть Командная строка разработчика для Visual Studio, см. в разделе [Командная строка разработчика и Developer PowerShell](../ide/reference/command-prompt-powershell.md).

   > [!NOTE]
   > Оставшиеся шаги позволяют принять следующие предположения о решении:
   >
   > - Имя решения — **мивпфпрожект**.
   > - Решение находится в следующем каталоге: `%UserProfile%\Documents\Visual Studio 2010\Projects\` .
   >
   > - Решение публикуется в следующем каталоге: `%UserProfile%\Documents\Visual Studio 2010\Projects\publish` .
   > - Последняя версия опубликованных файлов приложения находится в следующем каталоге: `%UserProfile%\Documents\Visual Studio 2010\Projects\publish\Application Files\WPFApp_1_0_0_0`
   >
   > Не нужно использовать имя или расположения каталогов, описанные выше. Описанные выше имена и расположения используются только для демонстрации действий, необходимых для публикации решения.

2. В командной строке измените путь к каталогу, содержащему последнюю версию опубликованных файлов приложения. Этот шаг показан в следующем примере.

   ```cmd
   cd "%UserProfile%\Documents\Visual Studio 2010\Projects\MyWPFProject\publish\Application Files\WPFApp_1_0_0_0"
   ```

3. В командной строке выполните следующую команду, чтобы внедрить файл манифеста в исполняемый файл приложения.

   ```cmd
   mt -manifest c:\temp\themes.manifest -outputresource:MyWPFApp.exe.deploy
   ```

## <a name="sign-the-application-and-deployment-manifests"></a>Подписывание манифестов приложения и развертывания

1. В командной строке выполните следующую команду, чтобы удалить расширение *. deploy* из исполняемого файла в текущем каталоге.

   ```cmd
   ren MyWPFApp.exe.deploy MyWPFApp.exe
   ```

   > [!NOTE]
   > В этом примере предполагается, что только один файл имеет расширение *. deploy* . Убедитесь, что все файлы в этом каталоге переименованы с расширением *deploy* .

2. В командной строке выполните следующую команду, чтобы подписать манифест приложения.

   ```cmd
   mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx
   ```

   > [!NOTE]
   > В этом примере предполагается, что манифест подписан с помощью *PFX* -файла проекта. Если вы не подписываете манифест, можно опустить `-cf` параметр, который используется в этом примере. Если вы подписываете манифест с помощью сертификата, для которого требуется пароль, укажите `-password` параметр ( `For example: mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx - password Password` ).

3. В командной строке выполните следующую команду, чтобы добавить расширение *. deploy* к имени файла, переименованного на предыдущем шаге этой процедуры.

   ```
   ren MyWPFApp.exe MyWPFApp.exe.deploy
   ```

   > [!NOTE]
   > В этом примере предполагается, что расширение файла *. deploy* имеет только один файл. Обязательно переименуйте все файлы в этом каталоге, для которых ранее было было развернуто расширение имени файла *. deploy* .

4. В командной строке выполните следующую команду, чтобы подписать манифест развертывания.

   ```
   mage -u ..\..\MyWPFApp.application -appm MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx
   ```

   > [!NOTE]
   > В этом примере предполагается, что манифест подписан с помощью *PFX* -файла проекта. Если вы не подписываете манифест, можно опустить `-cf` параметр, который используется в этом примере. Если вы подписываете манифест с помощью сертификата, для которого требуется пароль, укажите `-password` параметр, как в следующем примере: `For example: mage -u MyWPFApp.exe.manifest -cf ..\..\..\MyWPFApp_TemporaryKey.pfx - password Password` .

   После выполнения этих действий можно переместить опубликованные файлы в расположение, из которого конечные пользователи должны установить приложение. Если планируется частое обновление решения, эти команды можно переместить в сценарий и запустить скрипт при каждой публикации новой версии.

## <a name="see-also"></a>См. также раздел

- [Устранение неполадок, приводящих к определенным ошибкам в развертываниях ClickOnce](../deployment/troubleshooting-specific-errors-in-clickonce-deployments.md)
- [Общие сведения о визуальных стилях](/windows/desktop/Controls/visual-styles-overview)
- [Включение стилей оформления](/windows/desktop/Controls/cookbook-overview)
- [PowerShell для Командная строка разработчика и разработчиков](../ide/reference/command-prompt-powershell.md)
