---
title: Защита приложений ClickOnce | Документация Майкрософт
description: Узнайте о влиянии ограничений управления доступом для кода в платформа .NET Framework, которые могут ограничить доступ к коду для приложений ClickOnce.
ms.custom: SEO-VS-2020
ms.date: 02/17/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
- C++
helpviewer_keywords:
- Windows applications, ClickOnce security
- ClickOnce deployment, security
- deploying applications, ClickOnce security
ms.assetid: a05b5f2f-d1f2-471a-8096-8b11f7554265
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- multiple
ms.openlocfilehash: aa698fc0ac0e46fa645ede54d6608b79dd031655
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99949666"
---
# <a name="secure-clickonce-applications"></a>Защита приложений ClickOnce
К приложению[!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] могут применяться ограничения управления доступом для кода на платформе .NET Framework, позволяющие ограничить доступ кода к защищенным ресурсам и операциям. Важно понимать влияние управления доступом для кода, чтобы писать приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] соответствующим образом. Для ограничения доступа приложение может использовать зоны с полным или частичным доверием, такие как Интернет и интрасеть.

 Кроме того, ClickOnce использует сертификаты для проверки подлинности издателя приложения, подписи приложения и манифестов развертывания, чтобы удостовериться в том, что файлы не были изменены злоумышленником. Подписывание — это необязательный шаг, который упрощает изменение файлов приложения после создания манифестов. Без подписанных манифестов, однако, трудно гарантировать, что установщик приложения не был изменен злоумышленником (атака "злоумышленник в середине"). По этой причине рекомендуется подписывать манифесты приложений и развертываний для защиты приложений.

## <a name="zones"></a>Зоны
 Для приложений, развертываемых с помощью технологии [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] , ограничен доступ к наборам разрешений и действий, которые определены в зоне безопасности. Зоны безопасности определены в Internet Explorer и берут за основу местоположение приложения. Разрешения по умолчанию, основанные на местоположении развертывания, перечисляются в следующей таблице:

|Расположение развертывания|Зона безопасности|
|-------------------------|-------------------|
|Запуск из Интернета|Зона Интернета|
|Установка из Интернета|Зона Интернета|
|Установка из общего сетевого файлового ресурса|Зона локальной интрасети|
|Установка с компакт-диска|Full Trust|

 Разрешения по умолчанию основываются на местоположении, из которого была развернута исходная версия приложения. Обновления приложения наследуют эти разрешения. Если приложение настроено на проверку обновлений из Интернета или сетевого местоположения, и доступна более новая версия, исходная установка может получить разрешения для зоны Интернета или интрасети вместо разрешений полного доверия. Чтобы запретить вывод запросов, администратор системы может задать политику развертывания ClickOnce, которая определит конкретного издателя приложения в качестве доверенного источника. Для компьютеров, на которых развернута эта политика, разрешения предоставляются автоматически, и пользователям не выводятся запросы. Дополнительные сведения см. в разделе [Общие сведения о развертывании доверенных приложений](../deployment/trusted-application-deployment-overview.md). Чтобы настроить развертывание доверенного приложения, сертификат можно установить для уровня компьютера или предприятия. Дополнительные сведения см. в разделе [How to: Add a Trusted Publisher to a Client Computer for ClickOnce Applications](../deployment/how-to-add-a-trusted-publisher-to-a-client-computer-for-clickonce-applications.md).

## <a name="code-access-security-policies"></a>Политики управления доступом для кода
 Разрешения для приложения определяются параметрами [ \<trustInfo> в элементе element](../deployment/trustinfo-element-clickonce-application.md) манифеста приложения. [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] автоматически создает эти сведения на основе параметров на странице свойств **Безопасность** проекта. Приложению [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] предоставляются только определенные разрешения, которые им запрошены. Например, если там, где для доступа к файлу требуются разрешения полного доверия, приложение запрашивает разрешение на доступ к файлу, ему будет предоставлено только разрешение на доступ к файлу, а не разрешения полного доверия. При разработке приложения [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] необходимо убедиться в запросе только определенных разрешений, которые требуются приложению. В большинстве случаев для ограничения приложения частичным доверием можно использовать зоны Интернета или локальной интрасети. Дополнительные сведения см. [в разделе как задать зону безопасности для приложения ClickOnce](../deployment/how-to-set-a-security-zone-for-a-clickonce-application.md). Если приложению требуются пользовательские разрешения, можно создать пользовательскую зону. Дополнительные сведения см. [в разделе инструкции. Установка пользовательских разрешений для приложения ClickOnce](../deployment/how-to-set-custom-permissions-for-a-clickonce-application.md).

 При включении разрешения, не являющегося частью разрешения, устанавливаемого по умолчанию для зоны, из которой было развернуто приложение, пользователю будет предложено предоставить разрешение во время установки или обновления. Чтобы запретить вывод запросов, администратор системы может задать политику развертывания ClickOnce, которая определит конкретного издателя приложения в качестве доверенного источника. На компьютерах, на которых развернута эта политика, разрешения предоставляются автоматически, и для пользователя не выводятся запросы.

 Ответственность за работу приложения с надлежащими разрешениями лежит на разработчике. Если приложение во время исполнения запрашивает разрешения за пределами зоны, может возникнуть исключение безопасности. [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] позволяет выполнять отладку приложения в целевой зоне безопасности и предоставляет справку по разработке безопасных приложений. Дополнительные сведения см. в разделе [Отладка приложений ClickOnce, использующих System. Deployment. Application](../deployment/debugging-clickonce-applications-that-use-system-deployment-application.md).

 Дополнительные сведения об использовании средств управления доступом для кода и ClickOnce см. в статье [Управление доступом для кода для приложений ClickOnce](../deployment/code-access-security-for-clickonce-applications.md).

## <a name="code-signing-certificates"></a>Сертификаты подписи кода
 Чтобы опубликовать приложение с использованием развертывания [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] , необходимо подписать манифесты приложения и развертывания для приложения парой открытого и закрытого ключа. Средства для подписи манифеста доступны на странице **Подпись** в **конструкторе проектов**. Дополнительные сведения см. в разделе [Signing Page, Project Designer](../ide/reference/signing-page-project-designer.md).

 После подписи манифестов сведения об издателе, основанные на подписи Authenticode, показываются пользователю в диалоговом окне разрешений во время установки, чтобы пользователь мог убедиться, что приложение получено из надежного источника.

 Дополнительные сведения о ClickOnce и сертификатах см. в статье [ClickOnce and Authenticode](../deployment/clickonce-and-authenticode.md).

## <a name="aspnet-form-based-authentication"></a>Проверка подлинности, основанная на форме ASP.NET
 Если требуется контролировать, к каким развертываниям имеет доступ каждый пользователь, не следует включать анонимный доступ к приложениям [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] , развертываемым на веб-сервере. Предпочтительнее разрешить доступ пользователей к установленным развертываниям на основе удостоверения пользователя, используя проверку подлинности Windows.

 [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] не поддерживает проверку подлинности на основе форм ASP.NET, так как она предполагает использование постоянных файлов Cookie; эти файлы представляют угрозу безопасности, поскольку они находятся в кэше Internet Explorer и могут быть объектом вредоносной атаки. Поэтому при развертывании приложений [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] никакие сценарии проверки подлинности, кроме проверки подлинности Windows, не поддерживаются.

## <a name="pass-arguments"></a>Передача аргументов
 Если в приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] передаются аргументы, возникают дополнительные вопросы по безопасности. [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] предоставляет разработчикам возможность передачи строки запроса в приложения, развернутые через Интернет. Строка запроса принимает вид последовательности пар "имя-значение" в конце URL-адреса, используемого для запуска приложения:

 `http://servername.adatum.com/WindowsApp1.application?username=joeuser`

 По умолчанию аргументы строки запроса отключены. Чтобы включить их, для приложения должен быть установлен атрибут `trustUrlParameters` в манифесте развертывания. Это значение может быть установлено из [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] и из MageUI.exe. Подробные инструкции по включению передачи строк запросов см. в разделе [Практическое руководство. Извлечение сведений строки запроса в интернет-приложении ClickOnce](../deployment/how-to-retrieve-query-string-information-in-an-online-clickonce-application.md).

 Никогда не следует передавать аргументы, извлекаемые с помощью строки запроса, в базу данных или командную строку без проверки аргументов с целью убедиться, что они безопасны. Ненадежные аргументы — это аргументы, которые содержат escape-символы базы данных или командной строки, позволяющие злоумышленникам управлять приложением для выполнения произвольных команд.

> [!NOTE]
> Аргументы строки запроса представляют единственный способ передачи аргументов в приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] при запуске. В приложение [!INCLUDE[ndptecclick](../deployment/includes/ndptecclick_md.md)] нельзя передавать аргументы из командной строки.

## <a name="deploying-obfuscated-assemblies"></a>Развертывание замаскированных сборок
 Visual Studio включает в себя бесплатную программу [PreEmptive Protection — Dotfuscator Community](../ide/dotfuscator/index.md), которую можно использовать для защиты приложений ClickOnce с помощью обфускации кода и активных мер по защите.  Дополнительные сведения см. в [разделе по ClickOnce руководства пользователя Dotfuscator Community](https://www.preemptive.com/dotfuscator/ce/docs/help/5.27/advanced_clickonce.html).

## <a name="see-also"></a>См. также раздел
- [Развертывание и безопасность технологии ClickOnce](../deployment/clickonce-security-and-deployment.md)
- [Выбор стратегии развертывания ClickOnce](../deployment/choosing-a-clickonce-deployment-strategy.md)
