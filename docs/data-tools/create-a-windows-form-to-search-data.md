---
title: Создание формы Windows Forms для поиска данных
description: Ознакомьтесь с примером создания формы Windows Forms для поиска данных. Создайте приложение Windows Form, источник данных и форму. Добавление параметризации. Проверьте работу приложения.
ms.custom: SEO-VS-2020
ms.date: 06/07/2021
ms.topic: conceptual
helpviewer_keywords:
- Windows Forms, searching data
- Windows Forms, displaying data
- parameters, displaying filtered data
- data [Visual Studio], parameterizing queries
- data [Visual Studio], searching
ms.assetid: 65ca79a9-7458-466c-af55-978cd24c549e
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- data-storage
ms.openlocfilehash: 2ce9d3eeebf42855ad69f02b2d72330190a2b390
ms.sourcegitcommit: 01a411cd7ae3488b7b979a947bca92fd296a98e9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/09/2021
ms.locfileid: "111761099"
---
# <a name="create-a-windows-form-to-search-data"></a>Создание формы Windows Forms для поиска данных

Довольно распространенным сценарием приложения является отображение выбранных данных на форме. Например, вам может потребоваться отобразить заказы для определенного клиента или сведения о конкретном заказе. В таком сценарии пользователь вводит в форму информацию, после чего выполняется запрос, включающий в себя эти введенные пользователем данные в качестве параметра; таким образом, данные выбираются на основе параметризированного запроса. Запрос возвращает только те данные, которые удовлетворяют введенным пользователем условиям. Это пошаговое руководство показывает, как создать запрос, возвращающий клиентов из определенного города, и изменить пользовательский интерфейс, чтобы пользователи могли ввести название города и нажать кнопку для выполнения запроса.

Использование параметризованных запросов помогает сделать приложение эффективным, так как позволяет базе данных заниматься своей непосредственной задачей — быстрой фильтрацией записей. И наоборот, если запросить всю таблицу базы данных, передать ее по сети и использовать логику приложения для поиска записей, ваше приложение станет медленным и неэффективным.

Можно добавить параметризованные запросы в любой TableAdapter (и элементы управления для приема значений параметров и выполнения запроса) с помощью диалогового окна **Построитель условий поиска** . Откройте диалоговое окно, выбрав команду **Добавить запрос** в меню **Данные** (или на любом смарт-теге адаптера таблицы).

В данном пошаговом руководстве представлены следующие задачи.

- Создание и Настройка источника данных в приложении с помощью мастера **настройки источника данных** .

- Задание типа сброса элементов в окне **Источники данных** .

- Создание отображающих данные элементов управления с помощью перетаскивания элементов из окна **Источники данных** на форму.

- Добавление элементов управления для отображения данных на форме.

- Завершение работы с диалоговым окном **Построитель условий поиска** .

- Ввод параметров в форму и выполнение параметризованного запроса.

> [!NOTE]
> Процедуры, описанные в этой статье, применимы только к проектам платформа .NET Framework Windows Forms, а не к проектам .NET Core Windows Forms.

## <a name="prerequisites"></a>Предварительные требования

Необходимо установить рабочую нагрузку " **Хранение и обработка данных** ". См. раздел [Изменение Visual Studio](../install/modify-visual-studio.md).

В этом пошаговом руководстве используется SQL Server Express LocalDB и образец базы данных Northwind.

1. Если у вас нет SQL Server Express LocalDB, установите его на [странице загрузки SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions-express)или с помощью **Visual Studio Installer**. В **Visual Studio Installer** можно установить SQL Server Express LocalDB как часть рабочей нагрузки **хранения и обработки данных** или как отдельный компонент.

2. Установите учебную базу данных Northwind, выполнив следующие действия.

    1. В Visual Studio откройте окно **Обозреватель объектов SQL Server** . (Обозреватель объектов SQL Server устанавливается как часть рабочей нагрузки **хранения и обработки данных** в **Visual Studio Installer**.) Разверните узел **SQL Server** . Щелкните правой кнопкой мыши экземпляр LocalDB и выберите **создать запрос**.

       Откроется окно редактора запросов.

    2. Скопируйте [скрипт Transact-SQL Northwind](https://github.com/MicrosoftDocs/visualstudio-docs/blob/master/docs/data-tools/samples/northwind.sql?raw=true) в буфер обмена. Этот сценарий T-SQL создает базу данных Northwind с нуля и заполняет ее данными.

    3. Вставьте скрипт T-SQL в редактор запросов, а затем нажмите кнопку **выполнить** .

       По истечении короткого времени выполнение запроса завершается и создается база данных Northwind.

## <a name="create-the-windows-forms-application"></a>Создание приложения Windows Forms

:::moniker range="vs-2017"

Создайте новый проект **Windows Forms приложения (платформа .NET Framework)** для C# или Visual Basic. Присвойте проекту имя **WindowsSearchForm**.

## <a name="create-the-data-source"></a>Создание источника данных

На этом шаге **Мастер настройки источника данных** используется для создания источника данных из базы данных.

1. Чтобы открыть окно **Источники данных** , в меню **данные** выберите команду **отобразить источники данных**.

2. В окне **Источники данных** выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.

3. На странице **Выбор типа источника данных** выберите элемент **База данных** и нажмите **Далее**.

4. На странице **Выбор подключения к базе данных** выполните одно из следующих действий:

    - Если подключение к учебной базе данных Northwind доступно в раскрывающемся списке, то выберите его.

    - Выберите **Новое подключение** для открытия диалогового окна **Добавить/изменить подключение**.

5. Если базе данных требуется пароль, выберите параметр для включения конфиденциальных данных и нажмите кнопку **Далее**.

6. На странице **Сохранение подключения в файле конфигурации приложения** нажмите кнопку **Далее**.

7. Разверните узел **Таблицы** на странице **Выбор объектов базы данных**.

8. Выберите таблицу **Клиенты** и нажмите **Готово**.

     Объект **NorthwindDataSet** добавляется в проект, и таблица **Клиенты** отображается в окне **Источники данных**.

:::moniker-end

:::moniker range=">=vs-2019"

Создайте новый проект **Windows Forms приложения (платформа .NET Framework)** для C# или Visual Basic. Присвойте проекту имя **WindowsSearchForm**.

## <a name="create-the-data-source"></a>Создание источника данных

На этом шаге **Мастер настройки источника данных** используется для создания источника данных из базы данных.

1. Чтобы открыть окно **Источники данных** , используйте быстрый поиск (**CTRL** + **Q**) и найдите **Источники данных**.

1. В окне **Источники данных** выберите **Добавить новый источник данных**, чтобы запустить **Мастер настройки источника данных**.

1. На странице **Выбор типа источника данных** выберите элемент **База данных** и нажмите **Далее**.

1. На экране **Выбор модели базы данных** выберите **набор данных**, а затем нажмите кнопку **Далее**.

1. На странице **Выбор подключения к базе данных** выполните одно из следующих действий:

    - Если подключение к учебной базе данных Northwind доступно в раскрывающемся списке, то выберите его.

    - Выберите **Новое подключение** для открытия диалогового окна **Добавить/изменить подключение**.

1. На странице **Сохранение подключения в файле конфигурации приложения** нажмите кнопку **Далее**.

1. Разверните узел **Таблицы** на странице **Выбор объектов базы данных**.

1. Выберите таблицу **Клиенты** и нажмите **Готово**.

     Объект **NorthwindDataSet** добавляется в проект, и таблица **Клиенты** отображается в окне **Источники данных**.

:::moniker-end

## <a name="create-the-form"></a> Создание формы

Можно создать элементы управления с привязкой к данным, перетащив элементы из окна **Источники данных** на форму:

1. Убедитесь, что конструктор Windows Forms имеет активное фокус, а окно **Источники данных** открыто и закреплено.

1. Разверните узел **Customers** в окне **Источники данных**.

1. Перетащите узел **Клиенты** из окна **Источники данных** на свою форму.

     На форме появляются <xref:System.Windows.Forms.DataGridView> и полоса инструментов (<xref:System.Windows.Forms.BindingNavigator>) для перемещения по записям. В области компонентов появляется [NorthwindDataSet](../data-tools/dataset-tools-in-visual-studio.md), CustomersTableAdapter, <xref:System.Windows.Forms.BindingSource> и <xref:System.Windows.Forms.BindingNavigator>.

## <a name="add-parameterization-search-functionality-to-the-query"></a>Добавление параметризации (функции поиска) в запрос

Предложение WHERE можно добавить в исходный запрос с помощью диалогового окна **Построитель условий поиска** :

1. Непосредственно под областью конструктора формы нажмите кнопку **customersTableAdapter** , а затем в окне **свойства** выберите **Добавить запрос...**.

2. Введите **филлбиЦити** в области **имя нового запроса** в диалоговом окне **Построитель условий поиска** .

3. Добавьте `WHERE City = @City` в запрос в области **Текст запроса**.

     Запрос должен выглядеть примерно следующим образом:

     ```sql
     SELECT CustomerID, CompanyName, ContactName, ContactTitle,
          Address, City, Region, PostalCode, Country, Phone, Fax
     FROM Customers
     WHERE City = @City
     ```

    > [!NOTE]
    > Источники данных доступа и OLE DB используют вопросительный знак ("?") для обозначения параметров, поэтому предложение WHERE будет выглядеть следующим образом: `WHERE City = ?` .

4. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Построитель условий поиска**.

     На форму добавляется **FillByCityToolStrip**.

## <a name="test-the-application"></a>Тестирование приложения

При запуске приложения открывается форма, и она готова принять параметр в качестве входных данных:

1. Нажмите клавишу **F5** для запуска приложения.

2. Введите **Лондон** в текстовом поле **Город** и щелкните **FillByCity**.

     Сетка данных заполняется клиентами, которые удовлетворяют критериям. В этом примере сетка данных отображает только клиентов, для которых в столбце **Город** задано значение **Лондон**.

## <a name="next-steps"></a>Следующие шаги

В зависимости от требований приложения существуют несколько шагов, которые, возможно, потребуется выполнить после создания параметризованной формы. Ниже приводится перечень рекомендаций, позволяющих улучшить полученный результат.

- Добавление элементов управления, отображающих связанные данные. Дополнительные сведения см. [в разделе связи в наборах данных](relationships-in-datasets.md).

- Изменение набора данных для добавления или удаления объектов базы данных. Дополнительные сведения см. в разделе, посвященном [созданию и настройке наборов данных](../data-tools/create-and-configure-datasets-in-visual-studio.md).

## <a name="see-also"></a>См. также раздел

- [Привязка элементов управления Windows Forms к данным в Visual Studio](../data-tools/bind-windows-forms-controls-to-data-in-visual-studio.md)
