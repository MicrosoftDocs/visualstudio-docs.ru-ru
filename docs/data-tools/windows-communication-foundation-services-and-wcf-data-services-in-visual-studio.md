---
title: Службы Windows Communication Foundation и WCF Data Services
description: Изучите службы Windows Communication Foundation (WCF) и WCF Data Services в Visual Studio, чтобы вы могли создавать распределенные приложения.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: overview
dev_langs:
- VB
- CSharp
helpviewer_keywords:
- services, WCF Data
- WCF services, binding to
- WCF services, asynchronous service methods
- service references [Visual Studio]
- WCF Data Services
- asynchronous calls
- service references [Visual Studio], type sharing
- endpoints [WCF]
- asynchronous service methods
- service references [Visual Studio] endpoints
- WCF services, type sharing
- Windows Communication Foundation, in Visual Studio
- services, WCF
- WCF service, Visual Studio
- data services, WCF
- services, in Visual Studio
- data binding [Visual Studio], WCF
- service endpoints [Visual Studio]
- service references [Visual Studio], asynchronous calls
- services, Windows Communication Foundation
- type sharing in WCF services
- WCF services, endpoints
- service method, called asynchronously[Visual Studio]
ms.assetid: d56f12cb-e139-4fec-b3e4-488383356642
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- data-storage
ms.openlocfilehash: 45ff4336859fe0294232e9ca1d99513665d8e975
ms.sourcegitcommit: 80fc9a72e9a1aba2d417dbfee997fab013fc36ac
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106216479"
---
# <a name="windows-communication-foundation-services-and-wcf-data-services-in-visual-studio"></a>Службы Windows Communication Foundation и службы данных WCF в Visual Studio

В Visual Studio имеются инструменты для работы с Windows Communication Foundation (WCF) и WCF Data Services, технологиями Майкрософт для создания распределенных приложений. В этом разделе представлены общие сведения о службах с точки зрения Visual Studio. Полную документацию можно найти на странице [WCF Data Services 4.5](/dotnet/framework/data/wcf/index).

## <a name="what-is-wcf"></a>Что такое WCF

Windows Communication Foundation (WCF) — это унифицированная платформа для создания безопасных, надежных, транзакционных и функционально совместимых распределенных приложений. Она пришла на смену старым технологиям межпроцессного взаимодействия, таким как веб-службы ASMX, .NET Remoting, Enterprise Services (DCOM) и MSMQ. WCF объединяет функциональные возможности всех этих технологий в рамках единой модели программирования. Это упрощает разработку распределенных приложений.

### <a name="what-are-wcf-data-services"></a>Что такое WCF Data Services

WCF Data Services — это реализация стандарта Open Data Protocol (OData).  В WCF Data Services можно предоставлять табличные данные в виде набора REST API, что позволяет возвращать данные с помощью стандартных HTTP-команд, таких как GET, POST, PUT и DELETE. На стороне сервера WCF Data Services заменяет [веб-API ASP.NET](https://dotnet.microsoft.com/apps/aspnet/apis) для создания новых служб OData. Клиентская библиотека WCF Data Services по-прежнему рекомендуется для использования служб OData в приложении .NET из Visual Studio (**Проект** > **Добавить ссылку на службу**). Дополнительные сведения см. в разделе [Службы данных WCF 4.5](/dotnet/framework/data/wcf).

### <a name="wcf-programming-model"></a>Модель программирования WCF

Модель программирования WCF построена на взаимодействии между двумя сущностями — службой WCF и клиентом WCF. Модель программирования инкапсулирована в пространстве имен <xref:System.ServiceModel> в .NET.

### <a name="wcf-service"></a>Служба WCF

Служба WCF построена на интерфейсе, который определяет контракт между службой и клиентом. Он помечается атрибутом <xref:System.ServiceModel.ServiceContractAttribute>, как показано в следующем коде.

:::code language="csharp" source="../snippets/csharp/VS_Snippets_VBCSharp/wcfwalkthrough/cs/iservice1.cs" id="Snippet6":::
:::code language="vb" source="../snippets/visualbasic/VS_Snippets_VBCSharp/wcfwalkthrough/vb/iservice1.vb" id="Snippet6":::

Вы определяете функции или методы, предоставляемые службой WCF, помечая их атрибутом <xref:System.ServiceModel.OperationContractAttribute>.

:::code language="csharp" source="../snippets/csharp/VS_Snippets_VBCSharp/wcfwalkthrough/cs/iservice1.cs" id="Snippet1":::
:::code language="vb" source="../snippets/visualbasic/VS_Snippets_VBCSharp/wcfwalkthrough/vb/iservice1.vb" id="Snippet1":::

Кроме того, вы можете предоставить сериализованные данные, пометив составной тип атрибутом <xref:System.Runtime.Serialization.DataContractAttribute>. Это позволяет выполнять привязку данных в клиенте.

После определения интерфейса и его методов они инкапсулируются в класс, реализующий интерфейс. Один класс службы WCF может реализовывать несколько контрактов службы.

Служба WCF предоставляется для использования через так называемую *конечную точку*. Конечная точка обеспечивает единственный способ связи со службой; нельзя получить доступ к этой службе, используя прямую ссылку, как это делается с другими классами.

Конечная точка состоит из адреса, привязки и контракта. Адрес определяет, где находится служба; это может быть URL-адрес, FTP-адрес, сетевой или локальный путь. Привязка определяет способ взаимодействия со службой. Привязки WCF предоставляют универсальную модель для указания протокола, такого как HTTP или FTP, механизма безопасности, такого как проверка подлинности Windows или имена и пароли пользователей, и многого другого. Контракт включает операции, предоставляемые классом службы WCF.

Для одной службы WCF могут предоставляться несколько конечных точек. Это позволяет различным клиентам взаимодействовать с одной и той же службой разными способами. Например, банковская служба может предоставлять одну конечную точку для сотрудников, а другую — для внешних клиентов. При этом каждая из конечных точек использует свой адрес, привязку и (или) контракт.

### <a name="wcf-client"></a>клиент WCF

Клиент WCF включает в себя *прокси-сервер*, который позволяет приложению взаимодействовать со службой WCF, и конечную точку, которая соответствует конечной точке, определенной для службы. Прокси-сервер создается на стороне клиента в файле *app.config* и содержит информацию о типах и методах, предоставляемых службой. Для служб, которые предоставляют несколько конечных точек, клиент может выбрать ту, которая лучше всего соответствует его потребностям, например для взаимодействия по протоколу HTTP и использования проверки подлинности Windows.

После создания клиента WCF вы можете ссылаться на эту службу в своем коде так же, как на любой другой объект. Например, чтобы вызвать метод `GetData`, показанный ранее, вы должны написать код, похожий на следующий:

:::code language="csharp" source="../snippets/csharp/VS_Snippets_VBCSharp/wcfwalkthrough/cs/form1.cs" id="Snippet3":::
:::code language="vb" source="../snippets/visualbasic/VS_Snippets_VBCSharp/wcfwalkthrough/vb/form1.vb" id="Snippet3":::

## <a name="wcf-tools-in-visual-studio"></a>Инструменты WCF в Visual Studio

Visual Studio предоставляет инструменты, которые помогут вам создавать как службы, так и клиенты WCF. Пошаговое руководство, демонстрирующее эти средства, см. в разделе [Пошаговое руководство: создание простой службы WCF в Windows Forms](../data-tools/walkthrough-creating-a-simple-wcf-service-in-windows-forms.md).

### <a name="create-and-test-wcf-services"></a>Создание и тестирование служб WCF

Вы можете использовать шаблоны WCF в Visual Studio в качестве основы для быстрого создания собственной службы. Затем с помощью WCF Service Auto Host и тестового клиента WCF можно выполнить отладку и тестирование службы. Оба этих инструмента обеспечивают быстрый и удобный цикл отладки и тестирования и устраняют необходимость фиксации модели размещения на ранней стадии.

#### <a name="wcf-templates"></a>Шаблоны WCF

Шаблоны WCF в Visual Studio предоставляют базовую структуру классов для разработки служб. Несколько шаблонов WCF доступно в диалоговом окне **Добавление нового проекта**. К ним относятся проекты lLibrary службы WCF, веб-сайты служб WCF и шаблоны элементов службы WCF.

При выборе шаблона добавляются файлы для контракта службы, реализации службы и конфигурации службы. Все необходимые атрибуты уже добавлены, создан простой тип службы "Hello World", и вам не нужно писать код. Вы, конечно, захотите добавить код, чтобы создать функции и методы для вашей реальной службы, но шаблоны обеспечивают основу.

Дополнительные сведения о шаблонах WCF см. в разделе [Шаблоны WCF в Visual Studio](/dotnet/framework/wcf/wcf-vs-templates).

#### <a name="wcf-service-host"></a>Узел службы WCF

Когда вы запускаете отладчик Visual Studio (нажав клавишу **F5**) для проекта службы WCF, автоматически запускается инструмент "Узел службы WCF" для локального размещения службы. Узел службы WCF выполняет перечисление служб в проекте службы WCF, загружает конфигурацию проекта и создает экземпляр узла для каждой найденной службы.

С помощью узла службы WCF можно тестировать службу WCF без создания дополнительного кода или фиксации в конкретном узле во время разработки.

Дополнительные сведения об узле службы WCF см. в разделе [Узел службы WCF (WcfSvcHost.exe)](/dotnet/framework/wcf/wcf-service-host-wcfsvchost-exe).

#### <a name="wcf-test-client"></a>Тестовый клиент WCF

Тестовый клиент WCF представляет собой инструмент, позволяющий вводить тестовые параметры, отправлять их в службу WCF и просматривать ответную реакцию службы. В сочетании с узлом службы WCF он обеспечивает удобный интерфейс тестирования службы. Этот инструмент находится в папке *%ProgramFiles(x86)%\Microsoft Visual Studio\2017\Enterprise\Common7\IDE*.

Когда вы нажимаете клавишу **F5** для отладки проекта службы WCF, открывается тестовый клиент WCF, который отображает список конечных точек службы, заданных в файле конфигурации. Вы можете протестировать эти параметры и запустить службу и повторять этот процесс для последовательного тестирования и проверки службы.

Дополнительные сведения о тестовом клиенте WCF см. в разделе [Тестовый клиент WCF (WcfTestClient.exe)](/dotnet/framework/wcf/wcf-test-client-wcftestclient-exe).

### <a name="accessing-wcf-services-in-visual-studio"></a>Доступ к службам данных WCF в Visual Studio

Visual Studio упрощает задачу создания клиентов WCF, автоматически создавая прокси-сервер и конечную точку для служб, добавленных в диалоговом окне **Добавление ссылки на службу**. Все необходимые сведения конфигурации добавляются в файл *app.config*. В большинстве случаев все, что вам нужно сделать, это создать экземпляр службы, чтобы использовать его.

В диалоговом окне **Добавление ссылки на службу** можно ввести адрес для службы или выполнить поиск службы, которая определена в вашем решении. Это диалоговое окно возвращает список служб и действий, которые они предоставляют. Оно также позволяет определить пространство имен, по которому вы будете ссылаться на службы в коде.

Диалоговое окно **Настройка ссылок на службу** позволяет настраивать конфигурацию для службы. Вы можете изменить адрес службы, задать уровень доступа, асинхронное поведение и типы контрактов сообщений, а также настроить повторное использование типов.

## <a name="how-to-select-a-service-endpoint"></a>Практическое руководство. Выбор конечной точки службы

Некоторые службы Windows Communication Foundation (WCF) предоставляют несколько конечных точек, через которые клиент может взаимодействовать со службой. Например, служба может предоставлять одну конечную точку, которая использует привязку HTTP и проверку подлинности с помощью имени и пароля пользователя, и вторую конечную точку, которая использует FTP и проверку подлинности Windows. Первую конечную точку могут использовать приложения, обращающиеся к службе через брандмауэр, а вторая может использоваться в интрасети.

В таком случае вы можете указать `endpointConfigurationName` в качестве параметра конструктора для ссылки на службу.

[!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]

### <a name="to-select-a-service-endpoint"></a>Выбор конечной точки службы

1. Добавьте ссылку на службу WCF, щелкнув правой кнопкой мыши узел проекта в **обозревателе решений** и выбрав **Добавить ссылку на службу**.

2. В редакторе кода добавьте конструктор для ссылки на службу:

    ```vb
    Dim proxy As New ServiceReference.Service1Client(
    ```

    ```csharp
    ServiceReference.Service1Client proxy = new ServiceReference.Service1Client(
    ```

    > [!NOTE]
    > Замените *ServiceReference* на пространство имен для ссылки на службу и замените *Service1Client* на имя службы.

3. В списке IntelliSense отображаются перегрузки для конструктора. Выберите перегрузку `endpointConfigurationName As String`.

4. После перегрузки введите `=` *ConfigurationName*, где *ConfigurationName* — имя конечной точки, которую вы хотите использовать.

    > [!NOTE]
    > Если вам не известны имена доступных конечных точек, их можно найти в файле *app.config*.

### <a name="to-find-the-available-endpoints-for-a-wcf-service"></a>Поиск доступных конечных точек для службы WCF

1. В **Обозревателе решений** щелкните правой кнопкой мыши файл **app.config** для проекта, который содержит ссылку на службу, а затем нажмите **Открыть**. Этот файл откроется в редакторе кода.

2. Выполните поиск по тегу `<Client>` в этом файле.

3. Под тегом `<Client>` найдите тег, который начинается с `<Endpoint>`.

     Если ссылка на службу предоставляет несколько конечных точек, будет два или более тега `<Endpoint`.

4. Внутри тега `<EndPoint>` находится параметр `name="`*SomeService*`"` (где *SomeService* представляет имя конечной точки). Это имя конечной точки, которое можно передать в перегрузку `endpointConfigurationName As String` конструктора для ссылки на службу.

## <a name="how-to-call-a-service-method-asynchronously"></a>Практическое руководство. Асинхронный вызов метода службы

Большинство методов в службах Windows Communication Foundation (WCF) можно вызывать синхронно или асинхронно. Асинхронный вызов метода позволяет вашему приложению продолжать работу, пока метод вызывается, когда используется медленное соединение.

Когда в проект добавляется ссылка на службу, по умолчанию она настраивается для синхронного вызова методов. Вы можете изменить это поведение и задать асинхронный вызов методов, изменив соответствующий параметр в диалоговом окне **Настройка ссылки на службу**.

> [!NOTE]
> Этот параметр устанавливается отдельно для каждой службы. Если один метод для службы вызывается асинхронно, то все методы должны вызываться асинхронно.

[!INCLUDE[note_settings_general](../data-tools/includes/note_settings_general_md.md)]

### <a name="to-call-a-service-method-asynchronously"></a>Асинхронный вызов метода службы

1. В **Обозревателе решений** нажмите ссылку на службу.

2. В меню **Проект** выберите **Настроить ссылку на службу**.

3. В диалоговом окне **Настройка ссылки на службу** установите флажок **Создавать асинхронные операции**.

## <a name="how-to-bind-data-returned-by-a-service"></a>Практическое руководство. Привязка данных, возвращаемых службой

Вы можете привязать к элементу управления данные, возвращаемые службой Windows Communication Foundation (WCF), так же, как выполняется привязка к элементу управления любого другого источника данных. Если вы добавляете ссылку на службу WCF, и эта служба содержит составные типы, возвращающие данные, они автоматически добавляются в окно **Источники данных**.

### <a name="to-bind-a-control-to-single-data-field-returned-by-a-wcf-service"></a>Привязка элемента управления к одному полю данных, возвращаемому службой WCF

1. В меню **Данные** выберите команду **Показать источники данных**.

   Открывается окно **Источники данных**.

2. В окне **Источники данных** разверните узел для вашей ссылки на службу. Появятся все составные типы, возвращаемые службой.

3. Разверните узел для типа. Появятся поля данных для этого типа.

4. Выберите поле и щелкните стрелку раскрывающегося списка, чтобы вывести список элементов управления, доступных для этого типа данных.

5. Щелкните тип элемента управления, к которому вы хотите привязать данные.

6. Перетащите это поле в форму. Элемент управления будет добавлен в форму вместе с компонентами <xref:System.Windows.Forms.BindingSource> и <xref:System.Windows.Forms.BindingNavigator>.

7. Повторите шаги с 4 по 6 для всех остальных полей, которые хотите привязать.

### <a name="to-bind-a-control-to-composite-type-returned-by-a-wcf-service"></a>Привязка элемента управления к составному типу, возвращаемому службой WCF

1. В меню **Данные** выберите пункт **Показать источники данных**. Открывается окно **Источники данных**.

2. В окне **Источники данных** разверните узел для вашей ссылки на службу. Появятся все составные типы, возвращаемые службой.

3. Выберите узел для типа и щелкните стрелку раскрывающегося списка, чтобы вывести список доступных вариантов.

4. Щелкните **DataGridView**, чтобы отобразить данные в сетке, или **Подробности**, чтобы отобразить данные в отдельных элементах управления.

5. Перетащите узел в форму. Элементы управления будут добавлены в форму вместе с компонентами <xref:System.Windows.Forms.BindingSource> и <xref:System.Windows.Forms.BindingNavigator>.

## <a name="how-to-configure-a-service-to-reuse-existing-types"></a>Практическое руководство. Настройка службы для повторного использования существующих типов

При добавлении в проект ссылки на службу все типы, определенные в службе, создаются в локальном проекте. В результате во многих случаях создаются дубликаты типов, когда служба использует общие типы .NET или когда типы определены в общей библиотеке.

Для устранения этой проблемы типы в указанных сборках по умолчанию являются общими. Если вы хотите отключить совместное использование типов для одной или нескольких сборок, это можно сделать в диалоговом окне **Настройка ссылок на службы**.

### <a name="to-disable-type-sharing-in-a-single-assembly"></a>Отключение совместного использования типов в одной сборке

1. В **Обозревателе решений** нажмите ссылку на службу.

2. В меню **Проект** выберите **Настроить ссылку на службу**.

3. В диалоговом окне **Настройка ссылок на службы** установите флажок **Повторно использовать типы в указанных сборках, на которые есть ссылки**.

4. Установите этот флажок для каждой сборки, в которой вы хотите включить совместное использование типов. Чтобы отключить совместное использование типов для сборки, снимите этот флажок.

### <a name="to-disable-type-sharing-in-all-assemblies"></a>Отключение совместного использования типов во всех сборках

1. В **Обозревателе решений** нажмите ссылку на службу.

2. В меню **Проект** выберите **Настроить ссылку на службу**.

3. В диалоговом окне **Настройка ссылок на службы** снимите флажок **Повторно использовать типы в указанных сборках, на которые есть ссылки**.

## <a name="related-topics"></a>См. также

| Заголовок | Описание |
| - | - |
| [Пошаговое руководство. Создание простой службы WCF в Windows Forms](../data-tools/walkthrough-creating-a-simple-wcf-service-in-windows-forms.md) | Пошаговая демонстрация создания и использования служб WCF в Visual Studio. |
| [Пошаговое руководство: создание службы данных WCF с помощью WPF и Entity Framework](../data-tools/walkthrough-creating-a-wcf-data-service-with-wpf-and-entity-framework.md) | Пошаговая демонстрация создания и использования WCF Data Services в Visual Studio. |
| [Использование средств разработки WCF](/dotnet/framework/wcf/using-the-wcf-development-tools) | Обсуждение создания и тестирования служб WCF в Visual Studio. |
| | [Практическое руководство. Добавление, обновление или удаление ссылки на службу данных WCF](../data-tools/how-to-add-update-or-remove-a-wcf-data-service-reference.md) |
| [Диагностика ссылок на службы](../data-tools/troubleshooting-service-references.md) | Некоторые распространенные ошибки, которые могут возникать в ссылках на службы, и способы их предотвращения. |
| [Отладка служб WCF](../debugger/debugging-wcf-services.md) | Описание распространенных проблем и методов отладки, с которыми вы можете столкнуться при отладке служб WCF. |
| [Пошаговое руководство: создание n-уровневого приложения для работы с данными](../data-tools/walkthrough-creating-an-n-tier-data-application.md) | Содержит пошаговые инструкции по созданию типизированного набора данных и разделения кода адаптера таблицы и набора данных на несколько проектов. |
| [Настроить ссылку на службу - диалоговое окно](../data-tools/configure-service-reference-dialog-box.md) | Описание элементов пользовательского интерфейса в диалоговом окне **Настройка ссылки на службу**. |

## <a name="reference"></a>Справочник

- <xref:System.ServiceModel>
- <xref:System.Data.Services>

## <a name="see-also"></a>См. также

- [Visual Studio Data Tools для .NET](../data-tools/visual-studio-data-tools-for-dotnet.md)
