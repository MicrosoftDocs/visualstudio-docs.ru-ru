---
title: Создание простого приложения для работы с данными с помощью ADO.NET
description: Узнайте, как создать простое приложение форм для данных с помощью Windows Forms и ADO.NET в Visual Studio.
ms.custom: SEO-VS-2020
ms.date: 08/23/2017
ms.topic: conceptual
dev_langs:
- VB
- CSharp
ms.assetid: 2222841f-e443-4a3d-8c70-4506aa905193
author: ghogen
ms.author: ghogen
manager: jmartens
ms.workload:
- data-storage
ms.openlocfilehash: c499e36b7ee6bb15980fe89c6185a105681d4d05
ms.sourcegitcommit: 80fc9a72e9a1aba2d417dbfee997fab013fc36ac
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/02/2021
ms.locfileid: "106216505"
---
# <a name="create-a-simple-data-application-by-using-adonet"></a>Создание простого приложения для работы с данными с помощью ADO.NET

При создании приложения, которое работает с данными в базе данных, необходимо выполнить такие основные задачи, как определение строк подключения, вставка данных и выполнение хранимых процедур. В этом разделе вы узнаете, как взаимодействовать с базой данных из простого Windows Forms приложения "формы по данным" с помощью Visual C#, Visual Basic и ADO.NET.  Все технологии данных .NET, в том числе наборы данных, LINQ to SQL и Entity Framework, в конечном итоге выполняют шаги, которые очень похожи на те, которые приведены в этой статье.

В этой статье демонстрируется простой способ быстрого получения данных из базы данных. Если приложению необходимо изменить данные с помощью нетривиальных способов и обновить базу данных, следует рассмотреть возможность использования Entity Framework и привязки данных для автоматической синхронизации элементов управления пользовательского интерфейса с изменениями в базовых данных.

> [!IMPORTANT]
> С целью упрощения код не включает обработку исключений для выполнения в рабочей среде.

## <a name="prerequisites"></a>Предварительные требования

Для создания приложения вам потребуются следующие компоненты.

- приведенному.

- SQL Server Express LocalDB. Если у вас нет SQL Server Express LocalDB, его можно установить на [странице загрузки SQL Server Express](https://www.microsoft.com/sql-server/sql-server-editions-express).

В этом разделе предполагается, что вы знакомы с базовой функциональностью интегрированной среды разработки Visual Studio и можете создать Windows Forms приложение, добавить формы в проект, поместить кнопки и другие элементы управления в формы, задать свойства элементов управления и создать код для простых событий. Если вы не знакомы с этими задачами, мы рекомендуем выполнить инструкции по началу [работы с Visual C# и Visual Basic](../ide/quickstart-visual-basic-console.md) , прежде чем приступать к этому пошаговому руководству.

## <a name="set-up-the-sample-database"></a>Настройка образца базы данных

Создайте образец базы данных, выполнив следующие действия.

1. В Visual Studio откройте окно **Обозреватель сервера** .

2. Щелкните правой кнопкой мыши **подключения к данным** и выберите команду **создать новую базу данных SQL Server**.

3. В текстовом поле **имя сервера** введите **(LocalDB) \mssqllocaldb**.

4. В текстовом поле **имя новой базы данных** введите **Sales**, а затем нажмите кнопку **ОК**.

     Пустая база данных **Sales** создается и добавляется в узел подключения к данным в обозреватель сервера.

5. Щелкните правой кнопкой мыши подключение к данным о **продажах** и выберите **создать запрос**.

     Откроется окно редактора запросов.

6. Скопируйте [скрипт Transact-SQL Sales](https://github.com/MicrosoftDocs/visualstudio-docs/raw/master/docs/data-tools/samples/sales.sql) в буфер обмена.

7. Вставьте скрипт T-SQL в редактор запросов, а затем нажмите кнопку **выполнить** .

     По истечении короткого времени выполнение запроса завершается и создаются объекты базы данных. База данных содержит две таблицы: Customer и Orders. Эти таблицы изначально не содержат данных, но их можно добавить при запуске создаваемого приложения. База данных также содержит четыре простые хранимые процедуры.

## <a name="create-the-forms-and-add-controls"></a>Создание форм и добавление элементов управления

1. Создайте проект для приложения Windows Forms и назовите его **SimpleDataApp**.

    Visual Studio создает проект и несколько файлов, включая пустую форму Windows Forms с именем **Form1**.

2. Добавьте две формы Windows Forms в проект, чтобы он включал три формы, и назначьте им следующие имена:

   - **Навигация**

   - **NewCustomer**

   - **FillOrCancel**

3. Для каждой формы добавьте текстовые поля, кнопки и другие элементы управления, которые отображаются на рисунках ниже. Для каждого элемента управления задайте свойства, указанные в таблицах.

   > [!NOTE]
   > Элементы управления "группа" и "надпись" обеспечивают большую ясность, но не используются в коде.

   **Форма навигации**

   ![Диалоговое окно "Навигация"](../data-tools/media/simpleappnav.png)

|Элементы управления формы навигации|Свойства|
| - |----------------|
|Кнопка|Name = btnGoToAdd|
|Кнопка|Name = btnGoToFillOrCancel|
|Кнопка|Name = btnExit|

**Форма NewCustomer**

![Добавление нового заказчика и размещение заказа](../data-tools/media/simpleappnewcust.png)

|Элементы управления формы NewCustomer|Свойства|
| - |----------------|
|TextBox|Name = txtCustomerName|
|TextBox|Name = txtCustomerID<br /><br /> Readonly = True|
|Кнопка|Name = btnCreateAccount|
|NumericUpDown|DecimalPlaces = 0<br /><br /> Maximum = 5000<br /><br /> Name = numOrderAmount|
|DateTimePicker|Format = Short<br /><br /> Name = dtpOrderDate|
|Кнопка|Name = btnPlaceOrder|
|Кнопка|Name = btnAddAnotherAccount|
|Кнопка|Name = btnAddFinish|

**Форма FillOrCancel**

![заполнение или отмена заказов](../data-tools/media/simpleappcancelfill.png)

|Элементы управления формы FillOrCancel|Свойства|
| - |----------------|
|TextBox|Name = txtOrderID|
|Кнопка|Name = btnFindByOrderID|
|DateTimePicker|Format = Short<br /><br /> Name = dtpFillDate|
|DataGridView|Name = dgvCustomerOrders<br /><br /> Readonly = True<br /><br /> RowHeadersVisible = False|
|Кнопка|Name = btnCancelOrder|
|Кнопка|Name = btnFillOrder|
|Кнопка|Name = btnFinishUpdates|

## <a name="store-the-connection-string"></a>Сохранение строки подключения
Когда приложение пытается открыть подключение к базе данных, оно должно иметь доступ к строке подключения. Чтобы не вводить строку вручную в каждой форме, сохраните строку в файле *App.config* в проекте и создайте метод, возвращающий строку при вызове метода из любой формы в приложении.

Строку подключения можно найти, щелкнув правой кнопкой мыши подключение данных о **продажах** в **Обозреватель сервера** и выбрав **Свойства**. Найдите свойство **ConnectionString** , а затем с помощью **клавиш CTRL** + **A**, **CTRL** + **C** выберите и скопируйте строку в буфер обмена.

1. Если вы используете C#, в **Обозреватель решений** разверните узел **свойства** в проекте, а затем откройте файл **Settings. Settings** .
    Если вы используете Visual Basic, в **Обозреватель решений** выберите пункт **Показывать все файлы**, разверните узел **Мой проект** , а затем откройте файл **Settings. Settings** .

2. В столбце **имя** введите `connString` .

3. В списке **тип** выберите **(строка подключения)**.

4. В списке **область** выберите **приложение**.

5. В столбце **значение** введите строку подключения (без кавычек), а затем сохраните изменения.

> [!NOTE]
> В реальных приложениях строку подключения следует хранить безопасно, как описано в разделе [строки подключения и файлы конфигурации](/dotnet/framework/data/adonet/connection-strings-and-configuration-files).

## <a name="write-the-code-for-the-forms"></a>Написание кода для форм

Этот раздел содержит краткие обзоры того, что делает каждая форма. Он также предоставляет код, определяющий базовую логику при нажатии кнопки на форме.

### <a name="navigation-form"></a>Форма навигации

Форма навигации открывается при запуске приложения. Кнопка **Добавить учетную запись** открывает форму NewCustomer. Кнопка **Выполнение или отмена заказов** открывает форму FillOrCancel. Кнопка **Выход** закрывает приложение.

#### <a name="make-the-navigation-form-the-startup-form"></a>Преобразование формы навигации в начальную форму

При использовании C# в **обозревателе решений** откройте файл **Program.cs** и измените строку `Application.Run` на следующую: `Application.Run(new Navigation());`

Если вы используете Visual Basic, в **Обозреватель решений** откройте окно **свойства** , перейдите на вкладку **приложение** и выберите **симпледатаапп. Navigation** в списке **начальных форм** .

#### <a name="create-auto-generated-event-handlers"></a>Создание автоматически создаваемых обработчиков событий

Дважды щелкните три кнопки в форме навигации, чтобы создать пустые методы обработчика событий. При двойном щелчке кнопки также добавляется автоматически созданный код в файл кода конструктора, который позволяет нажать кнопку для вызова события.

#### <a name="add-code-for-the-navigation-form-logic"></a>Добавление кода для логики формы навигации

На странице кода для формы навигации заполните основные тексты методов для трех обработчиков событий нажатия кнопки, как показано в следующем коде.

:::code language="csharp" source="../data-tools/codesnippet/CSharp/SimpleDataApp/Navigation.cs" id="Snippet1":::
:::code language="vb" source="../data-tools/codesnippet/VisualBasic/SimpleDataApp/Navigation.vb" id="Snippet1":::

### <a name="newcustomer-form"></a>Форма NewCustomer

Если ввести имя клиента, а затем нажать кнопку **создать учетную запись** , форма newCustomer создает учетную запись клиента, а SQL Server ВОЗВРАЩАЕТ значение идентификатора в качестве нового идентификатора клиента. Затем можно разместить заказ для новой учетной записи, указав сумму и дату заказа и нажав кнопку **поместить порядок** .

#### <a name="create-auto-generated-event-handlers"></a>Создание автоматически создаваемых обработчиков событий

Создайте пустой обработчик событий щелчка для каждой кнопки в форме NewCustomer, дважды щелкнув каждую из четырех кнопок. При двойном щелчке кнопки также добавляется автоматически созданный код в файл кода конструктора, который позволяет нажать кнопку для вызова события.

#### <a name="add-code-for-the-newcustomer-form-logic"></a>Добавление кода для логики формы NewCustomer

Чтобы завершить логику формы NewCustomer, выполните следующие действия.

1. Перенесите `System.Data.SqlClient` пространство имен в область, чтобы не указывать полные имена его членов.

     ```csharp
     using System.Data.SqlClient;
     ```

     ```vb
     Imports System.Data.SqlClient
     ```

2. Добавьте в класс некоторые переменные и вспомогательные методы, как показано в следующем коде.

     :::code language="csharp" source="../data-tools/codesnippet/CSharp/SimpleDataApp/NewCustomer.cs" id="Snippet1":::
     :::code language="vb" source="../data-tools/codesnippet/VisualBasic/SimpleDataApp/NewCustomer.vb" id="Snippet1":::

3. Заполните основные тексты методов для четырех обработчиков событий нажатия кнопки, как показано в следующем коде.

     :::code language="csharp" source="../data-tools/codesnippet/CSharp/SimpleDataApp/NewCustomer.cs" id="Snippet2":::
     :::code language="vb" source="../data-tools/codesnippet/VisualBasic/SimpleDataApp/NewCustomer.vb" id="Snippet2":::

### <a name="fillorcancel-form"></a>Форма FillOrCancel

Форма Филлорканцел запускает запрос для возврата заказа при вводе идентификатора заказа и нажатия кнопки **найти заказ** . Возвращенная строка отображается в сетке данных только для чтения. Можно пометить заказ как отмененный (X), если нажать кнопку **отменить заказ** или пометить заказ как заполненный (F), если нажать кнопку **заполнить заказ** . Если нажать кнопку **найти порядок** еще раз, появится обновленная строка.

#### <a name="create-auto-generated-event-handlers"></a>Создание автоматически создаваемых обработчиков событий

Создайте пустые обработчики событий щелчка для четырех кнопок в форме Филлорканцел, дважды щелкнув кнопки. При двойном щелчке кнопки также добавляется автоматически созданный код в файл кода конструктора, который позволяет нажать кнопку для вызова события.

#### <a name="add-code-for-the-fillorcancel-form-logic"></a>Добавление кода для логики формы Филлорканцел

Чтобы завершить логику формы Филлорканцел, выполните следующие действия.

1. Перенесите следующие два пространства имен в область, чтобы не указывать полные имена их членов.

     ```csharp
     using System.Data.SqlClient;
     using System.Text.RegularExpressions;
     ```

     ```vb
     Imports System.Data.SqlClient
     Imports System.Text.RegularExpressions
     ```

2. Добавьте в класс переменную и вспомогательный метод, как показано в следующем коде.

     :::code language="csharp" source="../data-tools/codesnippet/CSharp/SimpleDataApp/FillOrCancel.cs" id="Snippet1":::
     :::code language="vb" source="../data-tools/codesnippet/VisualBasic/SimpleDataApp/FillOrCancel.vb" id="Snippet1":::

3. Заполните основные тексты методов для четырех обработчиков событий нажатия кнопки, как показано в следующем коде.

     :::code language="csharp" source="../data-tools/codesnippet/CSharp/SimpleDataApp/FillOrCancel.cs" id="Snippet2":::
     :::code language="vb" source="../data-tools/codesnippet/VisualBasic/SimpleDataApp/FillOrCancel.vb" id="Snippet2":::

## <a name="test-your-application"></a>Тестирование приложения

Нажмите клавишу **F5** для сборки и тестирования приложения после написания кода для каждого обработчика события нажатия кнопки и общего кода программы.

## <a name="see-also"></a>См. также

- [Visual Studio Data Tools для .NET](../data-tools/visual-studio-data-tools-for-dotnet.md)
