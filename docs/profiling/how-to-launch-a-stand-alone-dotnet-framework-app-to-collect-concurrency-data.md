---
title: Командная строка профилировщика — запуск клиентского приложения .NET и получение данных о параллелизме
description: Узнайте, как использовать программы командной строки Средств профилирования Visual Studio, чтобы запускать автономные приложения .NET, а также собирать данные о параллелизме потоков и процессов.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
ms.assetid: 17a48848-bd3e-44ef-9971-e39836ff1df2
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: vs-2017
ms.workload:
- dotnet
ms.openlocfilehash: 81311e9dea2c5367b44cdf2cc8e2327a8aff5617
ms.sourcegitcommit: 20f546a0b13b56e7b0da21abab291d42a5ba5928
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104884113"
---
# <a name="how-to-launch-a-stand-alone-net-framework-application-with-the-profiler-to-collect-concurrency-data-by-using-the-command-line"></a>Практическое руководство. Запуск автономного приложения .NET Framework с профилировщиком для сбора данных о параллелизме с помощью командной строки
В этом разделе описывается использование программ командной строки Средств профилирования [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для запуска автономного (клиентского) приложения .NET Framework и сбора данных о параллелизме потоков и процессов

> [!NOTE]
> Сведения о пути к средствам профилирования см. в статье [Указание пути к программам командной строки средств профилирования](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md). На 64-разрядных компьютерах доступны 64- и 32-разрядные версии этих программ. Для использования программ командной строки профилировщика необходимо добавить путь к программам в переменную среды PATH окна командной строки или в саму команду.

 Когда профилировщик будет подключен к приложению, можно будет приостанавливать и возобновлять сбор данных. Чтобы завершить сеанс профилирования, профилировщик следует отключить от приложения и явным образом завершить его работу.

## <a name="start-the-application-with-the-profiler"></a>Запуск приложения с помощью профилировщика
 Чтобы запустить целевое приложение .NET Framework с помощью профилировщика, используйте *VSPerfClrEnv.exe* для настройки переменных профилирования в .NET Framework. Воспользуйтесь параметрами VSPerfCmd **/start** и **/launch** для инициализации Profiler и запуска приложения. Параметры **/start** и **/launch** с соответствующими параметрами можно указать в одной командной строке. Можно также добавить в командную строку параметр **/globaloff**, чтобы приостановить сбора данных при запуске целевого приложения. Затем используйте параметр **/globalon** в отдельной командной строке для запуска сбора данных.

#### <a name="to-start-an-application-with-the-profiler"></a>Запуск приложения с помощью профилировщика

1. Откройте окно командной строки.

2. Запуск профилировщика. Тип:

    [VSPerfCmd](../profiling/vsperfcmd.md) **/start:concurrency**[ **,** {**ResourceOnly**&#124;**ThreadOnly**}] **/output:** `OutputFile` [`Options`]

   - Параметр [/start](../profiling/start.md) инициализирует профилировщик.

     | Get-Help | Описание |
     |-------------------------------------| - |
     | **/start:concurrency** | Включает сбор данных как о конфликтах ресурсов, так и о выполнении потоков. |
     | **/start:concurrency,resourceonly** | Включает сбор данных только о конфликтах ресурсов. |
     | **/start:concurrency,threadonly** | Включает сбор данных только о выполнении потоков. |

   - Параметр [/output](../profiling/output.md) **:** `OutputFile` является обязательным для параметра **/start**. `OutputFile` указывает имя и расположение файла данных профилирования (VSP-файла).

     С параметром **/start:concurrency** можно использовать любой из следующих параметров.

   | Параметр | Описание |
   | - | - |
   | [/user](../profiling/user-vsperfcmd.md) **:** [`domain\`]`username` | Задает необязательные домен и имя пользователя учетной записи, которой будет предоставлен доступ к профилировщику. |
   | [/crosssession](../profiling/crosssession.md) | Включает профилирование процессов в других сеансах входа. |
   | [/wincounter](../profiling/wincounter.md) **:** `WinCounterPath` | Задает счетчик производительности Windows, данные которого будут собираться во время профилирования. |
   | [/automark](../profiling/automark.md) **:** `Interval` | Используется с только с параметром **/wincounter**. Указывает время (в миллисекундах) между событиями сбора счетчика производительности Windows. Значение по умолчанию — 500 мс. |
   | [/events](../profiling/events-vsperfcmd.md) **:** `Config` | Задает события трассировки событий для Windows (ETW), собираемые во время профилирования. События трассировки событий Windows собираются в отдельный *ETL*-файл. |

3. Запустите целевое приложение. Тип:

    **VSPerfCmd**  [/launch](../profiling/launch.md) **:** `AppName` [`Options`] [`Sample Event`]

    С параметром **/launch** можно использовать любой из следующих параметров.

   |Параметр|Описание|
   |------------|-----------------|
   |[/args](../profiling/args.md) **:** `Arguments`|Указывает строку, которая содержит аргументы командной строки для передачи в целевое приложение.|
   |[/console](../profiling/console.md)|Запускает целевое приложение командной строки в отдельном окне.|
   |[/targetclr](../profiling/targetclr.md) **:** `Version`|Указывает версию профилируемой среды CLR, если в приложении загружено несколько версий среды выполнения.|

## <a name="control-data-collection"></a>Управление сбором данных
 Пока целевое приложение выполняется, вы можете управлять сбором данных путем запуска и остановки записи данных в файл, используя параметры *VSPerfCmd.exe*. Управление сбором данных позволяет собирать данные на конкретных этапах выполнения программы, например при запуске или завершении работы приложения.

#### <a name="to-start-and-stop-data-collection"></a>Запуск и остановка сбора данных

1. Следующие пары параметров *VSPerfCmd.exe* запускают и останавливают сбор данных. Каждый параметр необходимо указывать в отдельной командной строке. Сбор данных можно включать и отключать несколько раз.

    |Параметр|Описание|
    |------------|-----------------|
    |[/globalon /globaloff](../profiling/globalon-and-globaloff.md)|Запускает (**/globalon**) или останавливает (**/globaloff**) сбор данных для всех процессов.|
    |[/processon](../profiling/processon-and-processoff.md) **:** `PID` [/processoff](../profiling/processon-and-processoff.md) **:** `PID`|Запускает ( **/processon**) или останавливает ( **/processoff**) сбор данных для процесса с указанным идентификатором процесса (`PID`).|
    |[/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} [/detach](../profiling/detach.md)[**:**{`PID`&#124;`ProcName`}]|Параметр **/attach** запускает сбор данных для процесса с указанным идентификатором (`PID`) или именем процесса (ProcName). **/detach** останавливает сбор данных для указанного процесса или для всех процессов, если конкретный процесс не задан.|

## <a name="end-the-profiling-session"></a>Завершение сеанса профилирования
 Для завершения сеанса профилирования профилировщик не должен выполнять сбор данных. Вы можете остановить процесс сбора данных о параллелизме, закрыв профилируемое приложение или вызвав параметр **VSPerfCmd /detach**. Затем можно вызвать параметр **VSPerfCmd /shutdown**, чтобы завершить работу профилировщика и закрыть файл данных профилирования. Команда **VSPerfClrEnv /off** сбрасывает переменные среды профилирования.

#### <a name="to-end-a-profiling-session"></a>Завершение сеанса профилирования

1. Выполните одно из следующих действий, чтобы отключить профилировщик от целевого приложения.

    - Закройте целевое приложение.

         -или-

    - Введите команду **VSPerfCmd /detach**.

2. Завершите работу профилировщика

     **VSPerfCmd**  [/shutdown](../profiling/shutdown.md)

## <a name="see-also"></a>См. также
- [Сбор данных параллелизма](../profiling/collecting-concurrency-data-for-stand-alone-applications.md)
