---
title: Присоединение профилировщика к .NET для сбора данных о параллелизме
description: Сведения о том, как использовать средства командной строки со средствами профилирования Visual Studio для подключения профилировщика к запущенному приложению .NET Framework и сбора данных о параллелизме потоков и процессов.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: how-to
ms.assetid: fdd41576-797e-4312-8520-fee7bb767e4a
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: vs-2017
ms.workload:
- dotnet
ms.openlocfilehash: f3eb5fbed055ef79595947954f86159b9cb2efc4
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99958912"
---
# <a name="how-to-attach-the-profiler-to-a-net-framework-stand-alone-application-to-collect-concurrency-data-by-using-the-command-line"></a>Практическое руководство. присоединение профилировщика к автономному приложению .NET Framework для сбора данных о параллелизме с помощью командной строки
В этой статье описывается, как использовать средства командной строки со средствами профилирования [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] для подключения профилировщика к запущенному автономному приложению .NET Framework (клиентскому) и сбора данных о параллелизме потоков и процессов.

> [!NOTE]
> Сведения о пути к Средствам профилирования см. в статье [Пошаговое руководство. Использование API-интерфейсов профилировщика](../profiling/walkthrough-using-profiler-apis.md). На 64-разрядных компьютерах доступны 64- и 32-разрядные версии этих программ. Чтобы использовать средства командной строки профилировщика, необходимо добавить путь к средствам либо в переменную среды PATH в окне командной строки или в саму команду. Дополнительные сведения см. в статье [Указание пути к программам командной строки средств профилирования](../profiling/specifying-the-path-to-profiling-tools-command-line-tools.md).

 Когда профилировщик будет подключен к приложению, можно будет приостанавливать и возобновлять сбор данных. Чтобы завершить сеанс профилирования, профилировщик следует отключить от приложения и явным образом завершить его работу.

## <a name="attach-the-profiler"></a>Присоединение профилировщика

#### <a name="to-attach-the-profiler-to-a-running-net-framework-application"></a>Присоединение профилировщика к выполняющемуся приложению .NET Framework

1. Откройте окно командной строки.

2. Запуск профилировщика. Тип:

     [VSPerfCmd](../profiling/vsperfcmd.md) **/start:concurrency  /output:** `OutputFile` [`Options`]

     Параметр [/output](../profiling/output.md)**:**`OutputFile` является обязательным для параметра **/start**. `OutputFile` указывает имя и расположение файла данных профилирования (VSP-файла).

     С параметром **/start:concurrency** можно использовать любой из следующих параметров.

    |Параметр|Описание|
    |------------|-----------------|
    |[/wincounter](../profiling/wincounter.md) **:** `WinCounterPath`|Задает счетчик производительности Windows, данные которого будут собираться во время профилирования.|
    |[/automark](../profiling/automark.md) **:** `Interval`|Используется с только с параметром **/wincounter**. Указывает время (в миллисекундах) между событиями сбора счетчика производительности Windows. Значение по умолчанию — 500 мс.|
    |[/events](../profiling/events-vsperfcmd.md) **:** `Config`|Задает события трассировки событий для Windows (ETW), собираемые во время профилирования. События трассировки событий Windows собираются в отдельный ETL-файл.|

3. Запустите целевое приложение обычным образом.

4. Присоедините профилировщик к целевому приложению. Тип:

     **VSPerfCmd /attach:** `PID` [**/lineoff**] [**/targetclr:**`Version`]

    - `PID` указывает идентификатор процесса целевого приложения. Идентификаторы всех запущенных процессов можно просмотреть в диспетчере задач Windows.

    - [/LineOff](../profiling/lineoff.md) отключает сбор данных о номерах строк.

    - [/targetclr](../profiling/targetclr.md) **:** `Version` указывает версию профилируемой среды CLR, если в приложении загружено несколько версий среды выполнения. Необязательный элемент.

## <a name="control-data-collection"></a>Управление сбором данных
 Пока целевое приложение выполняется, вы можете управлять сбором данных путем запуска и остановки записи данных в файл, используя параметры *VSPerfCmd.exe*. Управление сбором данных позволяет собирать данные на определенных этапах выполнения программы, включая запуск или завершение работы приложения.

#### <a name="to-start-and-stop-data-collection"></a>Запуск и остановка сбора данных

- Следующие пары параметров *VSPerfCmd.exe* запускают и останавливают сбор данных. Каждый параметр необходимо указывать в отдельной командной строке. Сбор данных можно включать и отключать несколько раз.

    |Параметр|Описание|
    |------------|-----------------|
    |[/globalon /globaloff](../profiling/globalon-and-globaloff.md)|Запускает (**/globalon**) или останавливает (**/globaloff**) сбор данных для всех процессов.|
    |[/processon](../profiling/processon-and-processoff.md) **:** `PID` [/processoff](../profiling/processon-and-processoff.md) **:** `PID`|Запускает (**/processon**) или останавливает (**/processoff**) сбор данных для процесса с указанным идентификатором процесса (`PID`).|
    |[/attach](../profiling/attach.md) **:**{`PID`&#124;`ProcName`} [/detach](../profiling/detach.md)[**:**{`PID`&#124;`ProcName`}]|Параметр **/attach** запускает сбор данных для процесса с указанным идентификатором (`PID`) или именем процесса (ProcName). **/detach** останавливает сбор данных для указанного процесса или для всех процессов, если конкретный процесс не задан.|

## <a name="end-the-profiling-session"></a>Завершение сеанса профилирования
 Для завершения сеанса профилирования профилировщик не должен выполнять сбор данных. Вы можете остановить сбор данных из приложения, профилируемого с помощью метода параллелизма, закрыв приложение или вызвав параметр **VSPerfCmd /detach**. Затем можно вызвать параметр **VSPerfCmd/shutdown**, чтобы завершить работу профилировщика и закрыть файл данных профилирования. Команда **VSPerfClrEnv /off** сбрасывает переменные среды профилирования.

#### <a name="to-end-a-profiling-session"></a>Завершение сеанса профилирования

1. Выполните одно из следующих действий, чтобы отключить профилировщик от целевого приложения.

    - Введите команду **VSPerfCmd /detach**.

         -или-

    - Закройте целевое приложение.

2. Завершите работу профилировщика. Тип:

     VSPerfCmd[/shutdown](../profiling/shutdown.md)
