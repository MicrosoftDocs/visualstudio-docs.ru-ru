---
title: 'DA0022: высокая доля сборок мусора в поколении 2 | Документация Майкрософт'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- vs.performance.DA0022
- vs.performance.rules.DA0022
- vs.performance.22
ms.assetid: f871a547-0e6f-4b11-b2d7-174d30fc2ed8
author: mikejo5000
ms.author: mikejo
manager: jmartens
monikerRange: vs-2017
ms.workload:
- multiple
ms.openlocfilehash: 61fb953b1eae3ecfb0aa9c87e8b10a25099cb12a
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99967011"
---
# <a name="da0022-high-rate-of-gen-2-garbage-collections"></a>DA0022. Высокая доля сборок мусора в генерации 2

|Элемент|Значение|
|-|-|
|Идентификатор правила|DA0022|
|Категория|Использование .NET Framework|
|Способ профилирования|Все|
|Сообщение|Наблюдается довольно большое число операций сборок мусора в поколении 2. Если алгоритмом ваших программ предусмотрено, что большинство структур данных выделено постоянно и в течение длительного времени, то это нормально. Если же вы считаете такое поведение непредвиденным, то, возможно, ваше приложение вызывает закрепление объектов. Чтобы понять, как происходит выделение памяти, используемой вашим приложением, вы можете собрать данные о распределении памяти .NET и сведения о времени жизни объекта.|
|Тип правила|Предупреждение|

 При профилировании с помощью выборки, памяти .NET или методов разрешения конфликтов ресурсов необходимо собрать минимум 10 выборок, чтобы активировать это правило.

## <a name="cause"></a>Причина:
 Данные о производительности системы, собранные во время профилирования, указывают, что во время сборки мусора в поколении 2 была освобождена память, отведенная для объектов .NET Framework, значительно большая, чем при сборке мусора в поколениях 0 и 1.

## <a name="rule-description"></a>Описание правила
 Среда CLR Microsoft .NET обеспечивает автоматический механизм управления памятью, использующий сборщик мусора для удаления из памяти объектов, которые приложение больше не использует. Сборщик мусора ориентирован на поколение, исходя из той предпосылки, что многие выделения памяти являются краткосрочными. Например, срок жизни локальных переменных должен быть небольшим. Вновь созданные объекты сначала находятся в поколении 0 (gen 0), а затем переходят в поколение 1, если они сохраняются после выполнения сборки мусора и, наконец, переходят в поколение 2, если приложение по-прежнему использует их.

 Объекты поколения 0 собираются часто и обычно очень эффективно. Объекты поколения 1 собираются менее часто и менее эффективно. Наконец, сбор долгоживущих объектов в поколении 2 должен происходить еще реже. Сбор поколения 2, то есть полная сборка мусора, также является наиболее ресурсоемкой операцией.

 Это правило применяется в тех случаях, когда доля времени, затраченного на сборку мусора для поколения 2, становится слишком велика. Правильно настроенные приложения .NET Framework должны затрачивать более чем в 5 раз больше времени на сборку мусора для поколения 1, чем для поколения 2. (10-кратная разница была бы идеальным вариантом.)

## <a name="how-to-investigate-a-warning"></a>Изучение причин предупреждения
 Дважды щелкните сообщение в окне "Список ошибок", чтобы перейти к представлению [Метки](../profiling/marks-view.md) данных профилирования. Найдите столбцы **Память CLR .NET\\Сборов мусора для поколения 0** и **Память CLR .NET\\Сборов мусора для поколения 1**. Установите, есть ли какие-либо этапы выполнения программы, где сборка мусора происходит чаще. Сравните эти значения со значениями в столбце **% времени сборщика мусора**, чтобы узнать, не вызывает ли схема выделения управляемой памятью чрезмерные затраты памяти.

 Большая доля времени, затраченного на сборку мусора для поколения 2, не всегда является проблемой. Это может быть определено в алгоритме. Вызвать применение этого правила может приложение, выделяющее структуры данных большого объема, которые должны оставаться активными в течение длительного времени. Если такое приложение испытывает нехватку памяти, может быть применено принудительное частое выполнение сборки мусора. Если менее затратные сборки мусора для поколений 0 и 1 могут освободить только незначительное количество управляемой памяти, будут планироваться более частые сборки мусора для поколения 2.

 В представлении "Отметки" есть дополнительные столбцы "Память CLR .NET", которые могут помочь вам выявить проблемы со сборкой мусора. Столбец **% времени в сборщике мусора** показывает затраты, возникающие при управлении памятью. Если в приложении используется весьма незначительное число больших, но постоянных объектов, то частое выполнение сборок мусора для поколения 2 не должно привести к чрезмерной загрузке ЦП. Если приложение испытывает нехватку памяти из-за того, что не хватает физической памяти (ОЗУ), могут быть применены соответствующие правила на основе данных столбца **Память\Страниц в секунду**.

 Чтобы понять схему использования управляемой памяти в приложении, выполните его повторное профилирование, запустив профиль выделения памяти .NET, и выберите параметр профилирования "Время жизни объекта".

 Сведения о том, как повысить производительность сборки мусора, см. в статье [Сведения о повышении производительности сборки мусора](/previous-versions/dotnet/articles/ms973837(v=msdn.10)) на веб-сайте корпорации Майкрософт. Сведения о дополнительных затратах на автоматическую сборку мусора см. в статье [Представляем кучу для массивных объектов](/archive/msdn-magazine/2008/june/clr-inside-out-large-object-heap-uncovered).