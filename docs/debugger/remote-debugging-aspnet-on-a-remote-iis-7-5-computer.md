---
title: Удаленная отладка ASP.NET на компьютере со службами IIS
description: Узнайте, как установить и настроить приложение ASP.NET MVC 4.5.2 в Visual Studio, развернуть его в службах IIS и присоединить удаленный отладчик из Visual Studio.
ms.custom:
- remotedebugging
- seodec18
ms.date: 05/06/2020
ms.topic: conceptual
ms.assetid: 9cb339b5-3caf-4755-aad1-4a5da54b2a23
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.workload:
- aspnet
ms.openlocfilehash: 104927d42f7ec68e43686278042c0712bb3c875e
ms.sourcegitcommit: 79a6be815244f1cfc7b4123afff29983fce0555c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2021
ms.locfileid: "102250087"
---
# <a name="remote-debug-aspnet-on-a-remote-iis-computer"></a>Удаленная отладка ASP.NET на удаленном компьютере со службами IIS

Чтобы выполнить отладку приложения ASP.NET, развернутого в службах IIS, установите и запустите средства удаленной отладки на компьютере, где развернуто приложение, а затем подключитесь к выполняющемуся приложению из Visual Studio.

![Компоненты удаленного отладчика](../debugger/media/remote-debugger-aspnet.png "Remote_debugger_components")

В этом руководстве вы узнаете, как установить и настроить приложение ASP.NET MVC 4.5.2 в Visual Studio, развернуть его в службах IIS и присоединить удаленный отладчик из Visual Studio.

> [!NOTE]
> Сведения об удаленной отладке ASP.NET Core см. в разделе [Удаленная отладка ASP.NET Core на компьютере со службами IIS](../debugger/remote-debugging-aspnet-on-a-remote-iis-computer.md). Для службы приложений Azure можно легко выполнить развертывание и отладку на предварительно настроенном экземпляре служб IIS с помощью [Snapshot Debugger](../debugger/debug-live-azure-applications.md) (требуется .NET 4.6.1) или путем [подключения отладчика из обозревателя сервера](../debugger/remote-debugging-azure.md).

## <a name="prerequisites"></a>Предварительные требования

::: moniker range=">=vs-2019"
Для Visual Studio 2019 требуется выполнить действия, описанные в этой статье.
::: moniker-end
::: moniker range="vs-2017"
Для Visual Studio 2017 требуется выполнить действия, описанные в этой статье.
::: moniker-end

Эти процедуры были протестированы в следующих конфигурациях сервера.

* Windows Server 2012 R2 и IIS 8 (в Windows Server 2008 R2 шаги для сервера отличаются)

## <a name="network-requirements"></a>Требования к сети

Удаленный отладчик поддерживается в среде Windows Server начиная с версии Windows Server 2008 с пакетом обновления 2 (SP2). Полный список требований см. в разделе [Требования](../debugger/remote-debugging.md#requirements_msvsmon).

> [!NOTE]
> Отладка между двумя компьютерами, подключенными через прокси-сервер, не поддерживается. Отладка через подключение с высокой задержкой или низкой пропускной способностью, например при подключении к Интернету по коммутируемой линии или при размещении компьютеров в разных странах, может приводить к сбоям или работать недопустимо медленно и поэтому не рекомендуется.

## <a name="app-already-running-in-iis"></a>Приложение уже запущено в службах IIS?

Эта статья содержит инструкции по настройке базовой конфигурации IIS в Windows Server и развертыванию приложения из Visual Studio. Эти шаги помогают убедиться, что на сервере установлены необходимые компоненты, приложение работает корректно и вы готовы к удаленной отладке.

* Если приложение выполняется в службах IIS и требуется загрузить удаленный отладчик и начать отладку, перейдите на страницу [Загрузка и установка средств удаленной отладки на Windows Server](#BKMK_msvsmon).

* Если вы хотите убедиться, что приложение настроено, развернуто и правильно работает в службах IIS, чтобы можно было выполнить отладку, выполните все действия, описанные в этом разделе.

## <a name="create-the-aspnet-452-application-on-the-visual-studio-computer"></a>Создание приложения ASP.NET 4.5.2 на компьютере с Visual Studio

1. Создайте приложение MVC ASP.NET.

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 нажмите **CTRL+Q**, чтобы открыть поле поиска, введите **asp.net**, выберите **Шаблоны**, а затем **Создание проекта веб-приложения ASP.NET (.NET Framework)** . В появившемся диалоговом окне введите имя проекта **MyASPApp** и нажмите **Создать**. Выберите **MVC** и нажмите **создать**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 выберите **Файл > Создать > Проект**, а затем пункты **Visual C# > Веб > Веб-приложение ASP.NET**. В разделе шаблонов **ASP.NET 4.5.2** выберите шаблон **MVC**. Убедитесь, что не выбран пункт **Включить поддержку Docker**, и для параметра **Проверка подлинности** установлено значение **Без проверки подлинности**. Назовите проект **MyASPApp**.
    ::: moniker-end

2. Откройте файл *HomeController.cs* и установите точку останова в методе `About()`.

## <a name="install-and-configure-iis-on-windows-server"></a><a name="bkmk_configureIIS"></a> Установка и настройка IIS в Windows Server

[!INCLUDE [remote-debugger-install-iis-role](../debugger/includes/remote-debugger-install-iis-role.md)]

## <a name="update-browser-security-settings-on-windows-server"></a>Обновление параметров безопасности браузера в Windows Server

Если в Internet Explorer включена усиленная конфигурация безопасности (включена по умолчанию), возможно, потребуется добавить некоторые домены в качестве доверенных сайтов, чтобы можно было загрузить некоторые из компонентов веб-сервера. Добавьте доверенные сайты в разделе **Свойства обозревателя > Безопасность > Надежные сайты > Сайты**. Добавьте следующие домены.

- microsoft.com
- go.microsoft.com
- download.microsoft.com
- iis.net

При скачивании программного обеспечения вы можете получать запросы на предоставление разрешений для разных скриптов и ресурсов веб-сайта. Некоторые из этих ресурсов не являются обязательными, но для упрощения процесса щелкните **Добавить** при появлении запроса.

## <a name="install-aspnet-45-on-windows-server"></a><a name="BKMK_deploy_asp_net"></a> Установка ASP.NET 4.5 на Windows Server

Дополнительные сведения об установке ASP.NET в IIS см. в разделе [IIS 8.0 с использованием ASP.NET 3.5 и ASP.NET 4.5](/iis/get-started/whats-new-in-iis-8/iis-80-using-aspnet-35-and-aspnet-45).

1. В левой области диспетчер сервера выберите **IIS**. Щелкните сервер правой кнопкой мыши и выберите **Диспетчер служб IIS**.

1. Используйте установщик веб-платформы для установки ASP.NET 4.5 (из узла сервера в Windows Server 2012 R2, выберите **Получить новые компоненты веб-платформы**, а затем выполните поиск ASP.NET)

    ![Снимок экрана: установщик веб-платформы 5.0, в окне которого отображаются результаты поиска для asp.net с компонентом IIS веб-платформы: пункт ASP.NET 4.5 обведен красным кругом.](../debugger/media/remotedbg_iis_aspnet_45.png)

    > [!NOTE]
    > Если вы используете Windows Server 2008 R2, установите ASP.NET 4 с помощью следующей команды:

     **C:\Windows\Microsoft.NET\Framework64\v4.0.30319\aspnet_regiis.exe -ir**

2. Перезапустите систему (или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу).

## <a name="choose-a-deployment-option"></a>Выбор способа развертывания

Если вам нужна помощь в развертывании приложения в службах IIS, рассмотрите следующие варианты.

* Выполните развертывание, создав файл параметров публикации в IIS и импортировав параметры в Visual Studio. В некоторых сценариях этот способ позволяет быстро развертывать приложения. При создании файла параметров публикации разрешения автоматически настраиваются в службах IIS.

* Выполните развертывание путем публикации в локальной папке и копирования выходных данных предпочтительным методом в подготовленную папку приложения в службах IIS.

## <a name="optional-deploy-using-a-publish-settings-file"></a>(Дополнительно) Выполните развертывание с помощью файла параметров публикации

С помощью этого параметра можно создать файл параметров публикации и импортировать его в Visual Studio.

> [!NOTE]
> В этом методе используется компонент веб-развертывания, который должен быть установлен на сервере. Если вы хотите настроить веб-развертывание вручную вместо импорта параметров, можно установить веб-развертывание 3.6 вместо веб-развертывания 3.6 для серверов размещения. Однако если вы настраиваете веб-развертывание вручную, то необходимо убедиться, что папка приложения на сервере настроена с правильными значениями и разрешениями (см. [Настройка веб-сайта ASP.NET](#BKMK_deploy_asp_net)).

### <a name="install-and-configure-web-deploy-for-hosting-servers-on-windows-server"></a>Установка и настройка веб-развертывания для серверов размещения в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/install-web-deploy-with-hosting-server.md)]

### <a name="create-the-publish-settings-file-in-iis-on-windows-server"></a>Создание файла параметров публикации в IIS в Windows Server

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/create-publish-settings-iis.md)]

### <a name="import-the-publish-settings-in-visual-studio-and-deploy"></a>Импорт параметров публикации в Visual Studio и развертывание

[!INCLUDE [install-web-deploy-with-hosting-server](../deployment/includes/import-publish-settings-vs.md)]

После успешного развертывания приложение должно запускаться автоматически. Если приложение не запускается из Visual Studio, запустите его в IIS.

1. Переключитесь на конфигурацию отладки.

   ::: moniker range=">=vs-2019"
   Выберите **Изменить**, чтобы изменить профиль,а затем — **Параметры**. Выберите конфигурацию **Отладка**, а затем выберите **Удалить дополнительные файлы в пункте назначения** в параметрах **Публикация файла**.
   ::: moniker-end
   ::: moniker range="vs-2017"
   В диалоговом окне **Параметры** включите отладку, нажав кнопку **Далее**, выберите конфигурацию **Отладка**, а затем выберите **Удалить дополнительные файлы в пункте назначения** в параметрах **Публикация файла**.
   ::: moniker-end

   > [!IMPORTANT]
   > Если вы выбираете конфигурацию выпуска, отладку можно отключить при публикации в файле *web.config*.

1. Щелкните **Сохранить**, а затем повторно опубликуйте приложение.

## <a name="optional-deploy-by-publishing-to-a-local-folder"></a>(Дополнительно) Развертывание путем публикации в локальной папке

Этот параметр можно использовать для развертывания приложения, если требуется скопировать приложение в IIS с помощью PowerShell или RoboCopy или скопировать файлы вручную.

### <a name="configure-the-aspnet-web-site-on-the-windows-server-computer"></a><a name="BKMK_deploy_asp_net"></a> Настройка веб-сайта ASP.NET на компьютере Windows Server

1. Откройте проводник Windows и создайте новую папку **C:\Publish**, где позже будет развернут проект ASP.NET.

2. Откройте узел **Диспетчер служб IIS**, если он еще не открыт. (В левой области диспетчер сервера выберите **IIS**. Щелкните сервер правой кнопкой мыши и выберите **Диспетчер служб IIS**.)

3. В разделе **Подключения** в левой области перейдите к пункту **Сайты**.

4. Нажмите **Веб-сайт по умолчанию**, выберите **Основные параметры** и задайте для параметра **Физический путь** значение **C:\Publish**.

5. Щелкните правой кнопкой мыши узел **Веб-сайт по умолчанию** и выберите команду **Добавить приложение**.

6. Задайте для поля **Псевдоним** значение **MyASPApp**, примите пул приложений по умолчанию (**DefaultAppPool**) и установите для параметра **Физический путь** значение **C:\Publish**.

7. В разделе **Подключения** выберите **Пулы приложений**. Откройте **DefaultAppPool** и задайте в поле пула приложений значение **ASP.NET v4.0** (ASP.NET 4.5 не входит в список параметров для пула приложений).

8. Выбрав сайт в диспетчере служб IIS, нажмите **Изменить разрешения** и убедитесь, что IUSR, IIS_IUSRS или пользователь, настроенный для пула приложений, является полномочным пользователем с правами на чтение и выполнение. Если ни одного из этих пользователей не указано, добавьте учетную запись IUSR в качестве пользователя с правами на чтение и выполнение.

### <a name="publish-and-deploy-the-app-by-publishing-to-a-local-folder-from-visual-studio"></a>Публикация и развертывание приложения путем публикации в локальной папке из Visual Studio

Можно также опубликовать и развернуть приложение с помощью файловой системы или других средств.

1. (ASP.NET 4.5.2) Убедитесь в том, что в файле web.config указана правильная версия .NET.  Например, если вы нацелены на ASP.NET 4.5.2, убедитесь, что эта версия указана в файле web.config.

    ```xml
    <system.web>
      <compilation debug="true" targetFramework="4.5.2" />
      <httpRuntime targetFramework="4.5.2" />
      <httpModules>
        <add name="ApplicationInsightsWebTracking" type="Microsoft.ApplicationInsights.Web.ApplicationInsightsHttpModule, Microsoft.AI.Web" />
      </httpModules>
    </system.web>

    ```

    Например, версия должна быть 4.0 при установке ASP.NET 4 вместо 4.5.2.

[!INCLUDE [remote-debugger-deploy-app-local](../debugger/includes/remote-debugger-deploy-app-local.md)]

## <a name="download-and-install-the-remote-tools-on-windows-server"></a><a name="BKMK_msvsmon"></a> Загрузка и установка инструментов удаленной отладки в Windows Server

Загрузите версию удаленных инструментов, которая соответствует вашей версии Visual Studio.

[!INCLUDE [remote-debugger-download](../debugger/includes/remote-debugger-download.md)]

## <a name="set-up-the-remote-debugger-on-windows-server"></a><a name="BKMK_setup"></a> Настройка удаленного отладчика в Windows Server

[!INCLUDE [remote-debugger-configuration](../debugger/includes/remote-debugger-configuration.md)]

> [!NOTE]
> Если вам нужно добавить разрешения для дополнительных пользователей, изменить режим проверки подлинности или настроить номер порта для удаленного отладчика, воспользуйтесь инструкциями по [настройке удаленного отладчика](../debugger/remote-debugging.md#configure_msvsmon).

Сведения о запуске удаленного отладчика в качестве службы см. в разделе [Запуск удаленного отладчика в качестве службы](../debugger/remote-debugging.md#bkmk_configureService).

## <a name="attach-to-the-aspnet-application-from-the-visual-studio-computer"></a><a name="BKMK_attach"></a> Подключение к приложению ASP.NET с компьютера с Visual Studio

1. На компьютере Visual Studio откройте решение, которое вы пытаетесь отладить (в этой статье мы используем **MyASPApp**).
2. В Visual Studio выберите пункт **Отладка > Присоединить к процессу** (CTRL+ALT+P).

    > [!TIP]
    > В Visual Studio 2017 и более поздних версиях можно повторно присоединиться к тому же процессу, выбрав **Отладка > Присоединиться к процессу повторно...** (SHIFT + ALT + P).

3. В поле "Квалификатор" задайте значение **\<remote computer name>** и нажмите клавишу **ВВОД**.

    Убедитесь, что Visual Studio добавляет требуемый порт в имя компьютера, которое отображается в формате **\<remote computer name>:порт**.

    ::: moniker range=">=vs-2019"
    В Visual Studio 2019 должно отображаться **\<remote computer name>:4024**.
    ::: moniker-end
    ::: moniker range="vs-2017"
    В Visual Studio 2017 должно отображаться **\<remote computer name>:4022**.
    ::: moniker-end
    Указывать порт обязательно. Если номер порта не отображается, добавьте его вручную.

4. Нажмите кнопку **Обновить**.
    В окне **Доступные процессы** должен появиться ряд процессов.

    Если вы не видите никаких процессов, попробуйте использовать IP-адрес вместо имени удаленного компьютера (указывать порт обязательно). Для получения IPv4-адреса можно использовать `ipconfig` в командной строке.

5. Установите флажок  **Показать процессы, запущенные всеми пользователями**.

6. Введите первую букву имени процесса, чтобы быстро найти **w3wp.exe** для ASP.NET 4.5.

    При наличии нескольких процессов, отображающих **w3wp.exe**, проверьте столбец **Имя пользователя**. В некоторых сценариях в столбце **Имя пользователя** отображается имя пула приложений, например **IIS APPPOOL\DefaultAppPool**. Если вы видите пул приложений, можно легко определить правильный процесс, создав новый именованный пул приложений для отлаживаемого экземпляра приложения, после чего его можно будет найти в столбце **Имя пользователя**.

    ::: moniker range=">=vs-2019"
    ![RemoteDBG_AttachToProcess](../debugger/media/vs-2019/remotedbg-attachtoprocess.png "RemoteDBG_AttachToProcess")
    ::: moniker-end
    ::: moniker range="vs-2017"
    ![RemoteDBG_AttachToProcess](../debugger/media/remotedbg-attachtoprocess.png "RemoteDBG_AttachToProcess")
    ::: moniker-end

7. Нажмите кнопку **Присоединить**

8. Откройте веб-сайт удаленного компьютера. Для этого откройте в браузере адрес **http://\<remote computer name>** .

    Должна открыться веб-страница ASP.NET.
9. В работающем приложении ASP.NET щелкните ссылку на страницу **Сведения**.

    В Visual Studio должна быть достигнута точка останова.

## <a name="troubleshooting-open-required-ports-on-windows-server"></a><a name="bkmk_openports"></a> Устранение неполадок. Откройте необходимые порты на Windows Server

В большинстве установок необходимые порты открываются при установке ASP.NET и удаленного отладчика. Однако, возможно, потребуется проверить, что порты открыты.

> [!NOTE]
> На виртуальной машине Azure порты необходимо открывать через [группы безопасности сети](/azure/virtual-machines/windows/nsg-quickstart-portal).

Требуемые порты:

* 80 — требуется для IIS
::: moniker range=">=vs-2019"
* 4024 — требуется для удаленной отладки из Visual Studio 2019 (дополнительные сведения см. в разделе [Назначения портов удаленного отладчика](../debugger/remote-debugger-port-assignments.md)).
::: moniker-end
::: moniker range="vs-2017"
* 4022 — требуется для удаленной отладки из Visual Studio 2017 (дополнительные сведения см. в разделе [Назначения портов удаленного отладчика](../debugger/remote-debugger-port-assignments.md)).
::: moniker-end
* UDP 3702 — (необязательно) порт обнаружения позволяет использовать кнопку **Найти** при подключении к удаленному отладчику в Visual Studio.

1. Чтобы открыть порт в Windows Server, в меню **Пуск** найдите пункт **Брандмауэр Windows в режиме повышенной безопасности**.

2. Затем выберите **Правила для входящего трафика > Создать правило > Порт**. Нажмите **Далее** и в разделе **Определенные локальные порты** введите номер порта, нажмите **Далее**, **Разрешить подключение**, нажмите кнопку "Далее" и добавьте имя (**IIS**, **Веб-развертывание** или **msvsmon**) для правила входящего трафика.

    Информацию о настройке брандмауэра Windows см. в разделе [Настройка брандмауэра Windows для удаленной отладки](../debugger/configure-the-windows-firewall-for-remote-debugging.md).

3. Создайте дополнительные правила для других требуемых портов.