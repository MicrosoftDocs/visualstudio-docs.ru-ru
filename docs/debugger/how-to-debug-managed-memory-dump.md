---
title: Отладка дампа управляемой памяти с помощью диагностических анализаторов .NET | Документация Майкрософт
description: Узнайте, как использовать диагностические анализаторы .NET Visual Studio для анализа дампа управляемой памяти.
ms.custom: SEO-VS-2021
ms.date: 04/21/2021
ms.topic: how-to
dev_langs:
- CSharp
- VB
helpviewer_keywords:
- analyzers
- dump debugging
- debugging managed memory dump
- debugging [Visual Studio]
author: poppastring
ms.author: madownie
manager: andster
monikerRange: '>= vs-2019'
ms.workload:
- multiple
ms.openlocfilehash: 083095ad534aa6b9131ba103178313cb1cdc4b7c
ms.sourcegitcommit: 925db7adb9cb554b081c7e727d09680d4863feed
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2021
ms.locfileid: "107953083"
---
# <a name="how-to-debug-a-managed-memory-dump-with-net-diagnostic-analyzers"></a>Отладка дампа управляемой памяти с помощью диагностических анализаторов .NET



Выполняя данное руководство, вы сделаете следующее:

> [!div class="checklist"]
> * откроете дамп памяти;
> * выберете и выполните анализаторы для дампа;
> * просмотрите результаты анализатора;
> * перейдете к проблемному коду.


В примере, описанном в этой статье, проблема заключается в том, что приложение не отвечает на запросы своевременно. 


## <a name="opening-a-memory-dump-in-visual-studio"></a>Открытие дампа памяти в Visual Studio

1. Откройте дамп памяти в Visual Studio с помощью команды меню **Файл > Открыть > Файл** и выберите дамп памяти.

1. Обратите внимание, что на странице сводки дампа памяти в разделе **Действие** отображается пункт **Выполнить диагностический анализ**.

   ![Действие — диагностический анализ](../debugger/media/diagnostic-analyzer-dump-summary-actions.png)

1. Выберите это действие, чтобы запустить отладчик и открыть новую страницу **Диагностический анализ** со списком доступных параметров анализатора, упорядоченных по базовым симптомам.


## <a name="select-and-execute-analyzers-against-the-dump"></a>Выбор и выполнение анализаторов для дампа

Для изучения этих симптомов в разделе **Скорость реагирования процесса** доступны варианты, которые наиболее точно соответствуют проблеме в нашем примере.

   ![Выбор диагностических анализаторов](../debugger/media/diagnostic-analyzer-diagnostics-analysis-window.png)

1. Нажмите кнопку **Анализ**, чтобы запустить процесс. 

1. Анализатор представит результаты на основе сведений о процессе и данных CLR, полученных в дампе памяти.
 
## <a name="review-the-results-of-the-analyzers"></a>Просмотр результатов анализатора

1. В нашем примере анализатор обнаружил две ошибки. Выберите результат анализатора, чтобы просмотреть **сводку анализа** и предлагаемое **исправление**.

   ![Результаты диагностических анализаторов](../debugger/media/diagnostic-analyzer-diagnostics-analysis-results.png)

1. В разделе **Сводка анализа** указано, что пул потоков CLR испытывает нехватку ресурсов. Согласно этой информации предполагается, что среда CLR использовала все доступные потоки пула потоков. Это означает, что служба не сможет отвечать на новые запросы, пока поток не будет освобожден.

    > [!NOTE] 
    > **Исправление** в нашем примере — это рекомендация не выполнять синхронное ожидание мониторов, событий, задач или других объектов, которые могут блокировать поток, и проверить, можно ли обновить метод как асинхронный.

## <a name="navigating-to-the-problematic-code"></a>Переход к проблемному коду

Следующим заданием является поиск проблемного кода.

1. Когда вы щелкнете ссылку **Показать стек вызовов**, Visual Studio немедленно переключится на потоки, которые демонстрируют это поведение.

1. В окне **Стек вызовов** отобразятся методы, которые могут быстро отличить пользовательский код (SyncOverAsyncExmple. *) от кода платформы (System.* ).

   ![Ссылка на диагностические анализаторы для стека вызовов](../debugger/media/diagnostic-analyzer-call-stack.png)

1. Каждый кадр стека вызовов соответствует методу. Когда вы дважды щелкнете кадр стека, Visual Studio перейдет к коду, выполнение которого приводит непосредственно к описанному сценарию в этом потоке.

1. В нашем примере нет символов или кода, но на странице **Символы не загружены** можно выбрать вариант **[Декомпилировать исходный код](../debugger/decompilation.md)** .

   ![Декомпиляция](../debugger/media/diagnostic-analyzer-decompilation.png)

1. В декомпилированном источнике ниже асинхронная задача (ConsumeThreadPoolThread) вызывает синхронную блокирующую функцию.

    > [!NOTE]  
    > Метод DoSomething() содержит метод WaitHandle.WaitOne, который блокирует текущий поток пула потоков до получения сигнала.

   Чтобы ускорить реагирование приложений, важно снять блокировку синхронного кода из всех асинхронных контекстов.

   ![Анализ декомпилированного кода](../debugger/media/diagnostic-analyzer-decompiled-code.png)


## <a name="see-also"></a>См. также

* [Использование файлов дампа в отладчике](../debugger/using-dump-files.md)
* [Создание исходного кода из сборок .NET во время отладки](../debugger/decompilation.md)
* [Указание файлов символов (PDB) и файлов с исходным кодом](../debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger.md)
