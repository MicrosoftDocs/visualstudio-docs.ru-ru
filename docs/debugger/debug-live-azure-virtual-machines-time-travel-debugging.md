---
title: Отладка перехода по времени для динамических приложений ASP.NET в виртуальных машинах Azure
description: Узнайте о том, как записывать и воспроизводить динамические приложения ASP.NET на виртуальных машинах Azure с помощью Snapshot Debugger.
ms.custom: SEO-VS-2020
ms.date: 04/11/2019
ms.topic: how-to
helpviewer_keywords:
- debugger
author: poppastring
ms.author: madownie
manager: andster
monikerRange: '>= vs-2019'
ms.workload:
- aspnet
- azure
ms.openlocfilehash: f8aabb109de02a1beec326407472a841fe16425a
ms.sourcegitcommit: d4887ef2ca97c55e2dad9f179eec2c9631d91c95
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/06/2021
ms.locfileid: "108798457"
---
# <a name="record-and-replay-live-aspnet-apps-on-azure-virtual-machines-using-the-snapshot-debugger"></a>Запись и воспроизведение динамических приложений ASP.NET на виртуальных машинах Azure с помощью Snapshot Debugger

С помощью предварительной версии отладки перехода по времени (TTD) в Visual Studio Enterprise предоставляет возможность записи веб-приложения, работающего на виртуальной машине Azure, и последующей точной реконструкции и воспроизведения пути выполнения. TTD интегрируется с Snapshot Debugger и позволяет перематывать назад и воспроизводить каждую строку кода любое нужное количество раз, помогая изолировать и выявлять проблемы, которые могут возникнуть только в рабочих средах.

Фиксирование записи TTD не приводит к остановке приложения. Однако запись TDD накладывает значительные ограничения на выполняемый процесс, замедляет его в зависимости от факторов, которые включают размер процесса и число активных потоков.

Эта функция доступна в предварительной версии для выпуска Visual Studio 2019 с лицензией Go Live.

В этом руководстве рассмотрены следующие задачи:

> [!div class="checklist"]
> * Запуск Snapshot Debugger с включенной отладкой перехода по времени
> * Настройка точки моментальных снимков и сбор записей переходов по времени
> * Запуск отладки записи перехода по времени

## <a name="prerequisites"></a>Предварительные требования

* Отладка перехода по времени для виртуальных машин Azure доступна только для Visual Studio 2019 Enterprise или версии более высокого уровня с **рабочей нагрузкой разработки Azure**. (На вкладке **Отдельные компоненты** его можно найти в разделе **Отладка и тестирование** > **Отладчик моментальных снимков**.)

    Установите пакет [Visual Studio 2019 Enterprise](https://visualstudio.microsoft.com/vs/), если он еще не установлен.

* Отладка перехода по времени доступна для следующих веб-приложений виртуальной машины Azure:
  * Приложения ASP.NET (AMD64), выполняющиеся на платформе .NET Framework 4.8 или более поздней версии.

## <a name="start-the-snapshot-debugger-with-time-travel-debugging-enabled"></a>Запуск Snapshot Debugger с включенной отладкой перехода по времени

1. Откройте проект, для которого необходимо организовать сбор записей перехода по времени.

    > [!IMPORTANT]
    > Чтобы приступить к TTD, необходимо открыть *ту же версию исходного кода*, которая опубликована в службе виртуальных машин Azure.

1. Выберите **Отладка > Подключить Snapshot Debugger...** . Выберите виртуальную машину Azure, где развернуто ваше веб-приложение, и учетную запись хранения Azure. Выберите параметр **Включить отладку перехода по времени** (предварительная версия), а затем нажмите кнопку **Присоединить**.

      ![Выбор ресурса Azure](../debugger/media/time-travel-debugging-select-azure-resource-vm.png)

    > [!IMPORTANT]
    > Если впервые щелкнуть **Подключить Snapshot Debugger** для виртуальной машины, службы IIS автоматически перезагрузятся.

    Метаданные для окна **Модули** изначально не активированы. Перейдите к веб-приложению, после чего кнопка **Начать сбор** станет активной. Visual Studio теперь находится в режиме отладки моментальных снимков.

   ![Режим отладки моментальных снимков](../debugger/media/snapshot-message.png)

    > [!NOTE]
    > Расширение сайта Application Insights также поддерживает отладку моментальных снимков. При возникновении сообщения об ошибке из-за того, что расширение сайта устарело, ознакомьтесь со статьей [Устранение неполадок и известные проблемы для отладки моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-troubleshooting.md) для получения подробной информации об обновлении.

   Окно **Модули** показывает, когда все модули для виртуальных машин Azure загружены (чтобы открыть это окно, выберите **Отладка > Окна > Модули**).

   ![Проверка окна модулей](../debugger/media/snapshot-modules.png)

## <a name="set-a-snappoint-and-collect-a-time-travel-recording"></a>Настройка точки моментальных снимков и сбор записей переходов по времени

1. В редакторе кода щелкните левое внутреннее окно в интересующем вас методе, чтобы задать точку моментальных снимков. Убедитесь, что будет выполняться именно этот код.

   ![Настройка точки моментальных снимков](../debugger/media/time-travel-debugging-set-snappoint-settings.png)

1. Щелкните правой кнопкой мыши значок точки моментальных снимков (пустой шар) и выберите **Действия**. В окне **Параметры моментального снимка** установите флажок **Действие**. Затем установите флажок **Получить трассировку перехода по времени в конце этого метода**.

   ![Получение трассировки перехода по времени в конец метода](../debugger/media/time-travel-debugging-set-snappoint-action.png)

1. Нажмите кнопку **Запустить коллекцию**, чтобы включить точку моментальных снимков.

   ![Включение точки моментальных снимков](../debugger/media/snapshot-start-collection.png)

## <a name="take-a-snapshot"></a>Сделайте моментальный снимок

Когда точка моментальных снимков включена, она создает моментальный снимок при каждом выполнении строки кода, на которой она размещена. Это выполнение может быть вызвано реальным запросом на вашем сервере. Для принудительного выполнения точки моментальных снимков перейдите к представлению браузера на своем веб-сайте и выполните все необходимые действия, которые приведут к выполнению точки моментальных снимков.

## <a name="start-debugging-a-time-travel-recording"></a>Запуск отладки записи перехода по времени

1. При выполнении точки моментальных снимков в окне "Средства диагностики" появляется снимок. Чтобы открыть это окно, выберите **Отладка > Windows > Показать средства диагностики**.

   ![Открытие точки моментальных снимков](../debugger/media/snapshot-diagsession-window.png)

1. Щелкните ссылку "Просмотреть моментальный снимок", чтобы открыть запись перехода по времени в редакторе кода.
  
   Можно выполнить каждую строку кода, записанную с помощью TTD, используя кнопки **Продолжить** и **Продолжить в обратном порядке**. Кроме того, можно использовать параметры на панели инструментов **Отладка** — **Показать следующий оператор**, **Шаг со входом**, **Шаг с обходом**, **Шаг с выходом**, **Шаг назад со входом**, **Шаг назад с обходом**, **Шаг назад с выходом**.

   ![Начало отладки](../debugger/media/time-travel-debugging-step-commands.png)

   Можно также воспользоваться окнами **Локальные**, **Контрольные значения** и **Стек вызовов**, а также вычислять выражения.

   ![Проверка данных моментальных снимков](../debugger/media/time-travel-debugging-start-debugging.png)

    Сам веб-сайт является активным, и последующие действия TTD не влияют на конечных пользователей. По умолчанию создается только один моментальный снимок для каждой точки моментальных снимков. После создания моментального снимка точка моментальных снимков отключается. Если вы хотите сделать еще один снимок в одной точке, вы можете снова включить ее, нажав **Обновить коллекцию**.

**Нужна помощь?** См. статьи [Устранение неполадок и известные проблемы для отладки моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-troubleshooting.md) и [Часто задаваемые вопросы по отладке моментальных снимков в Visual Studio](../debugger/debug-live-azure-apps-faq.yml).

## <a name="set-a-conditional-snappoint"></a>Настройка условной точки моментальных снимков

Если вам трудно воссоздать определенное состояние в своем приложении, подумайте, может ли помочь использование условной точки моментальных снимков. Условные точки прикрепления позволяют избегать сбора записей перехода по времени, пока приложение не войдет в требуемое состояние, например, если переменная имеет определенное значение, которое требуется проверить. [Вы можете установить условия, используя выражения, фильтры или счетчики посещений](../debugger/debug-live-azure-apps-troubleshooting.md).

## <a name="next-steps"></a>Следующие шаги

В этом руководстве вы узнали, как организовать сбор записей переходов по времени для виртуальных машин Azure. Возможно, вы заходите ознакомиться с дополнительными сведениями об этой функции.

> [!div class="nextstepaction"]
> [Ответы на часто задаваемые вопросы по отладке моментальных снимков](../debugger/debug-live-azure-apps-faq.yml)