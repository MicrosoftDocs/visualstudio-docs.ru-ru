---
title: Таблица «выполнение документа» | Документация Майкрософт
description: Сведения о том, как интегрированная среда разработки Visual Studio поддерживает таблицу выполняющегося документа, включая все открытые документы в памяти.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- read locks
- running document table (RDT), IVsDocumentLockHolder interface
- running document table (RDT)
- running document table (RDT), edit locks
- document data objects, running document table
ms.assetid: bbec74f3-dd8e-48ad-99c1-2df503c15f5a
author: leslierichardson95
ms.author: lerich
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 615910684fd79d3cbd8d8a1e012c239e27abc180
ms.sourcegitcommit: f2916d8fd296b92cc402597d1d1eecda4f6cccbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105080974"
---
# <a name="running-document-table"></a>Запуск таблицы документов
Интегрированная среда разработки поддерживает список всех открытых документов во внутренней структуре, которая называется «выполняемая таблица документов» (РДТ). Этот список включает все открытые документы в памяти независимо от того, редактируются ли эти документы в данный момент. Документ — это любой сохраняемый элемент, включая файлы в проекте или основной файл проекта (например, VCXPROJ-файл).

## <a name="elements-of-the-running-document-table"></a>Элементы таблицы выполняющегося документа
 Таблица выполняемый документ содержит следующие записи.

|Элемент|Описание|
|-------------|-----------------|
|Моникер документа|Строка, однозначно идентифицирующая объект данных документа. Это будет абсолютный путь к файлу для системы проектов, которая управляет файлами (например, К:\мипрожект\мифиле). Эта строка также используется для проектов, сохраненных в хранилищах, отличных от файловых систем, например хранимых процедур в базе данных. В этом случае система проектов может получить уникальную строку, которую можно распознать и, возможно, проанализировать, чтобы определить способ хранения документа.|
|Владелец иерархии|Объект иерархии, которому принадлежит документ, представленный <xref:Microsoft.VisualStudio.Shell.Interop.IVsHierarchy> интерфейсом.|
|Идентификатор элемента|Идентификатор элемента для определенного элемента в иерархии. Это значение является уникальным среди всех документов в иерархии, которым принадлежит этот документ, но это значение не обязательно должно быть уникальным в разных иерархиях.|
|Объект данных документа|Как минимум это `IUnknown`<br /><br /> . Интегрированная среда разработки не требует какого-либо интерфейса, кроме `IUnknown` интерфейса для объекта данных документа пользовательского редактора. Однако в стандартном редакторе реализация интерфейса должна быть реализована в редакторе, <xref:Microsoft.VisualStudio.Shell.Interop.IVsPersistDocData2> чтобы обеспечить обработку вызовов сохранения файлов из проекта. Дополнительные сведения см. [в разделе Сохранение стандартного документа](../../extensibility/internals/saving-a-standard-document.md).|
|Флаги|Флаги, управляющие сохранением документа, применение блокировки чтения или редактирования и т. д., могут быть указаны при добавлении записей в РДТ. Дополнительные сведения см. в описании перечисления <xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS>.|
|Изменение счетчика блокировок|Число блокировок правки. Блокировка редактирования означает, что документ открыт для редактирования некоторым редактором. Когда число переходов на изменение блокировок меняется на ноль, пользователю предлагается сохранить документ, если он был изменен. Например, каждый раз при открытии документа в редакторе с помощью команды **New Window** для этого документа в РДТ добавляется блокировка редактирования. Чтобы задать блокировку редактирования, документ должен иметь иерархию или идентификатор элемента.|
|Число блокировок чтения|Число блокировок чтения. Блокировка чтения указывает, что документ читается с помощью какого-либо механизма, такого как мастер. Блокировка чтения содержит документ, активный в РДТ, и указывает, что документ нельзя изменить. Можно установить блокировку чтения, даже если у документа нет иерархии или идентификатора элемента. Эта функция позволяет открыть документ в памяти и ввести его в РДТ без принадлежности к документу какой-либо иерархии. Эта функция редко используется.|
|Владелец блокировки|Экземпляр <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> интерфейса. Держатель блокировки реализуется такими компонентами, как мастера, которые открывают и редактируют документы за пределами редактора. Держатель блокировки позволяет компоненту Добавить блокировку правки в документ, чтобы предотвратить закрытие документа, пока он еще редактируется. Как правило, блокировки редактирования добавляются только окнами документов (то есть редакторами).|

 Каждой записи в РДТ назначена уникальная иерархия или идентификатор элемента, который обычно соответствует одному узлу в проекте. Все документы, доступные для редактирования, обычно принадлежат иерархии. Записи, сделанные в РДТ, управляют проектом или, точнее, иерархией, в которой в настоящее время находится редактируемый объект данных документа. Используя сведения в РДТ, интегрированная среда разработки может препятствовать открытию документа несколькими проектами.

 Иерархия также управляет сохранением данных и использует сведения в РДТ для обновления диалоговых окон **сохранить** и **Сохранить как** . Когда пользователь изменяет документ, а затем выбирает команду **выйти** в меню **файл** , интегрированная среда разработки запрашивает у пользователя диалоговое окно **сохранить изменения** , чтобы отобразить все проекты и элементы проекта, которые в настоящее время изменены. Это позволяет пользователям выбирать, какие документы следует сохранить. Список документов для сохранения (то есть документы с изменениями) формируется из РДТ. Все элементы, которые должны отображаться в диалоговом окне **сохранить изменения** при выходе из приложения, должны иметь записи в РДТ. РДТ координирует, какие документы сохраняются, и будет ли пользователю выдаваться запрос на операцию сохранения, используя значения, указанные в записи flags для каждого документа. Дополнительные сведения о флагах РДТ см. в разделе <xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS> перечисление.

## <a name="edit-locks-and-read-locks"></a>Изменение блокировок и блокировок чтения
 Изменения блокировок и блокировки чтения находятся в РДТ. Окно документа увеличивает и уменьшает блокировку правки. Таким словами, когда пользователь открывает новое окно документа, число блокировок при изменении увеличивается на единицу. Когда число блокировок правки достигает нуля, иерархия получает сигнал для сохранения или сохранения данных для связанного документа. Иерархия может сохранить данные любым способом, включая сохранение в виде файла или элемента в репозитории. Можно использовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.LockDocument%2A> метод в <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable> интерфейсе для добавления блокировок правки и чтения, а также <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnlockDocument%2A> метод для удаления этих блокировок.

 Обычно при создании экземпляра окна документа для редактора фрейм окна автоматически добавляет блокировку редактирования для документа в РДТ. Однако при создании пользовательского представления документа, не использующего стандартное окно документа (то есть не реализует <xref:Microsoft.VisualStudio.Shell.Interop.IVsWindowFrame> интерфейс), необходимо задать собственную блокировку редактирования. Например, в мастере документ редактируется без открытия в редакторе. Чтобы блокировки документов открывались с помощью мастеров и аналогичных сущностей, эти сущности должны реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> интерфейс. Чтобы зарегистрировать держатель блокировки документа, вызовите <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.RegisterDocumentLockHolder%2A> метод и передайте свою <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> реализацию. Это приведет к добавлению владельца блокировки документа в РДТ. Другой сценарий для реализации держателя документа — Открытие документа с помощью специального окна инструментов. В этом случае не удается закрыть документ в окне инструментов. Однако, зарегистрировав в качестве заполнителя блокировки документа в РДТ, интегрированная среда разработки может вызвать реализацию <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder.CloseDocumentHolder%2A> метода для запроса закрытия документа.

## <a name="other-uses-of-the-running-document-table"></a>Другие варианты использования таблицы выполняющегося документа
 Другие сущности в интегрированной среде разработки используют РДТ для получения сведений о документах. Например, диспетчер управления версиями использует РДТ, чтобы сообщить системе о необходимости перезагрузки документа в редакторе после того, как он получит последнюю версию файла. Для этого диспетчер управления исходным кодом ищет файлы в РДТ, чтобы узнать, открыты ли они. Если они есть, диспетчер управления исходным кодом сначала проверяет, что иерархия реализует <xref:Microsoft.VisualStudio.Shell.Interop.IVsPersistHierarchyItem2.ReloadItem%2A> метод. Если в проекте не реализован <xref:Microsoft.VisualStudio.Shell.Interop.IVsPersistHierarchyItem2.ReloadItem%2A> метод, диспетчер управления исходным кодом проверяет реализацию <xref:Microsoft.VisualStudio.Shell.Interop.IVsPersistDocData2.ReloadDocData%2A> метода для объекта данных документа напрямую.

 Интегрированная среда разработки также использует РДТ для переповерхности (перенесите на передний план) открытый документ, если пользователь запрашивает этот документ. Дополнительные сведения см. [в разделе Отображение файлов с помощью команды открыть файл](../../extensibility/internals/displaying-files-by-using-the-open-file-command.md). Чтобы определить, открыт ли файл в РДТ, выполните одно из следующих действий.

- Запросите моникер документа (т. е. полный путь к документу), чтобы узнать, открыт ли элемент.

- Используйте иерархию или идентификатор элемента, чтобы задать в системе проектов полный путь к документу, а затем просмотрите элемент в РДТ.

## <a name="see-also"></a>См. также
- [Использование RDT_ReadLock](../../extensibility/internals/rdt-readlock-usage.md)
- [Сохранение состояния и запуск таблицы документов](../../extensibility/internals/persistence-and-the-running-document-table.md)
