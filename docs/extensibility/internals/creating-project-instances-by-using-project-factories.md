---
title: Создание экземпляров проекта с помощью фабрик проекта | Документация Майкрософт
description: Узнайте, как создавать экземпляры классов проектов с помощью фабрик проектов в интегрированной среде разработки Visual Studio (IDE).
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- project factories
- projects [Visual Studio SDK], project factories
ms.assetid: 94c90012-8669-459c-af8e-307ac242c8c4
author: leslierichardson95
ms.author: lerich
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 40b7c3fbe5b5b7fd59fe0e57376290181f3e9a20
ms.sourcegitcommit: f2916d8fd296b92cc402597d1d1eecda4f6cccbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105056807"
---
# <a name="create-project-instances-by-using-project-factories"></a>Создание экземпляров проекта с помощью фабрик проекта
Типы проектов в [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] используют *фабрику проектов* для создания экземпляров объектов Project. Фабрика проектов аналогична фабрике класса Standard для создаваемых COM-объектов. Однако объекты проекта не могут быть созданы одновременно. их можно создать только с помощью фабрики проектов.

 [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)]Интегрированная среда разработки вызывает фабрику проекта, реализованную в VSPackage, когда пользователь загружает существующий проект или создает новый проект в среде [!INCLUDE[vsprvs](../../code-quality/includes/vsprvs_md.md)] . Новый объект Project предоставляет интегрированной среде разработки достаточно сведений для заполнения **Обозреватель решений**. Новый объект Project также предоставляет необходимые интерфейсы для поддержки всех соответствующих действий пользовательского интерфейса, инициированных интегрированной средой разработки.

 Интерфейс можно реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory> в классе в проекте. Как правило, он находится в отдельном модуле.

 Проекты, которые поддерживают агрегирование с помощью владельца, должны сохранять ключ владельца в файле проекта. При <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A> вызове метода для проекта с ключом владельца, принадлежащий проект преобразует свой ключ владельца в GUID фабрики проекта, а затем вызывает `CreateProject` метод в этой фабрике проектов, чтобы выполнить фактическое создание.

## <a name="create-an-owned-project"></a>Создание собственного проекта
 Владелец создает принадлежащий проект в два этапа:

1. Путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.PreCreateForOwner%2A> метода. Это дает возможность владельцем проекта создать агрегированный объект проекта на основе входных данных, управляющих данными `IUnknown` . Владелец проекта передает внутренний `IUnknown` и объединенный объект обратно в проект владельца. Это дает принадлежащему проекту возможность хранить внутренние `IUnknown` .

2. Путем вызова <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory.InitializeForOwner%2A> метода. Собственный проект выполняет все свои экземпляры при вызове этого метода вместо вызова AS, так `IVsProjectFactory::CreateProject` как для проектов, которые не принадлежат. Входным `VSOWNEDPROJECTOBJECT` перечислением обычно является объединенный проект, принадлежащий. Принадлежащий проект может использовать эту переменную для определения того, был ли уже создан объект проекта (файл cookie не равен NULL) или должен быть создан (файл cookie равен NULL).

   Типы проектов определяются уникальным идентификатором GUID проекта, аналогично идентификатору CLSID создаваемого COM-объекта. Как правило, одна фабрика проектов обрабатывает создание экземпляров одного типа проекта, хотя одна фабрика проекта может обрабатывать несколько идентификаторов GUID для одного типа проекта.

   Типы проектов связаны с определенным расширением имени файла. Когда пользователь пытается открыть существующий файл проекта или пытается создать новый проект путем клонирования шаблона, интегрированная среда разработки использует расширение файла для определения соответствующего идентификатора GUID проекта.

   Как только интегрированная среда разработки определит, нужно ли создать новый проект или открыть существующий проект определенного типа, интегрированная среда разработки использует сведения из системного реестра в разделе **[HKEY_LOCAL_MACHINE\Software\Microsoft\VisualStudio\8.0\Projects]** , чтобы найти, какой пакет VSPackage реализует требуемую фабрику проектов. Интегрированная среда разработки загружает этот пакет VSPackage. В <xref:Microsoft.VisualStudio.Shell.Interop.IVsPackage.SetSite%2A> методе пакет VSPackage должен зарегистрировать свою фабрику проекта в интегрированной среде разработки, вызвав <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes.RegisterProjectType%2A> метод.

   Основным методом `IVsProjectFactory` интерфейса является <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory.CreateProject%2A> , который должен выполнять два сценария: Открытие существующего проекта и создание нового проекта. Большинство проектов сохраняют свое состояние проекта в файле проекта. Как правило, новые проекты создаются путем создания копии файла шаблона, переданного в `CreateProject` метод, и открытия копии. Экземпляры существующих проектов создаются путем непосредственного открытия файла проекта, переданного в `CreateProject` метод. `CreateProject`При необходимости метод может отображать дополнительные пользовательские функции пользовательского интерфейса.

   Проект также может использовать файлы без файлов и, вместо этого, хранить свое состояние проекта в механизме хранения, отличном от файловой системы, такой как база данных или веб-сервер. В этом случае параметр имени файла, передаваемый в `CreateProject` метод, фактически не является путем файловой системы, а уникальной строкой — URL-адресом для обнаружения данных проекта. Вам не нужно копировать файлы шаблонов, которые передаются в, `CreateProject` чтобы запустить соответствующую последовательность построения для выполнения.

## <a name="see-also"></a>См. также
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsOwnedProjectFactory>
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsProjectFactory>
- <xref:Microsoft.VisualStudio.Shell.Interop.IVsRegisterProjectTypes>
- [Контрольный список: создание новых типов проектов](../../extensibility/internals/checklist-creating-new-project-types.md)
