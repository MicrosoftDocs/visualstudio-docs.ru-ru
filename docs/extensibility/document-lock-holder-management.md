---
title: Управление блокировкой документов | Документация Майкрософт
description: Сведения о том, как поместить блокировку редактирования документа в выполняемой таблице документов без просмотра открытого документа в окне документа.
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- editors [Visual Studio SDK], custom - document locking
ms.assetid: fa1ce513-eb7d-42bc-b6e8-cb2433d051d5
author: acangialosi
ms.author: anthc
manager: jmartens
ms.workload:
- vssdk
ms.openlocfilehash: 5c80c2969676de25575ec75c6976224f1cd0160e
ms.sourcegitcommit: ae6d47b09a439cd0e13180f5e89510e3e347fd47
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/08/2021
ms.locfileid: "99968246"
---
# <a name="document-lock-holder-management"></a>Управление заполнителями для блокировки документов

В таблице выполняемых документов (РДТ) хранится число открытых документов и все их блокировки редактирования. Можно поместить блокировку редактирования документа в РДТ, когда он будет программно изменен в фоновом режиме без просмотра открытого документа в окне документа. Эта функция часто используется конструкторами, которые изменяют несколько файлов с помощью графического пользовательского интерфейса.

## <a name="document-lock-holder-scenarios"></a>Сценарии блокировки документов

### <a name="file-a-has-a-dependence-on-file-b"></a>Файл "a" имеет зависимость от файла "b"

Рассмотрим ситуацию, когда вы реализуете стандартный редактор "A" для типа файла "a", и каждый файл типа "a" имеет ссылку на файл типа "b" (или зависимость от него). Для файлов типа "b" существует стандартный редактор "B". Когда редактор "A" открывает файл "a", он получает ссылку на соответствующий файл "b". Файл "b" не отображается, но редактор "A" может изменить его. Редактор "A" получает ссылку на данные документа из файла "b" из <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метода, а также сохраняет блокировку изменения файла "b". После того как редактор "A" внес изменения в файл "b", можно уменьшить число блокировок редактирования в файле "b", вызвав <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnlockDocument%2A> метод. Этот шаг можно опустить, если был вызван <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.FindAndLockDocument%2A> метод с параметром, `dwRDTLockType` для которого задано значение [_VSRDTFLAGS. RDT_NoLock](<xref:Microsoft.VisualStudio.Shell.Interop._VSRDTFLAGS.RDT_NoLock>).

### <a name="file-b-is-opened-by-a-different-editor"></a>Файл "b" открыт в другом редакторе

В случае, если файл "b" уже открыт редактором "B", когда редактор "A" пытается открыть его, существует два отдельных сценария для работы:

- Если файл "b" открыт в совместимом редакторе, необходимо иметь редактор "A" зарегистрировать блокировку редактирования документа в файле "b" с помощью <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.RegisterDocumentLockHolder%2A> метода. После того как редактор "A" внес изменения в файл "b", отмените регистрацию блокировки редактирования документа с помощью <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable.UnregisterDocumentLockHolder%2A> метода.

- Если файл "b" открыт с помощью несовместимого способа, можно либо разрешить попытаться открыть файл "b" в редакторе "A", либо разрешить частичное открытие представления, связанного с редактором "A", и отобразить соответствующее сообщение об ошибке. Сообщение об ошибке должно дать пользователю команду Закрыть файл "b" в несовместимом редакторе, а затем повторно открыть файл "a" с помощью редактора "A". Можно также реализовать метод, [!INCLUDE[vsipsdk](../extensibility/includes/vsipsdk_md.md)] <xref:Microsoft.VisualStudio.Shell.Interop.IVsRunningDocumentTable2.QueryCloseRunningDocument%2A> чтобы пользователю было предложено закрыть файл "b", Открытый в несовместимом редакторе. Если пользователь закрывает файл "b", открытие файла "a" в редакторе "A" продолжится обычным образом.

## <a name="additional-document-edit-lock-considerations"></a>Дополнительные рекомендации по изменению блокировки документа

Вы получаете другое поведение, если редактор "A" является единственным редактором, который имеет блокировку редактирования документа в файле "b", чем если бы редактор "B" также содержал блокировку изменения документа для файла "b". В [!INCLUDE[vsprvs](../code-quality/includes/vsprvs_md.md)] **конструктор классов** является примером визуального конструктора, который не удерживает блокировку редактирования связанного файла кода. Это значит, что если пользователь открыл схему классов в режиме конструктора и связанный файл кода открыт одновременно, и если пользователь изменяет файл кода, но не сохраняет изменения, изменения также теряются в файле схемы классов (. CD). Если в **конструктор классов** имеется единственная блокировка редактирования документа для файла кода, пользователю не будет предложено сохранить изменения при закрытии файла кода. Интегрированная среда разработки запрашивает у пользователя сохранение изменений только после того, как пользователь закроет **конструктор классов**. Сохраненные изменения отражаются в обоих файлах. Если как **конструктор классов** , так и редактор файлов кода удерживал блокировки редактирования документа в файле кода, то пользователю будет предложено сохранить его при закрытии файла кода или формы. В этот момент сохраненные изменения отражаются как в форме, так и в файле кода. Дополнительные сведения о схемах классов см. в разделе [Работа с диаграммами классов (конструктор классов)](../ide/class-designer/designing-and-viewing-classes-and-types.md).

Обратите внимание, что если необходимо поместить блокировку правки для документа, не являющегося редактором, необходимо реализовать <xref:Microsoft.VisualStudio.Shell.Interop.IVsDocumentLockHolder> интерфейс.

Многие случаи, когда конструктор пользовательского интерфейса изменяет файлы кода программным путем, вносит изменения в более чем один файл. В таких случаях <xref:Microsoft.VisualStudio.Shell.Interop.IVsUIShell2.SaveItemsViaDlg%2A> метод обрабатывает сохранение одного или нескольких документов с помощью диалогового окна **сохранить изменения в следующих элементах?** .

## <a name="see-also"></a>См. также раздел

- [Выполняемая таблица документов](../extensibility/internals/running-document-table.md)
- [Сохраняемость и выполняемая таблица документов](../extensibility/internals/persistence-and-the-running-document-table.md)
