---
title: Введение в функции Azure
description: Использование функций Azure в Visual Studio для Mac.
author: heiligerdankgesang
ms.author: dominicn
ms.date: 05/06/2018
ms.technology: vs-ide-install
ms.assetid: 25CD47A4-5B32-4734-8EF3-E24A02AABF29
ms.topic: how-to
ms.openlocfilehash: 63793548bd3ea1098cc1113724cd9a3b513adbf5
ms.sourcegitcommit: fcfd0fc7702a47c81832ea97cf721cca5173e930
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/22/2020
ms.locfileid: "97727467"
---
# <a name="introduction-to-azure-functions"></a>Введение в функции Azure

Функции Azure позволяют создавать и запускать управляемые событиями фрагменты кода (функции) в облаке без необходимости явной подготовки и управления инфраструктурой. Дополнительные сведения о функциях Azure см. в [документации по функциям Azure](/azure/azure-functions/).

## <a name="requirements"></a>Требования

Средства функций Azure включены в **Visual Studio для Mac 7.5**.

Для создания и развертывания функций необходимо также наличие подписки на Azure, которая доступна бесплатно по адресу [https://azure.com/free](https://azure.com/free).

## <a name="creating-your-first-azure-functions-project"></a>Создание первого проекта с функциями Azure

1. В Visual Studio для Mac выберите **Файл > Новое решение**.
2. В диалоговом окне нового проекта выберите шаблон "Функции Azure" в разделе **Облако > Общие** и нажмите кнопку **Далее**:

    ![Диалоговое окно нового проекта с параметром "Функции Azure"](media/azure-functions-image1.png)

3. Выберите начальный шаблон функций Azure, который вы хотите использовать, введите имя функции и нажмите кнопку **Далее**.

    ![Диалоговое окно нового проекта с шаблонами "Функции Azure"](media/azure-functions-image2.png)

    В зависимости от выбранного типа функции на следующей странице будет предложено указать определенные данные, например права доступа, как показано ниже.

    ![Диалоговое окно нового проекта с дополнительным параметром](media/azure-functions-image3.png)

    Дополнительные сведения о различных типах шаблонов функций Azure и свойствах привязки, необходимые для настройки каждого шаблона, см. в разделе [Шаблоны доступных функций](#available-function-templates). В данном примере используется триггер HTTP с анонимными правами доступа.

4. Задав параметры, выберите расположение проекта и нажмите **Создать**.

Visual Studio для Mac создаст проект .NET Standard, содержащий функцию по умолчанию. Он также включает ссылки NuGet на различные пакеты **AzureWebJobs**, а также на пакет **Newtonsoft.Json**.

![Окно редактора Visual Studio для Mac с только что созданной из шаблона функцией Azure](media/azure-functions-newproj.png)

Новый проект содержит следующие файлы:

* **Имя-вашей-функции.cs** — класс, содержащий стереотипный код для выбранной вами функции. Он содержит атрибут **FunctionName** с именем функции и атрибут триггера, показывающий, что запускает функцию (например, HTTP-запрос). Дополнительные сведения о методе функции см. в статье [Справочник разработчика C# по функциям Azure](/azure/azure-functions/functions-dotnet-class-library).
* **host.json** — этот файл описывает параметры глобальной конфигурации для узла функции. Пример файла и сведения о доступных параметрах для этого файла см. в статье [Справочник по файлу host.json для функций Azure](/azure/azure-functions/functions-host-json).
* **local.settings.json** — этот файл содержит все параметры для локального выполнения функций. Эти параметры используются в основных средствах функций Azure. Дополнительные сведения см. в разделе [Файл с локальными параметрами](/azure/azure-functions/functions-run-local#local-settings-file) статьи об основных инструментах функций Azure.

После создания нового проекта функций Azure в Visual Studio для Mac мы можем протестировать созданную по умолчанию функцию, активируемую по HTTP, с локального компьютера.

## <a name="testing-the-function-locally"></a>Тестирование функции локально

Поддержка функций Azure в Visual Studio для Mac позволяет тестировать и выполнять отладку функции на локальном компьютере разработчика.

1. Чтобы проверить работу локально, нажмите кнопку **запуска** в Visual Studio для Mac:

    ![Кнопка запуска отладки в Visual Studio для Mac](media/azure-functions-run.png)

1. После запуска проекта начнется локальная отладка функции Azure и откроется новое окно терминала, как показано на следующем рисунке:

    ![вывод функции в окне терминала](media/azure-functions-terminal.png)

    Скопируйте URL-адрес из выходных данных.

3. Вставьте URL-адрес для HTTP-запроса в адресной строке браузера. Добавьте строку запроса `?name=<yourname>` в конец URL-адреса и выполните запрос. Ниже показан ответ в браузере на локальный запрос GET, возвращенный функцией:

    ![http-запрос в браузере](media/azure-functions-httpreq.png)

## <a name="adding-another-function-to-your-project"></a>Добавление в проект другой функции

Шаблоны функций позволяют быстро создавать новые функции с помощью наиболее распространенных триггеров и шаблонов. Чтобы создать другой тип функции, выполните следующие действия:

1. Чтобы добавить новую функцию, щелкните правой кнопкой мыши по имени проекта и выберите **Добавить > Добавить функцию...** :

    ![пункт контекстного меню для добавления новой функции](media/azure-functions-addnew.png)

2. В диалоговом окне **Новая функция Azure** выберите необходимую функцию:

    ![диалоговое окно создания функции azure](media/azure-functions-image4.png)

    Список шаблонов функций Azure приводится в разделе [Доступные шаблоны функций](#available-function-templates).

Используя описанную выше процедуру, вы можете добавить в свой проект приложения-функции дополнительные функции. У всех функций в проекте могут быть разные триггеры, однако у каждой должно быть не больше и не меньше одного триггера. Дополнительные сведения см. в разделе [Основные понятия триггеров и привязок в Функциях Azure](/azure/azure-functions/functions-triggers-bindings).

## <a name="publish-to-azure"></a>Публикация в Azure

1. Щелкните имя проекта правой кнопкой мыши и выберите **Опубликовать > Опубликовать в Azure**:  ![Снимок экрана: Функции Azure с выбранным проектом AF-httptrigger и командами "Опубликовать" и "Опубликовать в Azure", выделенными в контекстном меню.](media/azure-functions-image5.png)
2. Если вы уже подключили учетную запись Azure к Visual Studio для Mac, появится список доступных приложений. Если вы еще не вошли в систему, вам будет предложено это сделать.
3. В диалоговом окне **Публикация в службу приложений Azure** можно либо выбрать действующую службу приложений, либо создать новую, нажав **Создать**.
4. В диалоговом окне **Создать службу приложений** введите желаемые параметры:  ![Снимок экрана: окно "Создать службу приложений" в Функциях Azure с параметрами для создания службы приложений в Azure.](media/azure-functions-image7.png)

    |Параметр  |Описание  |
    |---------|---------|
    |**Имя службы приложений**|Глобально уникальное имя, определяющее новое приложение-функцию.|
    |**Подписка**|Подписка Azure, которую нужно использовать.|
    |**[Группа ресурсов](/azure/azure-resource-manager/resource-group-overview)**|Имя группы ресурсов, в которой будет создано приложение-функция. Щелкните **+** , чтобы создать группу ресурсов.|
    |**[План обслуживания](/azure/azure-functions/functions-scale)**|Выберите существующий план или создайте пользовательский план. Выберите расположение в регионе, расположенном рядом с вами или другими службами, к которым обращаются ваши функции.|

    > [!CAUTION]
    > Ошибка в версии 7.6 Visual Studio для Mac, из-за которой публикация завершается ошибкой подготовки, если при попытке создания плана обслуживания параметру **Цены** присвоено значение **Потребление**. Эта неполадка будет устранена в следующем выпуске службы.

5. Нажмите **Далее**, чтобы создать учетную запись хранения. Для среды выполнения функций необходима учетная запись хранения Azure. Нажмите **Пользовательский**, чтобы создать учетную запись хранения общего назначения, или выберите уже существующую учетную запись:

    ![Снимок экрана: экран "Настройка учетной записи хранилища" в инструментах Функций Azure. В качестве типа учетной записи хранения выбрано значение "Пользовательский", в полях "Имя учетной записи" и "Тип учетной записи" указаны данные.](media/azure-functions-image8.png)

6. Нажмите **Создать**, чтобы создать приложение-функцию и связанные ресурсы в Azure с указанными параметрами и развернуть код проекта функции.

7. Во время публикации может появиться диалоговое окно с предложением обновить версию функций Azure. Нажмите **Да**:

    ![Снимок экрана: диалоговое окно "Обновление версии функций в Azure" с предложением обновить параметры приложения Azure согласно параметрам версий локальных Функций.](media/azure-functions-image12.png)

> [!CAUTION]
> В версии 7.6 Visual Studio для Mac есть ошибка, из-за которой `FUNCTIONS_EXTENSION_VERSION` ошибочно получает значение beta, означающее, что ваша функция может не работать. Чтобы решить эту проблему, перейдите в раздел [Параметры приложения-функции](#function-app-settings) и измените значение `FUNCTIONS_EXTENSION_VERSION` с –1 на beta.

## <a name="function-app-settings"></a>Параметры приложения-функции

Все параметры, добавленные в файл local.settings.json, необходимо также добавить к приложению-функции в Azure. При публикации проекта эти параметры автоматически не передаются.

Чтобы открыть параметры приложения, зайдите на портал Azure по адресу [https://ms.portal.azure.com/](https://ms.portal.azure.com/). В разделе **Приложения-функции** выберите **Приложения-функции** и выделите имя своей функции:

![меню Функций Azure](media/azure-functions-image9.png)

На вкладке **Обзор** выберите **Дополнительные параметры** в разделе **Настроенные компоненты**.

![Над вкладкой функции Azure](media/azure-functions-image10.png)

Здесь можно настроить параметры для приложения-функции, добавить новые или изменить уже существующие:

![область параметров приложения портала Azure](media/azure-functions-image11.png)

В число важных параметров, настройка которых может потребоваться, входит `FUNCTIONS_EXTENSION_VERSION`. При публикации из Visual Studio для Mac этому параметру должно быть присвоено значение **beta**.

## <a name="available-function-templates"></a>Доступные шаблоны функций

- **Триггер GitHub** — реагирует на события, происходящие в репозиториях GitHub. Дополнительные сведения см. в [статье о работе с GitHub в функциях Azure](/azure/azure-functions/functions-create-github-webhook-triggered-function)
  - Комментатор GitHub — функция, которая будет запускаться и добавлять комментарий при получении веб-перехватчика GitHub для проблемы или запроса на вытягивание.
  - Веб-перехватчик GitHub — функция, которая будет запускаться при получении веб-перехватчика GitHub.

- **HTTP** — запускает выполнение кода с помощью HTTP-запроса. Существует явные шаблоны для следующих триггеров HTTP:
  - Триггер HTTP
  - Http GET CRUD
  - Http POST CRUD
  - Триггер HTTP с параметрами

- **Таймер** — выполняет очистку или другие пакетные задачи по предопределенному расписанию. Этот шаблон имеет два поля: имя и расписание, которое представляет собой выражение CRON из шести полей. Дополнительные сведения см. в [статье о работе с таймерами в функциях Azure](/azure/azure-functions/functions-create-scheduled-function)

- **Триггер очереди** — функция, которая будет отвечать на сообщения, помещаемые в очередь хранилища Azure. Помимо имени функции в шаблоне необходимо указать **Путь** (имя очереди, из которого будут считываться сообщения) и учетную запись хранения в параметре **Подключение** (имя параметра приложения, содержащего строку подключения вашей учетной записи хранения). Дополнительные сведения см. в [статье о работе с очередями хранилищ в функциях Azure](/azure/azure-functions/functions-create-storage-queue-triggered-function).

- **Триггер BLOB** — обрабатывает BLOB-объекты хранилища Azure при их добавлении к контейнеру. Помимо имени функции в этом шаблоне также необходимо указать путь и параметры подключения. В параметре "Путь" указывается путь в учетной записи хранения, который будет отслеживаться триггером. В качестве учетной записи подключения указывается имя параметра приложения, содержащего строку подключения вашей учетной записи хранения. Дополнительные сведения см. в [статье о работе с хранилищами BLOB-объектов в функциях Azure](/azure/azure-functions/functions-create-storage-blob-triggered-function).

- **Универсальный веб-перехватчик** — это простая функция, которая будет выполняться каждый раз при получении запроса от любых служб, поддерживающих веб-перехватчики. Дополнительные сведения см. в [статье о работе с универсальными веб-перехватчиками в функциях Azure](/azure/azure-functions/functions-create-generic-webhook-triggered-function).

- **Оркестрация устойчивых функций** — устойчивые функции позволяют писать функции с отслеживанием состояния в средах без сервера. Расширение управляет состоянием, создает контрольные точки и перезагружается. Дополнительные сведения см. в руководстве по [устойчивым функциям](/azure/azure-functions/durable-functions-overview).

- **Изменение размеров изображения** — функция, которая создает изображения измененного размера при каждом добавлении BLOB-объекта в контейнер. В шаблоне необходимо указать путь и строку подключения для триггера, вывод для маленьких изображений и вывод для изображений среднего размера.

- **Токен SAS** — функция, которая создает токен SAS для указанного контейнера и имени BLOB-объекта службы хранилища Azure. Помимо имени функции в этом шаблоне также необходимо указать путь и параметры подключения. В параметре "Путь" указывается путь в учетной записи хранения, который будет отслеживаться триггером. В качестве учетной записи подключения указывается имя параметра приложения, содержащего строку подключения вашей учетной записи хранения. Также необходимо задать **права доступа**. Уровень авторизации определяет, требуется ли функции ключ API, и какой ключ необходимо использовать. Функция использует ключ функции, администратор использует ключ доступа к учетной записи. Дополнительные сведения см. в примере [Функции Azure C# для создания токенов SAS](https://github.com/Azure-Samples/functions-dotnet-sas-token/).
